//>>built
define("control/customer/options/clippings/add_order",["dijit","dojo","dojox","dojo/require!ttl/BaseWidget,prcommon/search/Countries,prcommon/languages/Languages,prcommon/clippings/clippingstype,prmax/customer/clients/add,prcommon/search/std_search"],function(_1,_2,_3){_2.provide("prmax.iadmin.clippings.add_order");_2.require("ttl.BaseWidget");_2.require("prcommon.search.Countries");_2.require("prcommon.languages.Languages");_2.require("prcommon.clippings.clippingstype");_2.require("prmax.customer.clients.add");_2.require("prcommon.search.std_search");_2.declare("prmax.iadmin.clippings.add_order",[ttl.BaseWidget],{widgetsInTemplate:true,templatePath:_2.moduleUrl("prmax.iadmin.clippings","templates/add_order.html"),constructor:function(){this._add_call_back=_2.hitch(this,this._add_call);this._Client_Add_Call_Back=_2.hitch(this,this._Client_Add_Call);this._clippings_orders_model=new _3.data.JsonRestStore({target:"/iadmin/clippings/list_clippingsprices",idAttribute:"clippingspriceid"});this._clients=new _3.data.JsonRestStore({target:"/iadmin/clippings/list_clients",idAttribute:"clientid"});this._issues=new _3.data.JsonRestStore({target:"/iadmin/clippings/list_issues",idAttribute:"issueid"});this._pricecodes=new _2.data.ItemFileReadStore({url:"/common/lookups?searchtype=pricecodes&type=clippings"});this._sources=new _2.data.ItemFileReadStore({url:"/common/lookups?searchtype=clippingsource"});},postCreate:function(){this.clippingspriceid.set("store",this._clippings_orders_model);this.clientid.set("store",this._clients);this.issueid.set("store",this._issues);this.pricecodeid.set("store",this._pricecodes);this.clippingsourceid.set("store",this._sources);this._clear();this.inherited(arguments);},load:function(_4,_5,_6){this._dialog=_4;this.end_date=_6;this.icustomerid.set("value",_5);this._icustomerid=_5;this.clientid.set("query",{icustomerid:_5});this.issueid.set("query",{icustomerid:_5});this._dialog.resize({w:1010,h:700});},_close:function(){this._dialog.hide();},_add_call:function(_7){if(_7.success=="OK"){this._dialog.hide();this._clear();_2.publish("/clippings/order/add",[_7.data]);}else{alert("Problem Adding Clippings Order");}this.addbtn.cancel();},_clear:function(){this.addbtn.cancel();this.startdate.set("value",new Date());this.enddate.set("value",this.end_date);this.keywords.set("value","");this.rss_feed.set("value","");this.purchaseorder.set("value","");this.description.set("value","");this.message.set("value","");this.clientid.set("value",null);this.issueid.set("value",null);this.clippingsourceid.set("value",6);},_add:function(){if(this.clippingsourceid!=1&&this.clippingsourceid!=7&&this.clippingstypes.value==""){alert("Please Enter Clippings Type");this.addbtn.cancel();return false;}if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");this.addbtn.cancel();return false;}var _8=this.form.get("value");_8["startdate"]=ttl.utilities.toJsonDate(this.startdate.get("value"));_8["enddate"]=ttl.utilities.toJsonDate(this.enddate.get("value"));_2.xhrPost(ttl.utilities.makeParams({load:_2.hitch(this,this._add_call_back),url:"/iadmin/clippings/add_order",content:_8}));},clear:function(){this._clear();},_client_change:function(){var _9=this.clientid.get("value");if(_9==undefined){_9=-1;}this.issueid.set("query",{icustomerid:this.icustomerid.get("value"),clientid:_9});this.issueid.set("value",null);},_change_source:function(){var _a=this.clippingsourceid.get("value");if(_a==1||_a==7){_2.addClass(this.clippingstypes_node,"prmaxhidden");if(this._dialog){this._dialog.resize({w:1010,h:525});}}else{try{this._dialog.resize({w:1010,h:700});}catch(e){}_2.removeClass(this.clippingstypes_node,"prmaxhidden");}},_Client_Add_Call:function(_b,_c){this.clientid.set("value",_c.clientid);this.client_add_dialog.hide();},_New_Client:function(){this.client_add_ctrl.Load(-1,this._Client_Add_Call_Back);this.client_add_ctrl.set("icustomerid",this._icustomerid);this.client_add_dialog.show();}});});