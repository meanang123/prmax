//>>built
define("control/customer/options/clippings/update_order",["dijit","dojo","dojox","dojo/require!ttl/BaseWidget,prcommon/search/Countries,prcommon/languages/Languages,prcommon/clippings/clippingstype,prcommon/search/std_search"],function(_1,_2,_3){_2.provide("prmax.iadmin.clippings.update_order");_2.require("ttl.BaseWidget");_2.require("prcommon.search.Countries");_2.require("prcommon.languages.Languages");_2.require("prcommon.clippings.clippingstype");_2.require("prcommon.search.std_search");_2.declare("prmax.iadmin.clippings.update_order",[ttl.BaseWidget],{widgetsInTemplate:true,templatePath:_2.moduleUrl("prmax.iadmin.clippings","templates/update_order.html"),constructor:function(){this._update_call_back=_2.hitch(this,this._update_call);this._load_call_back=_2.hitch(this,this._load_call);this._resend_conformation_call_back=_2.hitch(this,this._resend_conformation_call);this._cancel_call_back=_2.hitch(this,this._cancel_call);this._reactivate_call_back=_2.hitch(this,this._reactivate_call);this._Client_Add_Call_Back=_2.hitch(this,this._Client_Add_Call);this._clippings_orders_model=new _3.data.JsonRestStore({target:"/iadmin/clippings/list_clippingsprices",idAttribute:"clippingspriceid"});this._clients=new _3.data.JsonRestStore({target:"/iadmin/clippings/list_clients",idAttribute:"clientid"});this._issues=new _3.data.JsonRestStore({target:"/iadmin/clippings/list_issues",idAttribute:"issueid"});this._pricecodes=new _2.data.ItemFileReadStore({url:"/common/lookups?searchtype=pricecodes&type=clippings"});this._sources=new _2.data.ItemFileReadStore({url:"/common/lookups?searchtype=clippingsource"});this._change_client_enabled=true;},postCreate:function(){this.clippingspriceid.set("store",this._clippings_orders_model);this.clientid.set("store",this._clients);this.issueid.set("store",this._issues);this.pricecodeid.set("store",this._pricecodes);this.clippingsourceid.set("store",this._sources);this._clear();this.inherited(arguments);},load:function(_4,_5,_6,_7){this._dialog=_5;this.licence_expire=_7;this.clippingsorderid.set("value",_4);this.icustomerid.set("value",_6);this.clientid.set("query",{icustomerid:_6});_2.xhrPost(ttl.utilities.makeParams({load:_2.hitch(this,this._load_call_back),url:"/iadmin/clippings/get_order",content:{clippingsorderid:_4}}));},_load_call:function(_8){if(_8.success=="OK"){with(_8){this.updbtn.cancel();this.resendsupemail.set("checked",false);this.icustomerid.set("value",order.customerid);this.startdate.set("value",order.startdate);this.enddate.set("value",order.enddate);this.keywords.set("value",order.keywords);this.rss_feed.set("value",order.rss_feed);this.purchaseorder.set("value",order.purchaseorder);this.description.set("value",order.description);this.message.set("value","");this._change_client_enabled=false;this.clientid.set("value",order.defaultclientid);this.issueid.set("value",order.defaultissueid);this.clippingspriceid.set("value",order.clippingspriceid);this.supplierreference.set("value",order.supplierreference);this.pricecodeid.set("value",order.pricecodeid);this.email.set("value",order.email);this.clippingsourceid.set("value",order.clippingsourceid);this.countries.set("value",order.countries);this.languages.set("value",order.languages);this.clippingstypes.set("value",order.clippingstypes);if(this.clippingsourceid.get("value")==1||this.clippingsourceid.get("value")==7){_2.addClass(this.clippingstypes_node,"prmaxhidden");if(this._dialog){this._dialog.resize({w:1010,h:550});}}else{this._dialog.resize({w:1010,h:700});_2.removeClass(this.clippingstypes_node,"prmaxhidden");}if(order.clippingorderstatusid==2){_2.addClass(this.updbtn.domNode,"prmaxhidden");_2.addClass(this.resendbtn.domNode,"prmaxhidden");_2.addClass(this.cancelbtn.domNode,"prmaxhidden");_2.removeClass(this.reactivatebtn.domNode,"prmaxhidden");}else{_2.removeClass(this.updbtn.domNode,"prmaxhidden");_2.removeClass(this.resendbtn.domNode,"prmaxhidden");_2.removeClass(this.cancelbtn.domNode,"prmaxhidden");_2.addClass(this.reactivatebtn.domNode,"prmaxhidden");}}this._dialog.show();}},_close:function(){this._dialog.hide();},_update_call:function(_9){if(_9.success=="OK"){this._dialog.hide();_2.publish("/clippings/order/upd",[_9.data]);this._clear();}else{alert("Problem Updating Clippings Order");}this.updbtn.cancel();},_clear:function(){this.updbtn.cancel();this.resendbtn.cancel();this.startdate.set("value",new Date());this.enddate.set("value",_2.date.add(new Date(),"year",1));this.keywords.set("value","");this.rss_feed.set("value","");this.purchaseorder.set("value","");this.description.set("value","");this.message.set("value","");this._change_client_enabled=false;this.clientid.set("value",-1);this.issueid.set("value",-1);this._change_client_enabled=true;this.supplierreference.set("value","");this.resendsupemail.set("checked",false);this.clippingsourceid.set("value",1);},_update:function(){if(this.clippingsourceid!=1&&this.clippingsourceid!=7&&this.clippingstypes.value==""){alert("Please Enter Clippings Type");this.updbtn.cancel();return false;}if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");this.updbtn.cancel();return false;}var _a=this.form.get("value");_a["startdate"]=ttl.utilities.toJsonDate(this.startdate.get("value"));_a["enddate"]=ttl.utilities.toJsonDate(this.enddate.get("value"));_2.xhrPost(ttl.utilities.makeParams({load:_2.hitch(this,this._update_call_back),url:"/iadmin/clippings/update_order",content:_a}));},_client_change:function(){var _b=this.clientid.get("value");if(_b==undefined){_b=-1;}this.issueid.set("query",{icustomerid:this.icustomerid.get("value"),clientid:_b});if(this._change_client_enabled==true){this.issueid.set("value",null);}this._change_client_enabled=true;},_resend_conformation_call:function(_c){if(_c.success=="OK"){_2.publish("/clippings/order/upd",[_c.data]);alert("Sent");}else{alert("Problem");}this.resendbtn.cancel();},_resend_conformation:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");this.resendbtn.cancel();return false;}if(confirm("Update & Resend Order Conformation")){var _d=this.form.get("value");_d["startdate"]=ttl.utilities.toJsonDate(this.startdate.get("value"));_d["enddate"]=ttl.utilities.toJsonDate(this.enddate.get("value"));_2.xhrPost(ttl.utilities.makeParams({load:_2.hitch(this,this._resend_conformation_call_back),url:"/iadmin/clippings/resend_conformation",content:_d}));}},_cancel_call:function(_e){if(_e.success=="OK"){alert("Clipping cancelled");this._dialog.hide();}else{alert("Problem");}},_cancel:function(){this.enddate.set("value",new Date());var _f=this.form.get("value");_f["enddate"]=ttl.utilities.toJsonDate(this.enddate.get("value"));_f["startdate"]=ttl.utilities.toJsonDate(this.startdate.get("value"));_2.xhrPost(ttl.utilities.makeParams({load:_2.hitch(this,this._cancel_call_back),url:"/iadmin/clippings/cancel_order",content:_f}));},_reactivate_call:function(_10){if(_10.success=="OK"){alert("Clipping reactivated");this._dialog.hide();}else{alert("Problem");}},_reactivate:function(){this.enddate.set("value",this.licence_expire);var _11=this.form.get("value");_11["enddate"]=ttl.utilities.toJsonDate(this.enddate.get("value"));_11["startdate"]=ttl.utilities.toJsonDate(this.startdate.get("value"));_2.xhrPost(ttl.utilities.makeParams({load:_2.hitch(this,this._reactivate_call_back),url:"/iadmin/clippings/reactivate_order",content:_11}));},_Client_Add_Call:function(_12,_13){this._change_client_enabled==true;this.clientid.set("value",_13.clientid);this.client_add_dialog.hide();},_New_Client:function(){this.client_add_ctrl.Load(-1,this._Client_Add_Call_Back);this.client_add_dialog.show();}});});