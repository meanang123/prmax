//>>built
require({cache:{"url:prcommon2/clippings/templates/filter.html":"<div>\r\n\t<div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props='style:\"overflow:hidden;background-color:black;color:white\"' class=\"std_menu_view\" >\r\n\t\t<button data-dojo-attach-event=\"onClick:_show_extended\" data-dojo-attach-point=\"showextbtn\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='style:\"float:left;margin:0px;padding:0px\",type:\"button\",label:\"Filter\",iconClass:\"fa fa-filter fa-3x\"'></button>\r\n\t\t<p style=\"border:1px solid green;float:left\" data-dojo-attach-point=\"filter_details\">No Filter Selected</p>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"filter_dlg\" data-dojo-type=\"dijit/Dialog\" title='<i class=\"fa fa-filter\" aria-hidden=\"true\"></i> Filter' data-dojo-props='style:\"width:450px;height:320px\"'>\r\n\t\t<span class=\"common_prmax_layout\">\r\n\t\t\t<label data-dojo-attach-point=\"client_label_1\" class=\"label_1\"></label><select data-dojo-props='placeHolder:\"No Selection\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\",style:\"width:8em\"' data-dojo-type=\"dijit/form/FilteringSelect\" data-dojo-attach-point=\"clientid\" data-dojo-attach-event=\"onChange:_change_filter\"></select></br>\r\n\t\t\t<label data-dojo-attach-point=\"issue_label_1\" class=\"label_1\"></label><select data-dojo-props='placeHolder:\"No Selection\",name:\"issueid\",autoComplete:true,searchAttr:\"name\",required:false,invalidMessage:\"Select\",labelType:\"html\",style:\"width:8em\"' data-dojo-type=\"dijit/form/FilteringSelect\" data-dojo-attach-point=\"issueid\"></select></br>\r\n\t\t\t<label class=\"label_1\">Dates</label><div data-dojo-type=\"prcommon2/date/daterange\" data-dojo-attach-point=\"date_search\"></div></br>\r\n\t\t\t<label class=\"label_1\">Tone</label><div style=\"position:relative;top:2px;height:30px\"><div data-dojo-type=\"prcommon2/clippings/selecttone\" data-dojo-attach-point=\"tone_ctrl\"></div></div><br/>\r\n\t\t\t<label class=\"label_1\">Text</label><input data-dojo-type=\"dijit/form/TextBox\" data-dojo-attach-point=\"textid\" data-dojo-props='placeHolder:\"Search text\",required:false,name:\"textid\",trim:true,type:\"text\",style:\"width:20em\"'><br/>\r\n\t\t\t<label data-dojo-attach-point=\"clippingstype_label\" class=\"label_1 prmaxhidden\">Types</label><select data-dojo-props='name:\"clippingstypeid\",autoComplete:true,labelType:\"html\",style:\"width:10em;color:black\",value:-1, class:\"prmaxhidden\"' data-dojo-type=\"dijit/form/Select\" data-dojo-attach-point=\"clippingstypeid\" data-dojo-attach-event=\"onChange:_swap_view\"></select><br data-dojo-attach-point=\"clippingstype_label_2\" class=\"prmaxhidden\"/>\r\n\t\t\t<label class=\"label_1\">Release</label><select data-dojo-props='placeHolder:\"No Selection\",name:\"emailtemplateid\",autoComplete:true,searchAttr:\"emailtemplatename\",labelType:\"html\"' data-dojo-type=\"dijit/form/FilteringSelect\" data-dojo-attach-point=\"emailtemplateid\" ></select><br/>\r\n\t\t\t<label data-dojo-attach-point=\"statement_view_1\" class=\"label_1 prmaxhidden\">Statement</label><select data-dojo-props='placeHolder:\"No Selection\",name:\"statementid\",autoComplete:true,searchAttr:\"statementdescription\",labelType:\"html\",\"class\":\"prmaxhidden\"' data-dojo-type=\"dijit/form/FilteringSelect\" data-dojo-attach-point=\"statementid\" ></select><br data-dojo-attach-point=\"statement_view_2\" class=\"prmaxhidden\"/>\r\n\t\t\t<button data-dojo-attach-point=\"clearbtn\" data-dojo-attach-event=\"onClick:_clear\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='style:\"float:left;padding:0px;margin:0px\",type:\"button\",label:\"Clear\",\"class\":\"dijitReset\"'></button>\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_update\" data-dojo-attach-point=\"updbtn\" data-dojo-type=\"dojox/form/BusyButton\" data-dojo-props='style:\"float:right\",type:\"button\",busyLabel:\"Please Wait Refreshing ...\",label:\"Refresh\"'></button>\r\n\t\t\t<br/><br/><br/><br/><br/>\r\n\t\t</span>\r\n\t\t<br/><br/><br/><br/>\r\n\t</div>\r\n</div>\r\n"}});define("prcommon2/clippings/filter",["dojo/_base/declare","ttl/BaseWidgetAMD","dojo/text!../clippings/templates/filter.html","dijit/layout/ContentPane","dojox/data/JsonRestStore","dojo/topic","dojo/dom-attr","dojo/_base/lang","dojo/dom-class","dojo/data/ItemFileReadStore","dijit/form/Select","dojox/form/BusyButton","dijit/form/CheckBox","dijit/form/FilteringSelect","prcommon2/date/daterange","prcommon2/clippings/selecttone"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _1("prcommon2.clippings.filter",[_2,_4],{templateString:_3,gutters:false,showextended:false,constructor:function(){this.start_settings();_6.subscribe("/clipping/refresh_filters",_8.hitch(this,this._refresh_filters));this.dirty_filters=false;this._update_event=null;this._close_event=_8.hitch(this,this._close);},postCreate:function(){this.inherited(arguments);this.date_search.set_range_to_last_30_days();this.clientid.set("store",PRCOMMON.data.clients);this.issueid.set("store",PRCOMMON.data.issues);this.emailtemplateid.set("store",PRCOMMON.data.email_templates);this.emailtemplateid.set("query",{restrict:"sent",include_no_select:1});this.statementid.set("store",PRCOMMON.data.statements);this.clippingstypeid.set("store",PRCOMMON.data._clippingtypes);this.clippingstypeid.set("value",-1);_7.set(this.issue_label_1,"innerHTML",PRMAX.utils.settings.issue_description);_7.set(this.client_label_1,"innerHTML",PRMAX.utils.settings.client_name);if(this.showextended==true){_9.remove(this.clippingstype_label,"prmaxhidden");_9.remove(this.clippingstype_label_2,"prmaxhidden");_9.remove(this.clippingstypeid.domNode,"prmaxhidden");}if(PRMAX.utils.settings.crm==true){_9.remove(this.statement_view_1,"prmaxhidden");_9.remove(this.statement_view_2,"prmaxhidden");_9.remove(this.statementid.domNode,"prmaxhidden");}this._set_filter_text();},_setUpdateeventAttr:function(_b){this._update_event=_b;},_update:function(){if(this.tone_ctrl.isValid()==false){alert(this.tone_ctrl.invalidMessage);this.updbtn.cancel();return;}setTimeout(this._close_event,300);this._set_filter_text();this.dirty_filters=true;if(this._update_event!=null){this._update_event();}this.updbtn.cancel();},_close:function(){this.filter_dlg.hide();},_change_filter:function(){var _c=this.clientid.get("value");if(_c==undefined){_c=-1;}this.issueid.set("query",{clientid:_c});this.issueid.set("value",null);},_getFilterAttr:function(){return this._get_filters(false);},_getFilterlimitedAttr:function(){return this._get_filters(true);},_setNewsettingsAttr:function(_d){this.clientid.set("value",_d.clientid);this.issueid.set("value",_d.issueid);this.clippingstypeid.set("value",_d.clippingstypeid);this.tone_ctrl.set("value",_d.tones);this.emailtemplateid.set("value",_d.emailtemplateid);this.statementid.set("value",_d.statementid);this.textid.set("value",_d.textid);if(_d.daterestriction){this.date_search.from_date_box.set("value",_d.daterestriction);this.date_search.to_date_box.set("value",_d.daterestriction);}else{this.date_search.set("intvalue",_d.int_drange);}},_get_filters:function(_e,_f){var _10={daterange:this.date_search.get("value"),drange:this.date_search.get("value"),tones:this.tone_ctrl.get("value"),};var _11=this.clientid.get("value");if(_11==""){_11="-1";}if(_e==true&&_11!="-1"){_10.clientid=_11;}else{if(_e==false){_10.clientid=_11;}}var _12=this.issueid.get("value");if(_12==""){_12="-1";}if(_e==true&&_12!="-1"){_10.issueid=_12;}else{if(_e==false){_10.issueid=_12;}}var _13=this.emailtemplateid.get("value");if(_13==""){_13="-1";}if(_e==true&&_13!="-1"){_10.emailtemplateid=_13;}else{if(_e==false){_10.emailtemplateid=_13;}}var _14=this.statementid.get("value");if(_14==""){_14="-1";}if(_e==true&&_14!="-1"){_10.statementid=_14;}else{if(_e==false){_10.statementid=_14;}}if(this.showextended==true){var _15=this.clippingstypeid.get("value");if(_e==true&&_15!="-1"){_10.clippingstypeid=_15;}else{if(_e==false){_10.clippingstypeid=_15;}}}if(_f==true){_10.int_drange=this.date_search.get_physical_values();}if(_e==true&&this.textid.get("value").length>0){_10.textid=this.textid.get("value");}return _10;},update_complete:function(){this.updbtn.cancel();},_swap_view:function(){this.clippingstypeid.get("value");},_refresh_filters:function(_16){if(_16.dirty){this.clippingstypeid.set("value",_16.clippingstypeid);}},start_settings:function(){if(PRCOMMON.data.clients==undefined){PRCOMMON.data.clients=new _5({target:"/clients/rest_combo",idAttribute:"id"});}if(PRCOMMON.data.issues==undefined){PRCOMMON.data.issues=new _5({target:"/crm/issues/issues_list_rest",idAttribute:"id"});}if(PRCOMMON.data.email_templates==undefined){PRCOMMON.data.email_templates=new _5({target:"/emails/templates_list_rest",idAttribute:"id"});}if(PRCOMMON.data.statements==undefined){PRCOMMON.data.statements=new _5({target:"/statement/statement_combo_rest",idAttribute:"id"});}if(PRCOMMON.data._clippingtypes==undefined){PRCOMMON.data._clippingtypes=new _a({url:"/common/lookups?searchtype=clippingstypes&show_all=0"});}},_show_extended:function(){this.filter_dlg.show();},_set_filter_text:function(){this.filter_text="";this._add_to_filter(this.clientid,PRMAX.utils.settings.client_name);this._add_to_filter(this.issueid,PRMAX.utils.settings.issue_description);if(PRMAX.utils.settings.crm==true){this._add_to_filter(this.statementid,"Statement");}this._add_to_filter(this.emailtemplateid,"Release");if(this.showextended==true){this._add_to_filter(this.clippingstypeid,"Type");}this._add_to_filter(this.tone_ctrl,"Tones");this._add_to_filter_text(this.textid.get("value"),"Clip Text");this._add_to_filter_text(this.date_search.get("FilterText"),"Dates");if(this.filter_text.length==0){this.filter_text="No Filter Selected";}_7.set(this.filter_details,"innerHTML",this.filter_text);},_add_to_filter:function(_17,_18){var tmp=_17.get("displayedValue");if(tmp!="No Selection"&&tmp!=""&&tmp!="All Types"&&tmp!=null){if(this.filter_text.length>0){this.filter_text+=" ; ";}this.filter_text+=this._get_caption_formatted(_18)+tmp;}},_add_to_filter_text:function(_19,_1a){if(_19!=""){if(this.filter_text.length>0){this.filter_text+=" ; ";}this.filter_text+=this._get_caption_formatted(_1a)+_19;}},_get_caption_formatted:function(_1b){return "<label style='font-weight:900'>"+_1b+"</label>"+" : ";},_clear:function(){this.clientid.set("value",null);this.issueid.set("value",null);this.date_search.clear();this.tone_ctrl.clear();this.textid.set("value","");this.clippingstypeid.set("value",-1);this.emailtemplateid.set("value",null);this.statementid.set("value",null);}});});