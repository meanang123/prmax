//>>built
require({cache:{"url:prcommon2/clippings/templates/detailedviewer.html":"<div>\r\n\t<div data-dojo-type=\"prcommon2/clippings/filter\" data-dojo-attach-point=\"filter_view\" data-dojo-props='region:\"top\", style:\"height:50px;background-color:black;width:100%;overflow:hidden\",showextended:true'></div>\r\n\t<div data-dojo-props='region:\"left\",splitter:true,style:\"width:50%;height:100%\"' data-dojo-attach-point=\"clippings_grid_view\" data-dojo-type=\"dijit/layout/ContentPane\"></div>\r\n\t<div data-dojo-type=\"dijit/layout/StackContainer\" data-dojo-props='region:\"center\",splitter:true,' data-dojo-attach-point=\"clippings_view_ctrl\">\r\n\t\t<div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-attach-point=\"blank_view\" data-dojo-props='style:\"width:100%;height:100%\", \"class\":\"bordered\"'></div>\r\n\t\t<div data-dojo-attach-point=\"clippings_view\" data-dojo-type=\"dijit/layout/TabContainer\" data-dojo-props='style:\"width:100%;height:100%\"' >\r\n\t\t\t<div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-attach-point=\"clipping_view\" data-dojo-props='iconClass:\"fa fa-info\",title:\"Clipping\",style:\"width:100%;height:100%\"'></div>\r\n\t\t\t<div data-dojo-type=\"prcommon2/clippings/analysis/edit\" data-dojo-attach-point=\"clipping_analysis_view\" data-dojo-props='iconClass:\"fa fa-eye\",title:\"Analysis\",style:\"width:100%;height:100%\"'></div>\r\n\t\t\t<div data-dojo-type=\"prcommon2/clippings/edit\" data-dojo-attach-point=\"clipping_edit_view\" data-dojo-props='iconClass:\"fa fa-pencil-square-o\",title:\"Edit\",style:\"width:100%;height:100%\"'></div>\r\n\t\t\t<div data-dojo-type=\"prcommon2/clippings/edit_private\" data-dojo-attach-point=\"clipping_edit_private_view\" data-dojo-props='iconClass:\"fa fa-pencil-square-o\",title:\"Edit\",style:\"width:100%;height:100%\",mode:\"edit\"'></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n"}});define("prcommon2/clippings/detailedviewer",["dojo/_base/declare","ttl/BaseWidgetAMD","dojo/text!../clippings/templates/detailedviewer.html","dijit/layout/BorderContainer","dojo/dom-geometry","dojo/_base/lang","ttl/store/JsonRest","dojo/store/Observable","ttl/grid/Grid","ttl/utilities2","dojo/topic","dojo/request","dojo/_base/lang","dojo/dom-attr","dijit/Menu","dijit/MenuItem","dojo/dom-construct","dojox/data/JsonRestStore","dijit/layout/StackContainer","dijit/layout/ContentPane","dijit/layout/TabContainer","dijit/Toolbar","dijit/form/Button","prcommon2/clippings/edit","prcommon2/clippings/analysis/edit","dijit/form/ValidationTextBox","dijit/form/DateTextBox","dijit/form/NumberTextBox","dijit/form/CurrencyTextBox","dijit/form/Textarea","dijit/form/RadioButton"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_6,_d,_e,_f,_10){return _1("prcommon2.clippings.detailedviewer",[_2,_4],{templateString:_3,basic_details_page:"/clippings/display_page?clippingid=${clippingid}",gutters:false,constructor:function(){this._clippings=new _8(new _7({target:"/clippings/list_clippings",idProperty:"clippingid"}));this._load_call_back=_6.hitch(this,this._load_call,"view");this._load2_call_back=_6.hitch(this,this._load_call,"edit");this._delete_call_back=_6.hitch(this,this._delete_call);this._selection_call_back=_6.hitch(this,this._selection_call);this._clear_selection_call_back=_6.hitch(this,this._clear_selection_call);this._std_menu=null;this._loaded=false;this.selected_clippings=[];this.userid=PRMAX.utils.settings.uid;_b.subscribe("/clipping/update",_6.hitch(this,this._update_event));_b.subscribe("/clipping/private_add",_6.hitch(this,this._private_add_event));_b.subscribe("/clipping/refresh_details",_6.hitch(this,this._section_view_event));_b.subscribe("/clipping/deleted",_6.hitch(this,this._clipping_delete_event));},postCreate:function(){this.inherited(arguments);var _11=[{label:" ",className:"grid-field-image-view",field:"selected",formatter:_a.check_cell},{label:" ",sortable:false,className:"grid-field-image-view",field:"menu",formatter:_a.format_row_icon,renderHeaderCell:function(_12){_12.title="Menu Options";return _10.create("div",{style:{height:"100%",width:"100%"},innerHTML:"<i class=\" fa fa-bars aria-hidden=\"true\"></i>"});}},{label:"T",className:"grid-field-image-view",field:"icon_name",formatter:_a.fonticon2},{label:"Date",className:"dgrid-column-status-small",field:"clip_source_date_display"},{label:"Title",className:"dgrid-column-title",field:"clip_title"},{label:"Outlet",className:"dgrid-column-companyname",field:"outletname"},{label:"Tone",className:"dgrid-column-status-small",field:"clippingstonedescription"},{label:"Client",className:"dgrid-column-status",field:"clientname"},{label:"Issue",className:"dgrid-column-status",field:"issuename"}];this.clippings_grid=new _9({columns:_11,selectionMode:"single",store:this._clippings,sort:[{attribute:"clip_source_date_display",descending:true}],query:{default_time_frame:1},minRowsPerPage:100,loadingMessage:"<i class='fa fa-spinner fa-spin fa-3x fa-fw'></i><p>Loading Data</p>",noDataMessage:"<span class='fa-stack fa-lg'><i class='fa fa-ban fa-3x fa-stack-2x text-danger'></i></span><p>No Results</p>"});this.clippings_grid_view.set("content",this.clippings_grid);this.clippings_grid.on(".dgrid-cell:click",_6.hitch(this,this._on_row_click));this.clippings_grid.on("dgrid-refresh-complete",_6.hitch(this,this._first_clipping_call));this.filter_view.set("Updateevent",_6.hitch(this,this._refresh_details_event));this.inherited(arguments);},_first_clipping_call:function(_13){if(this._loaded==true){return;}if(_13.results.results&&_13.results.results[0].length>0){var row=this.clippings_grid.row(_13.results.results[0][0]);this.clippings_grid.select(row);this._load_clipping(_13.results.results[0][0]);this._row=row;}this._loaded=true;},_load_clipping:function(_14){_c.post("/clippings/get_for_edit",_a.make_params({data:{clippingid:_14.clippingid}})).then(this._load_call_back);},_selection_call:function(_15){if(_15.success=="OK"){this._clippings.put(this._row);if(this._row.selected==true){this.selected_clippings.push(this._row);}else{var _16=this.selected_clippings.indexOf(this._row);if(_16>-1){this.selected_clippings.splice(_16,1);}}}else{alert("Problem");}},_on_row_click:function(evt){var _17=this.clippings_grid.cell(evt);if(_17==null||_17.row==null){return;}this._row=_17.row.data;if(_17.column.field=="selected"){var _18=!this._row.selected;this._row.selected=!this._row.selected;var _19=PRMAX.utils.settings.uid;_c.post("/clippings/user_select",_a.make_params({data:{clippingid:this._row.clippingid,userid:_19,selected:_18}})).then(this._selection_call_back);}else{if(_17.column.field=="menu"){if(this._std_menu===null){this._std_menu=new _e();this._std_menu.addChild(new _f({label:"&nbsp;Delete",iconClass:"fa fa-trash fa-2x fa-fw",onClick:_6.hitch(this,this._delete_clipping)}));this._std_menu.addChild(new _f({label:"&nbsp;Edit",iconClass:"fa fa-pencil-square-o fa-2x fa-fw",onClick:_6.hitch(this,this._edit_clipping,"edit")}));this._std_menu.addChild(new _f({label:"&nbsp;View",iconClass:"fa fa-eye fa-2x fa-fw",onClick:_6.hitch(this,this._edit_clipping,"view")}));this._std_menu.addChild(new _f({label:"&nbsp;New",iconClass:"fa fa-plus fa-2x fa-fw",onClick:_6.hitch(this,this._new_clipping,"view")}));this._std_menu.startup();}if(this._std_menu!=null){this._std_menu._openMyself(evt);}}else{this._edit_clipping("view");}}},_new_clipping:function(){_b.publish("/clipping/change_view","newclipping");},_edit_clipping:function(_1a){response=_1a=="view"?this._load_call_back:this._load2_call_back;_c.post("/clippings/get_for_edit",_a.make_params({data:{clippingid:this._row.clippingid}})).then(response);},_delete_clipping:function(){if(confirm("Delete Clipping")){_c.post("/clippings/delete_clipping",_a.make_params({data:{clippingid:this._row.clippingid}})).then(this._delete_call_back);}},_delete_call:function(_1b){if(_1b.success=="OK"){_b.publish("/clipping/deleted",_1b.data);}else{alert("Problem");}},_load_call:function(_1c,_1d){this._show_clipping(_1d.data,_1c);this._clippingid=_1d.data.clippingid;},_load_add_call:function(_1e){this._show_clipping(_1e.data,"analysis");},_show_clipping:function(_1f,_20){this._set_options(_1f);this.clipping_analysis_view.load(_1f.clippingid);this.clipping_view.set("href",dojo.string.substitute(this.basic_details_page,{clippingid:_1f.clippingid}));if(_1f.clippingsourceid==2){this.clipping_edit_private_view.load(_1f);}else{this.clipping_edit_view.load(_1f);}this.clippings_view_ctrl.selectChild(this.clippings_view);switch(_20){case "analysis":this.clippings_view.selectChild(this.clipping_analysis_view);break;case "edit":if(_1f.clippingsourceid==2){this.clippings_view.selectChild(this.clipping_edit_private_view);}else{this.clippings_view.selectChild(this.clipping_edit_view);}break;default:this.clippings_view.selectChild(this.clipping_view);}},_set_options:function(_21){if(_21.clippingsourceid==2){this.clipping_edit_view.controlButton.domNode.style.display="none";this.clipping_edit_private_view.controlButton.domNode.style.display="";}else{this.clipping_edit_view.controlButton.domNode.style.display="";this.clipping_edit_private_view.controlButton.domNode.style.display="none";}},_update_event:function(_22){if(this._row){this._clippings.put(_22);this.clipping_analysis_view.load(_22.clippingid);this.clipping_view.set("href",dojo.string.substitute(this.basic_details_page,{clippingid:_22.clippingid}));}},_private_add_event:function(_23){this._clippings.add(_23);},refesh_view:function(){this._loaded=false;this.clippings_grid.set("query",this.filter_view.get("filterlimited"));this.clippings_view_ctrl.selectChild(this.blank_view);},_refresh_details_event:function(_24){this.filter_par=this.filter_view.get("filterlimited");this.extra_filter_par=_24;this._loaded=false;_c.post("/clippings/clear_user_selection",_a.make_params({data:{userid:this.userid}})).then(this._clear_selection_call_back);},_clear_selection_call:function(_25){if(_25.success=="OK"){this.clippings_grid.set("query",_6.mixin(this.filter_par,this.extra_filter_par));this.clippings_view_ctrl.selectChild(this.blank_view);}else{alert("Problem");}},_section_view_event:function(_26){this.filter_view.set("newsettings",_26);this._loaded=false;this.clippings_grid.set("query",this.filter_view.get("filterlimited"));this.clippings_view_ctrl.selectChild(this.blank_view);},_clipping_delete_event:function(_27){this._clippings.remove(_27);this.clippings_view_ctrl.selectChild(this.blank_view);}});});