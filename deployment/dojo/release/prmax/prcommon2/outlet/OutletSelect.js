//>>built
require({cache:{"url:prcommon2/outlet/templates/OutletSelect.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox dijitValidationContainer dijitInputField dijitTextBox\">\r\n\t<p style=\"float:left;position:relative;top:3px;white-space: nowrap;overflow:hidden;width:60%\" class=\"PlaceHolder dijitReset\" data-dojo-attach-point=\"display\"></p>\r\n\t<button data-dojo-attach-event=\"onClick:_select\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='type:\"button\",label:\"Select an outlet\",style:\"float:right;padding:0px;margin:0px\",iconClass:\"fa fa-search\",showLabel: false',\"class\",\"dijitReset\"></button>\r\n\t<button data-dojo-attach-point=\"clearbtn\" data-dojo-attach-event=\"onClick:_clear\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='style:\"float:right;padding:0px;margin:0px\",type:\"button\",label:\"Clear current selection\",\"class\":\"prmaxhidden dijitReset\",iconClass:\"fa fa-eraser\",showLabel: false'></button>\r\n\t<button data-dojo-attach-point=\"parentbtn\" data-dojo-attach-event=\"onClick:_load_parent_outlet\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='style:\"float:right;padding:0px;margin:0px\",type:\"button\",label:\"Load Parent Outlet\",\"class\":\"prmaxhidden dijitReset\",iconClass:\"fa fa-level-up fa-fw\",showLabel: false'></button>\r\n\t<div data-dojo-attach-point=\"select_dlg\" data-dojo-type=\"dijit/Dialog\" data-dojo-props='title:\"Select Publication\",style:\"height:590px;width:650px;overflow:hidden\"'>\r\n\t\t<div data-dojo-props='style:\"width:100%;height:250px\"' data-dojo-type=\"dijit/layout/ContentPane\">\r\n\t\t\t<div data-dojo-props='style:\"width:100%:height:250px\",\"class\":\"scrollpanel\",searchtypeid:6' data-dojo-attach-point=\"search_form_pane\" data-dojo-type=\"prcommon2/search/OutletSearch\"></div>\r\n\t\t</div>\r\n\t\t<div data-dojo-props='style:\"width:100%;height:250px;overflow:hidden\"' data-dojo-attach-point=\"select_search_view\" data-dojo-type=\"dijit/layout/ContentPane\"></div>\r\n\t\t<div data-dojo-props='style:\"width:100%;height:50px;overflow:hidden\"'  data-dojo-type=\"dijit/layout/ContentPane\">\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_close\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='type:\"button\",label:\"Close\"'></button>\r\n\t\t\t<button data-dojo-attach-point=\"searchbutton\" data-dojo-attach-event=\"onClick:_search\" data-dojo-type=\"dojox/form/BusyButton\" data-dojo-props='style:\"float:right;padding-right:20px\",\"class\":\"prmaxbutton\",busyLabel:\"Searching...\",label:\"Search\"' ></button>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"selectdetails_dlg\" data-dojo-type=\"dijit/Dialog\" data-dojo-props='title:\"Publication Details\",style:\"width:600px;height:520px\"'>\r\n\t\t<div data-dojo-attach-point=\"selectdetails_ctrl\" data-dojo-type=\"prcommon2/outlet/OutletSelectDetails\" data-dojo-props='style:\"width:590px;height:490px\"'></div>\r\n\t</div>\r\n\r\n</div>\r\n\r\n\r\n\r\n"}});define("prcommon2/outlet/OutletSelect",["dojo/_base/declare","ttl/BaseWidgetAMD","dojo/text!../outlet/templates/OutletSelect.html","dojo/json","dojo/request","ttl/utilities2","ttl/store/JsonRest","dojo/store/Observable","dojo/_base/lang","dojo/topic","ttl/grid/Grid","dojo/dom-attr","dojo/dom-class","dojo/_base/array","dijit/form/TextBox","dijit/form/Button","dijit/Dialog","dijit/layout/BorderContainer","prcommon2/search/OutletSearch","prcommon2/outlet/OutletSelectDetails","dijit/layout/ContentPane","dojox/form/BusyButton"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e){return _1("prcommon2.outlet.OutletSelect",[_2],{templateString:_3,name:"",value:"",mode:"outlet",searchtypeid:6,placeHolder:"Select Outlet",source_url:"/search/list_rest",constructor:function(){this._outletid=null;this._circulation=0;this._load_call_back=_9.hitch(this,this._load_call);this.show_parentbtn=false;},postCreate:function(){var _f=[{label:" ",className:"grid-field-image-view",field:"prmax_outletgroupid",formatter:_6.outlet_type},{label:"Name",className:"standard",field:"outletname"},{label:"Contact",className:"standard",field:"contactname"},{label:"Source",className:"dgrid-column-status-small",field:"sourcename"},{label:"Id",className:"dgrid-column-accountnbr",field:"outletid"},{label:" ",name:"edit",className:"dgrid-column-type-boolean",field:"outletid",formatter:_6.format_row_ctrl},];this.model=new _8(new _7({target:this.source_url,idProperty:"sessionsearchid"}));this.searchgrid=new _b({columns:_f,selectionMode:"single",store:this.model,sort:[{attribute:"outletname",descending:false}],query:_6.EMPTYGRID});this.select_search_view.set("content",this.searchgrid);this.searchgrid.on(".dgrid-cell:click",_9.hitch(this,this._on_cell_call));_d.add(this.clearbtn.domNode,"prmaxhidden");_d.add(this.parentbtn.domNode,"prmaxhidden");_c.set(this.display,"innerHTML",this.placeHolder);this.inherited(arguments);this.selectdetails_ctrl.set("dialog",_9.hitch(this,this._show_details_function));},_show_details_function:function(_10){if(_10=="show"){this.selectdetails_dlg.show();}else{this.selectdetails_dlg.hide();}},_load_call:function(_11){if(_11.outlet){outletid=_11.outlet.outlet.outletid;sourcetypeid=_11.outlet.outlet.sourcetypeid;prmax_grouptypeid="";if(_11.outlet.outlet.outlettypeid==19){prmax_grouptypeid="freelance";}_a.publish("LoadParentOutlet",outletid,prmax_grouptypeid,sourcetypeid);}this.refresh();this.searchbutton.cancel();},_setValueAttr:function(_12){this._outletid=_12;this._set_view();},_setDisplayvalueAttr:function(_13){if(_13==""||_13==null){_c.set(this.display,"innerHTML",this.placeHolder);_d.add(this.display,"PlaceHolder");}else{_c.set(this.display,"innerHTML",_13);_d.remove(this.display,"PlaceHolder");_a.publish("/outlet/circulation",[this._circulation]);}},_setParentbtnvalueAttr:function(_14){if(_14){this.show_parentbtn=_14;}},_getValueAttr:function(){return this._outletid;},_clear:function(){this.clear();},_load_parent_outlet:function(){_5.post("/research/admin/outlets/research_outlet_edit_get",_6.make_params({data:{outletid:this._outletid}})).then(this._load_call_back);},_set_view:function(){if(this._outletid==null){_d.add(this.clearbtn.domNode,"prmaxhidden");_d.add(this.parentbtn.domNode,"prmaxhidden");_d.add(this.display,"PlaceHolder");}else{_d.remove(this.clearbtn.domNode,"prmaxhidden");_d.remove(this.display,"PlaceHolder");if(this.show_parentbtn){_d.remove(this.parentbtn.domNode,"prmaxhidden");}}},_select:function(){this.select_dlg.show();},clear:function(){this._outletid=null;_c.set(this.display,"innerHTML",this.placeHolder);this._set_view();},_close:function(){this.select_dlg.hide();},_get_form:function(){var _15=null;_e.every(this.search_form_pane.getChildren(),function(_16){if(_16.formid!=null){_15=_16;}});return _15;},_search:function(){var _17=this._get_form();_17.setExtendedMode(false);var _18=_17.get("value");_18["mode"]=1;_18["search_partial"]=2;_18["searchtypeid"]=this.searchtypeid;this.searchbutton.makeBusy();_5.post("/search/dosearch",_6.make_params({data:_18})).then(this._load_call_back);},refresh:function(){this.searchgrid.set("query",{searchtypeid:this.searchtypeid});},_clear_search:function(){var _19=this._get_form();_e.every(_19.getDescendants(),function(_1a){if(_1a.Clear!=null){_1a.Clear();}return true;});this.searchbutton.cancel();},_clear_search_results:function(){_5.post("/search/sessionclear",_6.make_params({data:{searchtypeid:this.searchtypeid}})).then(this._clear_all_call_back);},_search_update_event:function(_1b){this.refresh(_1b);},_on_cell_call:function(e){var _1c=this.searchgrid.cell(e);if(_1c.row==null||_1c.row==undefined){return;}this._row=_1c.row.data;this._outletid=this._row.outletid;this._circulation=this._row.circulation;if(_1c.column.id==5){this.selectdetails_dlg.startup();this.selectdetails_dlg.show();this.selectdetails_ctrl.load(this._outletid,this.mode);}else{_c.set(this.display,"innerHTML",this._row.outletname);this.select_dlg.hide();this._set_view();_a.publish("/outlet/circulation",[this._circulation]);}},});});