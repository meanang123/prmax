//>>built
require({cache:{"url:prcommon2/geographical/templates/GeographicalEdit.html":"<div class=\"dojogeographicalPane\" data-dojo-attach-point=\"containerNode\" >\r\n\t<form class=\"prmaxdefault\" data-dojo-attach-point=\"form\" data-dojo-type=\"dijit/form/Form\" onSubmit=\"return false\">\r\n\t<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t<tr><td >&nbsp;</td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" width=\"20%\">Name</td><td><input data-dojo-type=\"dijit/form/ValidationTextBox\"name=\"geographicalname\" data-dojo-attach-point=\"geographicalname\" data-dojo-props='trim:true,required:true,maxlength:85,style:\"width:98%\",type:\"text\"' ></td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" width=\"20%\">Type</td><td><select data-dojo-attach-point=\"geographicallookuptypeid\" data-dojo-type =\"dijit/form/FilteringSelect\" data-dojo-attach-event =\"onChange:_type_changed\" data-dojo-props='name:\"geographicallookuptypeid\",searchAttr:\"name\",labelType:\"html\",style:\"width:98%\"' /></td></tr>\r\n\t\t<tr><td >&nbsp;</td></tr>\r\n\t\t<tr><td class=\"prmaxrowtag\" colspan=\"2\" align=\"left\" >Parent</td></tr>\r\n\t\t<tr><td colspan=\"2\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t<tr ><td colspan=\"3\" ><span class=\"prmaxrowtag\">Select</span><input data-dojo-props='\"class\":\"prmaxfocus prmaxinput\",type:\"text\",style:\"width:200px;padding-bottom:3px\"' data-dojo-type=\"dijit/form/TextBox\" data-dojo-attach-point=\"geographical_list_select\" /></td></tr>\r\n\t\t<tr><td width=\"46%\"><select style=\"width:100%\" data-dojo-attach-point=\"geographical_list\" size=\"7\" class=\"lists\" multiple=\"multiple\" ></select></td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<button class=\"button_add_all\" style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"button_all\" disabled=\"true\" type=\"button\" data-dojo-attach-event=\"onClick:_geographical_select_all\" data-dojo-type=\"dijit/form/Button\"><div class=\"std_movement_button\">&gt;&gt;</div></button><br/>\r\n\t\t\t\t\t<button class=\"button_add_single\" style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"button_single\" disabled=\"true\" type=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:_geographical_select_single\"><div class=\"std_movement_button\">&gt;&nbsp;</div></button><br/>\r\n\t\t\t\t\t<button class=\"button_del_all\" style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"button_del_all\" disabled=\"true\" type=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:_geographical_remove_all\"><div class=\"std_movement_button\">&lt;&lt;</div></button><br/>\r\n\t\t\t\t\t<button class=\"button_del_single\" style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"button_del_single\" disabled=\"true\" type=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:_geographical_remove_single\"><div class=\"std_movement_button\">&lt;&nbsp;</div></button>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t<td  width=\"46%\"><select style=\"width:100%\" data-dojo-attach-point=\"geographical_select\" size=\"7\" class=\"lists\" multiple=\"multiple\" data-dojo-attach-event=\"onchange:_geographical_update_selection\"></select></td>\r\n\t\t</tr></table></td></tr>\r\n\t</table>\r\n\t<div data-dojo-attach-point=\"child_view\">\r\n\t\t<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t<tr><td class=\"prmaxrowtag\" colspan=\"2\" align=\"left\" >Children</td></tr>\r\n\t\t\t<tr><td colspan=\"2\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t<tr ><td colspan=\"3\" ><span class=\"prmaxrowtag\">Select</span><input class=\"prmaxfocus prmaxinput\" type=\"text\" style=\"width:200px;padding-bottom:3px\" data-dojo-type=\"dijit/form/TextBox\" data-dojo-attach-point=\"child_list_select\" /></td></tr>\r\n\t\t\t<tr><td width=\"46%\"><select style=\"width:100%\" data-dojo-attach-point=\"child_list\" size=\"7\" class=\"lists\" multiple=\"multiple\" ></select></td>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<button class=\"button_add_all\"  style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"child_btn_all\" disabled=\"true\" type=\"button\" data-dojo-attach-event=\"onClick:_child_select_all\" data-dojo-type=\"dijit/form/Button\"><div class=\"std_movement_button\">&gt;&gt;</div></button><br/>\r\n\t\t\t\t\t\t<button class=\"button_add_single\" style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"child_btn_single\" disabled=\"true\" type=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:_child_select_single\"><div class=\"std_movement_button\">&gt;&nbsp;</div></button><br/>\r\n\t\t\t\t\t\t<button class=\"button_del_all\" style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"child_btn_del_all\" disabled=\"true\" type=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:_child_remove_all\"><div class=\"std_movement_button\">&lt;&lt;</div></button><br/>\r\n\t\t\t\t\t\t<button class=\"button_del_single\" style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"child_btn_del_single\" disabled=\"true\" type=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:_child_remove_single\"><div class=\"std_movement_button\">&lt;&nbsp;</div></button>\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t<td  width=\"46%\"><select style=\"width:100%\" data-dojo-attach-point=\"child_select\" size=\"7\" class=\"lists\" multiple=\"multiple\" data-dojo-attach-event=\"onchange:_child_update_selection\"></select></td>\r\n\t\t\t</tr></table></td></tr>\r\n\t\t\t<tr><td >&nbsp;</td></tr>\r\n\t\t</table>\r\n\t</div>\r\n\t<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t<tr><td colspan=\"2\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t<td align=\"left\"><button  style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"transfer\" type=\"button\" data-dojo-attach-event=\"onClick:_transfere\" data-dojo-type=\"dijit/form/Button\" label=\"Show Transfer Coverage\"></button></td>\r\n\t\t<td><class=\"prmaxhidden\" button  style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"deletebtn\" type=\"button\" data-dojo-attach-event=\"onClick:_delete\" data-dojo-type=\"dijit/form/Button\" label=\"Delete\"></button></td>\r\n\t\t<td align=\"right\"><button  style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"save\" type=\"button\" data-dojo-attach-event=\"onClick:_save\" data-dojo-type=\"dijit/form/Button\" label=\"Save\"></button></td>\r\n\t\t</tr></table></tr></td>\r\n\t</table>\r\n\t</form>\r\n\t<div class=\"prmaxhidden\" data-dojo-attach-point=\"show_transfer\" style=\"padding-top:5px\">\r\n\t\t<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t<tr><td colspan=\"3\" class=\"prmaxrowdisplaytitle\">Move Coverage to a New Area</td></tr>\r\n\t\t\t<tr><td >&nbsp;</td></tr>\r\n\t\t\t<tr ><td colspan=\"3\" ><span class=\"prmaxrowtag\">Select</span><input class=\"prmaxfocus prmaxinput\" type=\"text\" style=\"width:200px;padding-bottom:3px\" data-dojo-type=\"dijit/form/TextBox\" data-dojo-attach-point=\"transfer_list_select\" /></td></tr>\r\n\t\t<tr><td width=\"46%\"><select style=\"width:100%\" data-dojo-attach-point=\"transfer_list\" size=\"7\" class=\"lists\" ></select></td>\r\n\t\t<tr><td >&nbsp;</td></tr>\r\n\t\t<tr><td align=\"left\"><button  style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"transfer_do\" disabled=\"disabled\" type=\"button\" data-dojo-attach-event=\"onClick:_transfere_do\" data-dojo-type=\"dijit/form/Button\" label=\"Do Transfer Coverage To\"></button></td>\r\n\t\t</tr></table></td></tr>\r\n\r\n </div>\r\n"}});define("prcommon2/geographical/GeographicalEdit",["dojo/_base/declare","ttl/BaseWidgetAMD","dojo/text!../geographical/templates/GeographicalEdit.html","dojo/request","ttl/utilities2","dojo/json","dojo/data/ItemFileReadStore","dojo/topic","dojo/dom-class","dojo/dom-style","dojo/_base/lang","dijit/form/TextBox","dijit/form/CheckBox","dijit/form/Button","dijit/form/ValidationTextBox","dijit/form/Form","prcommon2/interests/Interests"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){return _1("prcommon2.geographical.GeographicalEdit",[_2],{templateString:_3,constructor:function(){this.geographical_types=new _7({url:"/common/lookups?searchtype=geographicallookuptypes&typesonly=0"});this._collect_details_call_back=_b.hitch(this,this._collect_details_call);this._add_call_back=_b.hitch(this,this._add_call);this._update_call_back=_b.hitch(this,this._update_call);this._load_selection_call_back=_b.hitch(this,this._load_selection_call);this._load_child_selection_call_back=_b.hitch(this,this._load_child_selection_call);this._transfer_selection_call_back=_b.hitch(this,this._transfer_selection_call);this._delete_call_back=_b.hitch(this,this._delete_call);this._transfer_call_back=_b.hitch(this,this._transfer_call);this._geographicalid=-1;},postCreate:function(){this.geographicallookuptypeid.set("store",this.geographical_types);dojo.connect(this.geographical_list_select.domNode,"onkeyup",_b.hitch(this,this._geographical_select));dojo.connect(this.child_list_select.domNode,"onkeyup",_b.hitch(this,this._child_geog_select));dojo.connect(this.geographical_list,"onchange",_b.hitch(this,this._geographical_update_selection));dojo.connect(this.geographical_list,"ondblclick",_b.hitch(this,this._geographical_select_dbl));dojo.connect(this.geographical_select,"ondblclick",_b.hitch(this,this._geographical_select_delete_dbl));dojo.connect(this.geographical_select,"onchange",_b.hitch(this,this._geographical_update_selection));dojo.connect(this.child_list,"onchange",_b.hitch(this,this._child_update_selection));dojo.connect(this.child_list,"ondblclick",_b.hitch(this,this._child_select_dbl));dojo.connect(this.child_select,"ondblclick",_b.hitch(this,this._child_select_delete_dbl));dojo.connect(this.child_select,"onchange",_b.hitch(this,this._child_update_selection));dojo.connect(this.transfer_list_select.domNode,"onkeyup",_b.hitch(this,this._transfer_select));dojo.connect(this.transfer_list,"onchange",_b.hitch(this,this._transfer_selection_options));},_geographical_update_selection:function(){this._selection_options();},_child_update_selection:function(){this._child_selection_options();},_geographical_select_dbl:function(){this._geographical_select_single();this._selection_options();},_geographical_select_all:function(){for(var c=0;c<this.geographical_list.options.length;c++){var _c=this.geographical_list.options[c];var _d=true;for(var c1=0;c1<this.geographical_select.options.length;c1++){if(this.geographical_select.options[c1].value==_c.value){_d=false;break;}}if(_d){this.geographical_select.options[this.geographical_select.options.length]=new Option(_c.text,_c.value);}}this.geographical_list.options.length=0;this._geographical_update_selection();},_geographical_select_single:function(){for(var c=0;c<this.geographical_list.options.length;c++){var _e=this.geographical_list.options[c];if(_e.selected){_e.selected=false;var _f=true;for(var c1=0;c1<this.geographical_select.options.length;c1++){if(this.geographical_select.options[c1].value==_e.value){_f=false;break;}}if(_f){this.geographical_select.options[this.geographical_select.options.length]=new Option(_e.text,_e.value);}}}this._geographical_update_selection();},_geographical_remove_all:function(){this.geographical_select.options.length=0;this._geographical_update_selection();},_geographical_select_delete_dbl:function(_10){if(_10!=null&&_10.originalTarget!=null&&_10.originalTarget.index!=null){this.geographical_select.options[_10.originalTarget.index]=null;this._geographical_update_selection();}else{this._geographical_remove_single();}},_geographical_remove_single:function(){for(var c=0;c<this.geographical_select.options.length;c++){if(this.geographical_select.options[c].selected){this.geographical_select.options[c]=null;}}this._geographical_update_selection();},_load_selection_call:function(_11){if(this._transactionid==_11.transactionid){this._clear_selection_box();for(var i=0;i<_11.data.length;++i){var _12=_11.data[i];this.geographical_list.options[this.geographical_list.options.length]=new Option(_12[0],_12[1]);}this._selection_options();}},_load_child_selection_call:function(_13){if(this._transactionid_child==_13.transactionid){this._clear_child_selection_box();for(var i=0;i<_13.data.length;++i){var _14=_13.data[i];this.child_list.options[this.child_list.options.length]=new Option(_14[0],_14[1]);}this._child_selection_options();}},_geographical_select:function(){var _15=this.geographical_list_select.get("value");if(_15.length>0){this._transactionid=PRCOMMON.utils.uuid.createUUID();var fid=parseInt(this.geographicallookuptypeid.get("value"));if(fid==3){fid=6;}_4.post("/geographical/listbytype",_5.make_params({data:{word:_15,parentonly:1,filter:fid,transactionid:this._transactionid,cascade_region:1,extended_mode:true}})).then(this._load_selection_call_back);}else{this._clear_selection_box();this._selection_options();}},_child_geog_select:function(){var _16=this.child_list_select.get("value");if(_16.length>0){this._transactionid_child=PRCOMMON.utils.uuid.createUUID();var fid=parseInt(this.geographicallookuptypeid.get("value"))-1;if(fid==5){fid=3;}_4.post("/geographical/listbytype",_5.make_params({data:{word:_16,filter:fid,transactionid:this._transactionid_child,cascade_region:2,extended_mode:true}})).then(this._load_child_selection_call_back);}else{this._clear_child_selection_box();this._child_selection_options();}},_collect_details_call:function(_17){if(_17.success=="OK"){this._make_edit();this._geographicalid=_17.data.geographical.geographicalid;this.geographicalname.set("value",_17.data.geographical.geographicalname);this.geographicallookuptypeid.set("value",_17.data.geographical.geographicallookuptypeid);for(var i=0;i<_17.data.parents.length;++i){var _18=_17.data.parents[i];this.geographical_select.options[this.geographical_select.options.length]=new Option(_18.geographicalname,_18.parentgeographicalareaid);}for(var i=0;i<_17.data.children.length;++i){var _18=_17.data.children[i];this.child_select.options[this.child_select.options.length]=new Option(_18.geographicalname,_18.childgeographicalareaid);}this._type_changed();}else{alert("Problem getting Details");}},load:function(_19,_1a){this._clear();this._dialog=_1a;this._geographicalid=_19;if(this._geographicalid>0){_4.post("/geographical/getdetails",_5.make_params({data:{geographicalid:this._geographicalid}})).then(this._collect_details_call_back);}else{this._make_new();}},_transfere:function(){if(_9.contains(this.show_transfer,"prmaxhidden")){_9.remove(this.show_transfer,"prmaxhidden");}else{_9.add(this.show_transfer,"prmaxhidden");}},_delete_call:function(_1b){if(_1b.success=="OK"){_8.publish(PRCOMMON.Events.Geographical_Area_Delete,_1b.data);}else{alert("Problem Deleting area");}},_delete:function(){if(confirm("Delete Area")){_4.post("/geographical/delete_geographical",_5.make_params({data:{geographicalid:this._geographicalid}})).then(this._delete_call_back);}},_add_call:function(_1c){if(_1c.success=="OK"){_8.publish(PRCOMMON.Events.Geographical_Area_Add,_1c.data);alert("Area Added");this._dialog.hide();}else{if(_1c.success=="OK"){alert("Geographical Areas allready Exists");}else{if(_1c.success=="DU"){alert("Area Already Exists");}else{alert("Problem Adding Geographical Area");}}}},_update_call:function(_1d){if(_1d.success=="OK"){_8.publish(PRCOMMON.Events.Geographical_Area_Update,_1d.data.geographical);alert("Updating Geographical Area");}else{if(_1d.success=="DU"){alert("Area Already Exists");}else{alert("Problem Updating Geographical Area");}}},_save:function(){if(_5.form_validator(this.form)==false){alert("Not all required field filled in");throw "N";}var _1e=this.form.get("value");_1e["geographicalid"]=this._geographicalid;var _1f=Array();var _20=Array();for(var x=0;x<this.geographical_select.options.length;x++){_1f[x]=parseInt(this.geographical_select.options[x].value);}_1e["parents"]=dojo.toJson(_1f);for(var x=0;x<this.child_select.options.length;x++){_20[x]=parseInt(this.child_select.options[x].value);}_1e["children"]=dojo.toJson(_20);if(this._geographicalid==-1){_4.post("/geographical/add",_5.make_params({data:_1e})).then(this._add_call_back);}else{_4.post("/geographical/update",_5.make_params({data:_1e})).then(this._update_call_back);}},_clear:function(){this.geographicalname.set("value","");this.geographical_select.options.length=0;this.geographical_list.options.length=0;this.child_select.options.length=0;this.child_list.options.length=0;this.geographicallookuptypeid.set("value",1);this._clear_selection_box();this._selection_options();this._clear_child_selection_box();this._child_selection_options();this._clear_transfer_selection_box();this._transfer_selection_options();_9.add(this.show_transfer,"prmaxhidden");this.geographicalname.focus();},_make_new:function(){_a.set(this.transfer.domNode,"display","none");_a.set(this.deletebtn.domNode,"display","none");this.save.set("label","Add");},_make_edit:function(){_a.set(this.transfer.domNode,"display","");_a.set(this.deletebtn.domNode,"display","");this.save.set("label","Save");},_clear_selection_box:function(){this.geographical_list.options.length=0;},_clear_child_selection_box:function(){this.child_list.options.length=0;},_selection_options:function(){this.button_all.set("disabled",this.geographical_list.length?false:true);this.button_single.set("disabled",this.geographical_list.selectedIndex!=-1?false:true);this.button_del_all.set("disabled",this.geographical_select.length?false:true);this.button_del_single.set("disabled",this.geographical_select.selectedIndex!=-1?false:true);},_child_selection_options:function(){this.child_btn_all.set("disabled",this.child_list.length?false:true);this.child_btn_single.set("disabled",this.child_list.selectedIndex!=-1?false:true);this.child_btn_del_all.set("disabled",this.child_select.length?false:true);this.child_btn_del_single.set("disabled",this.child_select.selectedIndex!=-1?false:true);},_transfer_selection_call:function(_21){if(this._transactionid==_21.transactionid){this._clear_transfer_selection_box();for(var i=0;i<_21.data.length;++i){var _22=_21.data[i];this.transfer_list.options[this.transfer_list.options.length]=new Option(_22[0]+"("+_22[1]+")",_22[1]);}this._transfer_selection_options();}},_transfer_select:function(){var _23=this.transfer_list_select.get("value");if(_23.length>0){this._transactionid=PRCOMMON.utils.uuid.createUUID();_4.post("/geographical/listbytype",_5.make_params({data:{word:_23,filter:-1,transactionid:this._transactionid,extended_mode:true}})).then(this._transfer_selection_call_back);}else{this._clear_transfer_selection_box();this._transfer_selection_options();}},_clear_transfer_selection_box:function(){this.transfer_list.options.length=0;},_transfer_selection_options:function(){this.transfer_do.set("disabled",this.transfer_list.selectedIndex!=-1?false:true);},_transfer_call:function(_24){if(_24.success=="OK"){_8.publish(PRCOMMON.Events.Coverage_Moved);alert("Coverage Moved");}else{alert("Problem Moving Coverage");}},_transfere_do:function(){if(confirm("Move Coverage to "+this.transfer_list.options[this.transfer_list.selectedIndex].text+"?")){_4.post("/geographical/move_coverage",_5.make_params({data:{fromgeographicalid:this._geographicalid,togeographicalid:this.transfer_list.options[this.transfer_list.selectedIndex].value}})).then(this._transfer_call_back);}},_type_changed:function(){var v=this.geographicallookuptypeid.get("value");if(v==1){_9.add(this.child_view,"prmaxhidden");}else{_9.remove(this.child_view,"prmaxhidden");}},_child_select_all:function(){for(var c=0;c<this.child_list.options.length;c++){var _25=this.child_list.options[c];var _26=true;for(var c1=0;c1<this.child_select.options.length;c1++){if(this.child_select.options[c1].value==_25.value){_26=false;break;}}if(_26){this.child_select.options[this.child_select.options.length]=new Option(_25.text,_25.value);}}this.child_list.options.length=0;this._child_update_selection();},_child_select_single:function(){for(var c=0;c<this.child_list.options.length;c++){var _27=this.child_list.options[c];if(_27.selected){_27.selected=false;var _28=true;for(var c1=0;c1<this.child_select.options.length;c1++){if(this.child_select.options[c1].value==_27.value){_28=false;break;}}if(_28){this.child_select.options[this.child_select.options.length]=new Option(_27.text,_27.value);}}}this._child_update_selection();},_child_remove_all:function(){this.child_select.options.length=0;this._child_update_selection();},_child_select_dbl:function(){this._child_select_single();this._child_selection_options();},_child_select_delete_dbl:function(_29){if(_29!=null&&_29.originalTarget!=null&&_29.originalTarget.index!=null){this.child_select.options[_29.originalTarget.index]=null;this._child_update_selection();}else{this._child_remove_single();}},_child_remove_single:function(){for(var c=0;c<this.child_select.options.length;c++){if(this.child_select.options[c].selected){this.child_select.options[c]=null;}}this._child_update_selection();}});});