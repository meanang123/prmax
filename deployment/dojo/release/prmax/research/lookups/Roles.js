//>>built
require({cache:{"url:research/lookups/templates/Roles.html":"<div>\r\n\t<div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props='region:\"top\",style:\"width:100%;height:48px;padding:0px;margin:0px\"'>\r\n\t\t<div data-dojo-type=\"dijit/Toolbar\" data-dojo-props='style:\"height:99%;width:100%;padding:0px;margin:0px\"'>\r\n\t\t\t<div data-dojo-type=\"dijit/form/DropDownButton\"  data-dojo-props='iconClass:\"PRMaxCommonStdIcon PRMaxFilterIcon\",label:\"Filter\",showLabel:true'>\r\n\t\t\t\t<span>Filter By</span>\r\n\t\t\t\t<div data-dojo-type=\"dijit/TooltipDialog\" title=\"Enter Roles filter\" data-dojo-attach-event=\"execute: _execute\">\r\n\t\t\t\t\t<table>\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td>Text</td>\r\n\t\t\t\t\t\t\t<td><input data-dojo-type=\"dijit/form/TextBox\" data-dojo-attach-point=\"filter\" data-dojo-props='name:\"filter\",trim:\"true\",maxlength:45,type:\"text\"' ></td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td>Primary Only</td>\r\n\t\t\t\t\t\t\t<td><input data-dojo-type=\"dijit/form/CheckBox\" data-dojo-attach-point=\"visible_only\" data-dojo-props='name:\"visible\",type:\"checkbox\"' ></td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td align=\"left\"><button data-dojo-attach-event=\"onClick: _clear_filter\" data-dojo-type=\"dijit/form/Button\" type=\"button\" >Clear Filter by</button></td>\r\n\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-type=\"dijit/form/Button\" type=\"submit\" name=\"submit\">Filter by</button></td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-type=\"dijit/form/DropDownButton\" data-dojo-props='iconClass:\"PRMaxCommonStdIcon PRMaxAddIcon\",showLabel:true'>\r\n\t\t\t\t<span>New Role</span>\r\n\t\t\t\t<div data-dojo-type=\"dijit/TooltipDialog\" title=\"Enter New Role\" data-dojo-attach-event=\"execute: _execute_add\">\r\n\t\t\t\t\t<table>\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td>Role</td>\r\n\t\t\t\t\t\t\t<td><input data-dojo-props='trim:true,maxlength:45,type:\"text\",required:true,invalidMessage:\"Role Name Required\",name:\"rolename\"' data-dojo-type=\"dijit/form/ValidationTextBox\" data-dojo-attach-point=\"rolename\" ></td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t<tr><td align=\"right\" colspan=\"2\"><button data-dojo-type=\"dijit/form/Button\" type=\"submit\" name=\"submit\">Add Role</button></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props='region:\"center\"' data-dojo-attach-point=\"grid_view\"></div>\r\n\t<div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props='region:\"bottom\",style:\"height:50%;width:100%;overflow:auto;overflow-x:hidden\"'>\r\n\t\t<div class=\"prmaxhidden\" data-dojo-attach-point=\"detail_view\">\r\n\t\t\t<table style=\"width:100%;height:50px\">\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td><label >Primary Only</label><input data-dojo-type=\"dijit/form/CheckBox\" data-dojo-attach-point=\"visible_change\" type=\"checkbox\"  ></td>\r\n\t\t\t\t\t<td><button data-dojo-type=\"dijit/form/Button\" type=\"button\" data-dojo-attach-event=\"onClick:_set_primary\">Set Primary</button></td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t\t<div class=\"prmaxhidden\" data-dojo-attach-point=\"details_ext\">\r\n\t\t\t\t<form  data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"ext_form\" data-dojo-props='onsubmit:\"return false;\"'>\r\n\t\t\t\t\t<table width=\"100%\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\" border=\"0px\">\r\n\t\t\t\t\t\t<tr><td width=\"47%\"></td><td width=\"5%\"></td><td width=\"48%\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td colspan=\"3\">\r\n\t\t\t\t\t\t\t<table style=\"width:100%\" class=\"prmaxtable\" >\r\n\t\t\t\t\t\t\t\t<tr><td width=\"40%\" data-dojo-attach-point=\"master_type_text\"><span class=\"prmaxrowtag\">Select</span><input class=\"prmaxfocus prmaxinput\" type=\"text\" data-dojo-type=\"dijit/form/TextBox\" style=\"width:60%\" data-dojo-attach-point=\"role_list_select\" /><button data-dojo-type=\"dijit/form/Button\" type=\"button\" data-dojo-attach-event=\"onClick:_find_roles\" >Find</button> </td>\r\n\t\t\t\t\t\t\t</tr></table>\r\n\t\t\t\t\t\t</td></tr>\r\n\t\t\t\t\t\t<tr><td ><select style=\"width:100%\" data-dojo-attach-point=\"role_list\" size=\"7\" class=\"lists\" multiple=\"multiple\" data-dojo-attach-event=\"onchange:_selection_options,ondblclick:role_select_single\" ></select></td>\r\n\t\t\t\t\t\t\t<td >\r\n\t\t\t\t\t\t\t\t<button class=\"button_add_single\" style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"button_single\" disabled=\"true\" type=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:role_select_single\">&gt;&nbsp;</button><br/>\r\n\t\t\t\t\t\t\t\t<button class=\"button_del_all\" style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"button_del_all\" disabled=\"true\" type=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:role_remove_all\">&lt;&lt;</button><br/>\r\n\t\t\t\t\t\t\t\t<button class=\"button_del_single\" style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"button_del_single\" disabled=\"true\" type=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:role_remove_single\">&lt;&nbsp;</button></td>\r\n\t\t\t\t\t\t\t<td ><select style=\"width:100%\" data-dojo-attach-point=\"role_select\" size=\"7\" class=\"lists\" multiple=\"multiple\" data-dojo-attach-event=\"onchange:_selection_options\" ></select></td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t<tr><td align=\"left\" class=\"prmaxrowtag\" valign=\"top\" colspan=\"3\"><div data-dojo-props='keytypeid:6' data-dojo-type=\"prcommon2/interests/Interests\" data-dojo-attach-point=\"interests\" ></div></td></tr>\r\n\t\t\t\t\t\t<tr><td colspan=\"3\"></td></tr>\r\n\t\t\t\t\t\t<tr><td colspan=\"3\"><button type=\"button\" type=\"button\" data-dojo-attach-event=\"onClick:_update_synonims\" data-dojo-type=\"dijit/form/Button\">Update</button></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n"}});define("research/lookups/Roles",["dojo/_base/declare","ttl/BaseWidgetAMD","dojo/text!../lookups/templates/Roles.html","dijit/layout/BorderContainer","ttl/grid/Grid","ttl/store/JsonRest","dojo/store/Cache","dojo/store/Observable","dojo/store/Memory","dojo/request","ttl/utilities2","dojo/json","dojo/_base/lang","dojo/dom-class","dijit/layout/ContentPane","dijit/Toolbar","dijit/form/DropDownButton","dijit/TooltipDialog","dijit/form/TextBox","dijit/form/CheckBox","dijit/form/Button","dijit/form/ValidationTextBox","dijit/form/Form","prcommon2/interests/Interests"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e){return _1("research.lookup.Roles",[_2,_4],{templateString:_3,gutters:true,constructor:function(){this._store=new _8(new _6({target:"/research/admin/roles/rolesall",idProperty:"prmaxroleid"}));this._add_role_call=_d.hitch(this,this._add_role);this._load_role_call=_d.hitch(this,this._load_role);this._set_visible_call=_d.hitch(this,this._set_visible);this._find_roles_response_call=_d.hitch(this,this._find_roles_response);this._load_synonims_call=_d.hitch(this,this._load_synonims);this._load_roles_rebuild_call=_d.hitch(this,this._load_roles_rebuild);},postCreate:function(){var _f=[{label:" ",field:"prmaxroleid",sortable:false,formatter:_b.generic_view,className:"grid-field-image-view"},{label:"P",field:"visible",sortable:false,formatter:_b.check_cell,className:"grid-field-image-view"},{label:"Roles",className:"standard",field:"prmaxrole"},{label:"Job Roles",className:"standard",field:"roles"}];this.grid=new _5({columns:_f,selectionMode:"single",store:this._store,query:{visible:true}});this.grid.on("dgrid-select",_d.hitch(this,this._on_cell_call));this.inherited(arguments);},startup:function(){this.inherited(arguments);this.grid_view.set("content",this.grid);},_find_roles_response:function(_10){this.role_list.options.length=0;for(var key in _10.data){var _11=_10.data[key];this.role_list.options[this.role_list.options.length]=new Option(_11[1],_11[0]);}},_find_roles:function(){var tmp=this.role_list_select.get("value");if(tmp.length>0){_a.post("/research/admin/roles/find",_b.make_params({data:{prmaxroleid:this._row.prmaxroleid,prmaxrole:tmp}})).then(this._find_roles_response_call);}},_load_role:function(_12){this.visible_change.set("checked",_12.data.prmaxrole.visible);_e.remove(this.detail_view,"prmaxhidden");this._show_details();this.role_select.options.length=0;for(var key in _12.data.prmaxroleslist){var _13=_12.data.prmaxroleslist[key];this.role_select.options[this.role_select.options.length]=new Option(_13.prmaxrole,_13.synonymid);}if(_12.data.prmaxlistinterests!=null){this.interests.set("value",_12.data.prmaxlistinterests);}if(_12.data.prmaxrole.visible==true){_e.remove(this.details_ext,"prmaxhidden");}},_on_cell_call:function(e){this.interests.clear();this.role_list.options.length=0;this.role_list_select.set("value","");this._row=e.rows[0].data;_a.post("/research/admin/roles/getext",_b.make_params({data:{prmaxroleid:this._row.prmaxroleid}})).then(this._load_role_call);},_clear_filter:function(){this.filter.set("value","");this.visible_only.set("checked",false);},_execute:function(){var _14={filter:arguments[0].filter};if(arguments[0].visible.length>0){_14["visible"]=true;}this.grid.set("query",_14);this._clear();},_add_role:function(_15){if(_15.success=="OK"){this._store.add(_15.data);alert("Role Added");}else{if(_15.success=="DU"){alert("Role Already Exists");}else{alert("Prioblem Adding role");}}},_execute_add:function(){if(this.rolename.isValid()==false){alert("No Role Specified");}else{_a.post("/research/admin/roles/add",_b.make_params({data:{rolename:arguments[0].rolename}})).then(this._add_role_call);}return false;},_clear:function(){this._row=null;_e.add(this.detail_view,"prmaxhidden");this.interests.clear();this.role_list.options.length=0;this.role_list_select.set("value","");},_set_visible:function(_16){if(_16.success=="OK"){this._show_details();alert("Role Primary Status Updated");}},_show_details:function(){if(this.visible_change.get("checked")==true){_e.remove(this.details_ext,"prmaxhidden");}else{_e.add(this.details_ext,"prmaxhidden");}},_set_primary:function(){var _17={prmaxroleid:this._row.prmaxroleid};if(this.visible_change.get("checked")){_17["visible"]=1;}_a.post("/research/admin/roles/role_set_visible",_b.make_params({data:_17})).then(this._set_visible_call);},_selection_options:function(){this.button_single.set("disabled",this.role_list.selectedIndex!=-1?false:true);this.button_del_all.set("disabled",this.role_select.length?false:true);this.button_del_single.set("disabled",this.role_select.selectedIndex!=-1?false:true);},role_select_single:function(){for(var c=0;c<this.role_list.options.length;c++){var _18=this.role_list.options[c];if(_18.selected){_18.selected=false;var _19=true;for(var c1=0;c1<this.role_select.options.length;c1++){if(this.role_select.options[c1].value==_18.value){_19=false;break;}}if(_19){this.role_select.options[this.role_select.options.length]=new Option(_18.text,_18.value);}}}},role_remove_all:function(){this.role_select.options.length=0;this._selection_options();},role_remove_single:function(){this.role_select.options[this.role_select.selectedIndex]=null;this._selection_options();},_load_roles_rebuild:function(_1a){if(_1a.success=="OK"){alert("Updated");}else{alert("Problem Updating");}},_load_synonims:function(_1b){if(_1b.success=="OK"){alert("Synonims Updated");}else{alert("Problem Updating Synonims");}},_update_synonims:function(){var _1c=new Array();for(var c=0;c<this.role_select.options.length;c++){_1c.push(parseInt(this.role_select.options[c].value));}var _1d={prmaxroleid:this._row.prmaxroleid,roles:_c.stringify(_1c),interests:this.interests.get("value")};_a.post("/research/admin/roles/update_synonims",_b.make_params({data:_1d})).then(this._load_synonims_call);}});});