//>>built
require({cache:{"url:research/employees/templates/PersonNew.html":"<div style=\"border: 1px solid black\">\r\n<form  data-dojo-props='onsubmit:\"return false\",\"class\":\"prmaxdefault\"' data-dojo-attach-point=\"form\" data-dojo-type=\"dijit/form/Form\">\r\n\t<table cellspacing =\"0\" cellpadding=\"0\" width=\"100%\">\r\n\t\t<tr><td class=\"prmaxrowtag\">${displayname}</td><td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Prefix</td><td ><input  data-dojo-attach-point=\"prefix\" data-dojo-props='\"class\":\"prmaxinput\",name:\"prefix\",style:\"width: 2em;\",type:\"text\",trim:true'  data-dojo-attach-point=\"prefix\" data-dojo-type=\"dijit/form/TextBox\" ></input></td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">First Name</td><td ><input data-dojo-props='style:\"width: 5em;\",\"class\":\"prmaxinput\",name:\"firstname\",type:\"text\",trim:true' data-dojo-type=\"dijit/form/TextBox\" data-dojo-attach-point=\"firstname\" ></input></td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Surname</td><td><input data-dojo-attach-point=\"familyname\"  data-dojo-props='\"class\":\"prmaxrequired\",name:\"familyname\",type:\"text\",trim:true,required:true,style:\"width: 12em\"' data-dojo-type=\"dijit/form/ValidationTextBox\"></input></td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Country</td><td><select data-dojo-type =\"dijit/form/FilteringSelect\" data-dojo-attach-point=\"countryid\" data-dojo-props='name:\"countryid\",searchAttr:\"name\",labelType:\"html\",style:\"width:98%\",autoComplete:true'/></td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Source</td><td ><select data-dojo-type =\"dijit/form/FilteringSelect\" data-dojo-attach-point=\"sourcetypeid\" data-dojo-props='name:\"sourcetypeid\",searchAttr:\"name\",labelType:\"html\",style:\"width:98%\",\"class\":\"prmaxrequired\"'  /></td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Reason</td><td ><select data-dojo-type =\"dijit/form/FilteringSelect\" data-dojo-attach-point=\"reasoncodeid\" data-dojo-props='name:\"reasoncodeid\",searchAttr:\"name\",labelType:\"html\",style:\"width:98%\",\"class\":\"prmaxrequired\"'  /></td></tr>\r\n\t\t<tr><td colspan=\"2\" align=\"right\" valign=\"bottom\" ><button data-dojo-attach-event=\"onClick:_add_contact\" data-dojo-attach-point=\"addcontactnode\" type=\"button\" data-dojo-type=\"dijit/form/Button\" label=\"Add\"></button></td></tr>\r\n\t</table>\r\n</form>\r\n</div>\r\n"}});define("research/employees/PersonNew",["dojo/_base/declare","ttl/BaseWidgetAMD","dojo/text!../employees/templates/PersonNew.html","dojo/request","ttl/utilities2","dojo/json","dojo/_base/lang","dojo/topic","dojo/data/ItemFileReadStore","dijit/layout/ContentPane","dijit/form/TextBox","dijit/form/Button","dijit/form/Form","dijit/form/Textarea","dijit/form/ValidationTextBox","dijit/form/FilteringSelect"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _1("research.employees.PersonNew",[_2],{displayname:"New Person",templateString:_3,constructor:function(){this._sourcetypes=new _9({url:"/common/lookups?searchtype=sourcetypes"});this._add_call_back=_7.hitch(this,this._add_call);this._check_call_back=_7.hitch(this,this._check_call);this._parentcallback=null;this._dialog=null;},postCreate:function(){this.reasoncodeid.set("store",PRCOMMON.utils.stores.Research_Reason_Add_Codes());this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Add_Default);this.sourcetypeid.set("store",this._sourcetypes);this.sourcetypeid.set("value",2);this.countryid.set("store",PRCOMMON.utils.stores.Countries());this.inherited(arguments);},load:function(_a){this._dialog=_a;},_add_contact:function(){if(_5.form_validator(this.form)==false){alert("Not all required field filled in");throw "N";}if(confirm("Add Contact?")){_4.post("/research/admin/contacts/research_check",_5.make_params({data:this.form.get("value")})).then(this._check_call_back);}},_check_call:function(_b){if(_b.success=="DEL"){if(confirm("Contact '"+_b.data.firstname+" "+_b.data.familyname+"' has previously asked to be deleted.\nDo you want to proceed?")){_4.post("/research/admin/contacts/research_addnew",_5.make_params({data:this.form.get("value")})).then(this._add_call_back);}}else{if(_b.success=="DU"){if((_b.exist==true&&confirm("Contact already exist with same Firstname and Surname.\nDo you want to proceed?"))||_b.exist==false){_4.post("/research/admin/contacts/research_addnew",_5.make_params({data:this.form.get("value")})).then(this._add_call_back);}}else{if(_b.success=="DEL+DU"){if(confirm("Contact '"+_b.data.deletionhistory.firstname+" "+_b.data.deletionhistory.familyname+"' has previously asked to be deleted.\nDo you want to proceed?")){if((_b.data.exist==true&&confirm("Contact already exist with same Firstname and Surname.\nDo you want to proceed?"))||_b.data.exist==false){_4.post("/research/admin/contacts/research_addnew",_5.make_params({data:this.form.get("value")})).then(this._add_call_back);}}}else{if(_b.success=="OK"){_4.post("/research/admin/contacts/research_addnew",_5.make_params({data:this.form.get("value")})).then(this._add_call_back);}}}}},_add_call:function(_c){if(_c.success=="OK"){alert("Contact Added");if(this._parentcallback){this._parentcallback(_c.contact);}_8.publish(PRCOMMON.Events.Person_Added,_c.contact);this._clear_add_form();if(this._dialog){this._dialog.hide();}}else{alert("Failed");}},clear:function(){this._clear_add_form();},_clear_add_form:function(){this.prefix.set("value","");this.firstname.set("value","");this.familyname.set("value","");this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Add_Default);this.sourcetypeid.set("value",2);},_setCallbackAttr:function(_d){this._parentcallback=_d;},focus:function(){this.prefix.focus();},disabled:function(_e){this.prefix.set("disabled",_e);this.firstname.set("disabled",_e);this.familyname.set("disabled",_e);this.reasoncodeid.set("disabled",_e);this.sourcetypeid.set("disabled",_e);}});});