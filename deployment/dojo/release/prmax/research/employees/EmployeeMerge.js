//>>built
require({cache:{"url:research/employees/templates/EmployeeMerge.html":"<div>\r\n\t<form  data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\" onsubmit=\"return false;\">\r\n\t\t<input type=\"hidden\" name=\"employeeid\" value=\"-1\" data-dojo-type=\"dijit/form/TextBox\" data-dojo-attach-point=\"employeeid\">\r\n\t\t<table style=\"width:100%\" class=\"prmaxtable\" cellspacing=\"0\" cellpadding=\"0\">\r\n\t\t\t<tr><td width=\"110px\" class=\"prmaxrowtag\">Source</td><td data-dojo-attach-point=\"source_details\"></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\">Destination</td><td><select data-dojo-attach-point=\"employeelist\" data-dojo-type=\"dijit/form/FilteringSelect\" data-dojo-props='name:\"newemployeeid\",autoComplete:false,searchAttr:\"job_title\",labelAttr:\"extended_name\",pageSize:20,labelType:\"html\",style:\"width:20em\"'></select></td></tr>\r\n\t\t\t<tr><td><br/></td></tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td ><button data-dojo-props='type:\"button\", label:\"Close\"' data-dojo-attach-event=\"onClick:_do_close\" data-dojo-type=\"dijit/form/Button\"></button></td>\r\n\t\t\t\t<td align=\"right\" ><button data-dojo-attach-point=\"mergebtn\" data-dojo-props='type:\"submit\", label:\"Merge Contacts\",busyLabel:\"Please Wait ...\"' data-dojo-attach-event=\"onClick:_do_merge\" data-dojo-type=\"dojox/form/BusyButton\"></button></td></tr>\r\n\t\t</table>\r\n\t</form>\r\n</div>\r\n"}});define("research/employees/EmployeeMerge",["dojo/_base/declare","ttl/BaseWidgetAMD","dojo/text!../employees/templates/EmployeeMerge.html","dojo/request","ttl/utilities2","dojo/json","dojo/_base/lang","dojo/topic","dojox/data/JsonRestStore","dojo/store/Observable","dojo/dom-attr","dojo/dom-class","dijit/form/RadioButton","dijit/form/FilteringSelect","dijit/form/Button","research/employees/PersonNew"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){return _1("research.employees.EmployeeMerge",[_2],{templateString:_3,constructor:function(){this.employees=new _9({target:"/research/admin/employees/contactlist_rest",idProperty:"employeeid",labelAttribute:"job_title"});this._merge_call_back=_7.hitch(this,this._merge_call);this._dlg=null;},postCreate:function(){this.employeelist.set("store",this.employees);this.inherited(arguments);},load:function(_d,_e,_f,_10,dlg){this._dlg=dlg;if(_10){_b.set(this.source_details,"innerHTML",_10+" - "+_f);}else{_b.set(this.source_details,"innerHTML",_f);}this.employeeid.set("value",_d);this.employeelist.set("query",{extraemployeeid:_d,outletid:_e});this.mergebtn.cancel();this._dlg.show();},_do_close:function(){this._dlg.hide();},_do_merge:function(){if(_5.form_validator(this.form)==false){alert("Not all required fields filled in");throw "N";}if(confirm("Merge Contacts")){_4.post("/research/admin/employees/merge_contacts",_5.make_params({data:this.form.get("value")})).then(this._merge_call_back);}else{throw "N";}},_merge_call:function(_11){if(_11.success=="OK"){alert("Merge Completed. Please verify the 'Research tab' to make sure these changes haven't effected it");if(_11.employee.series==true){alert("Series members were affected. Please run employee synchronisation process");}_8.publish(PRCOMMON.Events.Employee_Deleted,{has_deleted:true,employeeid:this.employeeid.get("value")});this._dlg.hide();}else{alert("Problem Merging Contacts");}this.mergebtn.cancel();},_clear:function(){_b.set(this.source_details,"innerHTML",-1);this.employeelist.set("value",null);this.employeeid.set("value",-1);this.mergebtn.cancel();}});});