//>>built
require({cache:{"url:research/employees/templates/PersonEdit.html":"<div>\r\n\t<div data-dojo-props='style:\":width:820px;height:700px\",title:\"details_view\",region:\"center\"' data-dojo-attach-point=\"details_view\"  data-dojo-type=\"dijit/layout/TabContainer\" >\r\n\t\t<div  data-dojo-type=\"dijit/layout/BorderContainer\"  data-dojo-props='style:\"width:100%;height:100%\",title:\"Details\"' data-dojo-attach-point=\"details_tab\">\r\n\t\t\t<div data-dojo-attach-point=\"top\" data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props='region:\"top\",style:\"width:width:100%;height:35%\",splitter:true'>\r\n\t\t\t\t<form data-dojo-props='\"class\":\"prmaxdefault\",onSubmit:\"return false\"' data-dojo-attach-point=\"formUpdate\" data-dojo-type=\"dijit/form/Form\">\r\n<!--\r\n\t\t\t\t\t<input data-dojo-attach-point=\"contactid\" data-dojo-props='name:\"contactid\",type:\"hidden\"' data-dojo-type=\"dijit/form/TextBox\" ></input>\r\n-->\r\n\t\t\t\t\t<table cellspacing =\"1\" cellpadding=\"1\" width=\"100%\">\r\n\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Contact ID</td><td colspan=\"2\"><input data-dojo-props='type:\"text\",trim:true,style:\"width: 5em\",\"class\":\"prmaxinput\",name:\"contactid\", readOnly:true' data-dojo-attach-point=\"contactid\" data-dojo-type=\"dijit/form/TextBox\" ></input></td></tr>\r\n\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Prefix</td><td colspan=\"2\"><input data-dojo-props='type:\"text\",trim:true,style:\"width: 2em\",\"class\":\"prmaxinput\",name:\"prefix\"' data-dojo-attach-point=\"prefix\" data-dojo-type=\"dijit/form/TextBox\" ></input></td></tr>\r\n\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">First</td><td colspan=\"2\"><input data-dojo-props= '\"class\":\"prmaxinput\",name:\"firstname\",style:\"width: 5em;\",type:\"text\",trim:true' data-dojo-attach-point=\"firstname\" data-dojo-type=\"dijit/form/TextBox\" ></input></td></tr>\r\n\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Surname</td><td><input data-dojo-attach-point=\"familyname\" data-dojo-props='\"class\":\"prmaxrequired\", name:\"familyname\", type:\"text\", trim:true, required:\"true\",style:\"width: 12em\"' data-dojo-type=\"dijit/form/ValidationTextBox\" ></input></td></tr>\r\n\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Middle</td><td><input data-dojo-attach-point=\"middlename\" data-dojo-props='name:\"middlename\", type:\"text\", trim:true,style:\"width: 12em\"' data-dojo-type=\"dijit/form/ValidationTextBox\" ></input></td></tr>\r\n\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Country</td><td><select data-dojo-type =\"dijit/form/FilteringSelect\" data-dojo-attach-point=\"countryid\" data-dojo-props='name:\"countryid\",searchAttr:\"name\",labelType:\"html\",style:\"width:98%\",autoComplete:true'/></td></tr>\r\n\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Source</td><td ><select data-dojo-attach-point=\"sourcetypeid\" data-dojo-props='searchAtt:\"name\",labelType:\"html\",style:\"width:300px\",\"class\":\"prmaxrequired\",name:\"sourcetypeid\"' data-dojo-type =\"dijit/form/FilteringSelect\" /></td></tr>\r\n\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Reason Code</td><td ><select data-dojo-attach-point=\"reasoncodeid\" data-dojo-props='searchAtt:\"name\",labelType:\"html\",style:\"width:300px\",\"class\":\"prmaxrequired\",name:\"reasoncodeid\"' data-dojo-type =\"dijit/form/FilteringSelect\" /></td></tr>\r\n\t\t\t\t\t\t<tr><td align=\"left\" ><button data-dojo-attach-point=\"deletebtn\" data-dojo-attach-event=\"onClick:_delete_contact\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='type:\"button\",label:\"Delete\"'></button></td>\r\n\t\t\t\t\t\t\t<td align=\"right\" valign=\"bottom\" ><button data-dojo-attach-event=\"onClick:_update_contact\" data-dojo-attach-point=\"updatenode\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Saving...\",label:\"Update\"' data-dojo-type=\"dojox/form/BusyButton\" ></button></td>\r\n\t\t\t\t\t\t\t<td align=\"right\" valign=\"bottom\" ><button data-dojo-attach-event=\"onClick:_merge_contact\" data-dojo-attach-point=\"mergenode\" data-dojo-props='type:\"button\",label:\"Merge\"' data-dojo-type=\"dijit/form/Button\" ></button></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-attach-point=\"people_details_employee_grid_view\" data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props='region:\"center\"' ></div>\r\n\t\t</div>\r\n\t\t<div data-dojo-attach-point=\"audit_ctrl\" data-dojo-type=\"research/audit/AuditViewer\" data-dojo-props='objecttypeid:\"5\",style:\"width:100%;height:100%\",title:\"Audit\"'></div>\r\n\t</div>\r\n\t<div data-dojo-props='region:\"bottom\",style:\"width:100%\",height:\"2em\"' data-dojo-type=\"dijit/layout/ContentPane\">\r\n\t\t<button data-dojo-attach-event=\"onClick:_close_edit\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='type:\"button\",label:\"Close\"'></button>\r\n\t</div>\r\n\r\n\t<div data-dojo-attach-point=\"person_delete_dlg\" data-dojo-type=\"dijit/Dialog\" data-dojo-props='title:\"Delete Person\"'>\r\n\t\t<div data-dojo-attach-point=\"person_delete_ctrl\" data-dojo-type=\"research/employees/PersonDelete\" style=\"width:400px;height:200px\"></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"contact_merge_dlg\" data-dojo-type=\"dijit/Dialog\" data-dojo-props='title :\"Merge selected Contact to\"'>\r\n\t\t<div data-dojo-attach-point=\"contact_merge_ctrl\" data-dojo-type=\"research/employees/ContactMerge\"></div>\r\n\t</div>\r\n</div>\r\n"}});define("research/employees/PersonEdit",["dojo/_base/declare","ttl/BaseWidgetAMD","dojo/text!../employees/templates/PersonEdit.html","dojo/request","ttl/utilities2","ttl/store/JsonRest","dojo/json","dojo/_base/lang","dojo/topic","ttl/grid/Grid","dojo/dom-class","dojo/data/ItemFileReadStore","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/form/TextBox","dijit/form/Button","dijit/form/Form","dijit/form/Textarea","dijit/form/ValidationTextBox","dijit/form/FilteringSelect","research/employees/PersonDelete","research/audit/AuditViewer","research/employees/ContactMerge",],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){return _1("research.employees.PersonEdit",[_2,_d],{displayname:"Person Edit",templateString:_3,constructor:function(){this._parentcallback=null;this._dialog=null;this._GetEntryCallBack=_8.hitch(this,this._get_contact_entry);this._load_call_back=_8.hitch(this,this._load_call);this._updated_call_back=_8.hitch(this,this._updated_call);this.people_employee_model=new _6({target:"/research/admin/contacts/research_contact_employee",idProperty:"employeesid"});this._sourcetypes=new _c({url:"/common/lookups?searchtype=sourcetypes"});_9.subscribe(PRCOMMON.Events.Person_Update,_8.hitch(this,this._person_update_event));_9.subscribe(PRCOMMON.Events.Person_Delete,_8.hitch(this,this._person_delete_event));_9.subscribe("contacts/merge_contact",_8.hitch(this,this._contact_merge_event));},postCreate:function(){var _e=[{label:" ",className:"grid-field-icon-view",formatter:_5.format_row_ctrl},{label:"Outlet Name",className:"dgrid-column-address-short",field:"outletname"},{label:"Job Title ",className:"dgrid-column-address-short",field:"job_title"},{label:"Source",className:"dgrid-column-status-small",field:"sourcename"},{label:"Media Channel",className:"dgrid-column-status",field:"prmax_outlettypename"},{label:"Country",className:"dgrid-column-status-large",field:"countryname"}];this.people_details_employee_grid=new _a({columns:_e,selectionMode:"single",store:this.people_employee_model});this.people_details_employee_grid_view.set("content",this.people_details_employee_grid);this.people_details_employee_grid.on(".dgrid-cell:click",_8.hitch(this,this._on_cell_call));this.reasoncodeid.set("store",PRCOMMON.utils.stores.Research_Reason_Update_Codes());this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Upd_Default);this.sourcetypeid.set("store",this._sourcetypes);this.countryid.set("store",PRCOMMON.utils.stores.Countries());this.inherited(arguments);},startup:function(){this.inherited(arguments);},clear:function(){this._clear_form();},load:function(_f,_10,_11){this._dialog=_f;this._contactid=_10;this._contactname=_11;this.people_details_employee_grid.set("query",{contactid:this._contactid});this.audit_ctrl.load(this._contactid);_4.post("/research/admin/contacts/get",_5.make_params({data:{contactid:this._contactid}})).then(this._load_call_back);this.details_view.selectChild(this.details_tab);},_clear_form:function(){this.prefix.set("value","");this.firstname.set("value","");this.familyname.set("value","");this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Upd_Default);this.sourcetypeid.set("value",2);this.countryid.set("value","");this.contactid.set("value","");},_setCallbackAttr:function(_12){this._parentcallback=_12;},focus:function(){this.prefix.focus();},disabled:function(_13){this.prefix.set("disabled",_13);this.firstname.set("disabled",_13);this.familyname.set("disabled",_13);this.reasoncodeid.set("disabled",_13);this.sourcetypeid.set("disabled",_13);},_delete_contact:function(){this.person_delete_ctrl.load(this._contactid,this._contactname);this.person_delete_dlg.show();},_update_contact:function(){if(_5.form_validator(this.formUpdate)==false){alert("Not all required field filled in");throw "N";}var _14=this.formUpdate.get("value");_14["contactid"]=this._contactid;_4.post("/research/admin/contacts/research_update",_5.make_params({data:_14})).then(this._updated_call_back);},_load_call:function(_15){if(_15.success=="OK"){this.contactid.set("value",_15.contact.contactid);this.prefix.set("value",_15.contact.prefix);this.firstname.set("value",_15.contact.firstname);this.familyname.set("value",_15.contact.familyname);this.middlename.set("value",_15.contact.middlename);this.sourcetypeid.set("value",_15.contact.sourcetypeid);this.countryid.set("value",_15.contact.countryid);this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Upd_Default);if(_15.contact.inuse==true){_b.add(this.deletebtn.domNode,"prmaxhidden");}else{_b.remove(this.deletebtn.domNode,"prmaxhidden");}}},_person_delete_event:function(_16){this.person_delete_dlg.hide();this.clear();},_merge_contact:function(){this.contact_merge_ctrl.load(this._contactid,this._contactname,this.contact_merge_dlg);},_contact_merge_event:function(_17){this.contactid.set("value",_17.contactid);this.prefix.set("value",_17.contact.prefix);this.firstname.set("value",_17.contact.firstname);this.familyname.set("value",_17.contact.familyname);this.middlename.set("value",_17.contact.middlename);this.sourcetypeid.set("value",_17.contact.sourcetypeid);this.people_details_employee_grid.set("query",{contactid:_17.contactid});this.audit_ctrl.load(_17.contactid);},_updated_call:function(_18){if(_18.success=="OK"){alert("Contact Updated");_9.publish(PRCOMMON.Events.Person_Update,_18.contact);this._clear_reason();}else{alert("Problem Updated Contact");}this.updatenode.cancel();},_person_update_event:function(_19){this.updatenode.cancel();},_clear_reason:function(){this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Upd_Default);},_close_edit:function(){this._dialog.hide();},});});