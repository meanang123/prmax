//>>built
require({cache:{"url:research/projects/templates/create.html":"<div>\r\n\t<div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props='region:\"top\",style:\"height:150px;width:100%\"'>\r\n\t\t<form data-dojo-type=\"dijit/form/Form\" data-dojo-attach-event='onsubmit:_ReturnFalse' data-dojo-attach-point=\"form\">\r\n\t\t\t<table width=\"550px\" cellspacing=\"0\" cellpadding=\"0\" style=\"border-collapse: collapse\" >\r\n\t\t\t\t<tr><td>&nbsp;</td></tr>\r\n\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" width=\"250px\" >Name:</td><td colspan=\"2\"><input data-dojo-props='style:\"width:300px\",\"class\":\"prmaxrequired\",name:\"researchprojectname\",type:\"text\",maxlength:\"80\",trim:true,required:true' data-dojo-attach-point=\"researchprojectname\" data-dojo-type=\"dijit/form/ValidationTextBox\"/></td></tr>\r\n\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\">User:</td><td colspan=\"2\"><select data-dojo-attach-point=\"iuserid\" data-dojo-props='name:\"iuserid\",autoComplete:\"true\",style:\"width:15em\",labelType:\"html\"' data-dojo-type=\"dijit/form/FilteringSelect\"></td></tr>\r\n\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\">Is Monthly</td><td colspan=\"2\"><input data-dojo-attach-point=\"ismonthly\" data-dojo-props='name:\"ismonthly\",type:\"checkbox\"' data-dojo-type=\"dijit/form/CheckBox\" data-dojo-attach-event=\"onChange:_is_monthly\"></td></tr>\r\n\t\t\t\t<tr data-dojo-attach-point=\"start_date_view\" class=\"prmaxhidden\"><td class=\"prmaxrowtag\" align=\"right\">Start Date</td><td><input data-dojo-attach-point=\"startdate\" data-dojo-ptops='type:\"text\",name:\"startdate\",required:false,style:\"width:10em\"' data-dojo-type=\"dijit/form/DateTextBox\" ></td></tr>\r\n\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\">Questionnaire Completion Date</td><td><input data-dojo-attach-point=\"questionnaire_completion\" data-dojo-ptops='type:\"text\",name:\"questionnaire_completion\",required:true,style:\"width:10em\"' data-dojo-type=\"dijit/form/DateTextBox\" ></td><td align=\"right\"><button data-dojo-attach-event=\"onClick:_create\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='type:\"button\",\"class\":\"prmaxbuttonlarge\",label:\"Create Projects\"' ></button></td></tr>\r\n\t\t\t</table>\r\n\t\t\t<br/>\r\n\t\t</div>\r\n\t</form>\r\n\t<div data-dojo-type=\"dijit/layout/BorderContainer\" data-dojo-props='gutters:false,region:\"left\",style:\"width:50%;height:100%\"'>\r\n\t\t<div data-dojo-attach-point=\"tabcont\" data-dojo-type=\"dijit/layout/TabContainer\" data-dojo-props='region:\"center\"'>\r\n\t\t\t<div data-dojo-type=\"dijit/layout/BorderContainer\" data-dojo-props='title:\"Search\",style:\"width:100%;height:100%;overflow:hidden\",gutters:false'>\r\n\t\t\t\t<div data-dojo-attach-point=\"search_tabcont\" data-dojo-type=\"dijit/layout/TabContainer\" data-dojo-props='region:\"center\"'>\r\n\t\t\t\t\t<div data-dojo-attach-point=\"search_tab_outlet\" data-dojo-type=\"prcommon2/search/OutletSearch\" data-dojo-props='style:\"height:100%;overflow:auto;overflow-x:hidden\",\"class\":\"scrollpanel\",title:\"Outlet\"'></div>\r\n\t\t\t\t\t<div data-dojo-attach-point=\"search_tab_freelance\" data-dojo-type=\"prcommon2/search/FreelanceSearch\" data-dojo-props='style:\"height:100%;overflow:auto;overflow-x:hidden\",\"class\":\"scrollpanel\",title:\"Freelance\"'></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props='region:\"bottom\",style:\"width:100%;height:15%;padding-top:10px\"'>\r\n\t\t\t\t\t<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"border-collapse: collapse;\" >\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td><button data-dojo-attach-event=\"onClick:_clear_search\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='\"class\":\"prmaxbutton\",label:\"Clear Results\"' ></button></td>\r\n\t\t\t\t\t\t\t<td><button data-dojo-attach-event=\"onClick:_clear_search_criteria\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='\"class\":\"prmaxbutton\",label:\"Clear Criteria\"' ></button></td>\r\n\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-attach-point=\"searchbutton\" data-dojo-attach-event=\"onClick:_search\" data-dojo-type=\"dojox/form/BusyButton\" data-dojo-props='\"class\":\"prmaxbutton\",iconClass:\"dijitPrmaxIcon dijitPrmaxIconSearch\",busyLabel:\"Searching...\",label:\"Search\"'></button></td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props='style:\"height:100%;width:100%\",title:\"Generate a  Monthly Sets\",\"class\":\"common_prmax_layout\"'>\r\n\t\t\t\t<br/>\r\n\t\t\t\t<label class=\"label_1\">Month</label><select data-dojo-type=\"dijit/form/FilteringSelect\" data-dojo-attach-point=\"month\" data-dojo-props='name:\"month\",autoComplete:true,searchAttr:\"name\",required:true,labelType:\"html\"'></select>\r\n\t\t\t\t<button data-dojo-attach-point=\"search_monthly\" data-dojo-attach-event=\"onClick:_search_monthly\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='\"class\":\"prmaxbutton\",label:\"Build Monthly\"' ></button><br/><br/>\r\n\t\t\t\t<button data-dojo-attach-event=\"onClick:_clear_search\" data-dojo-type=\"dijit/form/Button\" data-dojo-props='\"class\":\"prmaxbutton\",label:\"Clear Results\"'></button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit/layout/BorderContainer\" data-dojo-props='gutters:false,region:\"center\",splitter:true'>\r\n\t\t<div data-dojo-type=\"dijit/Toolbar\" data-dojo-props='region:\"top\",style:\"height:40px;width:100%;padding:0px;margin:0px\"'>\r\n\t\t</div>\r\n\t\t<div data-dojo-attach-point=\"grid_view\" data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props='region:\"center\",splitter:true'></div>\r\n\t</div>\r\n</div>\r\n"}});define("research/projects/create",["dojo/_base/declare","ttl/BaseWidgetAMD","dojo/text!../projects/templates/create.html","dijit/layout/BorderContainer","dojo/request","ttl/utilities2","dojo/json","dojo/topic","dojo/_base/lang","dojo/data/ItemFileReadStore","ttl/grid/Grid","ttl/store/JsonRest","dojo/store/Observable","dojo/date","dojo/dom-class","dijit/layout/ContentPane","dijit/Toolbar","dijit/form/DateTextBox","prcommon2/search/OutletSearch","prcommon2/search/FreelanceSearch"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f){return _1("research.projects.create",[_2,_4],{templateString:_3,gutters:true,constructor:function(){this._load_call_back=_9.hitch(this,this._load_call);this._add_call_back=_9.hitch(this,this._add_call);this._clear_search_call_back=_9.hitch(this,this._clear_search_call);this._search_monthly_call_back=_9.hitch(this,this._search_monthly_call);this._delete_search_row_call_back=_9.hitch(this,this._delete_search_row_call);this._users=new _a({url:"/common/lookups?searchtype=users&group=dataadmin&nofilter"});this.model=new _d(new _c({target:"/search/list_rest?searchtypeid=5&research=1",idProperty:"sessionsearchid"}));this._months=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=months"});},postCreate:function(){this.inherited(arguments);this.iuserid.set("store",this._users);this.iuserid.set("value",-1);this.startdate.set("value",new Date());this.questionnaire_completion.set("value",_e.add(new Date(),"month",1));this.month.set("store",this._months);this.month.set("value",1);var _10=[{label:"  ",className:"grid-field-image-view",field:"sessionsearchid",formatter:_6.format_row_ctrl},{label:"Name",className:"standard",field:"outletname"},{label:"Contact",className:"standard",field:"contactname"},{label:"Desk",className:"standard",field:"deskname"},{label:"Source",className:"dgrid-column-type-small",field:"sourcename"},{label:"Id",className:"dgrid-column-nbr-right",field:"outletid"}];this.grid=new _b({columns:_10,selectionMode:"none",store:this.model});this.grid_view.set("content",this.grid);this.grid.on(".dgrid-row:click",_9.hitch(this,this._on_cell_call));},_on_cell_call:function(e){var _11=this.grid.cell(e);if(_11.column.id=="0"){if(confirm("Remove from results?")){_5.post("/search/delete_session_row",_6.make_params({data:{searchtypeid:5,sessionsearchid:_11.row.data.sessionsearchid}})).then(this._delete_search_row_call_back);}}},_delete_search_row_call:function(_12){if(_12.success=="OK"){this.model.remove(_12.sessionsearchid);}},_clear_search_call:function(_13){this.grid.set("query",{});},_clear_search:function(){_5.post("/search/sessionclear",_6.make_params({data:{searchtypeid:5}})).then(this._clear_search_call_back);},_clear_search_results:function(_14){if(_14.success=="OK"){this._load_call();}},_is_empty:function(_15){var _16=_15["search_type"];for(var _17 in _15){if(_17.indexOf(_16)!=-1){if(_15[_17].length!=0){return false;}}}return true;},_get_form:function(){var _18=null;dojo.every(this.search_tabcont.selectedChildWidget.getChildren(),function(_19){if(_19.formid!=null){_18=_19;}});return _18;},_search:function(){var _1a=this._get_form();_1a.setExtendedMode(false);var _1b=_1a.get("value");_1b["mode"]=0;_1b["search_partial"]=2;_1b["searchtypeid"]=5;_5.post("/search/dosearch",_6.make_params({data:_1b})).then(this._load_call_back);},_load_call:function(_1c){this.searchbutton.cancel();this.grid.set("query",{});},_clear:function(){this.grid.set("query",{});this.iuserid.set("value",-1);this.researchprojectname.set("value","");this.startdate.set("value",new Date());this.questionnaire_completion.set("value",_e.add(new Date(),"month",1));this.ismonthly.set("checked",false);this.researchprojectname.focus();},_add_call:function(_1d){if(_1d.success=="OK"){alert("Project Added");_8.publish("/project/add",_1d.data);this._clear();}else{if(_1d.success=="DU"){alert("Project Already Exists");this.researchprojectname.focus();}else{alert("Problem adding Project");this.researchprojectname.focus();}}},_create:function(){if(_6.form_validator(this.form)==false){alert("Not all required field filled in");this.searchbutton.cancel();throw "N";}var tmp=this.form.get("value");if(this.ismonthly.get("checked")){tmp["startdate"]=_6.to_json_date(this.startdate.get("value"));}tmp["questionnaire_completion"]=_6.to_json_date(this.questionnaire_completion.get("value"));if(confirm("Add Project")){_5.post("/research/admin/projects/projects_add",_6.make_params({data:tmp})).then(this._add_call_back);}},_search_monthly:function(){_5.post("/research/admin/projects/generate_monthly",_6.make_params({data:{month:this.month.get("value")}})).then(this._search_monthly_call_back);},_search_monthly_call:function(_1e){if(_1e.success=="OK"){this.ismonthly.set("checked",true);this.iuserid.set("value",-1);var _1f=new Date();this.researchprojectname.set("value","Monthly Build "+_1f.getDate()+"/"+(_1f.getMonth()+1)+"/"+(_1f.getFullYear()-2000));this._load_call(_1e);}else{alert("Problem Building");}},_clear_search_criteria:function(){this.search_tab_outlet.clear();this.search_tab_freelance.clear();},_is_monthly:function(){if(this.ismonthly.get("checked")){_f.remove(this.start_date_view,"prmaxhidden");this.startdate.set("required",true);}else{_f.add(this.start_date_view,"prmaxhidden");this.startdate.set("required",false);}}});});