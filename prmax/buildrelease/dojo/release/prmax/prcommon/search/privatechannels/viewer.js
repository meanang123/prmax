/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.search.privatechannels.viewer"]){dojo._hasResource["prcommon.search.privatechannels.viewer"]=true;dojo.provide("prcommon.search.privatechannels.viewer");dojo.require("ttl.GridHelpers");dojo.require("ttl.BaseWidget");dojo.require("dijit.form.Form");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dojox.form.BusyButton");dojo.require("dijit.form.Button");dojo.require("prcommon.data.QueryWriteStore");dojo.require("prcommon.search.privatechannels.add");dojo.require("prcommon.search.privatechannels.update");dojo.declare("prcommon.search.privatechannels.viewer",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"borderControl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='style:\"width:100%;height:100%\",gutters:false' >\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"top\", style:\"height:42px;width:100%;overflow:hidden\", \"class\":\"std_menu_view\"'>\r\n\t\t\t<div style=\"height:38px;width:100%;overflow:hidden\" class=\"std_menu_view\">\r\n\t\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='\"class\":\"dijitToolbarTop\", style:\"float:left:height:94%;width:400px\"' >\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_AddPrivateChannel\" data-dojo-attach-point=\"addbutton\" data-dojo-props='label:\"New Private Media Channel\", iconClass:\"fa fa-plus fa-3x\",showLabel:true'></div>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_deletePrivateChannel\" data-dojo-attach-point=\"deletebutton\"  data-dojo-props='label:\"Delete\", iconClass:\"fa fa-trash fa-3x\",showLabel:true'></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='style:\"width:50%;height:100%\", region:\"center\", splitter:true'>\r\n\t\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='query:{ }, rowsPerPage:30' ></div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.StackContainer\" data-dojo-attach-point='privatechannels_view_ctrl' data-dojo-props='style:\"width:50%;height:100%\", region:\"right\", splitter:true'>\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-attach-point=\"blank_view\" data-dojo-props='style:\"width:100%;height:100%\", \"class\":\"bordered\"'></div>\r\n\t\t\t<div data-dojo-attach-point=\"tabcont\" data-dojo-type=\"dijit.layout.TabContainer\" data-dojo-props=\"region:'center',splitter:true,'class':'bordered'\">\r\n\t\t\t\t<div data-dojo-attach-point=\"details\"  data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props=\"title:'Edit',style:'height:100%;width:500px;overflow :auto','class':'bordered scrollpane',selected:'selected'\">\r\n\t\t\t\t\t<span class=\"common_prmax_layout\">\r\n\t\t\t\t\t\t<div style=\"padding:2px\" data-dojo-attach-point =\"display_pane\" class=\"prmaxhidden\">\r\n\t\t\t\t\t\t\t<form data-dojo-attach-point=\"update_form\" data-dojo-props='\"class\":\"prmaxdefault\", onsubmit:\"return false\"' data-dojo-type=\"dijit.form.Form\">\r\n\t\t\t\t\t\t\t\t<input data-dojo-attach-point=\"prmax_outlettypeid\" data-dojo-props='name:\"prmax_outlettypeid\", type:\"hidden\"' data-dojo-type=\"dijit.form.TextBox\" >\r\n\t\t\t\t\t\t\t\t<table class=\"prmaxtable\" width=\"700px\" >\r\n\t\t\t\t\t\t\t\t\t<tr><td colspan=\"2\" align=\"center\" class=\"prmaxrowdisplaylarge\" > Private Media Channel Details</td></tr>\r\n\t\t\t\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" >Description</td><td class=\"prmaxrowdisplay\" width=\"86%\"><input data-dojo-props='invalidMessage:\"Description field must be filled in\", style:\"width:98%\", \"class\":\"prmaxrequired\", name:\"prmax_outlettypename\", type:\"text\", maxlength:80, trim:true, required:true' data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"prmax_outlettypename\"/></td></tr>\r\n\t\t\t\t\t\t\t\t\t<tr><td colspan = \"2\" align=\"right\"><button data-dojo-props='\"class\":\"prmaxbutton\", type:\"button\", label:\"Update\", busyLabel:\"Please Wait Updating\" ' data-dojo-type=\"dojox.form.BusyButton\" data-dojo-attach-event=\"onClick:_Update\" data-dojo-attach-point=\"update_form_btn\"></button></td></tr>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</form>\r\n\t\t\t\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div>\r\n\t\t<div data-dojo-attach-point=\"add_privatechannel_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"New Private Media Channel\", style:\"width:500px;height:130px\"'>\r\n\t\t<div data-dojo-attach-point=\"addprivatechannelctrl\" data-dojo-type=\"prcommon.search.privatechannels.add\" style=\"width:500px;height:130px\"></div>\r\n\t</div>\t\r\n</div>\r\n\r\n\r\n",constructor:function(){this.model=new prcommon.data.QueryWriteStore({url:"/prmax_outlettypes/get_list_prmax_outlettypes",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,nocallback:true,urlPreventCache:true});this._UpdatePrivateChannelCallBack=dojo.hitch(this,this._UpdatePrivateChannelCall);this._DeletePrivateChannelCallBack=dojo.hitch(this,this._DeletePrivateChannelCall);dojo.subscribe("/prmax_outlettypes/add",dojo.hitch(this,this._AddPrivateChannelEvent));},postCreate:function(){this.icustomerid=PRMAX.utils.settings.cid;this._prmax_outlettypeid=null;this.grid.set("structure",this.view);this.grid._setStore(this.model);this.grid["onCellClick"]=dojo.hitch(this,this._onCellClick);this.tabcont.selectChild(this.details);},_OnStyleRow:function(_1){ttl.GridHelpers.onStyleRow(_1);this.tabcont.selectChild(this.details);},view:{cells:[[{name:"Description",width:"500px",field:"prmax_outlettypename"}]]},_onCellClick:function(e){this._row=this.grid.getItem(e.rowIndex);this._prmax_outlettypeid=this._row.i.prmax_outlettypeid;this.prmax_outlettypeid.set("value",this._row.i.prmax_outlettypeid);this.prmax_outlettypename.set("value",this._row.prmax_outlettypename);this.grid.selection.clickSelectEvent(e);this.privatechannels_view_ctrl.selectChild(this.tabcont);this.tabcont.selectChild(this.details);this._ShowDetails();},_ShowDetails:function(){dojo.removeClass(this.display_pane,"prmaxhidden");this.prmax_outlettypeid.set("value",this._row.i.prmax_outlettypeid);this.prmax_outlettypename.set("value",this._row.i.prmax_outlettypename);},_AddPrivateChannel:function(){this.privatechannels_view_ctrl.selectChild(this.blank_view);this.addprivatechannelctrl.Load(this.add_privatechannel_dlg);this.add_privatechannel_dlg.show();},_AddPrivateChannelEvent:function(_2){this.model.newItem(_2);},_Update:function(){if(ttl.utilities.formValidator(this.update_form)==false){alert("Not all required field filled in");this.update_form_btn.cancel();return;}if(confirm("Update?")){var _3=this.update_form.get("value");_3["customerid"]=this.icustomerid;dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._UpdatePrivateChannelCallBack),url:"/prmax_outlettypes/update",content:_3}));}},_UpdatePrivateChannelCall:function(_4){if(_4.success=="OK"){alert("Private Media Channel Updated");this.update_form_btn.cancel();this.model.setValue(this._row,"prmax_outlettypename",_4.data.prmax_outlettypename,true);}else{if(_4.success=="DU"){alert("Private Media Channel Already Exists");this.update_form_btn.cancel();}else{alert("Problem updating Private Media Channel");this.update_form_btn.cancel();}}},_deletePrivateChannel:function(){if(confirm("Delete Selected Private Media Channel?")){var _5={};_5["prmax_outlettypeid"]=this._row.i.prmax_outlettypeid;_5["customerid"]=this.icustomerid;dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._DeletePrivateChannelCallBack),url:"/prmax_outlettypes/delete",content:_5}));}},_DeletePrivateChannelCall:function(_6){if(_6.success=="OK"){alert("Private Media Channel Deleted");this.grid.setQuery(ttl.utilities.getPreventCache({}));this.privatechannels_view_ctrl.selectChild(this.blank_view);}else{alert("Problem Deleting Selected Private Media Channel");}},});}