/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.search.Countries"]){dojo._hasResource["prcommon.search.Countries"]=true;dojo.provide("prcommon.search.Countries");dojo.require("ttl.BaseWidget");dojo.require("prcommon.search.std_search");dojo.declare("prcommon.search.Countries",[prcommon.search.std_search,ttl.BaseWidget],{name:"",value:"",displaytitle:"Countries",search:"",size:"7",testmode:false,selectonly:false,startopen:false,preload:true,interesttypeid:1,restrict:1,widgetsInTemplate:true,templateString:"<div data-dojo-attach-point=\"containerNode\" >\r\n\t<table width=\"100%\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\" data-dojo-attach-point=\"top_panel\">\r\n\t\t<tr><td width=\"20%\" class=\"prmaxrowtag\">${displaytitle}</td>\r\n\t\t\t\t<td width=\"5%\" ><i dojoAttachPoint=\"toggleCtrl\" dojoAttachEvent=\"onclick:_Toggle\" class=\"fa fa-plus-circle\" style=\"color:#7F7F7F\"></i></td>\r\n\t\t\t\t<td align=\"right\" v-align=\"top\" ><div data-dojo-attach-point=\"countNode\" data-dojo-type=\"prcommon.search.SearchCount\"></div></td>\r\n\t\t</tr>\r\n\t</table>\r\n\t<div class=\"dojoInterestPane\" >\r\n\t\t<div data-dojo-attach-point=\"selectarea\" class=\"prmaxselectmultiple\" style=\"display:none\" >\r\n\t\t\t<table width=\"100%\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\" >\r\n\t\t\t\t  <tr><td width=\"47%\"></td><td width=\"5%\"></td><td width=\"48%\" ></td></tr>\r\n\t\t\t\t  <tr><td colspan=\"3\">\r\n\t\t\t\t\t  <table style=\"width:100%\" class=\"prmaxtable\" >\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td width=\"40%\" data-dojo-attach-point=\"master_type_text\"><span class=\"prmaxrowtag\">Select</span><input data-dojo-type=\"dijit.form.TextBox\" data-dojo-props='\"class\":\"prmaxfocus prmaxinput\",type:\"text\",style:\"width:60%\"' data-dojo-attach-point=\"interest_list_select\" data-dojo-attach-event=\"onkeyup:interestSelect\" /></td>\r\n\t\t\t\t\t\t\t<td width=\"40%\"><select  data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-props='style:\"width:100%\",autoComplete:true,searchAttr:\"name\",labelType:\"html\"' data-dojo-attach-point=\"master_type\" data-dojo-attach-event=\"onChange:_change_filter\"></select></td>\r\n\t\t\t\t\t\t\t<td width=\"3%\" align=\"right\"><input data-dojo-props='\"class\":\"prmaxdefault\",checked:\"checked\",type:\"checkbox\",value:\"2\"' data-dojo-attach-point=\"AndOr\" data-dojo-type=\"dijit.form.CheckBox\" data-dojo-attach-event=\"onClick:And_Or\"/></td>\r\n\t\t\t\t\t\t\t<td width=\"15%\"><label data-dojo-attach-point=\"AndOrLabel\" class=\"prmaxlabeltag\" >All</label></td>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t  </td></tr>\r\n\t\t\t\t\t  <tr><td ><select style=\"width:100%\" data-dojo-attach-point=\"interest_list\" size=\"${size}\" class=\"lists\" multiple=\"multiple\" ></select></td>\r\n\t\t\t\t  <td>\r\n\t\t\t\t  <button data-dojo-props='style:\"padding:0px;margin:0px\",disabled:\"true\",type:\"button\",\"class\":\"button_add_all\"' data-dojo-attach-point=\"button_all\" data-dojo-attach-event=\"onClick:interestSelectAll\" data-dojo-type=\"dijit.form.Button\"><div class=\"std_movement_button\">&gt;&gt;</div></button><br/>\r\n\t\t\t\t  <button data-dojo-props='style:\"padding:0px;margin:0px\",disabled:\"true\",type:\"button\",\"class\":\"button_add_single\"' data-dojo-attach-point=\"button_single\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:interestSelectSingle\"><div class=\"std_movement_button\">&gt;&nbsp;</div></button><br/>\r\n\t\t\t\t  <button data-dojo-props='style:\"padding:0px;margin:0px\",disabled:\"true\",type:\"button\",\"class\":\"button_del_all\"' data-dojo-attach-point=\"button_del_all\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:interestRemoveAll\"><div class=\"std_movement_button\">&lt;&lt;</div></button><br/>\r\n\t\t\t\t  <button data-dojo-props='style:\"padding:0px;margin:0px\",disabled:\"true\",type:\"button\",\"class\":\"button_del_single\"' data-dojo-attach-point=\"button_del_single\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:interestRemoveSingle\"><div class=\"std_movement_button\">&lt;&nbsp;</div></button></td>\r\n\t\t\t\t  <td ><select style=\"width:100%\" size=\"${size}\" class=\"lists\" multiple=\"multiple\" data-dojo-attach-point=\"interest_select\" data-dojo-attach-event=\"onchange:interestUpdateSelection\"></select></td>\r\n\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.disabled=false;this._extended=false;this._LoadSelectionCall=dojo.hitch(this,this._LoadSelection);this._continents=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=continents"});this.interestTimer=null;this.inherited(arguments);},postCreate:function(){dojo.connect(this.interest_list_select.domNode,"onkeyup",dojo.hitch(this,this.interestSelect));dojo.connect(this.interest_list,"onchange",dojo.hitch(this,this.interestUpdateSelection));dojo.connect(this.interest_list,"ondblclick",dojo.hitch(this,this.interestSelectDbl));dojo.attr(this.AndOrLabel,"for",this.AndOr.id);if(this.selectonly){this.AndOr.domNode.style.display="None";this.countNode.domNode.style.display="None";this.AndOrLabel.style.display="None";if(this.displaytitle==""){dojo.addClass(this.top_panel,"prmaxhidden");}}if(this.startopen){dojo.style(this.toggleCtrl,"display","none");dojo.style(this.selectarea,"display","block");}if(this.preload){this._load_defaults();if(PRMAX.utils.settings.countries.length>0){this.MakeOpen();this._Get(this._getValueAttr(),true);}}this.master_type.store=this._continents;this.master_type.set("value",-1);this.inherited(arguments);},_load_defaults:function(){for(var _1 in PRMAX.utils.settings.countries){var _2=PRMAX.utils.settings.countries[_1];this.interest_select.options[this.interest_select.options.length]=new Option(_2.countryname,_2.countryid);}},Clear:function(){this._ClearSelectionBox();this._ClearSelectedBox();this.interest_list_select.set("value","");this._Get(this._getValueAttr());this._SelectionOptions();this._load_defaults();this.inherited(arguments);},_Send_Request:function(_3){this._transactionid=PRCOMMON.utils.uuid.createUUID();var _4=this.master_type.get("value");if(_4=="-1"&&_3=="*"){_3="";}dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadSelectionCall,url:"/geographical/countries_listselection",content:{word:_3,logic:this.AndOr.get("value"),filter:_4,keytypeid:this.keytypeid,restrict:this.restrict,transactionid:this._transactionid}}));},interestSelect:function(p1,_5){var _6=this.interest_list_select.get("value");if(_5!=null){_6=_5;}if(_6.length>0){if(this.interestTimer){clearTimeout(this.interestTimer);this.interestTimer=null;}this.interestTimer=setTimeout(dojo.hitch(this,this._Send_Request,_6),this.searchTime);}else{this.interestTimer=null;this._ClearSelectionBox();this._SelectionOptions();}},_LoadSelection:function(_7){if(this._transactionid==_7.transactionid){this._ClearSelectionBox();for(var i=0;i<_7.data.length;++i){var _8=_7.data[i];this.interest_list.options[this.interest_list.options.length]=new Option(_8.countryname,_8.countryid);}this._SelectionOptions();}},_ClearSelectionBox:function(){this.interest_list.options.length=0;},_ClearSelectedBox:function(){this.interest_select.length=0;},And_Or:function(){this._Get(this._getValueAttr(),true);},interestUpdateSelection:function(){this._SelectionOptions();},interestSelectDbl:function(){this.interestSelectSingle();this._SelectionOptions();},interestSelectAll:function(){for(var c=0;c<this.interest_list.options.length;c++){var _9=this.interest_list.options[c];var _a=true;for(var c1=0;c1<this.interest_select.options.length;c1++){if(this.interest_select.options[c1].value==_9.value){_a=false;break;}}if(_a){this.interest_select.options[this.interest_select.options.length]=new Option(_9.text,_9.value);}}this._Get(this._getValueAttr());this.interest_list.options.length=0;this.interestUpdateSelection();},interestSelectSingle:function(){for(var c=0;c<this.interest_list.options.length;c++){var _b=this.interest_list.options[c];if(_b.selected){_b.selected=false;var _c=true;for(var c1=0;c1<this.interest_select.options.length;c1++){if(this.interest_select.options[c1].value==_b.value){_c=false;break;}}if(_c){this.interest_select.options[this.interest_select.options.length]=new Option(_b.text,_b.value);this._Get(this._getValueAttr());}}}},interestRemoveAll:function(){this.interest_select.options.length=0;this.interestUpdateSelection();this._Get(this._getValueAttr());},interestRemoveSingle:function(){for(var c=0;c<this.interest_select.options.length;c++){if(this.interest_select.options[c].selected){this.interest_select.options[c]=null;}}this.interestUpdateSelection();this._Get(this._getValueAttr());},addSelect:function(_d){this.interest_select.options[this.interest_select.options.length]=new Option(_d.countryname,_d.countryid);},_setValueAttr:function(_e){this.Clear();var _f=_e.data;var _10=false;if(_f==null||_f==undefined){_f=_e;}for(var key in _f){var _11=_f[key];this.interest_select.options[this.interest_select.options.length]=new Option(_11.countryname,_11.countryid);opne=true;}if(_10){this.MakeOpen();}this._Get(this._getValueAttr());},_getValueAttr:function(){var _12=Array();for(var c=0;c<this.interest_select.options.length;c++){if(this._extended){_12[c]={countryid:parseInt(this.interest_select.options[c].value),countryname:this.interest_select.options[c].text};}else{_12[c]=parseInt(this.interest_select.options[c].value);}}var obj={data:_12,logic:this.AndOr.get("value")};if(this._extended){return obj;}else{var _12=_12.length>0?dojo.toJson(obj):"";this.value=_12;return _12;}},_getCountAttr:function(){return this.interest_select.options.length;},_setExtendedAttr:function(_13){this._extended=_13;},_SelectionOptions:function(){this.button_all.set("disabled",this.interest_list.length?false:true);this.button_single.set("disabled",this.interest_list.selectedIndex!=-1?false:true);this.button_del_all.set("disabled",this.interest_select.length?false:true);this.button_del_single.set("disabled",this.interest_select.selectedIndex!=-1?false:true);},_CaptureExtendedContent:function(_14){var _15=this.AndOr.get("value");return dojo.mixin(_14,{logic:_15});},_setDisabledAttr:function(_16){this.disabled=_16;},_getDisabledAttr:function(){return this.disabled;},destroy:function(){this.inherited(arguments);},_Get:function(){if(this.selectonly==false){this.inherited(arguments);}},_focus:function(){this.interest_list_select.focus();},_change_filter:function(){var _17=this.interest_list_select.get("value");if(_17.length==0){_17="*";}this.interestSelect(null,_17);}});}