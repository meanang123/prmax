/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.crm.add"]){dojo._hasResource["prcommon.crm.add"]=true;dojo.provide("prcommon.crm.add");dojo.require("ttl.BaseWidget");dojo.require("prmax.search.PersonSelect");dojo.require("prmax.search.PersonSelect2");dojo.require("prcommon.crm.issues.selectmultiple");dojo.require("prcommon.crm.issues.add");dojo.require("prcommon.common.ExpandedText");dojo.require("dijit.Dialog");dojo.require("dijit.layout.ContentPane");dojo.require("prcommon.documents.adddialog");dojo.declare("prcommon.crm.add",[ttl.BaseWidget,dijit.layout.ContentPane],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"tabcont\" data-dojo-type=\"dijit.layout.TabContainer\" data-dojo-props='region:\"center\"'>\r\n\t\t<div data-dojo-attach-point=\"details_view\" data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='title:\"Details\",style:\"width:600px;height:550px\",selected:\"selected\",\"class\":\"common_prmax_layout scrollpanel\"'>\r\n\t\t\t<form data-dojo-attach-point=\"form\"  data-dojo-type=\"dijit.form.Form\" data-dojo-props='onSubmit:\"return false\",style:\"padding:0px;margin:5px\"'>\r\n\t\t\t\t<p class=\"spacer\">&nbsp;</p>\r\n\t\t\t\t<input data-dojo-attach-point=\"contacthistoryid\"  data-dojo-props='name:\"contacthistoryid\",type:\"hidden\",value:\"-1\"' data-dojo-type=\"dijit.form.TextBox\" />\r\n\t\t\t\t<input data-dojo-props='name:\"outletid\",type:\"hidden\",value:\"-1\"' data-dojo-attach-point=\"outletid\"  data-dojo-type=\"dijit.form.TextBox\" />\r\n\t\t\t\t<input data-dojo-props='name:\"employeeid\",type:\"hidden\",value:\"-1\"' data-dojo-attach-point=\"employeeid\"  data-dojo-type=\"dijit.form.TextBox\" />\r\n\t\t\t\t<input data-dojo-props='name:\"emailtemplateid\",type:\"hidden\",value:\"-1\"' data-dojo-attach-point=\"emailtemplateid\"  data-dojo-type=\"dijit.form.TextBox\" />\r\n\t\t\t\t<label data-dojo-attach-point=\"contact_label\" class=\"label_1\">Contact</label><div data-dojo-props='name:\"contact\",placeHolder:\"Select contact\",required:false,style:\"width:250px;height:85px;float:left\"' data-dojo-type=\"prmax.search.PersonSelect2\" data-dojo-attach-point=\"contact\"></div><br/>\r\n\t\t\t\t<p class=\"spacer\">&nbsp;</p>\r\n\t\t\t\t<label class=\"label_1\" style=\"width:7.1em\">Date</label>\r\n\t\t\t\t<input data-dojo-props='type:\"text\",name:\"taken\",required:\"true\",\"class\":\"input_field input_date prmaxdate\"' data-dojo-attach-point=\"taken\" data-dojo-type=\"dijit.form.DateTextBox\" >\r\n\t\t\t\t<br /><label class=\"label_1\">Taken By</label><select data-dojo-props='style:\"width:10em\",name:\"taken_by\",\"class\":\"prmaxrequired prmaxinputselect\",autoComplete:true,searchAttr:\"name\",required:true,invalidMessage:\"Taken By\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"taken_by\"></select><br/>\r\n\t\t\t\t<div data-dojo-attach-point=\"page_1_point_1\" >\r\n\t\t\t\t\t<div data-dojo-attach-point=\"analysis_node\" >\r\n\t\t\t\t\t\t<br /><div class=\"prmaxhidden\" data-dojo-attach-point=\"chud1_view\" style=\"width:290px;padding-top:2px;float:left\"><label data-dojo-attach-point=\"chud1_label\" class=\"label_1\">User Defined 1</label><select data-dojo-props='\"class\":\"prmaxinputselect\", name:\"chud1id\",autoComplete:true,searchAttr:\"description\",required:false,invalidMessage:\"User Defined\",labelType:\"html\",style:\"width:140px\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"chud1id\"></select></div>\r\n\t\t\t\t\t\t<br /><div class=\"prmaxhidden\" data-dojo-attach-point=\"chud3_view\" style=\"width:290px;padding-top:2px;float:left\"><label data-dojo-attach-point=\"chud3_label\" class=\"label_1\">User Defined 3</label><select data-dojo-props='\"class\":\"prmaxinputselect\", name:\"chud3id\",autoComplete:true,searchAttr:\"description\",required:false,invalidMessage:\"User Defined\",labelType:\"html\",style:\"width:140px\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"chud3id\"></select></div>\r\n\t\t\t\t\t\t<br /><div class=\"prmaxhidden\" data-dojo-attach-point=\"chud2_view\" style=\"width:290px;padding-top:2px;float:left\"><label data-dojo-attach-point=\"chud2_label\" class=\"label_1\">User Defined 2</label><select data-dojo-props='\"class\":\"prmaxinputselect\", name:\"chud2id\",autoComplete:true,searchAttr:\"description\",required:false,invalidMessage:\"User Defined\",labelType:\"html\",style:\"width:140px\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"chud2id\"></select></div>\r\n\t\t\t\t\t\t<br /><div class=\"prmaxhidden\" data-dojo-attach-point=\"chud4_view\" style=\"width:290px;padding-top:2px;float:left\"><label data-dojo-attach-point=\"chud4_label\" class=\"label_1\">User Defined 4</label><select data-dojo-props='\"class\":\"prmaxinputselect\", name:\"chud4id\",autoComplete:true,searchAttr:\"description\",required:false,invalidMessage:\"User Defined\",labelType:\"html\",style:\"width:140px\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"chud4id\"></select></div>\r\n\t\t\t\t\t\t<br /><div class=\"prmaxhidden\" data-dojo-attach-point=\"chud5_view\"><br/><br/><br/><br/><br/><br/></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<label class=\"label_1\" data-dojo-attach-point=\"issue_label_1\">Primary Issue</label><select data-dojo-props='\"class\":\"prmaxrequired prmaxinputselect\",name:\"issueid\",autoComplete:true,searchAttr:\"name\",required:true,invalidMessage:\"Select\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"issueid\" data-dojo-attach-event=\"onChange:_issue_selected\"></select>\r\n\t\t\t\t<button data-dojo-attach-event=\"onClick:_new_issue\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"New\"'></button><br/>\r\n\t\t\t\t<label data-dojo-attach-point=\"subject_label_1\" class=\"label_1\">Subject</label><input data-dojo-props='\"class\":\"prmaxinput\",type:\"text\",name:\"crm_subject\",style:\"width:435px;margin-bottom:2px\"' data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"crm_subject\" /><br/>\r\n\t\t\t\t<label class=\"label_1\">Call Type</label>\r\n\t\t\t\t<select data-dojo-props='\"class\":\"prmaxrequired prmaxinputselect\",name:\"contacthistorytypeid\",autoComplete:true,searchAttr:\"name\",required:true,invalidMessage:\"Select\",labelType:\"html\",style:\"float:left;width:140px\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"contacthistorytypeid\"></select>\r\n\t\t\t\t<br/><label class=\"label_1\" style=\"float:left\">Status</label>\r\n\t\t\t\t<select data-dojo-props='\"class\":\"prmaxrequired prmaxinputselect\",name:\"contacthistorystatusid\",autoComplete:true,searchAttr:\"name\",required:true,invalidMessage:\"Status\",labelType:\"html\",style:\"float:left;width:140px\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"contacthistorystatusid\"></select><br/>\r\n\t\t\t\t<div data-dojo-attach-point=\"page_1_point_3\">\r\n\t\t\t\t\t<div data-dojo-attach-point=\"briefing_node\">\r\n\t\t\t\t\t\t<label class=\"label_1\" data-dojo-attach-point=\"briefing_notes_label\">Briefing Notes</label><br/>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<div class=\"stdframe\" style=\"height:90px;width:90%;float:left\"><textarea data-dojo-attach-point=\"details\" data-dojo-props='name:\"details\",trim:true,style:\"width:99%;height:99%\"' data-dojo-type=\"dijit.form.Textarea\" ></textarea></div>\r\n\t\t\t\t\t\t\t<div style=\"width:5%;float:left\"><button data-dojo-attach-event=\"onClick:_expand_details\" data-dojo-attach-point=\"expanddetailsbtn\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Expand\",iconClass:\"fa fa-expand\",showLabel: false, type:\"button\"'></button></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div data-dojo-attach-point=\"page_1_point_4\">\r\n\t\t\t\t\t<div data-dojo-attach-point=\"crm_response_zone\">\r\n\t\t\t\t\t\t<label class=\"label_1\" data-dojo-attach-point=\"response_label\">Response</label><br/>\r\n\t\t\t\t\t\t<div class=\"stdframe\" style=\"height:90px;width:90%;float:left\"><textarea data-dojo-attach-point=\"crm_response\" data-dojo-props='name:\"crm_response\",trim:true,style:\"width:99%;height:99%\"' data-dojo-type=\"dijit.form.Textarea\" ></textarea></div>\r\n\t\t\t\t\t\t<div style=\"width:5%;float:left\"><button data-dojo-attach-event=\"onClick:_expand_response\" data-dojo-attach-point=\"expandresponsebtn\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Expand\",iconClass:\"fa fa-expand\",showLabel: false, type:\"button\"'></button></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div data-dojo-attach-point=\"page_1_point_2\"></div>\r\n\t\t\t\t<label data-dojo-attach-point=\"client_label\" class=\"label_1\">Client</label><select data-dojo-props='\"class\":\"prmaxinputselect\",name:\"clientid\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clientid\" ></select><button data-dojo-attach-event=\"onClick:_new_client\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"New\"'></button><br/>\r\n\t\t\t\t<label class=\"label_1\">Document</label><select data-dojo-props='\"class\":\"prmaxinputselect\",name:\"documentid\",autoComplete:true,searchAttr:\"description\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"documentid\" ></select><button data-dojo-attach-event=\"onClick:_new_document\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"New\"'></button><br/>\r\n\t\t\t\t<label class=\"label_1\">Follow Up&nbsp;<input data-dojo-props='\"class\":\"prmaxdefault\",type:\"checkbox\",name:\"follow_up_view_check\"' data-dojo-attach-point=\"follow_up_view_check\" data-dojo-type=\"dijit.form.CheckBox\" data-dojo-attach-event=\"onClick:_follow_up_view_change\"/></label><br/>\r\n\t\t\t\t<br/><div data-dojo-attach-point=\"follow_up_view\" class=\"prmaxhidden\">\r\n\t\t\t\t\t<label class=\"label_1\">Follow up date</label>\r\n\t\t\t\t\t<input data-dojo-props='\"class\":\"prmaxinput\",type:\"text\",name:\"follow_up_date\",required:true,style:\"width:140px;float:left\"' data-dojo-attach-point=\"follow_up_date\" data-dojo-type=\"dijit.form.DateTextBox\" >\r\n\t\t\t\t\t<br/><label class=\"label_1\">Follow up by</label>\r\n\t\t\t\t\t<select data-dojo-props='\"class\":\"prmaxrequired prmaxinputselect\",name:\"follow_up_ownerid\",autoComplete:true,searchAttr:\"name\",required:true,invalidMessage:\"Follow Up Only\",labelType:\"html\",style:\"width:140px;float:left\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"follow_up_ownerid\"></select><br/>\r\n\t\t\t\t</div>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t\t<div data-dojo-attach-point=\"details_view2\" data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='title:\"Extended\",style:\"width:600px;height:550px\",\"class\":\"common_prmax_layout scrollpanel\"'>\r\n\t\t\t<form data-dojo-attach-point=\"form2\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='onSubmit:\"return false\",style:\"padding:0px;margin:5px\"'>\r\n\t\t\t\t<br/>\r\n\t\t\t\t<div data-dojo-attach-point=\"page_2_point_1\">\r\n\t\t\t\t\t<div data-dojo-attach-point=\"outcome_node\">\r\n\t\t\t\t\t\t<label class=\"label_1\" data-dojo-attach-point=\"outcome_label_1\">Outcome</label><br/>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<div class=\"stdframe\" style=\"height:90px;width:90%;float:left\"><textarea data-dojo-attach-point=\"outcome\" data-dojo-props='name:\"outcome\",trim:true,style:\"width:99%;height:99%\"' data-dojo-type=\"dijit.form.Textarea\" ></textarea></div>\r\n\t\t\t\t\t\t\t<div style=\"width:5%;float:left\"><button data-dojo-attach-event=\"onClick:_expand_outcome\" data-dojo-attach-point=\"expandoutcomebtn\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Expand\",iconClass:\"fa fa-expand\",showLabel: false, type:\"button\"'></button></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div data-dojo-type=\"prcommon.crm.issues.selectmultiple\" data-dojo-props='style:\"width:96%\",displaytitle:\"Other Issues\",displayselect:\"\",name:\"extraissues\",startopen:false' data-dojo-attach-point=\"extraissues\"></div>\r\n\t\t\t\t<div data-dojo-attach-point=\"page_2_point_2\"></div>\r\n\t\t\t\t<div data-dojo-attach-point=\"page_2_point_3\"></div>\r\n\t\t\t\t<div data-dojo-attach-point=\"page_2_point_4\"></div>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props=\"style:'height:100px;margin-left:10px;margin-right:10px',region:'bottom'\">\r\n\t\t<form data-dojo-attach-point=\"form3\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='onSubmit:\"return false\"'>\r\n\t\t\t<br/>\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_close\" data-dojo-attach-point=\"closebtn\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Close\",\"class\":\"btnleft\",style:\"float:left\"'></button>\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_save\" data-dojo-attach-point=\"savebtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='style:\"padding-right:18px\",type:\"button\",busyLabel:\"Please Wait Saving...\",label:\"Save\",\"class\":\"btnright\",style:\"float:right\"'></button>\r\n\t\t</form>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"person_select_dlg\" data-dojo-type=\"prmax.search.PersonSelect\"></div>\r\n\t<div data-dojo-attach-point=\"new_issue_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"New Issue\"'>\r\n\t\t<div data-dojo-attach-point=\"new_issue_ctrl\" data-dojo-type=\"prcommon.crm.issues.add\"></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"addctrl\" data-dojo-type=\"prcommon.documents.adddialog\"></div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-attach-point=\"client_add_dialog\" data-dojo-props='title:\"Add New Client\",style:\"width:700px;height:600px\"'>\r\n\t\t<div data-dojo-type=\"prmax.customer.clients.add\" data-dojo-attach-point=\"client_add_ctrl\"></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"text_view_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Add Notes\"'>\r\n\t\t<div data-dojo-attach-point=\"text_view_ctrl\" data-dojo-type=\"prcommon.common.ExpandedText\" data-dojo-props='style:\"width:600px;height:500px\"'></div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._users=new dojo.data.ItemFileReadStore({url:"/user/user_list"});this._contacthistorystatus=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=contacthistorystatus"});this._contacthistorytypes=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=prmaxcontacthistorytypes"});this._dialog=null;this._on_select_contact_call_back=dojo.hitch(this,this._on_select_contact);this._save_call_back=dojo.hitch(this,this._save_call);this._issue_brief_call_back=dojo.hitch(this,this._issue_brief_call);this._client_add_call_back=dojo.hitch(this,this._client_add_call);this._clients=new dojox.data.JsonRestStore({target:"/clients/rest_combo",idAttribute:"id"});this._documents=new dojox.data.JsonRestStore({target:"/crm/documents/rest_combo",idAttribute:"id"});this._issues=new dojox.data.QueryReadStore({url:"/crm/issues/issues_list",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true});for(var _1 in this._fields){var _2=this._fields[_1];this["_chud"+_2]=new dojox.data.QueryReadStore({url:"/crm/user_defined?fieldid="+_2,onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true});}dojo.subscribe(PRCOMMON.Events.Issue_Add,dojo.hitch(this,this._new_issue_event));dojo.subscribe("/crm/settings_change",dojo.hitch(this,this._settings_event));dojo.subscribe(PRCOMMON.Events.Document_Add,dojo.hitch(this,this._add_event));dojo.subscribe("/crm/update_person",dojo.hitch(this,this._update_person_event));},_fields:["1","2","3","4"],postCreate:function(){this.taken_by.store=this._users;this.follow_up_ownerid.store=this._users;this.contacthistorystatusid.store=this._contacthistorystatus;this.contacthistorytypeid.store=this._contacthistorytypes;this.issueid.store=this._issues;var _3=false;for(var _4 in this._fields){var _5=this._fields[_4];if(PRMAX.utils.settings["crm_user_define_"+_5]!=""&&PRMAX.utils.settings["crm_user_define_"+_5]!=null){dojo.removeClass(this["chud"+_5+"_view"],"prmaxhidden");dojo.attr(this["chud"+_5+"_label"],"innerHTML",PRMAX.utils.settings["crm_user_define_"+_5]);_3=true;}this["chud"+_5+"id"].store=this["_chud"+_5];}this.clientid.set("store",this._clients);if(PRMAX.utils.settings.required_client){dojo.addClass(this.clientid,"prmaxrequired");this.clientid.set("query",{required_client:true});this.clientid.set("store",this._clients);}else{dojo.removeClass(this.clientid,"prmaxrequired");this.clientid.set("value","-1");}this.documentid.set("store",this._documents);this._clear();dojo.attr(this.issue_label_1,"innerHTML",PRMAX.utils.settings.issue_description);this.new_issue_dlg.set("label",PRMAX.utils.settings.issue_description);this.extraissues.set("displaytitle","Other "+PRMAX.utils.settings.issue_description+"s");if(PRMAX.utils.settings.crm_subject.length>0){dojo.attr(this.subject_label_1,"innerHTML",PRMAX.utils.settings.crm_subject);}if(PRMAX.utils.settings.crm_outcome.length>0){dojo.attr(this.outcome_label_1,"innerHTML",PRMAX.utils.settings.crm_outcome);}dojo.attr(this.briefing_notes_label,"innerHTML",PRMAX.utils.settings.briefing_notes_description);dojo.attr(this.response_label,"innerHTML",PRMAX.utils.settings.response_description);this.initiate_layout();this.inherited(arguments);},_clear:function(){this.tabcont.selectChild(this.details_view);this.emailtemplateid.set("value",-1);this.contacthistorystatusid.set("value",2);this.contacthistorytypeid.set("value",1);this.follow_up_ownerid.set("value",PRMAX.utils.settings.uid);this.taken_by.set("value",PRMAX.utils.settings.uid);this.taken.set("value",new Date());this.follow_up_date.set("value",new Date());this.savebtn.cancel();this.issueid.set("value",null);this.extraissues.clear();this.details.set("value","");this.outcome.set("value","");this.crm_response.set("value","");this.crm_subject.set("value","");this.follow_up_view_check.set("checked",false);this.documentid.set("value","-1");this.emailtemplateid.set("value","-1");},_clear_contact:function(){this.employeeid.set("value","-1");this.outletid.set("value","-1");this.contact.set("Displayvalue","");},clear:function(){this._clear();this._clear_contact();dojo.addClass(this.follow_up_view,"prmaxhidden");},_close:function(){this._clear();if(this._dialog){this._dialog.hide();}},_new_issue:function(){this.new_issue_ctrl.clear();this.new_issue_ctrl.set("dialog",this.new_issue_dlg);this.new_issue_dlg.show();},_save:function(){var _6=this.form.get("value");var _7=this.form2.get("value");_6["taken"]=ttl.utilities.toJsonDate(this.taken.get("value"));_6["follow_up_date"]=ttl.utilities.toJsonDate(this.follow_up_date.get("value"));_6["outletid"]=this.outletid.value;_6["employeeid"]=this.employeeid.value;dojo.xhrPost(ttl.utilities.makeParams({load:this._save_call_back,url:"/crm/add_note",content:dojo.mixin(_6,_7)}));},_save_call:function(_8){if(_8.success=="OK"){dojo.publish("/crm/newnote",[_8.data.ch]);if(_8.data.task){dojo.publish(PRCOMMON.Events.Task_Add,[_8.data.task]);}this._close();}else{alert("Problem adding note");this.savebtn.cancel();}},_on_select_contact:function(_9,_a,_b,_c){this.outletid.set("value",_a);this.employeeid.set("value",_9);var _d="";if(_b!=undefined&&_b!=""){_d=_b;}if(_c!=undefined&&_c!=""&&_d!=null&&_d!=""){_d+=" ("+_c+")";}this.contact.set("Displayvalue",_d);},_select_contact:function(){this.person_select_dlg.start_search(this._on_select_contact_call_back);},_follow_up_view_change:function(){if(this.follow_up_view_check.get("checked")){dojo.removeClass(this.follow_up_view,"prmaxhidden");}else{dojo.addClass(this.follow_up_view,"prmaxhidden");}},load:function(_e,_f,_10,_11,_12,_13){if(_e==""||_e==undefined){this.outletid.set("value",-1);}else{this.outletid.set("value",_e);this.contact.outletid.set("value",_e);}if(_10==""||_10==undefined){this.employeeid.set("value",-1);}else{this.employeeid.set("value",_10);this.contact.employeeid.set("value",_10);}if(_13==""||_13==undefined){this.emailtemplateid.set("value",-1);}else{this.emailtemplateid.set("value",_13);}var _14="";if(_11!=undefined&&_11!=""){_14=_11;}if(_f!=undefined&&_f!=""&&_14!=null&&_14!=""){_14+=" ("+_f+")";}if(_12!=undefined&&_12!=""){this.contact.set("value",_12);}this.contact.set("Displayvalue",_14);this.tabcont.selectChild(this.details_view);},_new_issue_event:function(_15){this.issueid.set("value",_15.issueid);},_setDialogAttr:function(_16){this._dialog=_16;},_settings_event:function(){dojo.addClass(this["chud5_view"],"prmaxhidden");for(var key in this._fields){var _17=this._fields[key];if(PRMAX.utils.settings["crm_user_define_"+_17]!=""&&PRMAX.utils.settings["crm_user_define_"+_17]!=null){dojo.removeClass(this["chud"+_17+"_view"],"prmaxhidden");dojo.removeClass(this["chud5_view"],"prmaxhidden");dojo.attr(this["chud"+_17+"_label"],"innerHTML",PRMAX.utils.settings["crm_user_define_"+_17]);}else{dojo.addClass(this["chud"+_17+"_view"],"prmaxhidden");dojo.attr(this["chud"+_17+"_label"],"innerHTML",PRMAX.utils.settings["crm_user_define_"+_17]);}}this.initiate_layout();},_new_document:function(){this.addctrl.show();},_add_event:function(_18){this.documentid.set("value",_18.documentid);},_issue_selected:function(){var _19=this.issueid.get("value");if(_19!=null&&_19!=""&&_19!="-1"){dojo.xhrPost(ttl.utilities.makeParams({load:this._issue_brief_call_back,url:"/crm/issues/get_briefing_notes",content:{issueid:_19}}));}},_issue_brief_call:function(_1a){if(_1a.success=="OK"){this.details.set("value",_1a.data.briefingnotes);}},_new_client:function(){this.client_add_ctrl.Load(-1,this._client_add_call_back);this.client_add_dialog.show();},_client_add_call:function(_1b,_1c){this.clientid.set("value",_1c.clientid);this.client_add_dialog.hide();},resize:function(){this.tabcont.resize({w:600,h:600});},_update_person_event:function(_1d){this.outletid.set("value",_1d.outletid);this.employeeid.set("value",_1d.employeeid);},_expand_response:function(){this.text_view_ctrl.show_control(this.crm_response,this.text_view_dlg,PRMAX.utils.settings.response_description);},_expand_details:function(){this.text_view_ctrl.show_control(this.details,this.text_view_dlg,PRMAX.utils.settings.briefing_notes_description);},_expand_outcome:function(){this.text_view_ctrl.show_control(this.outcome,this.text_view_dlg,"Outcome");},initiate_layout:function(){var _1e=null;_1e=(PRMAX.utils.settings.crm_outcome_page_1)?this.page_1_point_2:this.page_2_point_1;dojo.place(this.outcome_node,_1e);_1e=(PRMAX.utils.settings.crm_analysis_page_1)?this.page_1_point_1:this.page_2_point_2;dojo.place(this.analysis_node,_1e);_1e=(PRMAX.utils.settings.crm_response_page_1)?this.page_1_point_4:this.page_2_point_4;dojo.place(this.crm_response_zone,_1e);_1e=(PRMAX.utils.settings.crm_briefingnotes_page_1)?this.page_1_point_3:this.page_2_point_3;dojo.place(this.briefing_node,_1e);}});}