/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.crm.userdefined"]){dojo._hasResource["prcommon.crm.userdefined"]=true;dojo.provide("prcommon.crm.userdefined");dojo.require("ttl.BaseWidget");dojo.require("dijit.Dialog");dojo.declare("prcommon.crm.userdefined",[ttl.BaseWidget],{widgetsInTemplate:true,fieldid:1,templateString:"<div >\r\n\t<div data-dojo-type=\"dijit.layout.ContentPane\"  data-dojo-props='style:\"width:98%;height:150px;border:1px solid black;padding:2px\",\"class\":\"common_prmax_layout\"'>\r\n\t\t<label>Selection Options</label><button data-dojo-attach-event=\"onClick:_show_add\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Result\",\"class\":\"btnright\",iconClass:\"fa fa-plus\"'></button><br/>\r\n\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='query:{fieldid:${fieldid} },rowsPerPage:30,style:\"padding:2px;margin-top:5px\"' ></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"new_item_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"New User Defined\"'>\r\n\t\t<br/>\r\n\t\t<form data-dojo-attach-point=\"form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='onSubmit:\"return false\",\"class\":\"common_prmax_layout\"'>\r\n\t\t\t<label class=\"label_2\">User Defined</label><input data-dojo-attach-point=\"crm_user_define_1\" data-dojo-props='name:\"description\",type:\"text\",required:false,trim:true' data-dojo-type=\"dijit.form.ValidationTextBox\" />\r\n\t\t\t<br/><br/>\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_close\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Close\",\"class\":\"btnright prmaxhidden\"'></button><button data-dojo-attach-event=\"onClick:_add\" data-dojo-attach-point=\"addbtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Adding...\",label:\"Adding\",\"class\":\"btnright\"'></button>\r\n\t\t</form>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._add_call_back=dojo.hitch(this,this._add_call);this._error_call_back=dojo.hitch(this,this._error_call);this._delete_call_back=dojo.hitch(this,this._delete_call);this._store=new prcommon.data.QueryWriteStore({url:"/crm/user_defined",nocallback:true,onError:ttl.utilities.globalerrorchecker});},view:{cells:[[{name:"Items",width:"auto",field:"description"},{name:" ",width:"20px",formatter:ttl.utilities.format_row_ctrl}]]},postCreate:function(){this.grid.set("structure",this.view);this.grid._setStore(this._store);this.grid.onRowClick=dojo.hitch(this,this._on_select_row);this.inherited(arguments);},_on_select_row:function(e){this._row=this.grid.getItem(e.rowIndex);if(this._row&&confirm("Delete ("+this._row.i.description+")?")){dojo.xhrPost(ttl.utilities.makeParams({load:this._delete_call_back,url:"/crm/user_defined_delete",error:this._error_call_back,content:{contacthistoryuserdefinid:this._row.i.contacthistoryuserdefinid}}));}},_delete_call:function(_1){if(_1.success=="OK"){this._store.deleteItem(this._row);}},force_startup:function(){this.grid.resize({w:200,h:150});},_add:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Not all required field filled in");this.addbtn.cancel();return;}var _2=this.form.get("value");_2["fieldid"]=this.fieldid;dojo.xhrPost(ttl.utilities.makeParams({load:this._add_call_back,url:"/crm/user_defined_add",error:this._error_call_back,content:_2}));},_add_call:function(_3){if(_3.success=="OK"){this._store.newItem(_3.data);this.new_item_dlg.hide();}else{if(_3.success=="DU"){alert("already exist's");}else{alert("Problem");}}this.addbtn.cancel();},_show_add:function(){this.addbtn.cancel();this.crm_user_define_1.set("value","");this.new_item_dlg.show();},_close:function(){this.new_item_dlg.hide();this.crm_user_define_1.set("value","");},_error_call:function(_4,_5){ttl.utilities.xhrPostError(_4,_5);this.addbtn.cancel();}});}