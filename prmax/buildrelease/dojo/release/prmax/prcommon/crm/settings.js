/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.crm.settings"]){dojo._hasResource["prcommon.crm.settings"]=true;dojo.provide("prcommon.crm.settings");dojo.require("ttl.BaseWidget");dojo.require("prcommon.crm.userdefined");dojo.declare("prcommon.crm.settings",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"tabcont\" data-dojo-type=\"dijit.layout.TabContainer\" data-dojo-props='region:\"center\"'>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\"  data-dojo-props='style:\"width:700px;height:650px\",\"class\":\"common_prmax_layout\",title:\"User Defined Fields\"'>\r\n\t\t\t<br/>\r\n\t\t\t<form data-dojo-attach-point=\"form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='onSubmit:\"return false\"'>\r\n\t\t\t\t<div style=\"float:left;width:280px;height:500px;margin-left:5px\">\r\n\t\t\t\t\t<label class=\"label_2\" style=\"width:275px\">User Defined Field 1<input data-dojo-type=\"dijit.form.CheckBox\" data-dojo-attach-point=\"crm_user_define_1_on\" data-dojo-props='\"class\":\"input_field\",type:\"checkbox\",name:\"crm_user_define_1_on\"' data-dojo-attach-event=\"onClick:_display_fields\" ></label>\r\n\t\t\t\t\t<label data-dojo-attach-point=\"crm_user_define_1_label\" class=\"prmaxhidden label_2\" style=\"width:50px;float:left\">Label</label><input data-dojo-attach-point=\"crm_user_define_1\" data-dojo-props='\"class\":\"prmaxhidden prmaxinput\",name:\"crm_user_define_1\",type:\"text\",required:false,trim:true,style:\"float:left\"' data-dojo-type=\"dijit.form.ValidationTextBox\" />\r\n\t\t\t\t\t<br/><br/>\r\n\t\t\t\t\t<div data-dojo-type=\"prcommon.crm.userdefined\" data-dojo-attach-point=\"crm_user_define_menu_1\" data-dojo-props=\"fieldid:1\"></div><br/>\r\n\t\t\t\t\t<label class=\"label_2\" style=\"width:275px\">User Defined Field 2<input data-dojo-type=\"dijit.form.CheckBox\" data-dojo-attach-point=\"crm_user_define_2_on\" data-dojo-props='\"class\":\"input_field\",type:\"checkbox\",name:\"crm_user_define_2_on\"' data-dojo-attach-event=\"onClick:_display_fields\"></label>\r\n\t\t\t\t\t<label data-dojo-attach-point=\"crm_user_define_2_label\" class=\"prmaxhidden label_2\" style=\"width:50px;float:left\">Label</label><input data-dojo-attach-point=\"crm_user_define_2\" data-dojo-props='\"class\":\"prmaxhidden prmaxinput\",name:\"crm_user_define_2\",type:\"text\",required:false,trim:true' data-dojo-type=\"dijit.form.ValidationTextBox\" />\r\n\t\t\t\t\t<br/><br/>\r\n\t\t\t\t\t<div data-dojo-type=\"prcommon.crm.userdefined\" data-dojo-attach-point=\"crm_user_define_menu_2\" data-dojo-props=\"fieldid:2\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style=\"float:right;width:280px;height:500px;margin-right:5px\">\r\n\t\t\t\t\t<label class=\"label_2\" style=\"width:275px\">User Defined Field 3<input data-dojo-type=\"dijit.form.CheckBox\" data-dojo-attach-point=\"crm_user_define_3_on\" data-dojo-props='\"class\":\"input_field\",type:\"checkbox\",name:\"crm_user_define_3_on\"' data-dojo-attach-event=\"onClick:_display_fields\"></label>\r\n\t\t\t\t\t<label data-dojo-attach-point=\"crm_user_define_3_label\" class=\"prmaxhidden label_2\" style=\"width:50px;float:left\">Label</label><input data-dojo-attach-point=\"crm_user_define_3\" data-dojo-props='\"class\":\"prmaxhidden prmaxinput\",name:\"crm_user_define_3\",type:\"text\",required:false,trim:true' data-dojo-type=\"dijit.form.ValidationTextBox\" />\r\n\t\t\t\t\t<br/><br/>\r\n\t\t\t\t\t<div data-dojo-type=\"prcommon.crm.userdefined\" data-dojo-attach-point=\"crm_user_define_menu_3\" data-dojo-props=\"fieldid:3\"></div><br/>\r\n\t\t\t\t\t<label class=\"label_2\" style=\"width:275px\">User Defined Field 4<input data-dojo-type=\"dijit.form.CheckBox\" data-dojo-attach-point=\"crm_user_define_4_on\" data-dojo-props='\"class\":\"input_field\",type:\"checkbox\",name:\"crm_user_define_4_on\"' data-dojo-attach-event=\"onClick:_display_fields\"></label>\r\n\t\t\t\t\t<label data-dojo-attach-point=\"crm_user_define_4_label\" class=\"prmaxhidden label_2\" style=\"width:50px;float:left\">Label</label><input data-dojo-attach-point=\"crm_user_define_4\" data-dojo-props='\"class\":\"prmaxhidden prmaxinput\",name:\"crm_user_define_4\",type:\"text\",required:false,trim:true' data-dojo-type=\"dijit.form.ValidationTextBox\" />\r\n\t\t\t\t\t<br/><br/>\r\n\t\t\t\t\t<div data-dojo-type=\"prcommon.crm.userdefined\" data-dojo-attach-point=\"crm_user_define_menu_4\" data-dojo-props=\"fieldid:4\"></div>\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t</div><br/><br/>\r\n\t\t\t\t<button data-dojo-attach-event=\"onClick:_save\" data-dojo-attach-point=\"savebtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Updating...\",label:\"Update\",\"class\":\"btnright\",style:\"float:right\"'></button>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\"  data-dojo-props='style:\"width:600px;height:450px\",\"class\":\"common_prmax_layout\",title:\"Layout\"'>\r\n\t\t\t<form data-dojo-attach-point=\"form_layout\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='onSubmit:\"return false\"'>\r\n\t\t\t\t<div style=\"width:600px;height:366px\">\r\n\t\t\t\t\t<br/><p style=\"text-align:center;font-size:1.2em;font-weight:bold;width:100%\">Engagement field's on page 1</p><br/>\r\n\t\t\t\t\t<label class=\"label_2\"><input data-dojo-attach-point=\"crm_outcome_page_1\"  data-dojo-type=\"dijit.form.CheckBox\" data-dojo-props='name:\"crm_outcome_page_1\",\"class\":\"prmaxdefault\",type:\"checkbox\",value:\"1\",checked:false'/> Outcome</label><br/>\r\n\t\t\t\t\t<p class=\"spacer\">&nbsp;</p>\r\n\t\t\t\t\t<label class=\"label_2\"><input data-dojo-attach-point=\"crm_analysis_page_1\"  data-dojo-type=\"dijit.form.CheckBox\" data-dojo-props='name:\"crm_analysis_page_1\",\"class\":\"prmaxdefault\",type:\"checkbox\",value:\"1\",checked:true'/> Analysis</label><br/>\r\n\t\t\t\t\t<p class=\"spacer\">&nbsp;</p>\r\n\t\t\t\t\t<label class=\"label_2\"><input data-dojo-attach-point=\"crm_response_page_1\"  data-dojo-type=\"dijit.form.CheckBox\" data-dojo-props='name:\"crm_response_page_1\",\"class\":\"prmaxdefault\",type:\"checkbox\",value:\"1\",checked:true'/> Response</label><br/>\r\n\t\t\t\t\t<p class=\"spacer\">&nbsp;</p>\r\n\t\t\t\t\t<label class=\"label_2\"><input data-dojo-attach-point=\"crm_briefingnotes_page_1\"  data-dojo-type=\"dijit.form.CheckBox\" data-dojo-props='name:\"crm_briefingnotes_page_1\",\"class\":\"prmaxdefault\",type:\"checkbox\",value:\"1\",checked:true'/> Briefing Notes</label><br/>\r\n\t\t\t\t\t<p class=\"spacer\">&nbsp;</p>\r\n\t\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t\t<button data-dojo-attach-event=\"onClick:_save_layout\" data-dojo-attach-point=\"savelayoutbtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Updating...\",label:\"Update\",\"class\":\"btnright\",style:\"float:right\"'></button>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\"  data-dojo-props='style:\"width:600px;height:450px\",\"class\":\"common_prmax_layout\",title:\"Descriptions\"'>\r\n\t\t\t<form data-dojo-attach-point=\"form_descriptions\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='onSubmit:\"return false\"'>\r\n\t\t\t\t<div style=\"width:600px;height:366px\">\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t<label class=\"label_2\">\"Subject\" Name</label><input data-dojo-props='style:\"float:left;width:8em\",\"class\":\"prmaxinput\",size:40,name:\"crm_subject\",maxLength:20,trim:true,required:false,invalidMessage:\"This cannot be blank\"' data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"crm_subject\"/><br/>\r\n\t\t\t\t\t<p class=\"spacer\">&nbsp;</p>\r\n\t\t\t\t\t<label class=\"label_2\">\"Outcome\" Name</label><input data-dojo-props='style:\"float:left;width:8em\",\"class\":\"prmaxinput\",size:40,name:\"crm_outcome\",maxLength:20,trim:true,required:false,invalidMessage:\"This cannot be blank\"' data-dojo-attach-point=\"crm_outcome\" data-dojo-type=\"dijit.form.ValidationTextBox\" /><br/>\r\n\t\t\t\t\t<p class=\"spacer\">&nbsp;</p>\r\n\t\t\t\t\t<label class=\"label_2\">\"Engagement\"</label><input data-dojo-attach-point=\"crm_engagement\" data-dojo-props='style:\"float:left;width:10em\",\"class\":\"prmaxinput\",size:40,name:\"crm_engagement\",maxLength:20,trim:true,required:false,invalidMessage:\"This cannot be blank\"' data-dojo-type=\"dijit.form.ValidationTextBox\" />\r\n\t\t\t\t\t<label class=\"label_1\">Plural</label><input  data-dojo-props='style:\"float:left;width:8em\",\"class\":\"prmaxinput\",size:40,name:\"crm_engagement_plural\",maxLength:20,trim:true,required:false,invalidMessage:\"This cannot be blank\"' data-dojo-attach-point=\"crm_engagement_plural\" data-dojo-type=\"dijit.form.ValidationTextBox\"/><br/>\r\n\t\t\t\t\t<p class=\"spacer\">&nbsp;</p>\r\n\t\t\t\t\t<label class=\"label_2\">\"Briefing Notes\"</label><input data-dojo-props='style:\"float:left;width:8em\",\"class\":\"prmaxinput\",size:40,name:\"briefing_notes_description\",maxLength:20,trim:true,required:false,invalidMessage:\"This cannot be blank\"' data-dojo-attach-point=\"briefing_notes_description\" data-dojo-type=\"dijit.form.ValidationTextBox\"/><br/>\r\n\t\t\t\t\t<p class=\"spacer\">&nbsp;</p>\r\n\t\t\t\t\t<label class=\"label_2\">\"Response\"</label><input data-dojo-props='style:\"float:left;width:8em\",\"class\":\"prmaxinput\",size:40,maxlength:20,trim:true,required:false,invalidMessage:\"This cannot be blank\",name:\"response_description\"' data-dojo-attach-point=\"response_description\" name=\"response_description\" data-dojo-type=\"dijit.form.ValidationTextBox\"/><br/>\r\n\t\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t\t<button data-dojo-attach-event=\"onClick:_save_desc\" data-dojo-attach-point=\"savedescbtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Updating...\",label:\"Update\",\"class\":\"btnright\",style:\"float:right\"'></button>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props=\"style:'height:45px',region:'bottom'\">\r\n\t\t<button data-dojo-attach-event=\"onClick:_close\" data-dojo-attach-point=\"closebtn\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Close\",style:\"float:right\"'></button>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._dialog=null;this._save_call_back=dojo.hitch(this,this._save_call);this._save_desc_call_back=dojo.hitch(this,this._save_desc_call);this._load_call_back=dojo.hitch(this,this._load_call);this._error_call_back=dojo.hitch(this,this._error_call);this._save_layout_call_back=dojo.hitch(this,this._save_layout_call);},postCreate:function(){this.inherited(arguments);},_clear:function(){this.savebtn.cancel();this.savedescbtn.cancel();this.savelayoutbtn.cancel();},_close:function(){this._clear();if(this._dialog){this._dialog.hide();}},_save:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._save_call_back,url:"/crm/update_settings",error:this._error_call_back,content:this.form.get("value")}));},_save_call:function(_1){if(_1.success=="OK"){PRMAX.utils.settings.crm_user_define_1=_1.data.crm_user_define_1;PRMAX.utils.settings.crm_user_define_2=_1.data.crm_user_define_2;PRMAX.utils.settings.crm_user_define_3=_1.data.crm_user_define_3;PRMAX.utils.settings.crm_user_define_4=_1.data.crm_user_define_4;dojo.publish("/crm/settings_change",[]);}else{alert("Problem updating settings");}this.savebtn.cancel();},_save_desc_call:function(_2){if(_2.success=="OK"){dojo.publish("/crm/settings_change",[]);}else{alert("Problem updating settings");}this.savedescbtn.cancel();},_fields:["1","2","3","4"],_load_call:function(_3){if(_3.success=="OK"){for(var _4 in this._fields){var _5=this._fields[_4];this["crm_user_define_"+_5].set("value",_3.data["crm_user_define_"+_5]);if(_3.data["crm_user_define_"+_5]!=""&&_3.data["crm_user_define_"+_5]!=null){this["crm_user_define_"+_5+"_on"].set("checked",true);}else{this["crm_user_define_"+_5+"_on"].set("checked",false);}this["crm_user_define_menu_"+_5].force_startup();}this.crm_user_define_1.startup();this.crm_user_define_2.startup();this.crm_user_define_3.startup();this.crm_user_define_4.startup();this._dialog.show();this._display_fields();this.crm_outcome.set("value",_3.data.crm_outcome);this.crm_subject.set("value",_3.data.crm_subject);this.crm_engagement.set("value",_3.data.crm_engagement);this.crm_engagement_plural.set("value",_3.data.crm_engagement_plural);this.briefing_notes_description.set("value",_3.data.briefing_notes_description);this.response_description.set("value",_3.data.response_description);this.crm_analysis_page_1.set("checked",_3.data.crm_analysis_page_1);this.crm_outcome_page_1.set("checked",_3.data.crm_outcome_page_1);this.crm_briefingnotes_page_1.set("checked",_3.data.crm_response_page_1);this.crm_response_page_1.set("checked",_3.data.crm_response_page_1);}else{alert("Problem Loading Settings");}},load:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._load_call_back,url:"/crm/load_settings"}));},_setDialogAttr:function(_6){this._dialog=_6;},_display_fields:function(){for(var _7 in this._fields){var _8=this._fields[_7];var _9=this["crm_user_define_"+_8+"_on"].get("checked");if(_9){dojo.removeClass(this["crm_user_define_"+_8].domNode,"prmaxhidden");dojo.removeClass(this["crm_user_define_menu_"+_8].domNode,"prmaxhidden");dojo.removeClass(this["crm_user_define_"+_8+"_label"],"prmaxhidden");this["crm_user_define_menu_"+_8].force_startup();}else{dojo.addClass(this["crm_user_define_"+_8].domNode,"prmaxhidden");dojo.addClass(this["crm_user_define_menu_"+_8].domNode,"prmaxhidden");dojo.addClass(this["crm_user_define_"+_8+"_label"],"prmaxhidden");}}},_error_call:function(_a,_b){ttl.utilities.xhrPostError(_a,_b);this.savebtn.cancel();this.savelayoutbtn.cancel();this.savedescbtn.cancel();},resize:function(){this.tabcont.resize({w:700,h:650});},_save_desc:function(){if(ttl.utilities.formValidator(this.form_descriptions)==false){alert("Not all required field filled in");this.savedescbtn.cancel();return;}dojo.xhrPost(ttl.utilities.makeParams({load:this._save_desc_call_back,url:"/crm/update_settings_desc",error:this._error_call_back,content:this.form_descriptions.get("value")}));},_save_layout:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._save_layout_call_back,url:"/crm/update_settings_layout",error:this._error_call_back,content:this.form_layout.get("value")}));},_save_layout_call:function(_c){if(_c.success=="OK"){PRMAX.utils.settings.crm_analysis_page_1=_c.data.crm_analysis_page_1;PRMAX.utils.settings.crm_outcome_page_1=_c.data.crm_outcome_page_1;PRMAX.utils.settings.crm_response_page_1=_c.data.crm_response_page_1;PRMAX.utils.settings.crm_briefingnotes_page_1=_c.data.crm_briefingnotes_page_1;dojo.publish("/crm/settings_change",[]);}else{alert("Problem updating settings");}this.savelayoutbtn.cancel();}});}