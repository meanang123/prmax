/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.crm.ViewContact"]){dojo._hasResource["prmax.crm.ViewContact"]=true;dojo.provide("prmax.crm.ViewContact");dojo.declare("prmax.crm.ViewContact",[dijit._Widget,dijit._Templated,dijit._Container],{widgetsInTemplate:true,contacthistoryid:-1,isdelete:false,isedit:false,templateString:"<div class=\"prmaxhidden scrollpanel\" dojoAttachPoint=\"view\" style=\"width:100%;height:100%\" >\r\n\t<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" class=\"prmaxtable\" border=\"0\">\r\n\t\t<tr><td align=\"right\" width=\"20%\" class=\"prmaxrowtag\" >Subject</td><td colspan=\"2\" dojoAttachPoint=\"subject\"></td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Created Date</td><td dojoAttachPoint=\"taken\"></td>\r\n\t\t<td rowspan=\"2\" align=\"right\" width=\"10%\" ><button dojotype=\"dijit.form.Button\" label=\"Edit Note\" dojoAttachEvent=\"onClick:_EditNote\" dojoAttachPoint=\"editbtn\" class=\"prmaxhidden\"></button></td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Created By</td><td dojoAttachPoint=\"takenbyname\"></td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Source Type</td><td dojoAttachPoint=\"contacthistorydescription\"></td>\r\n\t\t<td rowspan=\"2\" align=\"right\" width=\"10%\" ><button dojotype=\"dijit.form.Button\" label=\"Delete Note\" dojoAttachEvent=\"onClick:_DeleteNote\" dojoAttachPoint=\"deletebtn\" class=\"prmaxhidden\"></button></td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Modified Date</td><td dojoAttachPoint=\"modified\"></td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Modified By</td><td dojoAttachPoint=\"modifiedbyname\"></td></tr>\r\n\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\">Details</td><td  colspan=\"2\" dojoAttachPoint=\"details\"></td></tr>\r\n\t</table>\r\n\t<div dojoAttachPoint=\"editctrl\" dojoType=\"dijit.Dialog\" title=\"Edit Contact Note\">\r\n\t\t<div dojoAttachPoint=\"editctrl1\" dojotype=\"prmax.crm.AddContact\" showclose=\"true\" isedit=\"true\" style=\"width:600px;height:300px\"></div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._LoadCallBack=dojo.hitch(this,this._LoadCall);this._DeleteCallBack=dojo.hitch(this,this._DeleteCall);dojo.subscribe(PRCOMMON.Events.Dialog_Close,dojo.hitch(this,this._DialogCloseEvent));dojo.subscribe(PRCOMMON.Events.Crm_Note_Update,dojo.hitch(this,this._UpdateNoteEvent));this.inherited(arguments);},postCreate:function(){if(this.isdelete==true){dojo.removeClass(this.deletebtn.domNode,"prmaxhidden");}if(this.isedit==true){dojo.removeClass(this.editbtn.domNode,"prmaxhidden");}this.inherited(arguments);},Load:function(_1){this.contacthistoryid=_1;dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCallBack,url:"/crm/getnote",content:{contacthistoryid:_1}}));},_LoadCall:function(_2){if(_2.success=="OK"){this._LoadDisplay(_2.data);dojo.removeClass(this.view,"prmaxhidden");}},_LoadDisplay:function(_3){dojo.attr(this.subject,"innerHTML",_3.subject);dojo.attr(this.taken,"innerHTML",_3.taken);dojo.attr(this.details,"innerHTML",_3.details);dojo.attr(this.takenbyname,"innerHTML",_3.takenbyname);dojo.attr(this.modified,"innerHTML",_3.modified);dojo.attr(this.modifiedbyname,"innerHTML",_3.modifiedbyname);dojo.attr(this.contacthistorydescription,"innerHTML",_3.contacthistorydescription);},_EditNote:function(){this.editctrl1.LoadEdit(this.contacthistoryid);this.editctrl.show();},_DialogCloseEvent:function(_4){if(_4=="add_contact"){this.editctrl.hide();}},_UpdateNoteEvent:function(_5){this._LoadDisplay(_5);},_DeleteCall:function(_6){if(_6.success=="OK"){dojo.publish(PRCOMMON.Events.Crm_Note_Delete,[this.contacthistoryid]);this.Clear();}else{alert("Problem Deleting Note");}},_DeleteNote:function(){if(confirm("Delete Note")){dojo.xhrPost(ttl.utilities.makeParams({load:this._DeleteCallBack,url:"/crm/deletenote",content:{contacthistoryid:this.contacthistoryid}}));}},Clear:function(){dojo.addClass(this.view,"prmaxhidden");dojo.attr(this.subject,"innerHTML","");dojo.attr(this.taken,"innerHTML","");dojo.attr(this.details,"innerHTML","");dojo.attr(this.takenbyname,"innerHTML","");dojo.attr(this.modified,"innerHTML","");dojo.attr(this.modifiedbyname,"innerHTML","");dojo.attr(this.contacthistorydescription,"innerHTML","");}});}