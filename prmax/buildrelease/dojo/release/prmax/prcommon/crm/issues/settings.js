/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.crm.issues.settings"]){dojo._hasResource["prcommon.crm.issues.settings"]=true;dojo.provide("prcommon.crm.issues.settings");dojo.require("ttl.BaseWidget");dojo.require("prcommon.crm.issues.briefingnoteadd");dojo.require("prcommon.crm.issues.briefingnoteupdate");dojo.declare("prcommon.crm.issues.settings",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div >\r\n\t<div data-dojo-type=\"dijit.layout.ContentPane\"  data-dojo-props='style:\"width:400px;height:300px;margin:10px\",\"class\":\"common_prmax_layout\"'>\r\n\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='query:{},rowsPerPage:30' ></div>\r\n\t\t<button data-dojo-attach-event=\"onClick:_close\" data-dojo-attach-point=\"closebtn\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Close\",style:\"float:left\"'></button>\r\n\t\t<button data-dojo-attach-event=\"onClick:_add_briefing_status\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Add\",\"class\":\"btnright\",style:\"float:right\"'></button>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"new_briefingnote_status_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"New Briefing Note Status\"'>\r\n\t\t<div data-dojo-attach-point=\"new_briefingnote_status_ctrl\" data-dojo-type=\"prcommon.crm.issues.briefingnoteadd\"></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"upd_briefingnote_status_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Update Briefing Note Status\"'>\r\n\t\t<div data-dojo-attach-point=\"upd_briefingnote_status_ctrl\" data-dojo-type=\"prcommon.crm.issues.briefingnoteupdate\"></div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._dialog=null;this._add_call_back=dojo.hitch(this,this._add_call);this._error_call_back=dojo.hitch(this,this._error_call);this._delete_call_back=dojo.hitch(this,this._delete_call);this._store=new prcommon.data.QueryWriteStore({url:"/crm/issues/briefingnotelist",nocallback:true,onError:ttl.utilities.globalerrorchecker});dojo.subscribe("/bn/add",dojo.hitch(this,this._add_event));dojo.subscribe("/bn/upd",dojo.hitch(this,this._update_event));},view:{cells:[[{name:"Items",width:"auto",field:"briefingnotesstatusdescription"},{name:" ",width:"20px",formatter:ttl.utilities.editRowCtrl},{name:" ",width:"20px",formatter:ttl.utilities.deleteRowCtrl}]]},postCreate:function(){this.inherited(arguments);this.grid.set("structure",this.view);this.grid._setStore(this._store);this.grid.onRowClick=dojo.hitch(this,this._on_select_row);this.force_startup();dojo.attr(this.new_briefingnote_status_dlg,"title","New "+PRMAX.utils.settings.briefing_notes_description+" Status");dojo.attr(this.upd_briefingnote_status_dlg,"title","Update "+PRMAX.utils.settings.briefing_notes_description+" Status");},_clear:function(){},_close:function(){this._clear();if(this._dialog){this._dialog.hide();}},_load_call:function(_1){if(_1.success=="OK"){this._dialog.show();}else{alert("Problem Loading Settings");}},load:function(){},_setDialogAttr:function(_2){this._dialog=_2;},_add_briefing_status:function(){this.new_briefingnote_status_ctrl.set("dialog",this.new_briefingnote_status_dlg);this.new_briefingnote_status_dlg.show();},_on_select_row:function(e){this._row=this.grid.getItem(e.rowIndex);if(this._row){switch(e.cellIndex){case 2:if(confirm("Delete ("+this._row.i.briefingnotesstatusdescription+")?")){dojo.xhrPost(ttl.utilities.makeParams({load:this._delete_call_back,url:"/crm/issues/briefingnotedelete",error:this._error_call_back,content:{briefingnotesstatusid:this._row.i.briefingnotesstatusid}}));}break;default:this.upd_briefingnote_status_ctrl.set("dialog",this.upd_briefingnote_status_dlg);this.upd_briefingnote_status_ctrl.load(this._row.i.briefingnotesstatusid);break;}}},force_startup:function(){this.grid.resize({w:400,h:250});},_delete_call:function(_3){if(_3.success=="OK"){this._store.deleteItem(this._row);this._row=null;}else{alert("Problem Deleting "+PRMAX.utils.settings.briefing_notes_description+" Status");}},_add_event:function(_4){this._store.newItem(_4);},_update_event:function(_5){this._store.setValue(this._row,"briefingnotesstatusdescription",_5.briefingnotesstatusdescription,true);}});}