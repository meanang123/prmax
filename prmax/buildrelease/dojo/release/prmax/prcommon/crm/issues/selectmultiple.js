/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.crm.issues.selectmultiple"]){dojo._hasResource["prcommon.crm.issues.selectmultiple"]=true;dojo.provide("prcommon.crm.issues.selectmultiple");dojo.require("ttl.BaseWidget");dojo.require("prcommon.search.std_search");dojo.require("prcommon.crm.issues.add");dojo.declare("prcommon.crm.issues.selectmultiple",[ttl.BaseWidget],{name:"",value:"",displaytitle:"Issues",displayselect:"Select",show_header:false,search:"",size:"6",selectonly:true,startopen:true,widgetsInTemplate:true,templateString:"<div data-dojo-attach-point=\"containerNode\" >\r\n\t<div data-dojo-attach-point=\"header_panel\" >\r\n\t\t<table width=\"100%\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t<tr>\r\n\t\t\t\t<td width=\"20%\" data-dojo-attach-point=\"issue_label_2\" class=\"prmaxrowtag\">${displaytitle}</td>\r\n\t\t\t\t<td width=\"5%\" ><img height=\"16px\" width=\"16px\" data-dojo-attach-point=\"togglectrl\" data-dojo-attach-event=\"onclick:_toggle\" src=\"/static/images/toopen.gif\" class=\"toggleselect\"></img></td>\r\n\t\t\t\t<td width=\"75%\"></td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n\t<div class=\"dojoissuePane\" >\r\n\t\t<div data-dojo-attach-point=\"selectarea\" class=\"prmaxselectmultiple\" style=\"padding:0px;margin:0px\" >\r\n\t\t\t<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan=\"2\">\r\n\t\t\t\t\t\t<table style=\"width:100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t<td width=\"40%\" data-dojo-attach-point=\"master_type_text\"><span data-dojo-attach-point=\"issue_label_1\" class=\"prmaxrowtag\">${displayselect}</span><input class=\"prmaxfocus prmaxinput\" type=\"text\" data-dojo-type=\"dijit.form.TextBox\" style=\"width:60%\" data-dojo-attach-point=\"issue_list_select\" data-dojo-attach-event=\"onkeyup:_issue_select\" /></td>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td align=\"right\" width=\"100px\"><button data-dojo-attach-event=\"onClick:_new_issue\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"New\",iconClass:\"fa fa-plus\"'></button></td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr><td width=\"47%\"><select style=\"width:100%\" data-dojo-attach-point=\"issue_list\" size=\"${size}\" class=\"select_list\" multiple=\"multiple\" ></select></td>\r\n\t\t\t\t\t<td width=\"5%\">\r\n\t\t\t\t\t\t<button class=\"button_add_all\"  style=\"padding:0px;margin:0px\" class=\"button_add_all\" data-dojo-attach-point=\"button_all\" disabled=\"true\" type=\"button\" data-dojo-attach-event=\"onClick:issue_select_all\" data-dojo-type=\"dijit.form.Button\"><div class=\"std_movement_button\">&gt;&gt;</div></button><br/>\r\n\t\t\t\t\t\t<button class=\"button_add_single\" style=\"padding:0px;margin:0px\" class=\"button_add_single\" data-dojo-attach-point=\"button_single\" disabled=\"true\" type=\"button\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:issue_select_single\"><div class=\"std_movement_button\">&gt;&nbsp;</div></button><br/>\r\n\t\t\t\t\t\t<button class=\"button_del_all\" style=\"padding:0px;margin:0px\" class=\"button_del_all\" data-dojo-attach-point=\"button_del_all\" disabled=\"true\" type=\"button\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:issue_remove_all\"><div class=\"std_movement_button\">&lt;&lt;</div></button><br/>\r\n\t\t\t\t\t\t<button class=\"button_del_single\" style=\"padding:0px;margin:0px\" class=\"button_del_single\" data-dojo-attach-point=\"button_del_single\" disabled=\"true\" type=\"button\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:issue_remove_single\"><div class=\"std_movement_button\">&lt;&nbsp;</div></button>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td width=\"48%\"><select style=\"width:100%\" data-dojo-attach-point=\"issue_select\" size=\"${size}\" class=\"selection_lists\" multiple=\"multiple\" data-dojo-attach-event=\"onchange:issue_update_selection\"></select></td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"new_issue_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"New\"'>\r\n\t\t<div data-dojo-attach-point=\"new_issue_ctrl\" data-dojo-type=\"prcommon.crm.issues.add\"></div>\r\n\t</div>\r\n\r\n</div>\r\n",constructor:function(){this.disabled=false;this._extended=false;this._load_selection_call=dojo.hitch(this,this._load_selection);this.issue_timer=null;dojo.subscribe("/issue/add_multi",dojo.hitch(this,this._other_issue_event));},statup2:function(){this.inherited(arguments);},postCreate:function(){this.open=true;dojo.connect(this.issue_list_select.domNode,"onkeyup",dojo.hitch(this,this._issue_select));dojo.connect(this.issue_list,"onchange",dojo.hitch(this,this.issue_update_selection));dojo.connect(this.issue_list,"ondblclick",dojo.hitch(this,this.issue_select_dbl));if(this.startopen==false){this.open=false;dojo.style(this.selectarea,"display","none");}this.inherited(arguments);},clear:function(){this._clear_selection_box();this._clear_selected_box();this.issue_list_select.set("value","");this._Get(this._getValueAttr());this._selection_options();this.load_default();this.inherited(arguments);},_send_request:function(_1){this._transactionid=PRCOMMON.utils.uuid.createUUID();dojo.xhrPost(ttl.utilities.makeParams({load:this._load_selection_call,url:"/crm/issues/listuserselection",content:{word:_1,transactionid:this._transactionid}}));},_issue_select:function(p1,_2){var _3=this.issue_list_select.get("value");if(_2!=null){_3=_2;}if(_3.length>0){if(this.issue_timer){clearTimeout(this.issue_timer);this.issue_timer=null;}this.issue_timer=setTimeout(dojo.hitch(this,this._send_request,_3),this.search_time);}else{this.issue_timer=null;this._clear_selection_box();this._selection_options();}},_load_selection:function(_4){if(this._transactionid==_4.transactionid){this._clear_selection_box();for(var i=0;i<_4.data.length;++i){var _5=_4.data[i];this.issue_list.options[this.issue_list.options.length]=new Option(_5.name,_5.issueid);}this._selection_options();}},_clear_selection_box:function(){this.issue_list.options.length=0;},_clear_selected_box:function(){this.issue_select.length=0;},issue_update_selection:function(){this._selection_options();},issue_select_dbl:function(){this.issue_select_single();this._selection_options();},issue_select_all:function(){for(var c=0;c<this.issue_list.options.length;c++){var _6=this.issue_list.options[c];var _7=true;for(var c1=0;c1<this.issue_select.options.length;c1++){if(this.issue_select.options[c1].value==_6.value){_7=false;break;}}if(_7){this.issue_select.options[this.issue_select.options.length]=new Option(_6.text,_6.value);}}this._Get(this._getValueAttr());this.issue_list.options.length=0;this.issue_update_selection();},issue_select_single:function(){for(var c=0;c<this.issue_list.options.length;c++){var _8=this.issue_list.options[c];if(_8.selected){_8.selected=false;var _9=true;for(var c1=0;c1<this.issue_select.options.length;c1++){if(this.issue_select.options[c1].value==_8.value){_9=false;break;}}if(_9){this.issue_select.options[this.issue_select.options.length]=new Option(_8.text,_8.value);this._Get(this._getValueAttr());}}}},issue_remove_all:function(){this.issue_select.options.length=0;this.issue_update_selection();this._Get(this._getValueAttr());},issue_remove_single:function(){for(var c=0;c<this.issue_select.options.length;c++){if(this.issue_select.options[c].selected){this.issue_select.options[c]=null;}}this.issue_update_selection();this._Get(this._getValueAttr());},_add_select:function(_a){this.issue_select.options[this.issue_select.options.length]=new Option(_a.name,_a.issueid);},_setValueAttr:function(_b){this.clear();var _c=_b.data;var _d=false;if(_c==null||_c==undefined){_c=_b;}for(var _e in _c){var _f=_c[_e];this.issue_select.options[this.issue_select.options.length]=new Option(_f.name,_f.issueid);opne=true;}if(_d){this.MakeOpen();}this._Get(this._getValueAttr());},_getValueAttr:function(){var _10=Array();for(var c=0;c<this.issue_select.options.length;c++){if(this._extended){_10[c]={issueid:parseInt(this.issue_select.options[c].value),name:this.issue_select.options[c].text};}else{_10[c]=parseInt(this.issue_select.options[c].value);}}var obj={data:_10};if(this._extended){return obj;}else{var _10=_10.length>0?dojo.toJson(obj):"";this.value=_10;return _10;}},_getCountAttr:function(){return this.issue_select.options.length;},_setExtendedAttr:function(_11){this._extended=_11;},_selection_options:function(){this.button_all.set("disabled",this.issue_list.length?false:true);this.button_single.set("disabled",this.issue_list.selectedIndex!=-1?false:true);this.button_del_all.set("disabled",this.issue_select.length?false:true);this.button_del_single.set("disabled",this.issue_select.selectedIndex!=-1?false:true);},_CaptureExtendedContent:function(_12){return _12;},_setDisabledAttr:function(_13){this.disabled=_13;},_getDisabledAttr:function(){return this.disabled;},_Get:function(){if(this.selectonly==false){this.inherited(arguments);}},_focus:function(){this.issue_list_select.focus();},_toggle:function(){this.open=!this.open;dojo.style(this.selectarea,"display","none");dojo.style(this.selectarea,"display",this.open?"block":"none");if(this.open){dojo.addClass(this.toggleCtrl,"fa-minus-circle");dojo.removeClass(this.toggleCtrl,"fa-plus-circle");}else{dojo.addClass(this.toggleCtrl,"fa-plus-circle");dojo.removeClass(this.toggleCtrl,"fa-minus-circle");}},_other_issue_event:function(_14){this._clear_selection_box();this.issue_list.options[this.issue_list.options.length]=new Option(_14.name,_14.issueid);this._selection_options();},_new_issue:function(){this.new_issue_ctrl.clear();this.new_issue_ctrl.set("publish_event","/issue/add_multi");this.new_issue_ctrl.set("dialog",this.new_issue_dlg);this.new_issue_dlg.show();},load_default:function(){this._send_request("*");},_setDisplayselectAttr:function(_15){dojo.attr(this.issue_label_1,"innerHTML",_15);},_setDisplaytitleAttr:function(_16){}});}