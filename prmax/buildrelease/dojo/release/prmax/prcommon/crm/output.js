/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.crm.output"]){dojo._hasResource["prcommon.crm.output"]=true;dojo.provide("prcommon.crm.output");dojo.require("prmax.common.ReportBuilder");dojo.require("prcommon.date.daterange");dojo.declare("prcommon.crm.output",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n<span class=\"common_prmax_layout\"><br/>\r\n\t<form data-dojo-attach-point=\"form_output\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='onSubmit:\"return false\"'>\r\n\t\t<label class=\"label_1\">Output Style</label><select data-dojo-attach-point=\"output_style\" data-dojo-attach-event=\"onChange:_get_style\"data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-props='name:\"reporttemplateid\",\"class\":\"prmaxrequired prmaxinputselect\",autoComplete:true,searchAttr:\"reporttemplatename\",labelAttr:\"reporttemplatename\",required:true,invalidMessage:\"Please select label format\",labelType:\"html\"'></select><br/>\r\n\t\t<label class=\"label_1\">Output Format</label>\r\n\t\t<label data-dojo-attach-point=\"pdf_label\">Pdf&nbsp;<input data-dojo-attach-point=\"pdf\" data-dojo-props=\"name:'reportoutputtypeid',value:'0',type:'radio',checked:true\" data-dojo-type=\"dijit.form.RadioButton\"></label>\r\n\t\t<label data-dojo-attach-point=\"csv_label\">Csv&nbsp;<input data-dojo-attach-point=\"csv\" data-dojo-props=\"name:'reportoutputtypeid',value:'2',type:'radio'\" data-dojo-type=\"dijit.form.RadioButton\"></label>\r\n\t\t<label data-dojo-attach-point=\"excel_label\">Excel&nbsp;<input data-dojo-attach-point=\"excel\" data-dojo-props=\"name:'reportoutputtypeid',value:'4',type:'radio'\" data-dojo-type=\"dijit.form.RadioButton\"></label><br/>\r\n\t\t<label class=\"label_1\">Date Range</label><div data-dojo-type=\"prcommon.date.daterange\" data-dojo-attach-point=\"drange\" data-dojo-props='value:\"\",name:\"drange\"'></div><br/>\r\n\t\t<label class=\"label_1\" data-dojo-attach-point=\"client_label\">Client</label><select data-dojo-props='\"class\":\"prmaxinputselect\",name:\"clientid\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\",required:false' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clientid\"></select><br/></br>\r\n\t\t<div data-dojo-type=\"prmax.common.ReportBuilder\" data-dojo-attach-point=\"reportnode\" data-dojo-props='style:\"display:none\"'></div>\r\n\t\t<button data-dojo-attach-event=\"onClick:_close\" data-dojo-attach-point=\"closebtn\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Close\",\"class\":\"btnleft prmaxhidden\"'></button>\r\n\t\t<button data-dojo-attach-event=\"onClick:_do_report\" data-dojo-attach-point=\"reportbtn\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Generate\",\"class\":\"btnright\"'></button>\r\n\t\t<br/><br/>\r\n\t</form>\r\n</span>\r\n</div>\r\n",constructor:function(){this._dialog=null;this._complete_call_back=dojo.hitch(this,this._complete_call);this._output_styles=new dojo.data.ItemFileReadStore({url:"/reports/reporttemplates?reportsourceid=9"});this._clients=new dojox.data.JsonRestStore({target:"/clients/rest_combo",idAttribute:"id"});dojo.subscribe("/update/engagement_label",dojo.hitch(this,this._UpdateEngagementLabelEvent));},postCreate:function(){this.inherited(arguments);this.output_style.set("store",this._output_styles);this.output_style.set("value",21);this.clientid.set("store",this._clients);this.clientid.set("value",-1);dojo.addClass(this.excel.domNode,"prmaxhidden");dojo.addClass(this.excel_label,"prmaxhidden");},_do_report:function(){var _1=this.form_output.get("value");if(this.output_style==32&&this.drange.option.get("value")=="0"){alert("Please enter a range date");return false;}dojo.addClass(this.reportbtn.domNode,"prmaxhidden");this.reportnode.SetCompleted(this._complete_call_back);this.reportnode.StartNoDialog(_1);},clear:function(){this.reportnode.hide();dojo.removeClass(this.reportbtn.domNode,"prmaxhidden");},_setDialogAttr:function(_2){this._dialog=_2;if(this._dialog!=null){dojo.removeClass(this.closebtn.domNode,"prmaxhidden");}},_close:function(){if(this._dialog){this.reportnode.Stop();this._dialog.hide();this.clear();}},_complete_call:function(){this.reportnode.hide();this._close();this.clear();},_get_style:function(){if(this.output_style==31||this.output_style==39){dojo.addClass(this.csv.domNode,"prmaxhidden");dojo.addClass(this.csv_label,"prmaxhidden");dojo.addClass(this.excel.domNode,"prmaxhidden");dojo.addClass(this.excel_label,"prmaxhidden");dojo.removeClass(this.clientid.domNode,"prmaxhidden");dojo.removeClass(this.client_label,"prmaxhidden");this.pdf.set("checked",true);}else{if(this.output_style==32){dojo.addClass(this.csv.domNode,"prmaxhidden");dojo.addClass(this.csv_label,"prmaxhidden");dojo.removeClass(this.excel.domNode,"prmaxhidden");dojo.removeClass(this.excel_label,"prmaxhidden");dojo.addClass(this.clientid.domNode,"prmaxhidden");dojo.addClass(this.client_label,"prmaxhidden");this.excel.set("checked",true);}else{dojo.removeClass(this.csv.domNode,"prmaxhidden");dojo.removeClass(this.csv_label,"prmaxhidden");dojo.addClass(this.excel.domNode,"prmaxhidden");dojo.addClass(this.excel_label,"prmaxhidden");dojo.removeClass(this.clientid.domNode,"prmaxhidden");dojo.removeClass(this.client_label,"prmaxhidden");}}},_UpdateEngagementLabelEvent:function(){this._output_styles=new dojo.data.ItemFileReadStore({url:"/reports/reporttemplates?reportsourceid=9"});},});}