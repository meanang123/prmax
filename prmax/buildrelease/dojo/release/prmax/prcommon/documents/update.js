/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.documents.update"]){dojo._hasResource["prcommon.documents.update"]=true;dojo.provide("prcommon.documents.update");dojo.require("ttl.BaseWidget");dojo.declare("prcommon.documents.update",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<form data-dojo-attach-point=\"update_form\" data-dojo-props='\"class\":\"prmaxdefault\", onsubmit:\"return false\"' data-dojo-type=\"dijit.form.Form\">\r\n\t\t<input data-dojo-attach-point=\"documentid\" data-dojo-props='name:\"documentid\", type:\"hidden\", value:\"-1\"' data-dojo-type=\"dijit.form.TextBox\" >\r\n\t\t<table class=\"prmaxtable\" width=\"500px\" >\r\n\t\t\t<tr><td colspan=\"2\" align=\"center\" class=\"prmaxrowdisplaylarge\" > Document Details</td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" >Description</td><td class=\"prmaxrowdisplay\" width=\"76%\"><input data-dojo-props='invalidMessage:\"Description field must be filled in\", style:\"width:98%\", \"class\":\"prmaxrequired\", name:\"description\", type:\"text\", maxlength:80, trim:true, required:true' data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"description\"/></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" colspan=\"2\"><br/></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" >Controls</td>\r\n\t\t\t\t<td class=\"prmaxrowdisplay\" width=\"76%\">\r\n\t\t\t\t\t<button data-dojo-props='\"class\":\"prmaxbutton\", type:\"button\", label:\"Update\", busyLabel:\"Please Wait Updating\" ' data-dojo-type=\"dojox.form.BusyButton\" data-dojo-attach-event=\"onClick:_update\" data-dojo-attach-point=\"update_form_btn\"></button>\r\n\t\t\t\t\t<button data-dojo-props='\"class\":\"prmaxbutton\", type:\"button\", label:\"Delete\"' data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_delete\"></button>\r\n\t\t\t\t\t<button data-dojo-props='\"class\":\"prmaxbutton\", type:\"button\", label:\"Download\"' data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_download\"></button>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</form>\r\n</div>\r\n",constructor:function(){this._load_call_back=dojo.hitch(this,this._load_call);this._save_call_back=dojo.hitch(this,this._save_call);this._delete_call_back=dojo.hitch(this,this._delete_call);},postCreate:function(){this.inherited(arguments);},_clear:function(){this.update_form_btn.set("disabled",false);},clear:function(){this._clear();},load:function(_1,_2){this._show_func=_2;dojo.xhrPost(ttl.utilities.makeParams({load:this._load_call_back,url:"/crm/documents/get",content:{documentid:_1}}));},_load_call:function(_3){if(_3.success=="OK"){with(_3){this.documentid.set("value",data.documentid);this.description.set("value",data.description);this._data=data;}this._show_func(1);}else{alert("Problem Loading Record");}},_update:function(){if(ttl.utilities.formValidator(this.update_form)==false){alert("Not all required field filled in");this.update_form_btn.cancel();return;}dojo.xhrPost(ttl.utilities.makeParams({load:this._save_call_back,url:"/crm/documents/update",content:this.update_form.get("value")}));},_save_call:function(_4){if(_4.success=="OK"){alert("Updated");dojo.publish(PRCOMMON.Events.Document_Updated,[_4.data]);}else{alert("Problem Updating");}this.update_form_btn.cancel();},_delete:function(){if(confirm("Delete Document?")){dojo.xhrPost(ttl.utilities.makeParams({load:this._delete_call_back,url:"/crm/documents/delete",content:this.update_form.get("value")}));}},_delete_call:function(_5){if(_5.success=="OK"){dojo.publish(PRCOMMON.Events.Document_Deleted,[{documentid:this.documentid.get("value")}]);}else{alert("Problem Deleting");}},_download:function(){ttl.utilities.gotoDialogPageStatic("/crm/documents/download/"+this._data.documentid+this._data.ext);}});}