/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.documents.add"]){dojo._hasResource["prcommon.documents.add"]=true;dojo.provide("prcommon.documents.add");dojo.require("ttl.BaseWidget");dojo.require("dijit.ProgressBar");dojo.require("dijit.form.Button");dojo.require("dojo.io.iframe");dojo.declare("prcommon.documents.add",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<form  data-dojo-attach-point=\"document_form\" method=\"post\" name=\"document_form\" enctype=\"multipart/form-data\"  onSubmit=\"return false;\">\r\n\t\t<input class=\"prmaxinput\" type=\"hidden\" data-dojo-attach-point=\"document_cache\" name=\"document_cache\" value=\"-1\">\r\n\t\t<table width=\"350px\" border=\"0\" cellpadding=\"0\" cellspacing=\"1\" >\r\n\t\t\t<tr><td width=\"120px\" align=\"right\" class=\"prmaxrowtag\">File Name</td><td><input size=\"30\" class=\"prmaxinput\" type=\"file\" data-dojo-attach-point=\"document_file\" name=\"document_file\"></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Description</td><td><input data-dojo-props='style:\"width:255px\", \"class\":\"prmaxrequired prmaxinput\", name:\"documentname\", type:\"text\", maxLength:255, trim:true, required:true, invalidMessage:\"Description field must be filled in\"' data-dojo-attach-point=\"document_name\" data-dojo-type=\"dijit.form.ValidationTextBox\"/></td></tr>\r\n\t\t\t<tr><td colspan = \"2\" >&nbsp;</td></tr>\r\n\t\t\t<tr><td colspan = \"2\" ><span data-dojo-attach-point=\"progressnode\" style=\"display:none;\"><div data-dojo-type=\"dijit.ProgressBar\" data-dojo-attach-point=\"progresscontrol\" data-dojo-props='style:\"width:200px\", indeterminate:true'></div></span></td></tr>\r\n\t\t\t<tr><td align=\"left\"><button data-dojo-props='\"class\":\"prmaxbutton prmaxhidden\", label:\"Close\", type:\"button\"' data-dojo-attach-point=\"closenode\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_close\"></button></td>\r\n\t\t\t    <td align=\"right\"><button data-dojo-props='\"class\":\"prmaxbutton\", type:\"button\", label:\"Add\"' data-dojo-attach-point=\"savenode\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_add\"></button></td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</form>\r\n</div>\r\n",constructor:function(){this._added_call_back=dojo.hitch(this,this._added);},postCreate:function(){this.dlg=null;this.inherited(arguments);},_clear:function(){this.document_file.value="";this.progressnode.style.display="none";this.savenode.set("disabled",false);this.document_name.set("value","");},_added:function(_1){this.progressnode.style.display="none";if(_1.success=="OK"){dojo.publish(PRCOMMON.Events.Document_Add,[_1.data]);alert("Document Added");this._close();}else{if(_1.success=="FA"){alert(_1.message);}else{alert("Problem Adding Document");}}},_add:function(){if(this.document_name.get("value").length==0){alert("The Name field must be filled in");this.collateral_name.focus();return;}var _2=dojo.attr(this.document_file,"value");if(_2==""||_2==null){alert("No Document File Specified");this.document_file.focus();return;}this.document_cache.value=new Date().valueOf();this.progressnode.style.display="block";dojo.io.iframe.send({url:"/crm/documents/add",handleAs:"json",load:this._added_call_back,form:this.document_form});},clear:function(){this._clear();},_close:function(){this.clear();this.dlg.hide();},show_close:function(_3){this._clear();this.dlg=_3;dojo.removeClass(this.closenode,"prmaxhidden");}});}