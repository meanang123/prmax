/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.documents.view"]){dojo._hasResource["prcommon.documents.view"]=true;dojo.provide("prcommon.documents.view");dojo.require("ttl.GridHelpers");dojo.require("ttl.BaseWidget");dojo.require("dijit.form.Form");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dojox.form.BusyButton");dojo.require("dijit.form.Button");dojo.require("prcommon.documents.adddialog");dojo.require("prcommon.documents.update");dojo.declare("prcommon.documents.view",[ttl.BaseWidget],{templateString:"<div>\r\n\t<div data-dojo-attach-point=\"borderControl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='style:\"width:100%;height:100%\",gutters:false' >\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"top\", style:\"height:42px;width:100%;overflow:hidden\", \"class\":\"std_menu_view\"'>\r\n\t\t\t<div style=\"height:38px;width:100%;overflow:hidden\" class=\"std_menu_view\">\r\n\t\t\t\t<div style=\"height:100%;width:150px;float:left;padding-top:10px;\" class=\"prmaxrowdisplaylarge\">Documents</div>\r\n\t\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='\"class\":\"dijitToolbarTop\", style:\"float:left:height:94%;width:400px\"' >\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_add_document\" data-dojo-attach-point=\"addbutton\" data-dojo-props='label:\"Add Document\", iconClass:\"fa fa-plus fa-3x\",showLabel:false'></div>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\"  data-dojo-props='iconClass:\"fa fa-filter fa-3x\",showLabel:true'>\r\n\t\t\t\t\t\t<span>Filter By</span>\r\n\t\t\t\t\t\t<div data-dojo-type=\"dijit.TooltipDialog\" data-dojo-props='title:\"Filter By\"' data-dojo-attach-event=\"execute:_filter\">\r\n\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t<tr><td><label>Description</label></td><td><input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"description\" data-dojo-props='type:\"text\",name:\"description\"' ></td></tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td align=\"left\"><button data-dojo-attach-event=\"onClick: _clear_filter\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\"' >Clear</button></td>\r\n\t\t\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"submit\",name:\"submit\"'>Submit</button></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"center\", splitter:true'>\r\n\t\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='query:{ }, rowsPerPage:30' ></div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.StackContainer\" data-dojo-attach-point=\"controls\" data-dojo-props='style:\"width:60%;height:100%\", region:\"right\", splitter:true'>\r\n\t\t\t<div title=\"blank\" data-dojo-attach-point=\"blank\" data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='selected:\"selected\"'></div>\r\n\t\t\t<div title=\"Details\" data-dojo-attach-point=\"details\" data-dojo-type=\"prcommon.documents.update\" data-doj-props='style:\"width:100%;height:100%\"'></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"addctrl\" data-dojo-type=\"prcommon.documents.adddialog\"></div>\r\n</div>\r\n",constructor:function(){this.model=new prcommon.data.QueryWriteStore({url:"/crm/documents/document_list",onError:ttl.utilities.globalerrorchecker,nocallback:true});this._show_func_call=dojo.hitch(this,this._show_func);dojo.subscribe(PRCOMMON.Events.Document_Deleted,dojo.hitch(this,this._delete_event));dojo.subscribe(PRCOMMON.Events.Document_Add,dojo.hitch(this,this._add_event));dojo.subscribe(PRCOMMON.Events.Document_Updated,dojo.hitch(this,this._update_event));},postCreate:function(){this.grid.set("structure",this.view);this.grid["onStyleRow"]=dojo.hitch(this,this._on_style_row);this.grid["onCellClick"]=dojo.hitch(this,this._on_click_cell);this.grid._setStore(this.model);},_on_style_row:function(_1){ttl.GridHelpers.onStyleRow(_1);},_on_click_cell:function(e){this.grid.selection.clickSelectEvent(e);this._row=this.grid.getItem(e.rowIndex);this.details.load(this._row.i.documentid,this._show_func_call);},view:{cells:[[{name:"Description",width:"200px",field:"description"},{name:"Created Date",width:"100px",field:"created_display"},{name:"Created By",width:"100px",field:"user_name"}]]},clear:function(){this.grid.setQuery(ttl.utilities.getPreventCache({}));this.controls.selectChild(this.blank);},resize:function(){this.borderControl.resize(arguments[0]);},_add_document:function(){this.addctrl.show();},_show_func:function(_2){switch(_2){case 1:this.controls.selectChild(this.details);break;case 2:this.controls.selectChild(this.blank);this.details.clear();}},_delete_event:function(_3){if(this._row){this.model.deleteItem(this._row);this._row=null;}this._show_func(2);},_add_event:function(_4){this.model.newItem(_4);},_update_event:function(_5){this.model.setValue(this._row,"description",_5.description,true);},_filter:function(){var _6={};if(arguments[0].description!=""){_6["filter_description"]=arguments[0].description;}this.grid.setQuery(ttl.utilities.getPreventCache(_6));this._show_func(2);},_clear_filter:function(){this.description.set("value","");}});}