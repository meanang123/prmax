/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.advance.stdview"]){dojo._hasResource["prcommon.advance.stdview"]=true;dojo.provide("prcommon.advance.stdview");dojo.require("ttl.BaseWidget");dojo.require("prcommon.advance.saveas");dojo.require("prcommon.advance.DeleteFromList");dojo.require("prcommon.advance.SaveToStanding");dojo.require("prcommon.advance.ResultsToLists");dojo.require("prcommon.advance.Output");dojo.declare("prcommon.advance.stdview",[ttl.BaseWidget],{widgetsInTemplate:true,advancefeatureslistid:-1,templateString:"<div class=\"advstdview\">\r\n\t<div dojoAttachPoint=\"frame\" dojoType=\"dijit.layout.BorderContainer\" style=\"width:100%;height:100%\" gutters=\"false\" design=\"sidebar\">\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" preload=\"false\" region=\"top\" style=\"height:42px;width:100%;overflow:hidden\" class=\"advanceresults\">\r\n\t\t\t<div style=\"height:44px;width:100%;overflow:hidden\" class=\"searchresults\">\r\n\t\t\t\t<div style=\"float:left;padding:0px;margin:0px;width:200px;height:100%;padding-top:10px;padding-left:5px;overflow:hidden\" class=\"namecolour\" dojoAttachPoint=\"list\"></div>\r\n\t\t\t\t<div class=\"dijitToolbarTop\" dojoType=\"dijit.Toolbar\" style=\"float:left;height:100%;width:250px\">\r\n\t\t\t\t\t<div dojoType=\"dijit.form.DropDownButton\" dojoAttachPoint=\"save\" disabled=\"disabled\" iconClass=\"fa fa-floppy-o fa-3x\"  showLabel=\"false\">\r\n\t\t\t\t\t\t<div dojoType=\"dijit.Menu\" >\r\n\t\t\t\t\t\t\t<div dojoType=\"dijit.MenuItem\" label=\"To Features List\" dojoAttachPoint=\"clear\" dojoAttachEvent=\"onClick:_Save\" ></div>\r\n\t\t\t\t\t\t\t<div dojoType=\"dijit.MenuItem\" label=\"To Media List\" dojoAttachEvent=\"onClick:_Save_Standing\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div dojoType=\"dijit.form.Button\" dojoAttachPoint=\"output\" disabled=\"disabled\" iconClass=\"fa fa-print fa-3x\"  showLabel=\"false\" dojoAttachEvent=\"onClick:_OutputPrint\"></div>\r\n\t\t\t\t\t<div dojoType=\"dijit.form.Button\"  dojoAttachPoint=\"delete_option\" dojoAttachEvent=\"onClick:_Delete\" disabled=\"disabled\" iconClass=\"fa fa-trash fa-3x\" showLabel=\"false\">Delete</div>\r\n\t\t\t\t\t<div dojoType=\"dijit.form.DropDownButton\" dojoAttachPoint=\"search\" class=\"prmaxhidden\" iconClass=\"PrmaxResultsIcon PrmaxResultsSearch\"  showLabel=\"false\">\r\n\t\t\t\t\t\t<div dojoType=\"dijit.Menu\" >\r\n\t\t\t\t\t\t\t<div dojoType=\"dijit.MenuItem\" label=\"Add To List\" dojoAttachEvent=\"onClick:_Search_Append\" ></div>\r\n\t\t\t\t\t\t\t<div dojoType=\"dijit.MenuItem\" label=\"New Search\" dojoAttachEvent=\"onClick:_Search_New\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"float:right;padding:0px;margin:0px;width:100px;height:100%;\">\r\n\t\t\t\t<div class=\"advancecount\" dojoAttachPoint=\"countinfo\" dojoType=\"prmax.searchgrid.SearchGridCount\"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"center\">\r\n\t\t\t<div dojoAttachPoint=\"grid\" dojoType=\"dojox.grid.DataGrid\" query=\"{ name:'*'}\" rowsPerPage=\"50\" style=\"width:100%;height:100%\" ></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div dojoType=\"dijit.Dialog\" title=\"Save as Features List\" dojoAttachPoint=\"dlg_saveas\">\r\n\t\t<div dojoAttachPoint=\"saveas\" dojoType=\"prcommon.advance.saveas\" style=\"width:500px;height:370px\"></div>\r\n\t</div>\r\n\t<div dojoType=\"dijit.Dialog\" title=\"Delete Entries\" dojoAttachPoint=\"dlg_delete\">\r\n\t\t<div dojoAttachPoint=\"deletectrl\" dojoType=\"prcommon.advance.DeleteFromList\" style=\"width:400px;height:180px;margin:10px\"></div>\r\n\t</div>\r\n\t<div dojoType=\"dijit.Dialog\" title=\"Save To a Media List\" dojoAttachPoint=\"dlg_save_to_standing\">\r\n\t\t<div dojoAttachPoint=\"savetostandingctrl\" dojoType=\"prcommon.advance.SaveToStanding\" style=\"width:450px;height:300px\"></div>\r\n\t</div>\r\n\t<div dojoType=\"dijit.Dialog\" title=\"Save Results To List\" dojoAttachPoint=\"dlg_save_results_to_list\">\r\n\t\t<div dojoAttachPoint=\"resultstolistctrl\" dojoType=\"prcommon.advance.ResultsToLists\" style=\"width:500px;height:280px\"></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Output\"' data-dojo-attach-point=\"dlg_output\">\r\n\t\t<div data-dojo-attach-point=\"outputctrl\" data-dojo-type=\"prcommon.advance.Output\" data-dojo-props='style:\"width:450px;height:320px\"' ></div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){try{this.ctrldisplay=new PRMAX.DisplayObject();}catch(e){alert("missing 3");this.ctrldisplay=new Object();}this._sortorder=0;this._listid=-1;this._listname="";this._resultview=false;this._count=new PRMAX.SearchGridCount();dojo.subscribe(PRCOMMON.Events.Dialog_Close,dojo.hitch(this,this._DialogCloseEvent));dojo.subscribe(PRCOMMON.Events.Advance_Session_Changed,dojo.hitch(this,this._AdvanceChangedEvent));this._unsaved_class="advance_unsaved_row";this._list_class="advance_list_row";this._unsaved_results_class="advance_unsaved_results_row";this._class_list=[this._unsaved_class,this._list_class,this._unsaved_results_class];this._line_class=this._unsaved_class;},postCreate:function(){this.model=new prcommon.data.QueryWriteStore({url:"/advance/viewpage",tableid:5,oncallback:dojo.hitch(this,this._SelectionChanged),onError:ttl.utilities.globalerrorchecker,oncallbackparams:dojo.hitch(this,this._getContext)});this._listid=this.advancefeatureslistid;this.ctrldisplay.listid=this._listid;this.grid.set("structure",this.view);this.grid._setStore(this.model);this._UpdateCountCall=dojo.hitch(this,this._UpdateCount);this.grid._setQuery(ttl.utilities.getPreventCache({sortorder:this._sortorder,advancefeatureslistid:this.advancefeatureslistid}));this.grid["onStyleRow"]=dojo.hitch(this,this._OnStyleRow);this.grid["onRowClick"]=dojo.hitch(this,this._OnSelectRow);this.grid["onCellClick"]=dojo.hitch(this,this._OnCellClick);this.UpdateCount();this.inherited(arguments);},_getContext:function(){return {advancefeatureslistid:(this._listid!=-1&&this.ctrldisplay.listid==-1)?-1:this._listid};},_SelectionChanged:function(_1){this._count.Set(_1.data);this.countinfo.set("value",this._count);},_OnCellClick:function(e){if(e.cellIndex==0||e.cellIndex>1){this._OnSelectRow(e);}else{if(e.cellIndex==1){var _2=this.grid.getItem(e.rowIndex);this.model.setValue(_2,"selected",!_2.i.selected,true);}else{this.inherited(arguments);}}},_OnSelectRow:function(e){var _3=this.grid.getItem(e.rowIndex);this.ctrldisplay.Set(_3.i);dojo.publish(PRCOMMON.Events.Display_Load,[this.ctrldisplay,"advance"]);this.grid.selection.clickSelectEvent(e);},_OnStyleRow:function(_4){if(_4.selected){_4.customClasses+=" prmaxSelectedRow";return;}if(_4.odd){_4.customClasses+=(" "+this._line_class);}if(_4.over){_4.customClasses+=" dojoxGridRowOver";}},view:{cells:[[{name:" ",width:"6px",styles:"text-align: center;",width:"6px",field:"prmax_outletgroupid",formatter:ttl.utilities.outletType},{name:" ",width:"15px",styles:"text-align: center;",width:"20px",field:"selected",formatter:ttl.utilities.formatButtonCell},{name:"Outlet Name",width:"200px",field:"outletname"},{name:"Publication Date",width:"150px",field:"pub_date_display"},{name:"Feature",width:"auto",field:"feature"}]]},_Save:function(){if(this._listid!=-1&&this._resultview==true){this.dlg_save_results_to_list.set("title","Save Result to Existing List ("+this._listname+")");this.resultstolistctrl.Load(this._listid,this._count.selected,this._listname);this.dlg_save_results_to_list.show();}else{this.saveas.Load(this._listid,this._count.selected);this.dlg_saveas.show();}},_OutputPrint:function(){this.outputctrl.Load(this._listid,this._count.selected);this.dlg_output.show();},_Delete:function(){this.deletectrl.Load(this._listid,this._count.selected);this.dlg_delete.show();},_Save_Standing:function(){this.savetostandingctrl.Load(this._listid,this._count.selected,this.dlg_save_to_standing);this.dlg_save_to_standing.show();},resize:function(){this.frame.resize(arguments[0]);this.inherited(arguments);},_DialogCloseEvent:function(_5){this.dlg_saveas.hide();this.dlg_save_to_standing.hide();this.dlg_save_results_to_list.hide();this.dlg_delete.hide();this.dlg_output.hide();},enableControls:function(){var _6=this._count.total?false:true;this.save.set("disabled",_6);this.delete_option.set("disabled",_6);if(PRMAX.utils.settings.isdemo==false&&PRMAX.utils.settings.isadvancedemo==false){this.output.set("disabled",_6);}if(this._listid==-1){dojo.addClass(this.search.domNode,"prmaxhidden");}else{dojo.removeClass(this.search.domNode,"prmaxhidden");}},_UpdateCount:function(_7){if(_7.success=="OK"){if(this.advancefeatureslistid!=-1){this._listname=_7.data.listname;this.advancefeatureslistid=-1;}this.ctrldisplay.Set(_7.data);dojo.publish(PRCOMMON.Events.Display_Load,[this.ctrldisplay,"advance"]);this._count.Set(_7.data);this.countinfo.set("value",this._count);this.enableControls();this._SetStyle();}},_SetStyle:function(){var _8="Unsaved Search Results";this._line_class=this._unsaved_class;if(this._listid!=-1){if(this.ctrldisplay.listid==-1){_8="Search result for adding to List : "+this._listname;this._line_class=this._unsaved_results_class;this._resultview=true;}else{this._line_class=this._list_class;_8=this._listname+" list";}}dojo.attr(this.list,"innerHTML",_8);for(var _9 in this._class_list){dojo.removeClass(this.list,this._class_list[_9]);}dojo.addClass(this.list,this._line_class);},_GetListId:function(){var _a=-1;if(this.ctrldisplay!=-1){_a=this.ctrldisplay.listid;}return _a;},UpdateCount:function(){dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._UpdateCountCall),url:"/advance/count",content:{advancefeatureslistid:this._listid}}));},Load:function(_b,_c){if(_c!=null&&_c==0){this._listid=-1;}this._resultview=false;this._Load(_b);},_Load:function(_d){this.grid.sortInfo=4;this.grid.selection.select(0);this.ctrldisplay.Set(_d);this._count.Set(_d);this.countinfo.set("value",this._count);this._SetStyle();this.grid.setQuery(ttl.utilities.getPreventCache({sortorder:this._sortorder,advancefeatureslistid:this._GetListId()}));this.enableControls();dojo.publish(PRCOMMON.Events.Display_Load,[this.ctrldisplay,"advance"]);},_AdvanceChangedEvent:function(_e,_f,_10,_11){if(_11==true){this._resultview=false;}if(_10==0){this._listid=-1;}else{this._listid=_e.listid;this._listname=_e.listname;}this._Load(_e);},_Search_Append:function(){dijit.byId("std_banner_control").ShowSearchAdvance(1);},_Search_New:function(){dijit.byId("std_banner_control").ShowSearchAdvance(0);}});}