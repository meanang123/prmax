/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.advance.ResultsToLists"]){dojo._hasResource["prcommon.advance.ResultsToLists"]=true;dojo.provide("prcommon.advance.ResultsToLists");dojo.require("ttl.BaseWidget");dojo.declare("prcommon.advance.ResultsToLists",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div  dojoAttachPoint=\"borderCtrl\" dojotype=\"dijit.layout.BorderContainer\" style=\"width:100%;height:100%\" >\r\n\t\t<div  dojoAttachPoint=\"tabController\" dojotype=\"dijit.layout.TabContainer\" style=\"width:100%;height:100%\">\r\n\t\t\t<div dojoAttachPoint=\"savetolisttab\" dojoType=\"dijit.layout.ContentPane\" title=\"Save To Existing List\" style=\"width:100%;height:385px;padding:5px\">\r\n\t\t\t\t<form class=\"prmaxdefault\" dojoAttachPoint=\"form\" dojoType=\"dijit.form.Form\" onsubmit=\"return false\">\r\n\t\t\t\t<input type=\"hidden\" dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"advancefeatureslistid\" name =\"advancefeatureslistid\">\r\n\t\t\t\t<table class=\"prmaxtable\" cellpadding=\"0\" cellspacing =\"0\" style=\"border-style:collapsed\" width=\"100%\">\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\" width=\"20%\" valign=\"top\">Selection</td><td><div name=\"selection\" dojoAttachPoint=\"selection\" dojoType=\"prmax.common.SelectOptions\"></div></td></tr\r\n\t\t\t\t\t<tr><td>&nbsp;</td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\" valign=\"top\">Save to List</td><td><span dojoAttachPoint=\"listname_view\"></span>&nbsp;<button class=\"prmaxbutton\" dojoAttachEvent=\"onClick:_Save\" dojoAttachPoint=\"saveNode\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Saving...\" label=\"Save\"></td></tr>\r\n\t\t\t\t\t<tr><td>&nbsp;</td></tr>\r\n\t\t\t\t\t<tr><td><button style=\"float:right\" dojoType=\"dijit.form.Button\" label=\"Save to Alternate List\" dojoAttachEvent=\"onClick:_ShowSelector\"></button></td>\r\n\t\t\t\t\t\t<td><table cellpadding=\"0\" cellspacing =\"0\" style=\"border-style:collapsed\" width=\"100%\"><tr dojoAttachPoint=\"selection_view\" class=\"prmaxhidden\" >\r\n\t\t\t\t\t\t<td class=\"prmaxrowtag\" >Select List</td><td>\r\n\t\t\t\t\t<div dojoType=\"dijit.form.FilteringSelect\" dojoAttachPoint=\"lists\" pageSize=\"20\" autoComplete=\"true\" labelAttr=\"advancefeatureslistdescription\" searchAttr=\"advancefeatureslistdescription\"></div><button dojoType=\"dijit.form.Button\" label=\"Select\" dojoAttachEvent=\"onClick:_Select\"></button></td></tr>\r\n\t\t\t\t\t</table></td></tr>\r\n\t\t\t\t\t<tr><td>&nbsp;</td></tr>\r\n\t\t\t\t\t<tr><td colspan = \"3\" align=\"right\"><button class=\"prmaxbutton\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_Cancel\" type=\"button\" >Cancel</button></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType=\"dijit.layout.ContentPane\" title=\"Save To New List\" style=\"width:100%;height:385px;padding:5px\">\r\n\t\t\t\t<form class=\"prmaxdefault\" dojoAttachPoint=\"form2\" dojoType=\"dijit.form.Form\" onsubmit=\"return false\">\r\n\t\t\t\t\t<input dojoType=\"dijit.form.TextBox\" type=\"hidden\" dojoAttachPoint=\"advancefeatureslistid2\" name=\"advancefeatureslistid\"></input>\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t<table class=\"prmaxtable\" cellpadding=\"0\" cellspacing =\"0\" style=\"border-style:collapsed\" width=\"100%\">\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" valign=\"top\">Selection</td><td><div name=\"selection\" dojoAttachPoint=\"source2\" dojoType=\"prmax.common.SelectOptions\" i></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\">New List Name</td><td><input dojoType=\"dijit.form.ValidationTextBox\" name=\"listname\" dojoAttachPoint=\"listname\" required=\"true\" trim=\"true\"></td><td></td></tr>\r\n\t\t\t\t\t\t<tr><td>&nbsp;</td></tr>\r\n\t\t\t\t\t\t<tr><td>&nbsp;</td></tr>\r\n\t\t\t\t\t\t<tr><td align=\"left\"><button class=\"prmaxbutton\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_Cancel\" type=\"button\" >Cancel</button></td>\r\n\t\t\t\t\t\t\t<td align=\"right\"><button class=\"prmaxbutton\" dojoAttachEvent=\"onClick:_Add\" dojoAttachPoint=\"addNode\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Saving...\" label=\"Save\"></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._SaveAsCallBack=dojo.hitch(this,this._SaveAsCall);this._SaveCallBack=dojo.hitch(this,this._SaveCall);this.store=new dojox.data.QueryReadStore({url:"/advance/lists",onError:ttl.utilities.globalerrorchecker});},postCreate:function(){this.lists.store=this.store;this.inherited(arguments);},Load:function(_1,_2,_3){this.advancefeatureslistid.set("value",_1);this.selection.setOptions(_2);this.advancefeatureslistid2.set("value",_1);this.source2.setOptions(_2);dojo.attr(this.listname_view,"innerHTML",_3);this._Clear();},_Cancel:function(){dojo.publish(PRCOMMON.Events.Dialog_Close,["adv_result_saveas_del"]);this.saveNode.cancel();},show:function(){dojo.addClass(this.selection_view,"prmaxhidden");this.saveNode.cancel();this.inherited(arguments);},_SaveAsCall:function(_4){if(_4.success=="OK"){dojo.publish(PRCOMMON.Events.Advance_Session_Changed,[_4.data,null,null,true]);this._Cancel();}else{alert("problem Saving too list");this.saveNode.cancel();}},_Save:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._SaveAsCallBack,url:"/advance/results_to_list",content:this.form.get("value")}));},_ShowSelector:function(){dojo.toggleClass(this.selection_view,"prmaxhidden");},_Select:function(){var _5=this.lists.get("value");if(_5){this.advancefeatureslistid.set("value",_5);dojo.attr(this.listname_view,"innerHTML",this.lists.get("displayedValue"));}this._ShowSelector();},_Add_List:function(){var _6=this.listname.get("value");if(_6.Length==0){alert("No List Name Supplied");this.listname.focus();return;}if(confirm(" Add new Features list - "+_6+" ?")){dojo.xhrPost(ttl.utilities.makeParams({load:this._SaveCallBack,url:"/advance/createlist",content:{listname:_6}}));}},_SaveCall:function(_7){if(_7.success=="OK"){this.advancefeatureslistid.set("value",_7.data.advancefeatureslistid);dojo.attr(this.listname_view,"innerHTML",_7.data.advancefeatureslistdescription);this._Hide();}else{if(_7.success=="DU"){alert("List Already Exists");this.listname.focus();}else{alert("Problem Creating List");}}this.addNode.cancel();},_Hide:function(){dojo.addClass(this.new_list_view,"prmaxhidden");this.lists.focus();this.addNode.cancel();},_Add:function(){if(ttl.utilities.formValidator(this.form2)==false){alert("Not all required fields filled in");return;}dojo.xhrPost(ttl.utilities.makeParams({load:this._SaveCallBack,url:"/advance/saveas_new",content:this.form2.get("value")}));},_SaveCall:function(_8){if(_8.success=="OK"){dojo.publish(PRCOMMON.Events.Advance_Session_Changed,[_8.data]);this._Clear();this._Cancel();}else{if(_8.success=="DU"){alert("List Already Exists");this.listname.focus();}else{alert("Problem Creating List");}}this.addNode.cancel();},resize:function(){this.tabController.resize({h:435,width:400});},_Clear:function(){this.saveNode.cancel();this.addNode.cancel();this.listname.set("value","");this.lists.set("value",null);this.tabController.selectChild(this.savetolisttab);}});}