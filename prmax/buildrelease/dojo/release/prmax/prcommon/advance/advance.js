/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.advance.advance"]){dojo._hasResource["prcommon.advance.advance"]=true;dojo.provide("prcommon.advance.advance");dojo.require("ttl.BaseWidget");dojo.require("prcommon.date.DateExtended");dojo.declare("prcommon.advance.advance",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div class=\"prmaxhidden\">\r\n\t<div dojoType=\"dijit.layout.ContentPane\"  dojoAttachPoint=\"frame\" style=\"overflow:auto;overflow-x:hidden;border:1px solid black\">\r\n\t\t<form  dojotype=\"dijit.form.Form\" dojoAttachPoint=\"form\" onsubmit=\"return false;\">\r\n\t\t\t<input type=\"hidden\" name=\"outletid\" value=\"-1\" dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"outletid\">\r\n\t\t\t<input type=\"hidden\" name=\"advancefeatureid\" value=\"-1\" dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"advancefeatureid\">\r\n\t\t\t<table style=\"width:97%;border-style:collapsed\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" width=\"120px\">Editorial Date</td><td><div style=\"width:25em\" dojoType=\"prcommon.date.DateExtended\" name=\"editorial\" required=\"false\" dojoAttachPoint=\"editorial_date\"></div></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Cover Date</td><td><div  style=\"width:25em\" dojoType=\"prcommon.date.DateExtended\" name=\"cover\" required=\"true\" dojoAttachPoint=\"cover_date\"></div></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Publication Date</td><td><div  style=\"width:25em\" dojoType=\"prcommon.date.DateExtended\" name=\"publicationdate\" required=\"true\" dojoAttachPoint=\"publication_date\"></div></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Summary</td><td><input style=\"width:95%\" dojoAttachPoint=\"feature\" name=\"feature\" type=\"text\" dojoType=\"dijit.form.ValidationTextBox\" maxLength=\"120\" required=\"true\"></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Contact</td><td><select style=\"width:100%\" name=\"employeeid\" class=\"prmaxinput\" autoComplete=\"true\" searchAttr=\"displayname\" labelAttr=\"displayname\" dojoType=\"dijit.form.FilteringSelect\" labelType=\"html\" maxlength=\"80\" dojoAttachPoint=\"employeeid\" ></select></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Feature Details</td><td>&nbsp;\t</td></tr>\r\n\t\t\t\t<tr><td colspan=\"2\"><div class=\"stdframe\" style=\"height:200px\"><textarea dojoAttachPoint=\"featuredescription\"  name=\"featuredescription\" dojoType=\"dijit.form.Textarea\"  required=\"true\" style=\"height:300px;width:99%\"></textarea></div></td></tr>\r\n<!--\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\">Feature Interest</td><td><div name=\"interests\" selectonly=\"true\" size=\"6\" displaytitle=\"\" startopen=\"\"  dojoAttachPoint=\"interests\" restrict=\"0\"  dojoType=\"prcommon.interests.Interests\" keytypeid=\"-1\" title=\"Select\"></div></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Reason Code</td><td ><select dojoAttachPoint=\"reasoncodeid\" name=\"reasoncodeid\" dojotype =\"dijit.form.FilteringSelect\" searchAttr=\"name\" labelType=\"html\" style=\"width:98%\" class=\"prmaxrequired\"  /></td></tr>\r\n-->\t\t\t\t\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\">Description</td><td ><div class=\"reasonframe\" ><textarea dojoAttachPoint=\"reason\" name=\"reason\" required=\"true\" dojoType=\"dijit.form.Textarea\" style=\"width:99%;height:80%\"  ></textarea></div></td></tr>\r\n\r\n\t\t\t\t<tr><td align=\"right\" colspan=\"2\"><button type=\"button\" class=\"prmaxbutton\" style=\"font-size:2em\" dojoAttachPoint=\"saveNode\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Saving...\" dojoAttachEvent=\"onClick:_Save\" label=\"Save\"></button></td></tr>\r\n\t\t\t</table>\r\n\t\t</form>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.inherited(arguments);this._SaveCallBack=dojo.hitch(this,this._SaveCall);this._LoadCallBack=dojo.hitch(this,this._LoadCall);},postCreate:function(){this.modelemployees=new dojox.data.QueryReadStore({url:"/employees/listcombo?extended=1&nocontact=1",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true});this.employeeid.store=this.modelemployees;this.inherited(arguments);},_SaveCall:function(_1){if(_1.success=="OK"){if(this.advancefeatureid.get("value")==-1){dojo.publish(PRCOMMON.Events.Feature_Added,[_1.data]);alert("Feature Added");this.Clear();}else{dojo.publish(PRCOMMON.Events.Feature_Update,[_1.data]);alert("Feature Updated");}}else{alert("Problem with Feature");}this.saveNode.cancel();},_Save:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Not all required field filled in");this.saveNode.cancel();return;}dojo.xhrPost(ttl.utilities.makeParams({load:this._SaveCallBack,url:"/advance/save",content:this.form.get("value")}));},Load:function(_2,_3){this.modelemployees.url="/employees/listcombo?extended=1&nocontact=1&outletid="+_3;if(_2!=-1){dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCallBack,url:"/advance/get_ext",content:{advancefeatureid:_2}}));}else{this.Clear();this.advancefeatureid.set("value",-1);this.outletid.set("value",_3);}},_LoadCall:function(_4){if(_4.success=="OK"){this.outletid.set("value",_4.data.advance.outletid);this.advancefeatureid.set("value",_4.data.advance.advancefeatureid);this.editorial_date.set("value",_4.data.advance.editorial_date_full);this.cover_date.set("value",_4.data.advance.cover_date_full);this.publication_date.set("value",_4.data.advance.publication_date_full);this.feature.set("value",_4.data.advance.feature);this.featuredescription.set("value",_4.data.advance.featuredescription);if(_4.data.advance.employeeid!=null){this.employeeid.set("value",_4.data.advance.employeeid);}else{this.employeeid.set("value",-1);}dojo.removeClass(this.domNode,"prmaxhidden");}else{this.advancefeatureid.set("value",-1);alert("Problem Loading Feature");}},Clear:function(){this.advancefeatureid.set("value",-1);this.editorial_date.set("value",null);this.cover_date.set("value",null);this.publication_date.set("value",null);this.feature.set("value","");this.featuredescription.set("value","");this.reason.set("value","");this.employeeid.set("value",-1);},newmode:function(){dojo.removeClass(this.domNode,"prmaxhidden");},resize:function(){this.frame.resize(arguments[0]);this.inherited(arguments);}});}