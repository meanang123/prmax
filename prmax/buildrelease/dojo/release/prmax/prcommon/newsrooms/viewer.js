/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.newsrooms.viewer"]){dojo._hasResource["prcommon.newsrooms.viewer"]=true;dojo.provide("prcommon.newsrooms.viewer");dojo.require("ttl.GridHelpers");dojo.require("ttl.BaseWidget");dojo.require("dijit.form.Form");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dojox.form.BusyButton");dojo.require("dijit.form.Button");dojo.require("prcommon.data.QueryWriteStore");dojo.require("prcommon.newsrooms.add");dojo.declare("prcommon.newsrooms.viewer",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"borderControl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='style:\"width:100%;height:100%\",gutters:false' >\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"top\", style:\"height:42px;width:100%;overflow:hidden\", \"class\":\"std_menu_view\"'>\r\n\t\t\t<div style=\"height:38px;width:100%;overflow:hidden\" class=\"std_menu_view\">\r\n\t\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='\"class\":\"dijitToolbarTop\", style:\"float:left:height:94%;width:400px\"' >\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_AddNewsroom\" data-dojo-attach-point=\"addbutton\" data-dojo-props='label:\"Add Global Newsroom\",showLabel:true'></div>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_deleteNewsroom\" data-dojo-attach-point=\"deletebutton\"  data-dojo-props='label:\"Delete\",showLabel:true'></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='style:\"width:40%;height:100%\", region:\"center\", splitter:true'>\r\n\t\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='query:{ }, rowsPerPage:30' ></div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='style:\"width:60%;height:100%\", region:\"right\", splitter:true, \"class\":\"bordered\"'>\r\n\t\t\t<div data-dojo-attach-point=\"control\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='style:\"width:100%;height:100%\",gutters:false' >\r\n\t\t\t\t<div data-dojo-attach-point=\"tabcont\" data-dojo-type=\"dijit.layout.TabContainer\" data-dojo-props=\"region:'center',splitter:true,'class':'bordered'\">\r\n\t\t\t\t\t<div data-dojo-attach-point=\"details\"  data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props=\"title:'Details',style:'height:100%;width:100%;overflow :auto','class':'bordered scrollpane',selected:'selected'\">\r\n\t\t\t\t\t\t<span class=\"common_prmax_layout\">\r\n\t\t\t\t\t\t\t<div style=\"padding:2px\" data-dojo-attach-point =\"display_pane\" class=\"prmaxhidden\">\r\n\t\t\t\t\t\t\t\t<form data-dojo-attach-point=\"update_form\" data-dojo-props='\"class\":\"prmaxdefault\", onsubmit:\"return false\"' data-dojo-type=\"dijit.form.Form\">\r\n\t\t\t\t\t\t\t\t\t<input data-dojo-attach-point=\"newsroomid\" data-dojo-props='name:\"newsroomid\", type:\"hidden\", value:\"-1\"' data-dojo-type=\"dijit.form.TextBox\" >\r\n\t\t\t\t\t\t\t\t\t<table class=\"prmaxtable\">\r\n\t\t\t\t\t\t\t\t\t\t<tr><td colspan=\"4\" align=\"center\" class=\"prmaxrowdisplaylarge\" > Newsroom Details</td><td><button data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"show_new_room_url\" data-dojo-attach-event=\"onClick:_show_new_room_url\" data-dojo-props='type:\"button\",label:\"Goto News Room\"'></button></td></tr>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" >Description</td><td colspan=\"3\" class=\"prmaxrowdisplay\" width=\"70%\"><input data-dojo-props='invalidMessage:\"Description field must be filled in\", style:\"width:90%\", \"class\":\"prmaxrequired\", name:\"description\", type:\"text\", maxlength:80, trim:true, required:true' data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"description\"/></td></tr>\r\n\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<td class=\"prmaxrowtag\">News Room Root</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"3\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span><input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"news_room_root\" data-dojo-props='lowercase:true,\"class\":\"prmaxrequired\",name:\"news_room_root\",trim:true,maxLength:20,type:\"text\",style:\"width:10em\", regExp:\"[\\\\w]+\", invalidMessage:\"Invalid\"'/></span>\r\n\t\t\t\t\t\t\t\t\t\t\t</td></tr>\r\n\t\t\t\t\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Custom Link 1</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"3\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"prmaxrowtag\">Name</span><input data-dojo-attach-point=\"link_1_name\" data-dojo-props='\"class\":\"prmaxinput\",name:\"link_1_name\",type:\"text\",maxLength:\"80\",trim:true,style:\"width:10em\"' data-dojo-type=\"dijit.form.TextBox\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"prmaxrowtag\">Url</span><input data-dojo-attach-point=\"link_1_url\" data-dojo-props='\"class\":\"prmaxinput\",name:\"link_1_url\",type:\"text\",maxLength:\"80\",regExpGen:dojox.validate.regexp.url,trim:true,style:\"width:20em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" />\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Custom Link 2</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"3\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"prmaxrowtag\">Name</span><input data-dojo-attach-point=\"link_2_name\" data-dojo-props='\"class\":\"prmaxinput\",name:\"link_2_name\",type:\"text\",maxLength:\"80\",trim:true,style:\"width:10em\"' data-dojo-type=\"dijit.form.TextBox\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"prmaxrowtag\">Url</span><input data-dojo-attach-point=\"link_2_url\" data-dojo-props='\"class\":\"prmaxinput\",name:\"link_2_url\",type:\"text\",maxLength:\"80\",regExpGen:dojox.validate.regexp.url,trim:true,style:\"width:20em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" />\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t<tr><td width=\"30%\" align=\"right\" class=\"prmaxrowtag\" valign=\"top\" >Header Color</td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td width=\"20%\"><div data-dojo-type=\"prmax.customer.clients.pickcolour\" data-dojo-attach-point=\"header_colour\" data-dojo-props='name:\"header_colour\",style:\"width:200px\"' data-dojo-attach-event=\"onClick:_ColourUpdate\" ></div></td>\r\n\t\t\t\t\t\t\t\t\t\t\t<td width=\"50%\"><label><input data-dojo-attach-point=\"default_header_colour\" data-dojo-type=\"dijit.form.CheckBox\" data-dojo-props='\"class\":\"prmaxdefault\",type:\"checkbox\",value:\"0\",checked:false' data-dojo-attach-event=\"onClick:_use_default_color\"/>Use Default</label><br/></td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\" >Header Image Left</td><td colspan=\"3\"><div data-dojo-type=\"prmax.customer.clients.headerimage\" data-dojo-attach-point=\"headerimage_left\" data-dojo-props='style:\"width:500px;height:120px;margin:2px\",\"class\":\"bordered\",title:\"Left side Image\",imagetypeid:1,name:\"headerimageleftid\"' ></div></td></tr>\r\n\t\t\t\t\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\" >Header Image Right</td><td colspan=\"3\"><div data-dojo-type=\"prmax.customer.clients.headerimage\" data-dojo-attach-point=\"headerimage_right\" data-dojo-props='style:\"width:500px;height:120px;margin:2px\",\"class\":\"bordered\",title:\"Right side Image\",imagetypeid:2,name:\"headerimagerightid\"' ></div></td></tr>\r\n\t\t\t\t\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\" >About</td>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t<td colspan=\"4\" style=\"height:150px;\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div style=\"height:150px;\" data-dojo-type=\"dijit.Editor\" data-dojo-attach-point=\"about_template\" data-dojo-props='name:\"about_template\", \"class\":\"bordered\", extraPlugins:[{name:\"dijit._editor.plugins.FontChoice\",command:\"fontName\", generic:false},\"fontSize\",\"createLink\",\"viewsource\",\"preview\"]'></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</td></tr>\r\n<!--\r\n\t\t\t\t\t\t\t\t\t\t<tr><td colspan = \"3\" align=\"right\"><button data-dojo-props='\"class\":\"prmaxbutton\", style:\"margin-right:25px\", type:\"button\", label:\"Update\", busyLabel:\"Please Wait Updating\" ' data-dojo-type=\"dojox.form.BusyButton\" data-dojo-attach-event=\"onClick:_Update\" data-dojo-attach-point=\"update_form_btn\"></button></td></tr>\r\n-->\r\n\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t\t\t<form data-dojo-attach-point=\"show_news_room_form\" target=\"_blank\" method=\"post\" action=\"\"></form>\t\t\t\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div data-dojo-attach-point=\"contact\" data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props=\"title:'Contact',style:'height:100%;width:100%;overflow :auto;display:none;','class':'bordered scrollpane'\">\r\n\t\t\t\t\t\t<form data-dojo-attach-point=\"contact_form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='\"class\":\"prmaxdefault common_prmax_layout\",onsubmit:\"return false\",style:\"margin:5px\"'>\r\n\t\t\t\t\t\t\t<table class=\"prmaxtable\">\t\t\r\n\t\t\t\t\t\t\t\t<tr><td colspan=\"2\" align=\"center\" class=\"prmaxrowdisplaylarge\" > Newsroom Contact Details</td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" width=\"20%\">Www</td><td colspan=\"2\"><input data-dojo-attach-point=\"www\" data-dojo-props='name:\"www\",type:\"text\",size:\"40\",maxLength:\"90\",trim:true,style:\"width:25em\",regExpGen:dojox.validate.regexp.url' data-dojo-type=\"dijit.form.ValidationTextBox\"/></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Email</td><td colspan=\"2\"><input data-dojo-attach-point=\"email\" data-dojo-props='name:\"email\",type:\"text\",size:\"40\",maxLength:\"84\",trim:true,style:\"width:25em\",regExpGen:dojox.validate.regexp.emailAddress' data-dojo-type=\"dijit.form.ValidationTextBox\"/></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Tel</td><td colspan=\"2\"><input data-dojo-attach-point=\"tel\" data-dojo-props='name:\"tel\",type:\"text\",maxLength:\"40\",style:\"15em\"' data-dojo-type=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Twitter</td><td colspan=\"2\"><input data-dojo-attach-point=\"twitter\" data-dojo-props='\"class\":\"prmaxinput\",name:\"twitter\",type:\"text\",maxLength:\"90\",regExpGen:dojox.validate.regexp.url,trim:true,style:\"width:25em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Facebook</td><td colspan=\"2\"><input data-dojo-attach-point=\"facebook\" data-dojo-props='\"class\":\"prmaxinput\",name:\"facebook\",type:\"text\",maxLength:\"90\",regExpGen:dojox.validate.regexp.url,trim:true,style:\"width:25em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Linkedin</td><td colspan=\"2\"><input data-dojo-attach-point=\"linkedin\" data-dojo-props='\"class\":\"prmaxinput\",name:\"linkedin\",type:\"text\",maxLength:\"80\",regExpGen:dojox.validate.regexp.url,trim:true,style:\"width:25em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</form>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"bottom\",style:\"width:100%;height:50px\"'>\r\n\t\t\t\t\t<div class=\"common_prmax_layout\" style=\"padding:2px;\">\r\n\t\t\t\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_deleteNewsroom\" data-dojo-attach-point=\"deletebutton\"  data-dojo-props='label:\"Delete\",showLabel:true'>Delete</button>\r\n\t\t\t\t\t\t<button data-dojo-attach-point=\"update_form_btn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-attach-event=\"onClick:_Update\" data-dojo-props='busyLabel:\"Please Wait...\",\"class\":\"prmaxbutton\",style:\"float:right\",label:\"Update\"'>Update</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div>\r\n\t\t<div data-dojo-attach-point=\"add_newsroom_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Add Newsroom\", style:\"width:700px;height:800px\"'>\r\n\t\t<div data-dojo-attach-point=\"addnewsroomctrl\" data-dojo-type=\"prcommon.newsrooms.add\" style=\"width:700px;height:800px\"></div>\r\n\t</div>\r\n</div>\r\n\r\n\r\n",constructor:function(){this.model=new prcommon.data.QueryWriteStore({url:"/newsroom/newsroom_grid",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,nocallback:true,urlPreventCache:true});this._LoadNewsroomCallBack=dojo.hitch(this,this._LoadNewsroomCall);this._UpdateNewsroomCallBack=dojo.hitch(this,this._UpdateNewsroomCall);this._DeleteNewsroomCallBack=dojo.hitch(this,this._DeleteNewsroomCall);dojo.subscribe("/newsroom/add",dojo.hitch(this,this._AddNewsroomEvent));},postCreate:function(){this.icustomerid=PRMAX.utils.settings.cid;this.grid.set("structure",this.view);this.grid._setStore(this.model);this.grid["onCellClick"]=dojo.hitch(this,this._onCellClick);this.tabcont.selectChild(this.details);},_OnStyleRow:function(_1){ttl.GridHelpers.onStyleRow(_1);this.tabcont.selectChild(this.details);},view:{cells:[[{name:"Description",width:"200px",field:"description"},{name:"Client",width:"200px",field:"clientname"},{name:"Root",width:"200px",field:"news_room_root"}]]},_onCellClick:function(e){this._row=this.grid.getItem(e.rowIndex);var _2={};_2["newsroomid"]=this._row.i.newsroomid;dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._LoadNewsroomCallBack),url:"/newsroom/newsroom_get",content:_2}));},_LoadNewsroomCall:function(_3){if(_3.success=="OK"){dojo.removeClass(this.display_pane,"prmaxhidden");dojo.style(this.contact.controlButton.domNode,{display:"none"});this.newsroomid.set("value",_3.data.newsroom.newsroomid);this.description.set("value",_3.data.newsroom.description);this.news_room_root.set("value",_3.data.newsroom.news_room_root);this.link_1_name.set("value",_3.data.customlinks.link_1.name);this.link_1_url.set("value",_3.data.customlinks.link_1.url);this.link_2_name.set("value",_3.data.customlinks.link_2.name);this.link_2_url.set("value",_3.data.customlinks.link_2.url);this.header_colour.set("value",_3.data.newsroom.header_colour);this.headerimage_left.set("value",_3.data.newsroom.newsroomid);this.headerimage_right.set("value",_3.data.newsroom.newsroomid);this.about_template.set("value",_3.data.newsroom.about_template);dojo.attr(this.show_news_room_form,"action",_3.data.newsroom_url);if(_3.data.clientmode==false){dojo.style(this.contact.controlButton.domNode,{display:"inline-block"});if(_3.data.ns_contact){this.www.set("value",_3.data.ns_contact.www);this.tel.set("value",_3.data.ns_contact.tel);this.email.set("value",_3.data.ns_contact.email);this.linkedin.set("value",_3.data.ns_contact.linkedin);this.facebook.set("value",_3.data.ns_contact.facebook);this.twitter.set("value",_3.data.ns_contact.twitter);}else{this.www.set("value","");this.tel.set("value","");this.email.set("value","");this.linkedin.set("value","");this.facebook.set("value","");this.twitter.set("value","");}}else{dojo.style(this.contact.controlButton.domNode,{display:"none"});}}this.tabcont.selectChild(this.details);},_AddNewsroom:function(){this.addnewsroomctrl.Load(this.add_newsroom_dlg);this.add_newsroom_dlg.show();},_AddNewsroomEvent:function(_4){this.model.newItem(_4);},_Update:function(){if(ttl.utilities.formValidator(this.update_form)==false||ttl.utilities.formValidator(this.contact_form)==false){alert("Not all required field filled in");this.update_form_btn.cancel();return;}if(confirm("Update?")){var _5=dojo.mixin(this.update_form.get("value"),this.contact_form.get("value"));dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._UpdateNewsroomCallBack),url:"/newsroom/newsroom_update",content:_5}));}},_UpdateNewsroomCall:function(_6){if(_6.success=="OK"){alert("Newsroom Updated");this.update_form_btn.cancel();this.model.setValue(this._row,"description",_6.data.newsroom.description,true);this.model.setValue(this._row,"news_room_root",_6.data.newsroom.news_room_root,true);}else{if(_6.success=="DU"){alert("Newsroom Already Exists");this.update_form_btn.cancel();}else{alert("Problem updating Newsroom");this.update_form_btn.cancel();}}},_deleteNewsroom:function(){if(confirm("Delete Selected Newsroom?")){var _7={};_7["newsroomid"]=this._row.i.newsroomid;dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._DeleteNewsroomCallBack),url:"/newsroom/newsroom_delete",content:_7}));}},_DeleteNewsroomCall:function(_8){if(_8.success=="OK"){alert("Newsroom Deleted");this.grid.setQuery(ttl.utilities.getPreventCache({}));this.Clear();}else{alert("Problem Deleting Selected Newsroom");}},Clear:function(){this._Clear();},_Clear:function(){this.newsroomid.set("value","-1");this.description.set("value","");this.news_room_root.set("value","");this.link_1_name.set("value","");this.link_1_url.set("value","");this.link_2_name.set("value","");this.link_2_url.set("value","");this.header_colour.set("value","");this.headerimage_left.set("value","");this.headerimage_right.set("value","");this.about_template.set("value","");this.www.set("value","");this.tel.set("value","");this.email.set("value","");this.linkedin.set("value","");this.facebook.set("value","");this.twitter.set("value","");this.update_form_btn.set("disabled",false);},_use_default_color:function(){if(this.default_header_colour.checked){this.header_colour.set("value","#2e74b5");}},_ColourUpdate:function(){this.default_header_colour.set("checked",false);},_show_new_room_url:function(){this.show_news_room_form.submit();},});}