/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.interests.Interests"]){dojo._hasResource["prcommon.interests.Interests"]=true;dojo.provide("prcommon.interests.Interests");dojo.require("ttl.BaseWidget");dojo.require("prcommon.search.std_search");dojo.declare("prcommon.interests.Interests",[prcommon.search.std_search,ttl.BaseWidget],{name:"",value:"",displaytitle:"Keywords",search:"",size:"7",testmode:false,selectonly:false,startopen:false,interesttypeid:1,nofilter:false,restrict:1,widgetsInTemplate:true,templateString:"<div dojoAttachPoint=\"containerNode\" >\r\n\t<table width=\"100%\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t<tr><td width=\"20%\"   class=\"prmaxrowtag\">${displaytitle}</td>\r\n\t\t\t\t<td width=\"5%\" ><i dojoAttachPoint=\"toggleCtrl\" dojoAttachEvent=\"onclick:_Toggle\" class=\"fa fa-plus-circle\" style=\"color:#7F7F7F\"></i></td>\r\n\t\t\t\t<td align=\"right\" v-align=\"top\" ><div dojoAttachPoint=\"countNode\" dojotype=\"prcommon.search.SearchCount\"></div></td>\r\n\t\t</tr>\r\n\t</table>\r\n\t<div class=\"dojoInterestPane\" >\r\n\t\t<div dojoAttachPoint=\"selectarea\" class=\"prmaxselectmultiple\" style=\"display:none\" >\r\n\t\t\t<table width=\"100%\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\" >\r\n\t\t\t\t  <tr><td width=\"47%\"></td><td width=\"5%\"></td><td width=\"48%\" ></td></tr>\r\n\t\t\t\t  <tr><td colspan=\"3\">\r\n\t\t\t\t  <table style=\"width:100%\" class=\"prmaxtable\" >\r\n\t\t\t\t  <tr>\r\n\t\t\t\t  <td width=\"40%\" dojoAttachPoint=\"master_type_text\"><span class=\"prmaxrowtag\">Select</span><input class=\"prmaxfocus prmaxinput\" type=\"text\" dojoType=\"dijit.form.TextBox\" style=\"width:60%\" dojoAttachPoint=\"interest_list_select\" dojoAttachEvent=\"onkeyup:interestSelect\" /></td>\r\n\t\t\t\t  <td width=\"40%\">\r\n\t\t\t\t\t<select\r\n\t\t\t\t\t\t\tstyle=\"width:100%\"\r\n\t\t\t\t\t\t\t autoComplete=\"true\"\r\n\t\t\t\t\t\t\t searchAttr=\"name\"\r\n\t\t\t\t\t\t\t dojoType=\"dijit.form.FilteringSelect\"\r\n\t\t\t\t\t\t\t labelType=\"html\"\r\n\t\t\t\t\t\t\t dojoAttachPoint=\"master_type\"\r\n\t\t\t\t\t\t\t dojoAttachEvent=\"onChange:changeFilter\">\r\n\t\t\t\t  </td>\r\n\t\t\t\t  <td width=\"3%\" align=\"right\"><input class=\"prmaxdefault\" dojoAttachPoint=\"AndOr\"  dojoType=\"dijit.form.CheckBox\" checked type=\"checkbox\" value=\"2\" dojoAttachEvent=\"onClick:And_Or\"/></td>\r\n\t\t\t\t  <td width=\"15%\"><label dojoAttachPoint=\"AndOrLabel\" class=\"prmaxlabeltag\" >All</label></td>\r\n\t\t\t\t  </tr></table>\r\n\t\t\t\t  </td></tr>\r\n\t\t\t\t  <tr><td ><select style=\"width:100%\" dojoAttachPoint=\"interest_list\" size=\"${size}\" class=\"select_list\" multiple=\"multiple\" ></select></td>\r\n\t\t\t\t  <td >\r\n\t\t\t\t  <button class=\"button_add_all\"  style=\"padding:0px;margin:0px\" class=\"button_add_all\" dojoAttachPoint=\"button_all\" disabled=\"true\" type=\"button\" dojoAttachEvent=\"onClick:interestSelectAll\" dojoType=\"dijit.form.Button\"><div class=\"std_movement_button\">&gt;&gt;</div></button><br/>\r\n\t\t\t\t  <button class=\"button_add_single\" style=\"padding:0px;margin:0px\" class=\"button_add_single\" dojoAttachPoint=\"button_single\" disabled=\"true\" type=\"button\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:interestSelectSingle\"><div class=\"std_movement_button\">&gt;&nbsp;</div></button><br/>\r\n\t\t\t\t  <button class=\"button_del_all\" style=\"padding:0px;margin:0px\" class=\"button_del_all\" dojoAttachPoint=\"button_del_all\" disabled=\"true\" type=\"button\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:interestRemoveAll\"><div class=\"std_movement_button\">&lt;&lt;</div></button><br/>\r\n\t\t\t\t  <button class=\"button_del_single\" style=\"padding:0px;margin:0px\" class=\"button_del_single\" dojoAttachPoint=\"button_del_single\" disabled=\"true\" type=\"button\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:interestRemoveSingle\"><div class=\"std_movement_button\">&lt;&nbsp;</div></button></td>\r\n\t\t\t\t  <td ><select style=\"width:100%\" dojoAttachPoint=\"interest_select\" size=\"${size}\" class=\"selection_lists\" multiple=\"multiple\" dojoAttachEvent=\"onchange:interestUpdateSelection\"></select></td></tr>\r\n\t\t\t</table>\r\n\t\t</div>\r\n\t</div>\r\n    <div dojoType=\"dijit.Tooltip\" dojoAttachPoint=\"AndOr_Tip\" showDelay=\"800\">\r\n\t<div class=\"tooltipframe\" ><b>All Search Options</b><br/>If this option is selected then the resulting search will be all the unique items in all the interests <br/>added together, if it's not checked then the result is only those items that have entries in all the interests<br/></div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.disabled=false;this._extended=false;this._LoadSelectionCall=dojo.hitch(this,this._LoadSelection);this.interestTimer=null;this.inherited(arguments);},statup2:function(){this.master_type.set("value",-1);this.inherited(arguments);},postCreate:function(){this.master_type.store=PRCOMMON.utils.stores.Interest_Sections();this.master_type.set("value",-1);dojo.connect(this.interest_list_select.domNode,"onkeyup",dojo.hitch(this,this.interestSelect));dojo.connect(this.interest_list,"onchange",dojo.hitch(this,this.interestUpdateSelection));dojo.connect(this.interest_list,"ondblclick",dojo.hitch(this,this.interestSelectDbl));dojo.attr(this.AndOrLabel,"for",this.AndOr.id);if(this.selectonly){this.AndOr.domNode.style.display="None";this.countNode.domNode.style.display="None";this.AndOrLabel.style.display="None";}else{this.AndOr_Tip.set("connectId",this.AndOr.id);}if(this.nofilter){dojo.style(this.master_type.domNode,"display","none");}if(this.startopen){dojo.style(this.toggleCtrl,"display","none");dojo.style(this.selectarea,"display","block");}this.inherited(arguments);},Clear:function(){this._ClearSelectionBox();this._ClearSelectedBox();this.master_type.set("value",-1);this.interest_list_select.set("value","");this._Get(this._getValueAttr());this._SelectionOptions();this.inherited(arguments);},clear_private:function(){this.Clear();this.interest_select.options[this.interest_select.options.length]=new Option("Private",3312);},_Send_Request:function(_1,_2){this._transactionid=PRCOMMON.utils.uuid.createUUID();dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadSelectionCall,url:"/interests/listuserselection",content:{word:_1,filter:_2,logic:this.AndOr.get("value"),interesttypeid:this.interesttypeid,keytypeid:this.keytypeid,restrict:this.restrict,transactionid:this._transactionid}}));},interestSelect:function(p1,_3){var _4=this.interest_list_select.get("value");var _5=this.master_type.get("value");if(_3!=null){_4=_3;}if(_5=="-1"&&_4=="*"){_4="";}if(_4.length>0){if(this.interestTimer){clearTimeout(this.interestTimer);this.interestTimer=null;}this.interestTimer=setTimeout(dojo.hitch(this,this._Send_Request,_4,_5),this.searchTime);}else{this.interestTimer=null;this._ClearSelectionBox();this._SelectionOptions();}},_LoadSelection:function(_6){if(this._transactionid==_6.transactionid){this._ClearSelectionBox();for(var i=0;i<_6.data.length;++i){var _7=_6.data[i];this.interest_list.options[this.interest_list.options.length]=new Option(_7[0],_7[1]);}this._SelectionOptions();}},_ClearSelectionBox:function(){this.interest_list.options.length=0;},_ClearSelectedBox:function(){this.interest_select.length=0;},And_Or:function(){this._Get(this._getValueAttr(),true);},interestUpdateSelection:function(){this._SelectionOptions();},interestSelectDbl:function(){this.interestSelectSingle();this._SelectionOptions();},interestSelectAll:function(){for(var c=0;c<this.interest_list.options.length;c++){var _8=this.interest_list.options[c];var _9=true;for(var c1=0;c1<this.interest_select.options.length;c1++){if(this.interest_select.options[c1].value==_8.value){_9=false;break;}}if(_9){this.interest_select.options[this.interest_select.options.length]=new Option(_8.text,_8.value);}}this._Get(this._getValueAttr());this.interest_list.options.length=0;this.interestUpdateSelection();},interestSelectSingle:function(){for(var c=0;c<this.interest_list.options.length;c++){var _a=this.interest_list.options[c];if(_a.selected){_a.selected=false;var _b=true;for(var c1=0;c1<this.interest_select.options.length;c1++){if(this.interest_select.options[c1].value==_a.value){_b=false;break;}}if(_b){this.interest_select.options[this.interest_select.options.length]=new Option(_a.text,_a.value);this._Get(this._getValueAttr());}}}},interestRemoveAll:function(){this.interest_select.options.length=0;this.interestUpdateSelection();this._Get(this._getValueAttr());},interestRemoveSingle:function(){for(var c=0;c<this.interest_select.options.length;c++){if(this.interest_select.options[c].selected){this.interest_select.options[c]=null;}}this.interestUpdateSelection();this._Get(this._getValueAttr());},addSelect:function(_c){this.interest_select.options[this.interest_select.options.length]=new Option(_c.interestname,_c.interestid);},_setValueAttr:function(_d){this.Clear();var _e=_d.data;var _f=false;if(_e==null||_e==undefined){_e=_d;}for(var key in _e){var _10=_e[key];this.interest_select.options[this.interest_select.options.length]=new Option(_10.interestname,_10.interestid);opne=true;}if(_f){this.MakeOpen();}this._Get(this._getValueAttr());},_getValueAttr:function(){var _11=Array();for(var c=0;c<this.interest_select.options.length;c++){if(this._extended){_11[c]={interestid:parseInt(this.interest_select.options[c].value),interestname:this.interest_select.options[c].text};}else{_11[c]=parseInt(this.interest_select.options[c].value);}}var obj={data:_11,logic:this.AndOr.get("value")};if(this._extended){return obj;}else{var _11=_11.length>0?dojo.toJson(obj):"";this.value=_11;return _11;}},_getCountAttr:function(){return this.interest_select.options.length;},_setExtendedAttr:function(_12){this._extended=_12;},changeFilter:function(){this.interestSelect(null,"*");},_SelectionOptions:function(){this.button_all.set("disabled",this.interest_list.length?false:true);this.button_single.set("disabled",this.interest_list.selectedIndex!=-1?false:true);this.button_del_all.set("disabled",this.interest_select.length?false:true);this.button_del_single.set("disabled",this.interest_select.selectedIndex!=-1?false:true);},_CaptureExtendedContent:function(_13){var _14=this.AndOr.get("value");return dojo.mixin(_13,{logic:_14});},_setDisabledAttr:function(_15){this.disabled=_15;},_getDisabledAttr:function(){return this.disabled;},destroy:function(){this.inherited(arguments);},_Get:function(){if(this.selectonly==false){this.inherited(arguments);}},_focus:function(){this.interest_list_select.focus();},_Toggle:function(){if(this.open==false&&(this.master_type.get("value")==null||this.master_type.get("value").length==0)){this.master_type.set("value",-1);}this.inherited(arguments);}});}