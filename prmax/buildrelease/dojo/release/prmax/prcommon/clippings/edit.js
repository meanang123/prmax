/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.clippings.edit"]){dojo._hasResource["prcommon.clippings.edit"]=true;dojo.provide("prcommon.clippings.edit");dojo.require("ttl.BaseWidget");dojo.declare("prcommon.clippings.edit",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<form data-dojo-attach-point=\"formnode\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='\"class\":\"common_prmax_layout prmaxdefault\",\"onSubmit\":\"return false\"'>\r\n\t\t<input data-dojo-attach-point=\"clippingid\" data-dojo-props='value:\"\",name:\"clippingid\",type:\"hidden\"' data-dojo-type=\"dijit.form.TextBox\"/>\r\n\t\t<br/>\r\n\t\t<label class=\"label_1\">Client</label><select data-dojo-props='name:\"clientid\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clientid\" ></select><br/>\r\n\t\t<label data-dojo-attach-point=\"issue_label_1\" class=\"label_1\">Issue</label><select data-dojo-props='name:\"issueid\",autoComplete:true,searchAttr:\"name\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"issueid\" ></select><br/>\r\n\t\t<button data-dojo-attach-event=\"onClick:_save\" data-dojo-attach-point=\"savebtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Saving...\",label:\"Save\",\"class\":\"btnright\"'></button>\r\n\t</form>\r\n</div>\r\n",constructor:function(){this._clients=new dojox.data.JsonRestStore({target:"/clients/rest_combo",idAttribute:"id"});this._issues=new dojox.data.JsonRestStore({target:"/crm/issues/issues_list_rest",idAttribute:"id"});this._update_call_back=dojo.hitch(this,this._update_call);},postCreate:function(){this.inherited(arguments);this.clientid.set("store",this._clients);this.clientid.set("value","-1");this.issueid.set("store",this._issues);this.issueid.set("value","-1");dojo.attr(this.issue_label_1,"innerHTML",PRMAX.utils.settings.issue_description);},clear:function(){this.clippingid.set("value",-1);this.clientid.set("value","-1");this.issueid.set("value","-1");this.savebtn.cancel();},_save:function(){if(ttl.utilities.formValidator(this.formnode)==false){alert("Please Enter Details");this.savebtn.cancel();return false;}dojo.xhrPost(ttl.utilities.makeParams({load:this._update_call_back,url:"/clippings/update_clipping",content:this.formnode.get("value")}));},_update_call:function(_1){if(_1.success=="OK"){dojo.publish("/clipping/update",[_1.data]);}else{alert("Problem");}this.savebtn.cancel();},load:function(_2){this.savebtn.cancel();this.clippingid.set("value",_2.clippingid);this.clientid.set("value",_2.clientid);this.issueid.set("value",_2.issueid);}});}