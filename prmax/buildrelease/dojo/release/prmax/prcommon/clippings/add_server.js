/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.clippings.add_server"]){dojo._hasResource["prcommon.clippings.add_server"]=true;dojo.provide("prcommon.clippings.add_server");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("dojox.form.PasswordValidator");dojo.declare("prcommon.clippings.add_server",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n    <form data-dojo-attach-point=\"form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='\"onSubmit\":\"return false\"'>\r\n        <input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"customerid\" data-dojo-props='\"class\":\"prmaxhidden\", name:\"customerid\",type:\"text\"'/>\r\n        <table width=\"100%\" class=\"prmaxtable\" >\r\n            <tr><td align=\"right\"  width=\"30%\" class=\"prmaxrowtag\">From:</td><td><input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"fromemailaddress\" data-dojo-props='name:\"fromemailaddress\",type:\"text\"'></td></tr>\r\n            <tr><td align=\"right\" width=\"30%\" class=\"prmaxrowtag\">Server Type:</td><td><select data-dojo-props='name:\"servertypeid\",autoComplete:true,labelType:\"html\",style:\"width:15em\"' data-dojo-type=\"dijit.form.Select\" data-dojo-attach-point=\"servertypeid\" data-dojo-attach-event=\"onChange:_server_type\"></select></td></tr><br/>\r\n            <tr><td align=\"right\" width=\"30%\" class=\"prmaxrowtag\">Username:</td><td><input data-dojo-props='\"class\":\"prmaxinput\",trim:true,name:\"username\",type:\"text\",required:true,placeHolder:\"Email server login name\"' data-dojo-attach-point=\"username\" data-dojo-type=\"dijit.form.ValidationTextBox\" ></td></tr>\r\n            <tr data-dojo-attach-point=\"url_view\" class=\"prmaxhidden\"><td align=\"right\" width=\"30%\" class=\"prmaxrowtag\">Host:</td><td><input data-dojo-props='\"class\":\"prmaxinput\",pattern:dojox.validate.regexp.url,trim:true,name:\"host\",type:\"text\",required:false' data-dojo-attach-point=\"host\" data-dojo-type=\"dijit.form.ValidationTextBox\" ></td></tr>\r\n\r\n            <tr ><td colspan=\"2\">\r\n                <div data-dojo-type=\"dojox.form.PasswordValidator\" name=\"password\" class=\"prmaxrowtag\" data-dojo-attach-point=\"password\">\r\n                    <table class=\"prmaxtable\" width=\"100%\" >\r\n                        <tr><td align=\"right\" width=\"30%\" class=\"prmaxrowtag\">Password:</td><td><input class=\"prmaxrequired\" type=\"password\" pwType=\"new\" data-dojo-attach-point=\"password\"/></td></tr>\r\n                        <tr><td align=\"right\" width=\"30%\" class=\"prmaxrowtag\" >Verify:</td><td><input class=\"prmaxrequired\" type=\"password\" pwType=\"verify\" data-dojo-attach-point=\"verify\" /></td></tr>\r\n                    </table>\r\n                </div>\r\n            </td></tr>\r\n\r\n            <tr><td class=\"prmaxrowtag\" colspan=\"2\" align=\"left\"><button data-dojo-attach-event=\"onClick:_send_test\" data-dojo-attach-point=\"sendtestbtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait...\",label:\"Set Test Email\",\"class\":\"btnright\"'></button></td></tr>\r\n            <tr><td class=\"prmaxrowtag\" colspan=\"2\" align=\"right\"><button data-dojo-attach-event=\"onClick:_save\" data-dojo-attach-point=\"savebtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Saving...\",label:\"Save\",\"class\":\"btnright\"'></button></td></tr>\r\n\r\n        </table></br></br>\r\n        \r\n    </form></br></br>\r\n</div>\r\n\r\n",constructor:function(){this._save_call_back=dojo.hitch(this,this._save_call);this._send_test_call_back=dojo.hitch(this,this._send_test_call);this._servertypes=new dojo.data.ItemFileWriteStore({url:"/common/lookups?searchtype=servertypes"});this._customerid=PRMAX.utils.settings.cid;},postCreate:function(){this.inherited(arguments);this.servertypeid.store=this._servertypes;},load:function(_1,_2){this._dialog=_1;this.customerid.set("value",_2);},_save:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");this.savebtn.cancel();return false;}var _3=this.form.get("value");_3["password"]=this.password.value;dojo.xhrPost(ttl.utilities.makeParams({load:this._save_call_back,url:"/customeremailserver/add",content:_3}));},_save_call:function(_4){if(_4.success=="OK"){alert("Email Server Added");this.savebtn.cancel();this._dialog.hide();dojo.publish("customeremailserver/add",[_4.data]);}else{alert("Problem Adding Email Server");}this.savebtn.cancel();},_send_test:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");this.sendtestbtn.cancel();return false;}var _5={};_5["customerid"]=this._customerid;_5["fromemailaddress"]=this.fromemailaddress.get("value");_5["host"]=this.servertypeid.get("value");_5["username"]=this.username.get("value");_5["password"]=this.password.value;_5["hostname"]=this.host.get("value");dojo.xhrPost(ttl.utilities.makeParams({load:this._send_test_call_back,url:"/emails/email_test_server",content:_5}));},_send_test_call:function(_6){if(_6.success=="OK"){alert("Test email has been sent");this.sendtestbtn.cancel();}else{alert("Problem Sending Test Email");}this.sendtestbtn.cancel();},_server_type:function(){this._change_view();},_change_view:function(){var _7=parseInt(this.servertypeid.get("value"));if(_7==6){dojo.removeClass(this.url_view,"prmaxhidden");this.host.set("required",true);}else{dojo.addClass(this.url_view,"prmaxhidden");this.host.set("required",false);}}});}