/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.clippings.viewer"]){dojo._hasResource["prcommon.clippings.viewer"]=true;dojo.provide("prcommon.clippings.viewer");dojo.require("ttl.BaseWidget");dojo.require("dijit.Menu");dojo.require("dijit.MenuBar");dojo.require("dijit.MenuBarItem");dojo.require("dijit.PopupMenuBarItem");dojo.require("dojox.data.JsonRestStore");dojo.require("prcommon.clippings.searchext");dojo.require("dijit.Dialog");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.layout.StackContainer");dojo.require("prcommon.clippings.edit");dojo.require("prcommon.clippings.analysis.edit");dojo.require("prcommon.clippings.edit_private");dojo.require("prcommon.clippings.questions.viewer");dojo.require("prcommon.clippings.clippingoutput");dojo.declare("prcommon.clippings.viewer",[ttl.BaseWidget],{widgetsInTemplate:true,basic_details_page:"/clippings/display_page?clippingid=${clippingid}",templateString:"<div>\r\n\t<div data-dojo-attach-point=\"frame\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-point='style:\"width:100%;height:100%\",gutters:false' >\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-attach-point=\"controls\" data-dojo-props='region:\"top\",style:\"height:50px;width:100%;padding:0x;margin:0px;overflow:hidden\",\"class\":\"std_menu_view\"'>\r\n\t\t\t<label>Client&nbsp;</label><select data-dojo-props='autoComplete:true,searchAttr:\"clientname\",labelType:\"html\",style:\"width:8em;background-color:black\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clientid\" data-dojo-attach-event=\"onChange:_change_filter\"></select>\r\n\t\t\t<div data-dojo-attach-event=\"onClick:_add_clipping\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"fa fa-plus fa-3x\",label:\"Add Clipping\",showLabel:false'></div>\r\n\t\t\t<div data-dojo-attach-event=\"onClick:_search_ext\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"fa fa-search fa-3x\",label:\"Search\",showLabel:false'></div>\r\n\t\t\t<div data-dojo-attach-event=\"onClick:_reporting\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"fa fa-bar-chart fa-3x\",label:\"Output\",showLabel:false'></div>\r\n\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\" data-dojo-props='iconClass:\"fa fa-ellipsis-v fa-3x\",label:\"Options\",showLabel:false'>\r\n\t\t\t\t<div data-dojo-type=\"dijit.Menu\" >\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.MenuItem\" data-dojo-props='label:\"Clients\"' data-dojo-attach-event=\"onClick:_clients\"></div>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.MenuItem\" data-dojo-props='label:\"Issues\"' data-dojo-attach-point=\"issue_label_1\" data-dojo-attach-event=\"onClick:_issues\"></div>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.MenuItem\" data-dojo-props='label:\"Questions\"' data-dojo-attach-event=\"onClick:_questions\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\"  data-dojo-props='region:\"center\",splitter:true'>\r\n\t\t\t<div data-dojo-attach-point=\"viewer_grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='query:{ },rowsPerPage:30,style:\"width:100%;height:100%\"' ></div>\r\n\t\t</div>\r\n\t\t<div data-dojo-attach-point=\"clipping_view_ctrl\" data-dojo-type=\"dijit.layout.StackContainer\" data-dojo-props='region:\"right\",splitter:true,style:\"width:50%;height:100%\"'>\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-attach-point=\"blank_view\" data-dojo-props='style:\"width:100%;height:100%\"'></div>\r\n\t\t\t<div data-dojo-attach-point=\"clippings_view\" data-dojo-type=\"dijit.layout.TabContainer\" data-dojo-props='style:\"width:100%;height:100%\"' >\r\n\t\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-attach-point=\"clipping_view\" data-dojo-props='title:\"Clipping\",style:\"width:100%;height:100%\"'></div>\r\n\t\t\t\t<div data-dojo-type=\"prcommon.clippings.analysis.edit\" data-dojo-attach-point=\"clipping_analysis_view\" data-dojo-props='title:\"Analysis\",style:\"width:100%;height:100%\"'></div>\r\n\t\t\t\t<div data-dojo-type=\"prcommon.clippings.edit\" data-dojo-attach-point=\"clipping_edit_view\" data-dojo-props='title:\"Edit\",style:\"width:100%;height:100%\"'></div>\r\n\t\t\t\t<div data-dojo-type=\"prcommon.clippings.edit_private\" data-dojo-attach-point=\"clipping_edit_private_view\" data-dojo-props='title:\"Edit\",style:\"width:100%;height:100%\",mode:\"edit\"'></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t<div data-dojo-attach-point=\"search_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Search Clippings\",style:\"width:500px;height:300px\"'>\r\n\t\t<div data-dojo-attach-point=\"search_ctrl\" data-dojo-type=\"prcommon.clippings.searchext\"></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"add_clipping_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Add Clippings\",style:\"width:600px;height:600px\"'>\r\n\t\t<div data-dojo-attach-point=\"add_clipping_ctrl\" data-dojo-type=\"prcommon.clippings.edit_private\"></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"output_clipping_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Clippings Output\",style:\"width:600px;height:400px\"'>\r\n\t\t<div data-dojo-attach-point=\"output_clipping_ctrl\" data-dojo-type=\"prcommon.clippings.clippingoutput\"></div>\r\n\t</div>\r\n</div>\r\n\r\n",constructor:function(){this._clippings=new dojox.data.JsonRestStore({target:"/clippings/list_clippings",idAttribute:"clippingid"});this._load_call_back=dojo.hitch(this,this._load_call);this._load_add_call_back=dojo.hitch(this,this._load_add_call);this._clients_model=new dojox.data.JsonRestStore({target:"/clients/rest_combo",idAttribute:"id"});this._do_search_ext_call_back=dojo.hitch(this,this._do_search_ext_call);dojo.subscribe("/clipping/update",dojo.hitch(this,this._update_event));dojo.subscribe("/clipping/private_add",dojo.hitch(this,this._private_add_event));},view1:{noscroll:false,cells:[[{name:" ",styles:"text-align: center;",width:"15px",formatter:ttl.utilities.format_row_ctrl},{name:"Date",width:"50px",field:"clip_source_date_display"},{name:"Type",styles:"text-align: center;",width:"30px",field:"clippingstypedescription",formatter:ttl.utilities.fonticon},{name:"Title",width:"250px",field:"clip_title"},{name:"Outlet",width:"250px",field:"outletname"},{name:"Source",width:"80px",field:"clippingsourcedescription"},{name:"Tone",width:"80px",field:"clippingstonedescription"}]]},postCreate:function(){this.clientid.set("store",this._clients_model);this.clientid.set("value","-1");this.viewer_grid.set("structure",this.view1);this.viewer_grid._setStore(this._clippings);this.viewer_grid["onRowClick"]=dojo.hitch(this,this._on_row_click);this.inherited(arguments);this.issue_label_1.set("label",PRMAX.utils.settings.issue_description+"s");},startup:function(){this.inherited(arguments);this.clipping_edit_view.controlButton.domNode.style.display="none";this.clipping_edit_private_view.controlButton.domNode.style.display="none";},_on_row_click:function(_1){var _2=this.viewer_grid.getItem(_1.rowIndex);if(_2){this._row=_2;dojo.xhrPost(ttl.utilities.makeParams({load:this._load_call_back,url:"/clippings/get_for_edit",content:{clippingid:_2.clippingid}}));}},_load_call:function(_3){this._show_clipping(_3.data,null);},_load_add_call:function(_4){this._show_clipping(_4.data,"analysis");},_show_clipping:function(_5,_6){this._set_options(_5);this.clipping_analysis_view.load(_5.clippingid);this.clipping_view.set("href",dojo.string.substitute(this.basic_details_page,{clippingid:_5.clippingid}));if(_5.clippingsourceid==2){this.clipping_edit_private_view.load(_5);}else{this.clipping_edit_view.load(_5);}this.clipping_view_ctrl.selectChild(this.clippings_view);if(_6=="analysis"){this.clippings_view.selectChild(this.clipping_analysis_view);}else{this.clippings_view.selectChild(this.clipping_view);}},_set_options:function(_7){if(_7.clippingsourceid==2){this.clipping_edit_view.controlButton.domNode.style.display="none";this.clipping_edit_private_view.controlButton.domNode.style.display="";}else{this.clipping_edit_view.controlButton.domNode.style.display="";this.clipping_edit_private_view.controlButton.domNode.style.display="none";}},_hide_clipping:function(){this.clipping_view_ctrl.selectChild(this.blank_view);},resize:function(){this.frame.resize(arguments[0]);},load:function(_8){},_add_clipping:function(){this.add_clipping_ctrl.clear();this.add_clipping_dlg.show();},_clients:function(){dijit.byId("std_banner_control")._Clients();},_newsrooms:function(){dijit.byId("std_banner_control")._Newsrooms();},_issues:function(){dijit.byId("std_banner_control")._issues();},_questions:function(){dijit.byId("std_banner_control")._question();},_search_ext:function(){this.search_ctrl.load(this._do_search_ext_call_back);this.search_dlg.show();},_change_filter:function(){var _9={};var _a=this.clientid.get("value");if(_a!=null&&_a!=-1){_9["clientid"]=_a;}this.viewer_grid.setQuery(ttl.utilities.getPreventCache(_9));this._hide_clipping();},_reporting:function(){this.output_clipping_dlg.show();},_do_search_ext_call:function(_b){this.viewer_grid.setQuery(ttl.utilities.getPreventCache(_b));this._hide_clipping();this.search_dlg.hide();},_update_event:function(_c){if(this._row){this._clippings.setValue(this._row,"clip_source_date_display",_c.clip_source_date_display);this._clippings.setValue(this._row,"clip_title",_c.clip_title);this._clippings.setValue(this._row,"outletname",_c.outletname);this._clippings.setValue(this._row,"clippingsourcedescription",_c.clippingsourcedescription);this.clipping_analysis_view.load(_c.clippingid);this.clipping_view.set("href",dojo.string.substitute(this.basic_details_page,{clippingid:_c.clippingid}));}},_private_add_event:function(_d){this._row=null;this._clippings.newItem(_d);dojo.xhrPost(ttl.utilities.makeParams({load:this._load_add_call_back,url:"/clippings/get_for_edit",content:{clippingid:_d.clippingid}}));this.add_clipping_dlg.hide();this.add_clipping_ctrl.clear();}});}