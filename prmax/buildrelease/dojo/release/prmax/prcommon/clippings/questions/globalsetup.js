/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.clippings.questions.globalsetup"]){dojo._hasResource["prcommon.clippings.questions.globalsetup"]=true;dojo.provide("prcommon.clippings.questions.globalsetup");dojo.declare("prcommon.clippings.questions.globalsetup",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"border_control\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-point='style:\"width:100%;height:100%\",gutters:false' >\r\n\t\t<span class=\"std_menu_view\">\r\n\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-attach-point=\"controls\" data-dojo-props='region:\"top\",style:\"height:38px;width:100%;padding:0x;margin:0px;overflow:hidden\",\"class\":\"std_menu_view\"'>\r\n\t\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"New Question\",iconClass:\"fa fa-plus fa-3x\"' data-dojo-attach-event=\"onClick:_new_question\"></button>\r\n\t\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Select Question\",iconClass:\"fa fa-list fa-3x\"' data-dojo-attach-event=\"onClick:_select_question\"></button>\r\n\t\t\t</div>\r\n\t\t</span>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\"  data-dojo-props='region:\"center\",splitter:true'>\r\n\t\t\t<div data-dojo-attach-point=\"viewer_grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='query:{ },rowsPerPage:30,style:\"width:100%;height:100%\"' ></div>\r\n\t\t</div>\r\n\t\t\t\t<div data-dojo-attach-point=\"add_new_question_dlg\" data-dojo-type=\"dijit.Dialog\"  data-dojo-props='title:\"Add New Question\",style:\"width:500px;height:460px\"'>\r\n\t\t\t<div data-dojo-type=\"prcommon.clippings.questions.add\" data-dojo-attach-point=\"add_new_question_ctrl\" data-dojo-props='globalonly:true,publish_path:\"/clippings/question/global/add\"'></div>\r\n\t\t</div>\r\n\t\t<div data-dojo-attach-point=\"select_question_dlg\" data-dojo-type=\"dijit.Dialog\"  data-dojo-props='title:\"Select a Question\",style:\"width:500px;height:200px\"'>\r\n\t\t\t<div data-dojo-type=\"prcommon.clippings.questions.selectquestion\" data-dojo-attach-point=\"select_question_ctrl\" data-dojo-props='globalonly:true,publish_path:\"/clippings/question/global/select\"'></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n\r\n",constructor:function(){this._questions=new dojox.data.JsonRestStore({target:"/clippings/analyse/global_analysis",idAttribute:"clippingsanalysistemplateid"});this._update_global_template_back=dojo.hitch(this,this._update_global_template);this._remove_question_call_back=dojo.hitch(this,this._remove_question_call);this._menu_item_std=null;dojo.subscribe("/clippings/question/global/add",dojo.hitch(this,this._add_question_event));dojo.subscribe("/clippings/question/global/select",dojo.hitch(this,this._update_question_event));},postCreate:function(){this.viewer_grid.set("structure",this.view1);this.viewer_grid._setStore(this._questions);this.viewer_grid["onRowClick"]=dojo.hitch(this,this._on_row_click);this.inherited(arguments);},_on_row_click:function(e){var _1=this.viewer_grid.getItem(event.rowIndex);if(_1){this._row=_1;if(this._row.has_been_deleted=="Deleted"){if(this._menu_item_deleted==null){this._menu_item_deleted=new dijit.Menu();this._menu_item_deleted.addChild(new dijit.MenuItem({label:"Restore",onClick:dojo.hitch(this,this._restore_question)}));}this._menu_item_deleted._openMyself(e);}else{if(this._menu_item_std==null){this._menu_item_std=new dijit.Menu();this._menu_item_std.addChild(new dijit.MenuItem({label:"Remove",onClick:dojo.hitch(this,this._remove_question)}));}this._menu_item_std._openMyself(e);}}},resize:function(){this.border_control.resize(arguments[0]);},_new_question:function(){this.add_new_question_ctrl.clear();this.add_new_question_dlg.show();},_select_question:function(){this.select_question_ctrl.clear();this.select_question_dlg.show();},_new_question_event:function(_2,_3,_4){if(this._clientid===_3||this._issueid===_4){this._questions.newItem(_2);}this.add_new_question_dlg.hide();this.select_question_dlg.hide();},view1:{noscroll:false,cells:[[{name:" ",styles:"text-align: center;",width:"15px",formatter:ttl.utilities.format_row_ctrl},{name:"Name",width:"350px",field:"questiontext"},{name:"Type",width:"100px",field:"questiondescription"}]]},_add_question_event:function(_5){this._questions.newItem(_5);dojo.xhrPost(ttl.utilities.makeParams({load:this._update_global_template_back,url:"/clippings/analyse/add_question_to_analysis",content:{questionid:_5.questionid}}));},_update_global_template:function(_6){this.add_new_question_dlg.hide();},_remove_question:function(){if(confirm("Remove "+this._row.questiontext+" from analysis?")){dojo.xhrPost(ttl.utilities.makeParams({load:this._remove_question_call_back,url:"/clippings/analyse/delete_question_to_analysis",content:{clippingsanalysistemplateid:this._row.clippingsanalysistemplateid}}));}},_remove_question_call:function(_7){if(_7.success=="OK"){if(_7.msg){alert(_7.msg);this._questions.deleteItem(this._row);}else{this._questions.deleteItem(this._row);}}else{alert("Problem");}},_update_question_event:function(_8){this._questions.newItem(_8);this.select_question_dlg.hide();}});}