/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.clippings.questions.analysis_viewer"]){dojo._hasResource["prcommon.clippings.questions.analysis_viewer"]=true;dojo.provide("prcommon.clippings.questions.analysis_viewer");dojo.require("ttl.BaseWidget");dojo.require("dijit.Menu");dojo.require("dijit.MenuBar");dojo.require("dijit.MenuBarItem");dojo.require("dijit.PopupMenuBarItem");dojo.require("dijit.form.RadioButton");dojo.require("prcommon.clippings.questions.add");dojo.require("prcommon.clippings.questions.selectquestion");dojo.declare("prcommon.clippings.questions.analysis_viewer",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"border_control\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-point='style:\"width:100%;height:100%\",gutters:false' >\r\n\t\t<span class=\"std_menu_view\">\r\n\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-attach-point=\"controls\" data-dojo-props='region:\"top\",style:\"height:38px;width:100%;padding:0x;margin:0px;overflow:hidden\",\"class\":\"std_menu_view\"'>\r\n\t\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"New Question\",iconClass:\"fa fa-plus fa-3x\"' data-dojo-attach-event=\"onClick:_new_question\"></button>\r\n\t\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Select Question\",iconClass:\"fa fa-list fa-3x\"' data-dojo-attach-event=\"onClick:_select_question\"></button>\r\n\t\t\t</div>\r\n\t\t</span>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\"  data-dojo-props='region:\"center\",splitter:true'>\r\n\t\t\t<div data-dojo-attach-point=\"viewer_grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='query:{ },rowsPerPage:30,style:\"width:100%;height:100%\"' ></div>\r\n\t\t</div>\r\n\t\t<div data-dojo-attach-point=\"add_new_question_dlg\" data-dojo-type=\"dijit.Dialog\"  data-dojo-props='title:\"Add New Question\",style:\"width:500px;height:460px\"'>\r\n\t\t\t<div data-dojo-type=\"prcommon.clippings.questions.add\" data-dojo-attach-point=\"add_new_question_ctrl\" data-dojo-props='publish_path:\"/clippings/question/analysis\"'></div>\r\n\t\t</div>\r\n\t\t<div data-dojo-attach-point=\"select_question_dlg\" data-dojo-type=\"dijit.Dialog\"  data-dojo-props='title:\"Select a Question\",style:\"width:500px;height:200px\"'>\r\n\t\t\t<div data-dojo-type=\"prcommon.clippings.questions.selectquestion\" data-dojo-attach-point=\"select_question_ctrl\" data-dojo-props='publish_path:\"/clippings/question/analysis/select\"'></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n\r\n",constructor:function(){this._questions=new dojox.data.JsonRestStore({target:"/clippings/analyse/list_by_source",idAttribute:"clippingsanalysistemplateid"});this._clientid=null;this._issueid=null;this._menu_item=null;this._is_load=false;dojo.subscribe("/clippings/question/analysis",dojo.hitch(this,this._new_question_event));dojo.subscribe("/clippings/question/analysis/select",dojo.hitch(this,this._selected_question_event));this._remove_question_call_back=dojo.hitch(this,this._remove_question_call);},view1:{noscroll:false,cells:[[{name:" ",styles:"text-align: center;",width:"15px",formatter:ttl.utilities.format_row_ctrl},{name:"Name",width:"250px",field:"questiontext"},{name:"Type",width:"100px",field:"questiondescription"}]]},postCreate:function(){this.viewer_grid.set("structure",this.view1);this.viewer_grid["onRowClick"]=dojo.hitch(this,this._on_row_click);this.viewer_grid.canSort=function(){return false;};this.inherited(arguments);},_on_row_click:function(e){var _1=this.viewer_grid.getItem(event.rowIndex);if(_1){this._row=_1;if(this._menu_item==null){this._menu_item=new dijit.Menu();this._menu_item.addChild(new dijit.MenuItem({label:"Remove",onClick:dojo.hitch(this,this._remove_question)}));}this._menu_item._openMyself(e);}},_remove_question:function(){if(confirm("Remove "+this._row.questiontext+" from analysis?")){dojo.xhrPost(ttl.utilities.makeParams({load:this._remove_question_call_back,url:"/clippings/analyse/remove_question",content:{clippingsanalysistemplateid:this._row.clippingsanalysistemplateid}}));}},_remove_question_call:function(_2){if(_2.success=="OK"){this._questions.deleteItem(this._row);}},resize:function(){this.border_control.resize(arguments[0]);},load:function(_3,_4){if(this._is_load==false){this.viewer_grid._setStore(this._questions);this._is_load=true;}var _5={};if(_3!=null){_5["clientid"]=_3;}if(_4!=null){_5["issueid"]=_4;}this.viewer_grid.setQuery(ttl.utilities.getPreventCache(_5));this._clientid=_3;this._issueid=_4;this.add_new_question_ctrl.load(this._clientid,this._issueid);this.select_question_ctrl.load(this._clientid,this._issueid);},_new_question:function(){this.add_new_question_ctrl.clear();this.add_new_question_dlg.show();},_select_question:function(){this.select_question_dlg.show();},_new_question_event:function(_6,_7,_8){if(this._clientid===_7||this._issueid===_8){this._questions.newItem(_6);}this.add_new_question_dlg.hide();this.select_question_dlg.hide();},_selected_question_event:function(_9){this._questions.newItem(_9);this.select_question_dlg.hide();}});}