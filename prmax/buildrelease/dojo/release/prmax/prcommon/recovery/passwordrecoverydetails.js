/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.recovery.passwordrecoverydetails"]){dojo._hasResource["prcommon.recovery.passwordrecoverydetails"]=true;dojo.provide("prcommon.recovery.passwordrecoverydetails");dojo.require("ttl.BaseWidget");dojo.declare("prcommon.recovery.passwordrecoverydetails",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div style=\"margin:10px\">\r\n\t<form data-dojo-attach-point=\"form\" onsubmit=\"return false\" data-dojo-type=\"dijit.form.Form\" data-dojo-point='style:\"margin:15px\"'>\r\n\t\t<p data-dojo-attach-point='message' data-dojo-props='value:\"\"'></p>\r\n\t\t<table width=\"98%\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\r\n\t\t\t<tr><td>&nbsp</td></tr>\r\n\t\t\t<tr><td align=\"right\" width=\"20%\" class=\"prmaxrowtag\"><label>Email</label></td><td><input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"recovery_email\" data-dojo-props='regExpGen:dojox.validate.regexp.emailAddress,invalidMessage:\"invalid email address\", name:\"recovery_email\",required:true,trim:true,type:\"text\",style:\"width:320px\"'></td></tr>\r\n<!--\r\n\t\t\t<tr><td align=\"right\" width=\"20%\" class=\"prmaxrowtag\"><label>Phone</label></td><td><input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"recovery_phone\" data-dojo-props='name:\"recovery_phone\",trim:true,type:\"text\",style:\"width:300px\"'></input></td></tr>\r\n-->\r\n\t\t\t<tr><td align=\"right\" width=\"20%\" class=\"prmaxrowtag\"><label>Secret Word</label></td><td><input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"recovery_word\" data-dojo-props='name:\"recovery_word\",trim:true,type:\"text\",style:\"width:150px\", required:true'></input></td></tr>\r\n\r\n\t\t\t<tr><td>&nbsp</td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" align=\"left\"><button data-dojo-attach-event=\"onClick:_close\" data-dojo-attach-point=\"closebtn\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Close\",\"class\":\"btnleft\"'></button></td>\r\n\t\t\t\t<td class=\"prmaxrowtag\" align=\"right\"><button data-dojo-attach-event=\"onClick:_save\" data-dojo-attach-point=\"savebtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='style:\"float:right\", type:\"button\",busyLabel:\"Please Wait Saving...\",label:\"Save\",\"class\":\"btnright\"'></button></td></tr>\r\n\t\t</table>\r\n\t</form>\r\n\r\n</div>\r\n",constructor:function(){this._save_call_back=dojo.hitch(this,this._save_call);this._load_call_back=dojo.hitch(this,this._load_call);this._message="";},load:function(_1,_2,_3){if(_2&&_3=="set"){this._message=_3;dojo.removeClass(this.message,"prmaxhidden");dojo.attr(this.message,"innerHTML","Please set your password recovery details by entering:</br>1. An email address different than your username and your user email address</br>2. A secret word of at least 8 characters");dojo.attr(this.savebtn,"label","Save");}else{if(_2&&_3=="update"){this._message=_3;dojo.removeClass(this.message,"prmaxhidden");dojo.attr(this.message,"innerHTML","Please confirm your password recovery details");dojo.attr(this.savebtn,"label","Confirm");}else{dojo.addClass(this.message,"prmaxhidden");dojo.attr(this.savebtn,"label","Save");}}this._dialog=_1;dojo.xhrPost(ttl.utilities.makeParams({load:this._load_call_back,url:"/user/get_password_recovery_details"}));},_load_call:function(_4){if(_4.success=="OK"){if(PRMAX.utils.settings.passwordrecovery&&_4.details){this.recovery_email.set("value",_4.details.recovery_email);this.recovery_word.set("value",_4.details.recovery_word);}}},_save:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");this.savebtn.cancel();if(this._message=="update"){dojo.attr(this.savebtn,"label","Confirm");}return false;}if(this.recovery_word.get("value").length<8){alert("Please enter secret word of minimum 8 characters");this.savebtn.cancel();if(this._message=="update"){dojo.attr(this.savebtn,"label","Confirm");}return;}if(this.recovery_email.get("value").toLowerCase()==PRMAX.utils.settings.username.toLowerCase()||this.recovery_email.get("value").toLowerCase()==PRMAX.utils.settings.uemail.toLowerCase()){alert("Please enter different email address than your username and your user email address");this.savebtn.cancel();if(this._message=="update"){dojo.attr(this.savebtn,"label","Confirm");}return;}var _5=this.form.get("value");dojo.xhrPost(ttl.utilities.makeParams({load:this._save_call_back,url:"/user/set_password_recovery",content:_5}));},_save_call:function(_6){if(_6.success=="OK"){alert("Saved Details for Password Recovery");this.savebtn.cancel();this._dialog.hide();}else{alert("Problem Adding Details for Password Recovery");}this.savebtn.cancel();if(this._message=="update"){dojo.attr(this.savebtn,"label","Confirm");}},_close:function(){this._dialog.hide();},_clear:function(){this.recovery_email.set("value","");this.recovery_word.set("value","");}});}