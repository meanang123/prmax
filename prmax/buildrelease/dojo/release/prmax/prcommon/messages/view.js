/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prcommon.messages.view"]){dojo._hasResource["prcommon.messages.view"]=true;dojo.provide("prcommon.messages.view");dojo.require("ttl.BaseWidget");dojo.require("prcommon.messages.message");dojo.require("prcommon.messages.view_message");function replyFormatter(){if(arguments[1]!=null){if(arguments[1].i.touserid!=null){return "<img height=\"10px\" width=\"10px\" class=\"prmaxdefault\" src=\"/prcommon/images/rowctrl.gif\"></img>";}}else{return "...";}};dojo.declare("ttl.BaseWidget",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div >\r\n\t<div dojoAttachPoint=\"borderControl\" dojotype=\"dijit.layout.BorderContainer\" style=\"width:100%;height:100%\" >\r\n\t\t<div dojoType=\"dijit.MenuBar\" region=\"top\" style=\"height:25px;width:98%\">\r\n\t\t\t<div dojoType=\"dijit.MenuBarItem\"  dojoAttachEvent=\"onClick:_Send_Message\" dojoAttachPoint=\"menu_home_btn\">Send Message</div>\r\n\t\t\t\t<div dojoType=\"dijit.PopupMenuBarItem\">\r\n\t\t\t\t\t<span>View</span>\r\n\t\t\t\t\t<div dojoType=\"dijit.Menu\" >\r\n\t\t\t\t\t\t<div dojoType=\"dijit.CheckedMenuItem\" checked >In Coming</div>\r\n\t\t\t\t\t\t<div dojoType=\"dijit.CheckedMenuItem\" >Sent </div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t<div dojoType=\"dijit.MenuBarItem\"  style=\"float:right\">Help</div>\r\n\t\t</div>\r\n\t\t<div dojoAttachPoint=\"viewer_grid\" dojoType=\"dojox.grid.EnhancedGrid\"  region=\"center\" query=\"{ }\" rowsPerPage=\"30\" ></div>\r\n\t</div>\r\n\t<div dojoAttachPoint=\"sendDialog\" dojotype=\"dijit.Dialog\"  title=\"Send Message\" >\r\n\t\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t\t<div dojoAttachPoint=\"message\" dojotype=\"prcommon.messages.message\"  ></div>\r\n\t\t</div>\r\n\t\t<div class=\"dijitDialogPaneActionBar\">\r\n\t\t\t<button dojoType=\"dijit.form.Button\" type=\"button\" dojoAttachEvent=\"onClick:_Close\">Close</button>\r\n\t\t\t<button dojoType=\"dijit.form.Button\" type=\"button\" dojoAttachEvent=\"onClick:_Send\">Send</button>\r\n\t\t</div>\r\n\t</div>\r\n\t<div dojoAttachPoint=\"replyDialog\" dojotype=\"dijit.Dialog\"  title=\"Reply To Message\" >\r\n\t\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t\t<div dojoAttachPoint=\"view_message\" dojotype=\"prcommon.messages.view_message\" ></div>\r\n\t\t\t<div dojoAttachPoint=\"message\" dojotype=\"prcommon.messages.message\" ></div>\r\n\t\t</div>\r\n\t\t<div class=\"dijitDialogPaneActionBar\">\r\n\t\t\t<button dojoType=\"dijit.form.Button\" type=\"button\" dojoAttachEvent=\"onClick:_Close2\">Close</button>\r\n\t\t\t<button dojoType=\"dijit.form.Button\" type=\"button\" dojoAttachEvent=\"onClick:_Reply\">Send</button>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.filter_db=new prcommon.data.QueryWriteStore({url:"/message/view",nocallback:true,onError:ttl.utilities.globalerrorchecker,nocallback:true});dojo.subscribe(PRCOMMON.Events.Message_Sent,dojo.hitch(this,this._MessageSentEvent));dojo.subscribe(PRCOMMON.Events.Dialog_Close,dojo.hitch(this,this._CloseEvent));this._DeleteCallBack=dojo.hitch(this,this._DeleteCall);},view:{cells:[[{name:"Sent",width:"120px",field:"sent"},{name:"Subject",width:"240px",field:"subject"},{name:"Type",width:"100px",field:"messagetypedescription"},{name:"From",width:"auto",field:"display_name"},{name:" ",width:"20px",field:"touserid",format:replyFormatter},{name:" ",width:"20px",format:ttl.utilities.deleteRowCtrl}]]},postCreate:function(){this.viewer_grid.attr("structure",this.view);this.viewer_grid._setStore(this.filter_db);this.viewer_grid["onRowClick"]=dojo.hitch(this,this._OnSelectRow);this.inherited(arguments);},_Send_Message:function(){this.sendDialog.show();},resize:function(){this.borderControl.resize(arguments);this.inherited(arguments);},_Send:function(){this.message.Send();},_Close:function(){this.message.Clear();this.sendDialog.hide();},_CloseEvent:function(_1){if(_1=="mess_close"){this._Close();}},_MessageSentEvent:function(_2){var t=_2.d;t.messagetypedescription=_2.l.messagetypedescription;t.sent=t.created.slice(0,t.created.lastIndexOf(":"));t.display_name=_2.u.display_name;this.filter_db.newItem(t);},_DeleteCall:function(_3){if(_3.success=="OK"){this.viewer_grid.deleteItem(this._selectedRow);alert("Message Delete");}else{alert("Problem Deleting Message");}},_OnSelectRow:function(e){var _4=this.viewer_grid.getItem(e.rowIndex);if(e.cellIndex==4){}else{if(e.cellIndex==5){this._selectedRow=_4;if(confirm("Delete Message?")){dojo.xhrPost(ttl.utilities.makeParams({load:this._DeleteCallBack,url:"/message/delete_message",content:{messageid:_4.i.messageid}}));}}}this.viewer_grid.selection.clickSelectEvent(e);},_Close2:function(){},_Reply:function(){}});}