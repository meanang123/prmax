/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["ttl.data.QueryWriteStore"]){dojo._hasResource["ttl.data.QueryWriteStore"]=true;dojo.provide("ttl.data.QueryWriteStore");dojo.require("dojox.data.QueryReadStore");dojo.declare("ttl.data.QueryWriteStore",dojox.data.QueryReadStore,{tableid:"",constructor:function(_1){_1["clearOnClose"]=true;_1["urlPreventCache"]=true;dojo.mixin(this,_1);this._features["dojo.data.api.Write"]=true;this._features["dojo.data.api.Notification"]=true;this._nocallback=(_1.nocallback==null)?false:_1["nocallback"];if(_1.oncallback!=undefined){this.onCallBack=_1.oncallback;}else{this.onCallBack=null;}},_getIdentifierAttribute:function(){var _2=this.getFeatures()["dojo.data.api.Identity"];return _2;},SetNoCallBackMode:function(_3){this._nocallback=_3;},newItem:function(_4,_5){var _6=_4[this._identifier];var _7={i:_4,r:this,n:this._items.length};this._items.push(_7);var _8=_7.i[this._identifier];this._itemsByIdentity[_8]=_7.i;var _9=null;this.onNew(_7,_9);return _7;},deleteItem:function(_a){var _b=this._identifier;var _c=_a.i[_b];delete this._itemsByIdentity[_c];for(var c=0;c<this._items.length;c++){if(this._items[c]==null){continue;}if(this._items[c].i[_b]==_a.i[_b]){delete this._items[c];break;}}this.onDelete(_a);return true;},invertValue:function(_d){for(var c=0;c<this._items.length;c++){var _e=this._items[c];var _f=_e.i[_d];_e.i[_d]=!_f;this.onSet(_e,_d,!_f,!_f);}},clearValue:function(_10,_11){for(var c=0;c<this._items.length;c++){var _12=this._items[c];var _13=_12.i[_10];_12.i[_10]=_11;this.onSet(_12,_10,_11,_11);}},setValue:function(_14,_15,_16,_17){if(_14.i[_15]!=_16){var _18=_14.i[_15];_14.i[_15]=_16;if(this._nocallback==false){var _19={attribute:_15,value:_16,key:_14.i[this._identifier],tableid:this.tableid};if(this.oncallbackparams!=null){_19=dojo.mixin(_19,this.oncallbackparams());}dojo.xhrPost(ttl.utilities.makeParams({url:"/maintenance/updatefield",load:this.onCallBack,error:null,content:_19}));}}if(_17==true){this.onSet(_14,_15,_16,_16);}return true;},unsetAttribute:function(_1a,_1b){return true;},save:function(_1c){return true;},revert:function(){return true;},isDirty:function(_1d){return true;},onDelete:function(_1e){},onNew:function(_1f,_20){},fetchItemByIdentity:function(_21){if(this._itemsByIdentity){var _22=this._itemsByIdentity[_21.identity];if(!(_22===undefined)){if(_21.onItem){var _23=_21.scope?_21.scope:dojo.global;_21.onItem.call(_23,{i:_22,r:this});}return;}else{var _24=this._identifier;for(var c=0;c<this._items.length;c++){if(this._items[c]==null){continue;}if(this._items[c].i[_24]==_21.identity){if(_21.onItem){var _23=_21.scope?_21.scope:dojo.global;_21.onItem.call(_23,{i:this._items[c].i,r:this});}break;}}}}var _25=function(_26,_27){var _28=_21.scope?_21.scope:dojo.global;if(_21.onError){_21.onError.call(_28,_26);}};var _29=function(_2a,_2b){var _2c=_21.scope?_21.scope:dojo.global;try{var _2d=null;if(_2a&&_2a.length==1){_2d=_2a[0];}if(_21.onItem){_21.onItem.call(_2c,_2d,true);}}catch(error){if(_21.onError){_21.onError.call(_2c,error);}}};var _2e={serverQuery:{id:_21.identity}};this._fetchItems(_2e,_29,_25);},hasRows:function(){var _2f=false;for(var key in this._itemsByIdentity){_2f=true;break;}return _2f;}});}