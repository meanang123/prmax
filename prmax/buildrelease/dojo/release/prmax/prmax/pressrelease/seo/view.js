/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.pressrelease.seo.view"]){dojo._hasResource["prmax.pressrelease.seo.view"]=true;dojo.provide("prmax.pressrelease.seo.view");dojo.require("prmax.pressrelease.seo.add");dojo.require("prmax.pressrelease.seo.edit");dojo.declare("prmax.pressrelease.seo.view",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"borderControl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='gutters:false,\"class\":\"seoview\"'>\r\n\t\t<div data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props=\"region:'left',splitter:true,'class':'bordered',style:'height:100%;width:40%',gutters:false\">\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-attach-point=\"controls\" data-dojo-props='region:\"top\",style:\"height:42px;width:100%;overflow:hidden\", \"class\":\"std_menu_view\"'>\r\n\t\t\t\t<div style=\"height:100%;width:100px;float:left;padding-top:10px;\" class=\"prmaxrowdisplaylarge\">SEO</div>\r\n\t\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='style:\"height:99%;width:200px;padding:0px;margin:0px;float:left\"'>\r\n\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Add\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"fa fa-plus fa-3x\",label:\"New SEO\",showLabel:false'></div>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\"  data-dojo-props='iconClass:\"fa fa-filter fa-3x\",label:\"Filter SEO List\",showLabel:false'>\r\n\t\t\t\t\t\t<span></span>\r\n\t\t\t\t\t\t<div data-dojo-type=\"dijit.TooltipDialog\" data-dojo-props='title:\"Filter By\"' data-dojo-attach-event=\"execute:_ExecuteFilter\">\r\n\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t<tr><td>Status</td><td><select data-dojo-props='name:\"seostatusid\",autoComplete:true,searchAttr:\"name\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"filter_seostatusid\" ></select></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td>Headline</td><td><input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"filter_headline\" data-dojo-props='name:\"headline\",type:\"text\"' ></td></tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td align=\"left\"><button data-dojo-attach-event=\"onClick: _ClearFilter\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\"' >Clear</button></td>\r\n\t\t\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"submit\",name:\"submit\"'>Submit</button></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"center\"'>\r\n\t\t\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='style:\"height:100%;width:100%\",rowsPerPage:50,splitter:true'></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-attach-point=\"seopanel\" data-dojo-type=\"dijit.layout.StackContainer\" data-dojo-props='region:\"center\",splitter:true'>\r\n\t\t\t<div data-dojo-attach-point=\"seopanel_blank\" data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='selected:\"selected\",title:\"blank\"' ></div>\r\n\t\t\t<div data-dojo-type=\"prmax.pressrelease.seo.add\" data-dojo-attach-point=\"seo_add_ctrl\" data-dojo-props='style:\"width:100%;height:100%\",title:\"add\"'></div>\r\n\t\t\t<div data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-attach-point=\"seopanel_edit\" data-dojo-props='style:\"height:100%;width:100%\",gutters:false,title:\"Edit\"'>\r\n\t\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"top\",style:\"width:100%;height:42px\",\"class\":\"std_menu_view\"'>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='style:\"height:99%;width:100%;padding:0px;margin:0px\"'>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Delete\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"fa fa-trash fa-3x\",label:\"Delete SEO\",showLabel:false'></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Withdraw\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"fa fa-outdent fa-3x\",label:\"Withdraw SEO\",showLabel:false' data-dojo-attach-point=\"withdrawbtn\"></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Update\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"fa fa-floppy-o fa-3x\",label:\"Update SEO\",showLabel:false'></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Publish\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='\"class\":\"prmaxhidden\",iconClass:\"fa fa-upload fa-3x\",label:\"Publish SEO\",showLabel:false' data-dojo-attach-point=\"publishbtn\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"center\"'>\r\n\t\t\t\t\t<div data-dojo-type=\"prmax.pressrelease.seo.edit\" data-dojo-attach-point=\"seo_edit_ctrl\" data-dojo-props='style:\"width:100%;height:100%\"'></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",isinternal:false,constructor:function(){this.seo_model=new prcommon.data.QueryWriteStore({url:"/emails/seorelease/list",onError:ttl.utilities.globalerrorchecker,nocallback:true});this._DeleteCallBack=dojo.hitch(this,this._DeleteCall);this._WithdrawCallBack=dojo.hitch(this,this._WithdrawCall);this._PublishCallBack=dojo.hitch(this,this._PublishCall);this._CallBack=dojo.hitch(this,this._Call_Back);this._seostatus_data=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=seostatus&nofilter="});},postCreate:function(){this.grid.set("structure",this.view);this.grid._setStore(this.seo_model);this.grid["onCellClick"]=dojo.hitch(this,this._OnCellClick2);this.filter_seostatusid.set("store",this._seostatus_data);this.filter_seostatusid.set("value",-1);this.seo_add_ctrl.Load(dojo.hitch(this,this._seo_added));this.inherited(arguments);},_seo_added:function(_1){this.seo_model.newItem(_1);this.seopanel.selectChild(this.seopanel_blank);},view:{cells:[[{name:"Seo Name",width:"auto",field:"headline"},{name:"Client",width:"120px",field:"clientname"},{name:"Status",width:"70px",field:"seostatusdescription"},{name:"Published",width:"80px",field:"published_display"},{name:"Views",width:"30px",field:"viewed"}]]},resize:function(){this.borderControl.resize(arguments[0]);},_Add:function(){this.seo_add_ctrl.Clear();this.seopanel.selectChild(this.seo_add_ctrl);},_ExecuteFilter:function(){var _2={};if(arguments[0].headline.length>0){_2["headline"]=arguments[0].headline;}if(arguments[0].seostatusid!="-1"){_2["seostatusid"]=arguments[0].seostatusid;}this.grid.setQuery(ttl.utilities.getPreventCache(_2));},_ClearFilter:function(){this.filter_headline.set("value","");this.filter_seostatusid.set("value",-1);this.grid.setQuery(ttl.utilities.getPreventCache({}));},_DeleteCall:function(_3){if(_3.success=="OK"){this.seopanel.selectChild(this.seopanel_blank);this.seo_model.deleteItem(this._row2);}else{alert("Problem deleting SEO "+PRMAX.utils.settings.distribution_description);}},_Delete:function(){if(confirm("Delete the Seo "+PRMAX.utils.settings.distribution_description)){}dojo.xhrPost(ttl.utilities.makeParams({load:this._DeleteCallBack,url:"/emails/seorelease/delete",content:{seoreleaseid:this._row2.i.seoreleaseid}}));},_WithdrawCall:function(_4){if(_4.success=="OK"){this.seopanel.selectChild(this.seopanel_blank);this.seo_model.setValue(this._row2,"seostatusdescription","Customer Withdrawn",true);this.seo_model.setValue(this._row2,"seostatusid",3,true);dojo.removeClass(this.publishbtn.domNode,"prmaxhidden");dojo.addClass(this.withdrawbtn.domNode,"prmaxhidden");alert("SEO Withdrawn");}},_Withdraw:function(){if(confirm("Withdraw SEO")){dojo.xhrPost(ttl.utilities.makeParams({load:this._WithdrawCallBack,url:"/emails/seorelease/withdraw",content:{seoreleaseid:this._row2.i.seoreleaseid}}));}},_Update:function(){this.seo_edit_ctrl.Save();},_Call_Back:function(_5){this.seo_model.setValue(this._row2,"headline",_5.headline,true);},_OnCellClick2:function(e){this.grid.selection.clickSelectEvent(e);this._row2=this.grid.getItem(e.rowIndex);this.EnableControl();this.seo_edit_ctrl.LoadSeo(this._row2.i.seoreleaseid,this._CallBack);this.seopanel.selectChild(this.seopanel_edit);},EnableControl:function(){if(this._row2.i.seostatusid==3||(this._row2.i.seostatusid==4&&this.isinternal)){dojo.removeClass(this.publishbtn.domNode,"prmaxhidden");dojo.addClass(this.withdrawbtn.domNode,"prmaxhidden");}else{if(this._row2.i.seostatusid==2){dojo.removeClass(this.withdrawbtn.domNode,"prmaxhidden");dojo.addClass(this.publishbtn.domNode,"prmaxhidden");}else{dojo.addClass(this.withdrawbtn.domNode,"prmaxhidden");dojo.removeClass(this.publishbtn.domNode,"prmaxhidden");}}},_PublishCall:function(_6){if(_6.success=="OK"){dojo.addClass(this.publishbtn.domNode,"prmaxhidden");dojo.removeClass(this.withdrawbtn.domNode,"prmaxhidden");this.seo_model.setValue(this._row2,"seostatusdescription","Live",true);this.seo_model.setValue(this._row2,"seostatusid",2,true);this.seo_model.setValue(this._row2,"published_display",_6.data.published_display,true);this.EnableControl();alert("Published");}},_Publish:function(){if(this.seo_edit_ctrl.isValid()==false){return;}if(confirm("Publish SEO")){dojo.xhrPost(ttl.utilities.makeParams({load:this._PublishCallBack,url:"/emails/seorelease/republish",content:this.seo_edit_ctrl.seoform({})}));}},refresh:function(){this._ClearFilter();}});}