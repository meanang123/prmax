/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.pressrelease.seo.seoimage"]){dojo._hasResource["prmax.pressrelease.seo.seoimage"]=true;dojo.provide("prmax.pressrelease.seo.seoimage");dojo.require("dojo.io.iframe");dojo.declare("prmax.pressrelease.seo.seoimage",[ttl.BaseWidget],{name:"seoimageid",widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"borderControl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='style:\"width:100%;height:100%\",gutters:false'>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"left\",style:\"width:150px;height:110px;border:1px solid black\"' >\r\n\t\t\t<img data-dojo-attach-point=\"seoimagepreview\" height=\"100px\" ></img>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"center\"' >\r\n\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Load\"' data-dojo-attach-event=\"onClick:_ShowLoad\" data-dojo-attach-point=\"loadbtn\"></button>\r\n\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Clear\",\"class\":\"prmaxhidden\"' data-dojo-attach-event=\"onClick:_Clear\" data-dojo-attach-point=\"clearbtn\"></button><br/>\r\n\t\t\t<span class=\"prmaxrowtagcomment\">If you would like to include an image in your release click Load</span>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-attach-point=\"load_image_dialog\" data-dojo-props='title:\"Upload Image\",style:\"width:500px;height:200px\"'>\r\n\t\t<form  data-dojo-attach-point=\"upload_form\" method=\"post\" name=\"upload_form\" enctype=\"multipart/form-data\"  onSubmit=\"return false;\">\r\n\t\t<input class=\"prmaxinput\" type=\"hidden\" data-dojo-attach-point=\"seoimageid\" name=\"seeimageid\" value=\"-1\">\r\n\t\t<input class=\"prmaxinput\" type=\"hidden\" data-dojo-attach-point=\"seoimage_cache\" name=\"seoimage_cache\" value=\"-1\">\r\n\t\t<br/>\r\n\t\t<table width=\"99%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" border = \"0\">\r\n\t\t\t<tr><td width=\"10%\" align=\"right\" class=\"prmaxrowtag\">Image</td><td width=\"90%\" ><input class=\"prmaxinput\" type=\"file\" name=\"seoimage_file\" data-dojo-attach-point=\"seoimage_file\"></td></tr>\r\n\t\t\t<tr><td  >&nbsp;</td></tr>\r\n\t\t\t<tr><td colspan=\"2\"><p class=\"prmaxrowtag\">The following file types can be uploaded .jpg, .gif, .png.  Upload may take a few minutes.</p></td></tr>\r\n\t\t\t<tr><td colspan=\"2\" align=\"right\"><button data-dojo-attach-point=\"saveNode\" data-dojo-props='\"class\":\"prmaxbutton\",type:\"button\",label:\"Upload Image\"' data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_UpLoad\"></button></td></tr>\r\n\t\t\t<tr><td colspan=\"2\">\r\n\t\t\t\t<div data-dojo-attach-point=\"progressNode\" style=\"display:none;\">\r\n\t\t\t\t\t<p style=\"text-align:center\" class=\"prmaxrowtag\">Uploading started. Please wait as this may take several minutes</p>\r\n\t\t\t\t</div>\r\n\t\t\t</td></tr>\r\n\t\t</table>\r\n\t</form>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._AddedCallback=dojo.hitch(this,this._AddedCall);this._ErrorCallBack=dojo.hitch(this,this._ErrorCall);dojo.subscribe("/seo/thumbnail",dojo.hitch(this,this._image_reloaded_call));},_image_reloaded_call:function(){dojo.attr(this.seoimagepreview,"src","/emails/seorelease/load_seo_thumbnail");dojo.attr(this.seoimageid,"value","-2");},postCreate:function(){this.inherited(arguments);},resize:function(){this.borderControl.resize(arguments[0]);},_UpLoad:function(){if(this.seoimage_file.value.length==0){this.seoimage_file.focus();return;}var _1=this.seoimage_file.value;var _2=_1.substring(_1.lastIndexOf(".")+1).toLowerCase();if(_2!="jpg"&&_2!="gif"&&_2!="png"){alert("Upload png, jpg, gif files only");this.seoimage_file.focus();return;}this.saveNode.set("disabled",true);this.seoimage_cache.value=new Date().valueOf();dojo.io.iframe.send({url:"/emails/seorelease/thumbnail_image_load",handleAs:"json",load:this._AddedCallback,form:this.upload_form,error:this._ErrorCallBack});},_ErrorCall:function(_3,_4){alert("Problem Uploading Image");this._Clear();},_AddedCall:function(_5){if(_5.success=="OK"){this._Clear();this.load_image_dialog.hide();dojo.attr(this.seoimagepreview,"src","/emails/seorelease/load_seo_thumbnail");dojo.attr(this.seoimageid,"value","-2");this.enableControls(true);}else{if(_5.success=="FA"){alert(_5.message);this._Clear();}else{alert("Problem Uploading Image Document");this._Clear();}}},_ShowLoad:function(){this.load_image_dialog.show();},_Clear:function(){dojo.attr(this.seoimagepreview,"src","");dojo.attr(this.seoimageid,"value","-1");this.enableControls(false);this.saveNode.set("disabled",false);},isValid:function(){return true;},_setValueAttr:function(_6){dojo.attr(this.seoimageid,"value",_6);this.enableControls((_6=="-1"||_6==-1)?false:true);if(parseInt(_6)>0){dojo.attr(this.seoimagepreview,"src","/emails/seorelease/thumbnail_image?seoimageid="+_6);}else{dojo.attr(this.seoimagepreview,"src","");}},_getValueAttr:function(){return dojo.attr(this.seoimageid,"value");},enableControls:function(_7){if(_7){dojo.removeClass(this.clearbtn.domNode,"prmaxhidden");}else{dojo.addClass(this.clearbtn.domNode,"prmaxhidden");}}});}