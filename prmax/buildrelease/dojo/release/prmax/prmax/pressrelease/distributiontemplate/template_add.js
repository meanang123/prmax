/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.pressrelease.distributiontemplate.template_add"]){dojo._hasResource["prmax.pressrelease.distributiontemplate.template_add"]=true;dojo.provide("prmax.pressrelease.distributiontemplate.template_add");dojo.require("prmax.email.loadworddocument");dojo.require("dijit.Editor");dojo.require("dijit._editor.plugins.AlwaysShowToolbar");dojo.require("dijit._editor.plugins.ViewSource");dojo.require("dijit._editor.plugins.FontChoice");dojo.require("dojox.editor.plugins.Preview");dojo.require("prmax.email.TtlImgLinkDialog");dojo.declare("prmax.pressrelease.distributiontemplate.template_add",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<form data-dojo-attach-point=\"main_form\" data-dojo-props='onsubmit:\"return false\",\"class\":\"common_prmax_layout\"' data-dojo-type=\"dijit.form.Form\">\r\n\t\t<input data-dojo-props='name:\"distributiontemplatetypeid\",type:\"hidden\"' data-dojo-attach-point=\"distributiontemplatetypeid\"  data-dojo-type=\"dijit.form.TextBox\" />\r\n\t\t<br/>\r\n\t\t<label class=\"label_1\">Description</label><input data-dojo-props='\"class\":\"prmaxrequired\",name:\"description\",type:\"text\",maxlength:80,trim:true,required:true,style:\"width:26em\"' data-dojo-attach-point=\"description\" data-dojo-type=\"dijit.form.ValidationTextBox\"/><br/><br/>\r\n\t\t<div data-dojo-attach-point=\"wordtohtml\" data-dojo-type=\"prmax.email.loadworddocument\" data-dojo-props='style:\"border:1px solid black;padding-bottom:5px\",sourcename:\"template_add\"' ></div><br/>\r\n\t\t<div data-dojo-type=\"dijit.Editor\" data-dojo-attach-point=\"emailtemplatecontent\" data-dojo-props='name:\"templatecontent\",style:\"width:590px;height:300px;border:1px solid black;padding-left:1px\",extraPlugins:[{name:\"dijit._editor.plugins.FontChoice\",command:\"fontName\", generic:false},\"fontSize\",\"createLink\",\"viewsource\",\"preview\",\"ttlinsertimage\",\"insertCollateral\"]'></div>\r\n\t\t<br/>\r\n\t\t<button data-dojo-attach-event=\"onClick:_add_template\" data-dojo-attach-point=\"savebtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Saving ...\",label:\"Add\",\"class\":\"btnright\"'></button>\r\n\t</form>\r\n</div>\r\n\r\n\r\n",s_distributiontemplatetypeid:1,constructor:function(){this._save_call_back=dojo.hitch(this,this._save_call);this._show=null;dojo.subscribe(PRCOMMON.Events.Word_Html_Data,dojo.hitch(this,this._word_html_data_event));},postCreate:function(){this.inherited(arguments);this.distributiontemplatetypeid.set("value",this.s_distributiontemplatetypeid);},load:function(_1,_2){this._show=_1;this.distributiontemplatetypeid.set("value",_2);},clear:function(){this.description.set("value","");this.emailtemplatecontent.set("value","");this.wordtohtml.Clear();this.savebtn.cancel();},_add_template:function(){if(ttl.utilities.formValidator(this.main_form)==false){alert("Not all required field filled in");this.savebtn.cancel();return;}var _3=this.main_form.get("value");_3["templatecontent"]=this.emailtemplatecontent.get("value");dojo.xhrPost(ttl.utilities.makeParams({load:this._save_call_back,url:"/emails/distributiontemplates/add",content:_3}));},_save_call:function(_4){if(_4.success=="OK"){this._show("hide",_4.data);this.clear();}else{if(_4.success=="DU"){alert("Already Exists");this.description.focus();}else{alert("Problem");}}this.savebtn.cancel();},resize:function(){var b=dojo.contentBox(this.emailtemplatecontent.domNode);b.h=300;this.emailtemplatecontent.resize(b);},_word_html_data_event:function(_5){if(_5.sourcename=="template_add"){this.emailtemplatecontent.set("value",_5.html);}}});}