/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.pressrelease.distributiontemplate.template_update"]){dojo._hasResource["prmax.pressrelease.distributiontemplate.template_update"]=true;dojo.provide("prmax.pressrelease.distributiontemplate.template_update");dojo.declare("prmax.pressrelease.distributiontemplate.template_update",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<form data-dojo-attach-point=\"main_form\" data-dojo-props='onsubmit:\"return false\",\"class\":\"common_prmax_layout\"' data-dojo-type=\"dijit.form.Form\">\r\n\t\t<input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"distributiontemplateid\" data-dojo-props='name:\"distributiontemplateid\",type:\"hidden\"' >\r\n\r\n\t\t<br/>\r\n\t\t<label class=\"label_1\">Description</label><input data-dojo-props='\"class\":\"prmaxrequired\",name:\"description\",type:\"text\",maxlength:80,trim:true,required:true,style:\"width:26em\"' data-dojo-attach-point=\"description\" data-dojo-type=\"dijit.form.ValidationTextBox\"/><br/><br/>\r\n\t\t<div data-dojo-attach-point=\"wordtohtml\" data-dojo-type=\"prmax.email.loadworddocument\" data-dojo-props='style:\"border:1px solid black;padding-bottom:5px\",sourcename:\"template_update\"' ></div><br/>\r\n\t\t<div data-dojo-type=\"dijit.Editor\" data-dojo-attach-point=\"emailtemplatecontent\" data-dojo-props='name:\"templatecontent\",style:\"width:100%;height:300px;border:1px solid black;padding-left:1px\",extraPlugins:[{name:\"dijit._editor.plugins.FontChoice\",command:\"fontName\", generic:false},\"fontSize\",\"createLink\",\"viewsource\",\"preview\",\"ttlinsertimage\",\"insertCollateral\"]'></div>\r\n\t\t<br/>\r\n\t\t<button data-dojo-attach-event=\"onClick:_delete_template\" data-dojo-attach-point=\"deletebtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Deleting ...\",label:\"Delete\",\"class\":\"btnleft\"'></button>\r\n\t\t<button data-dojo-attach-event=\"onClick:_update_template\" data-dojo-attach-point=\"savebtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Saving ...\",label:\"Add\",\"class\":\"btnright\"'></button>\r\n\t</form>\r\n</div>\r\n\r\n\r\n",constructor:function(){this._load_call_back=dojo.hitch(this,this._load_call);this._update_call_back=dojo.hitch(this,this._update_call);this._delete_call_back=dojo.hitch(this,this._delete_call);dojo.subscribe(PRCOMMON.Events.Word_Html_Data,dojo.hitch(this,this._word_html_data_event));},postCreate:function(){this.inherited(arguments);},load:function(_1,_2){this._show=_2;this.distributiontemplateid.set("value",_1);dojo.xhrPost(ttl.utilities.makeParams({load:this._load_call_back,url:"/emails/distributiontemplates/load",content:{distributiontemplateid:_1}}));},_load_call:function(_3){if(_3.success=="OK"){with(_3){this.description.set("value",data.description);this.emailtemplatecontent.set("value",data.templatecontent);this.distributiontemplateid.set("value",data.distributiontemplateid);}this._show("show");}else{alert("Problem");}},clear:function(){this.description.set("value","");this.emailtemplatecontent.set("value","");this.wordtohtml.Clear();this.savebtn.cancel();this.deletebtn.cancel();this.distributiontemplateid.set("value","-1");},_update_template:function(){if(ttl.utilities.formValidator(this.main_form)==false){alert("Not all required field filled in");this.savebtn.cancel();return;}var _4=this.main_form.get("value");_4["templatecontent"]=this.emailtemplatecontent.get("value");dojo.xhrPost(ttl.utilities.makeParams({load:this._update_call_back,url:"/emails/distributiontemplates/update",content:_4}));},_update_call:function(_5){if(_5.success=="OK"){alert("Updated");}else{}this.savebtn.cancel();},_delete_template:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._delete_call_back,url:"/emails/distributiontemplates/delete",content:{distributiontemplateid:this.distributiontemplateid.get("value")}}));},_delete_call:function(_6){if(_6.success=="OK"){this._show("delete");this.clear();}else{}},resize:function(){var b=dojo.contentBox(this.emailtemplatecontent.domNode);b.h=300;this.emailtemplatecontent.resize(b);},_word_html_data_event:function(_7){if(_7.sourcename=="template_update"){this.emailtemplatecontent.set("value",_7.html);}}});}