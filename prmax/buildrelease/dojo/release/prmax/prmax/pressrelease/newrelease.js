/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.pressrelease.newrelease"]){dojo._hasResource["prmax.pressrelease.newrelease"]=true;dojo.provide("prmax.pressrelease.newrelease");dojo.declare("prmax.pressrelease.newrelease",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Enter Distribution Name\"' data-dojo-attach-point=\"dlg\">\r\n\t\t<div style=\"width:350px;padding:2px\">\r\n\t\t\t<form data-dojo-attach-point=\"form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='\"class\":\"prmaxdefault\",onsubmit:\"return false\"'>\r\n\t\t\t\t<input data-dojo-props='type:\"hidden\",name:\"emailtemplatecontent\",value:\"\"' data-dojo-type=\"dijit.form.TextBox\"/>\r\n\t\t\t\t<table class=\"prmaxtable\" cellpadding=\"0\" cellspacing =\"0\" border=\"0\" width=\"100%\">\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td class=\"prmaxlabeltag\" data-dojo-attach-point=\"distr_label\">Distribution Name</label></td><td><input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"emailtemplatename\" data-dojo-props='\"class\":\"prmaxinput\",name:\"emailtemplatename\",required:true,trim:true,maxLength:45,promptMessage:\"Enter Distribution name\",type:\"text\"' ></td>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxlabeltag\" data-dojo-attach-point=\"client_label_1\" >Client</td><td><select data-dojo-props='\"class\":\"prmaxinputselect\",name:\"clientid\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\",required:false' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clientid\" data-dojo-attach-event=\"onChange:_client_change\" ></select></td></tr>\r\n\t\t\t\t\t\t<tr class=\"prmaxhidden\" data-dojo-attach-point=\"issue_view\" ><td class=\"prmaxlabeltag\" data-dojo-attach-point=\"issue_label_1\">Issue</td><td><select data-dojo-props='\"class\":\"prmaxinputselect\",name:\"issueid\",autoComplete:true,searchAttr:\"name\",labelType:\"html\",required:false' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"issueid\" ></select></td></tr>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td align=\"left\"><button data-dojo-props='\"class\":\"prmaxbutton\",type:\"button\",label:\"Cancel\"' data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_Cancel\"></button></td>\r\n\t\t\t\t\t\t<td align=\"right\"><button data-dojo-attach-event=\"onClick:_Save\" data-dojo-attach-point=\"saveNode\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='\"class\":\"prmaxbutton\",busyLabel:\"Please Wait Creating...\",label:\"Create\"'></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._SavedCall=dojo.hitch(this,this._Saved);this._clients=new dojox.data.JsonRestStore({target:"/clients/rest_combo",idAttribute:"id"});this._issues=new dojox.data.JsonRestStore({target:"/crm/issues/issues_list_rest",idAttribute:"id"});this._change_client_enabled=true;dojo.subscribe("/update/distribution_label",dojo.hitch(this,this._UpdateDistributionLabelEvent));},postCreate:function(){this.clientid.set("store",this._clients);this.clientid.set("value","-1");this.issueid.set("store",this._issues);this.issueid.set("value","-1");this.inherited(arguments);dojo.attr(this.issue_label_1,"innerHTML",PRMAX.utils.settings.issue_description);dojo.attr(this.client_label_1,"innerHTML",PRMAX.utils.settings.client_name);dojo.attr(this.distr_label,"innerHTML",PRMAX.utils.settings.distribution_description);dojo.attr(this.dlg,"title","Enter "+PRMAX.utils.settings.distribution_description+" Name");if(PRMAX.utils.settings.crm){dojo.removeClass(this.issue_view,"prmaxhidden");}},_UpdateDistributionLabelEvent:function(){dojo.attr(this.distr_label,"innerHTML",PRMAX.utils.settings.distribution_description);dojo.attr(this.dlg,"title","Enter "+PRMAX.utils.settings.distribution_description+" Name");},_Cancel:function(){this.hide();},_Save:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Not all required field filled in");this.saveNode.cancel();return;}dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedCall,url:"/emails/templates_add",content:this.form.get("value")}));},_Saved:function(_1){if(_1.success=="OK"){dojo.publish(PRCOMMON.Events.PressReleaseStart,[_1.data]);this.hide();this._Clear();}else{if(_1.success=="DU"){alert("Press Release Name Already Exists");this.emailtemplatename.focus();}else{if(_1.success=="VF"){alert("Press Release: "+_1.error_message[0][1]);this.emailtemplatename.focus();}else{alert("Problem with Press Release");this.emailtemplatename.focus();}}}this.saveNode.cancel();},_Clear:function(){this.emailtemplatename.set("value",null);this._change_client_enabled=false;this.clientid.set("value","-1");this.issueid.set("value","-1");this._change_client_enabled=false;this.saveNode.cancel();},show:function(){this._Clear();this.dlg.show();},hide:function(){this.dlg.hide();this._Clear();},_client_change:function(){if(PRMAX.utils.settings.crm){var _2=this.clientid.get("value");if(_2==undefined){_2=-1;}this.issueid.set("query",{clientid:_2});if(this._change_client_enabled==true){this.issueid.set("value",null);}this._change_client_enabled=true;}}});}