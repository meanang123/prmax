/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.pressrelease.rename"]){dojo._hasResource["prmax.pressrelease.rename"]=true;dojo.provide("prmax.pressrelease.rename");dojo.declare("prmax.pressrelease.rename",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<form data-dojo-attach-point=\"rename_form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='\"class\":\"common_prmax_layout\",onsubmit:\"return false\"'>\r\n\t\t<br/>\r\n\t\t<input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"emailtemplateid\"  data-dojo-props='name:\"emailtemplateid\",type:\"hidden\"' >\r\n\t\t<label data-dojo-attach-point=\"distribution_label\" class=\"label_1\">Distribution</label><input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"emailtemplatename\" data-dojo-props='name:\"emailtemplatename\",required:true,trim:true,maxLength:45,promptMessage:\"Enter Distribution name\",type:\"text\"' ><br/>\r\n\t\t<label data-dojo-attach-point=\"client_label\" class=\"label_1\">Client</label><select data-dojo-props='name:\"clientid\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\",required:false' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clientid\" ></select><br/>\r\n\t\t<div class=\"prmaxhidden\" style=\"padding:0px;margin:0px\" data-dojo-attach-point=\"issue_view\" ><label class=\"label_1\" data-dojo-attach-point=\"issue_label\">Issue</label><select data-dojo-props='name:\"issueid\",autoComplete:true,searchAttr:\"name\",labelType:\"html\",required:false' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"issueid\" ></select></div>\r\n\t\t<br/>\r\n\t\t<button data-dojo-attach-event=\"onClick:_cancel\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Cancel\",style:\"float:left\"'></button>\r\n\t\t<button data-dojo-attach-event=\"onClick:_rename\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-attach-point=\"rename_btn\" data-dojo-props='style:\"float:right\",type:\"button\",label:\"Rename Distribution\"'></button><br/>\r\n\t</form>\r\n</div>\r\n",constructor:function(){this._rename_call_back=dojo.hitch(this,this._rename_call);this._load_call_back=dojo.hitch(this,this._load_call);this._clients=new dojox.data.JsonRestStore({target:"/clients/rest_combo",idAttribute:"id"});this._issues=new dojox.data.JsonRestStore({target:"/crm/issues/issues_list_rest",idAttribute:"id"});this._change_client_enabled=true;dojo.subscribe("/update/distribution_label",dojo.hitch(this,this._UpdateDistributionLabelEvent));},postCreate:function(){dojo.attr(this.client_label,"innerHTML",PRMAX.utils.settings.client_name);dojo.attr(this.issue_label,"innerHTML",PRMAX.utils.settings.issue_description);dojo.attr(this.distribution_label,"innerHTML",PRMAX.utils.settings.distribution_description);dojo.attr(this.rename_btn,"label",PRMAX.utils.settings.distribution_description);this.clientid.set("store",this._clients);this.clientid.set("value",-1);this.issueid.set("store",this._issues);this.issueid.set("value","-1");if(PRMAX.utils.settings.crm){dojo.removeClass(this.issue_view,"prmaxhidden");}this.inherited(arguments);},_UpdateDistributionLabelEvent:function(){dojo.attr(this.distribution_label,"innerHTML",PRMAX.utils.settings.distribution_description);dojo.attr(this.rename_btn,"label",PRMAX.utils.settings.distribution_description);},_cancelRename:function(){this._dialog.hide();this._clear();},_rename_call:function(_1){if(_1.success=="OK"){dojo.publish("/pr/rename",[_1.data]);alert("Distribution Renamed");this._dialog.hide();this._clear();}else{if(_1.success=="DU"){alert("Distribution allready Exists");}else{alert("Problem Renaming Distrbution");}}this.rename_btn.cancel();},_rename:function(){if(ttl.utilities.formValidator(this.rename_form)==false){alert("Not all required field filled in");this.rename_btn.cancel();return;}dojo.xhrPost(ttl.utilities.makeParams({load:this._rename_call_back,url:"/emails/template_rename",content:this.rename_form.get("value")}));},_clear:function(){this.emailtemplateid.set("value",-1);this.emailtemplatename.set("value","");this.clientid.set("value",-1);this.rename_btn.cancel();},load:function(_2,_3){this._dialog=_3;this.rename_btn.cancel();dojo.attr(this.rename_btn,"label","Rename "+PRMAX.utils.settings.distribution_description);dojo.xhrPost(ttl.utilities.makeParams({load:this._load_call_back,url:"/emails/templates_get_min",content:{emailtemplateid:_2}}));},_load_call:function(_4){if(_4.success=="OK"){this.emailtemplateid.set("value",_4.data.emailtemplateid);this.emailtemplatename.set("value",_4.data.emailtemplatename);this.clientid.set("value",_4.data.clientid);this.issueid.set("value",_4.data.issueid);this._dialog.show();}},_cancel:function(){this._dialog.hide();this._clear();},_client_change:function(){if(PRMAX.utils.settings.crm){var _5=this.clientid.get("value");if(_5==undefined){_5=-1;}this.issueid.set("query",{clientid:_5});if(this._change_client_enabled==true){this.issueid.set("value",null);}this._change_client_enabled=true;}}});}