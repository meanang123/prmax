/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.pressrelease.selectrelease"]){dojo._hasResource["prmax.pressrelease.selectrelease"]=true;dojo.provide("prmax.pressrelease.selectrelease");dojo.declare("prmax.pressrelease.selectrelease",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Select Press Release\"' data-dojo-attach-point=\"dlg\">\r\n\t\t<div style=\"width:330px;padding:20px\">\r\n\t\t\t<form data-dojo-attach-point=\"form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='\"class\":\"prmaxdefault\",onsubmit:\"return false\"'>\r\n\t\t\t\t<table class=\"prmaxtable\" cellpadding=\"0\" cellspacing =\"0\">\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td class=\"prmaxlabeltag\" data-dojo-attach-point=\"distr_label\">Release</label></td>\r\n\t\t\t\t\t\t<td colspan=\"2\"><select data-dojo-props='\"class\":\"prmaxinputselect\",autoComplete:true,searchAttr:\"emailtemplatename\",labelType:\"html\",required:true,style:\"width:250px\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"template\"></select></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr><td colspan=\"3\">&nbsp;</td></tr>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td width=\"33%\" align=\"left\"><button class=\"prmaxbutton\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_Cancel\" data-dojo-props='type:\"button\",label:\"Cancel\"'></button></td>\r\n\t\t\t\t\t\t<td width=\"33%\" align=\"left\"><button class=\"prmaxbutton\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_new_release\" data-dojo-props='type:\"button\",label:\"New Distribution\"' data-dojo-attach-point=\"distrbtn\"></button></td>\r\n\t\t\t\t\t\t<td width=\"33%\" align=\"right\"><button class=\"prmaxbutton\" data-dojo-attach-event=\"onClick:_Open\" data-dojo-attach-point=\"saveNode\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='busyLabel:\"Please Wait Opening\",label:\"Open\"'></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.model=new dojox.data.QueryReadStore({url:"/emails/templates_list",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true});dojo.subscribe("/update/distribution_label",dojo.hitch(this,this._UpdateDistributionLabelEvent));},postCreate:function(){this.template.store=this.model;dojo.attr(this.distrbtn,"label","New "+PRMAX.utils.settings.distribution_description);dojo.attr(this.distr_label,"innerHTML",PRMAX.utils.settings.distribution_description);dojo.attr(this.dlg,"title","Select "+PRMAX.utils.settings.distribution_description);this.inherited(arguments);},_UpdateDistributionLabelEvent:function(){dojo.attr(this.distrbtn,"label","New "+PRMAX.utils.settings.distribution_description);dojo.attr(this.distr_label,"innerHTML",PRMAX.utils.settings.distribution_description);dojo.attr(this.dlg,"title","Select "+PRMAX.utils.settings.distribution_description);},_Cancel:function(){this.hide();},_Open:function(){this._add();},_add:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Not all required field filled in");this.saveNode.cancel();return;}dojo.publish(PRCOMMON.Events.PressReleaseStart,[{emailtemplateid:this.template.get("value")}]);this.hide();this._Clear();},_Clear:function(){this.template.set("value",null);this.saveNode.cancel();},show:function(){this._Clear();this.dlg.show();},hide:function(){this.dlg.hide();this._Clear();},_new_release:function(){this.dlg.hide();dijit.byId("std_banner_control").ShowNewPressRelease();}});}