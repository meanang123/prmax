/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.sales.DemoRequestView"]){dojo._hasResource["prmax.iadmin.sales.DemoRequestView"]=true;dojo.provide("prmax.iadmin.sales.DemoRequestView");dojo.require("prmax.iadmin.sales.DemoAddCustomer");dojo.require("ttl.BaseWidget");dojo.declare("prmax.iadmin.sales.DemoRequestView",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div dojotype=\"dijit.layout.BorderContainer\" gutters=\"false\" style=\"width:100%;height:100%\" dojoAttachPoint=\"borderControl\" >\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"top\" style=\"width:100%\">\r\n\t\t\t<div style=\"height:40px;width:100%;overflow:hidden;margin:0px;padding:0px\" class=\"searchresults\">\r\n\t\t\t\t<div style=\"height:100%;width:15%;float:left;margin:0px;padding:0px\" dojoAttachPoint=\"demorequests_time\" class=\"dijitToolbar prmaxrowdisplaylarge\">Time</div>\r\n\t\t\t\t\t<div class=\"dijitToolbarTop\" dojoType=\"dijit.Toolbar\" style=\"float:left;height:100%;width:85%;margin:0px;padding:0px\" >\r\n\t\t\t\t\t\t<div dojoType=\"dijit.form.Button\" iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" dojoAttachEvent=\"onClick:_RefreshDemoRequest\" showLabel=\"true\">Refresh</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t<div  dojoType=\"dijit.layout.ContentPane\" region=\"left\" style=\"width:70%\" >\r\n\t\t\t<div dojoAttachPoint=\"demorequestview\" dojoType=\"dojox.grid.DataGrid\" query=\"{ name:'*'}\" rowsPerPage=\"50\" structure=\"PRMAX.iadmin.gridlayout.demorequest\" splitter=\"true\"></div>\r\n\t\t</div>\r\n\t\t<div  dojoType=\"dijit.layout.ContentPane\" region=\"center\" splitter=\"true\">\r\n\t\t\t<div dojoAttachPoint=\"demo_options_view\" class=\"prmaxhidden\">\r\n\t\t\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"demo_to_customer_email\" label=\"Add Customer & Send Email\" dojoAttachEvent=\"onClick:_DemoToCustomerEmail\"></button><br/>\r\n\t\t\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"demo_to_customer\" label=\"Add Customer\" dojoAttachEvent=\"onClick:_DemoToCustomer\"></button><br/>\r\n\t\t\t\t<button dojoType=\"dojox.form.BusyButton\" dojoAttachPoint=\"demo_delete\" label=\"Delete Request\" busyLabel=\"Deleting Request\" dojoAttachEvent=\"onClick:_DemoDelete\"></button><br/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div dojotype=\"dijit.Dialog\" title=\"Add Customer\" dojoAttachPoint=\"senddlg\">\r\n\t\t<div dojotype=\"prmax.iadmin.sales.DemoAddCustomer\" dojoAttachPoint=\"sendctrl\"></div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._DemoToCustomerResponseCall=dojo.hitch(this,this._DemoToCustomerResponse);this._DemoDeleteResponseCall=dojo.hitch(this,this._DemoDeleteResponse);this.demo_request_data=new prcommon.data.QueryWriteStore({url:"/iadmin/demorequests",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,nocallback:true,urlPreventCache:true});},postCreate:function(){this.inherited(arguments);this.demorequestview.set("structure",this._view);this.demorequestview._setStore(this.demo_request_data);this.demorequestview["onRowClick"]=dojo.hitch(this,this._OnSelectDemoRequest);this.demorequestview["onStyleRow"]=dojo.hitch(this,this._OnStyleRow);},_OnStyleRow:function(_1){ttl.GridHelpers.onStyleRow(_1);},_SetTime:function(_2){dojo.attr(_2,"innerHTML",new Date().toString());},resize:function(){this.borderControl.resize(arguments[0]);this.inherited(arguments);},_RefreshDemoRequest:function(){this.demorequestview.setQuery(ttl.utilities.getPreventCache());this._SetTime(this.demorequests_time);},_OnSelectDemoRequest:function(e){this._demorow=this.demorequestview.getItem(e.rowIndex);dojo.removeClass(this.demo_options_view,"prmaxhidden");this.demorequestview.selection.clickSelectEvent(e);},_view:{noscroll:false,cells:[[{name:"Source",width:"auto",field:"customertypename"},{name:"Customer Name",width:"auto",field:"customername"},{name:"Contact Name",width:"auto",field:"contactname"},{name:"Email",width:"auto",field:"email"},{name:"Address1",width:"auto",field:"address1"},{name:"Town",width:"auto",field:"townname"},{name:"PostCode",width:"auto",field:"postcode"},{name:"Telephone",width:"auto",field:"telephone"}]]},_DeleteDemoRow:function(){this.demo_request_data.deleteItem(this._demorow);this.demorequestview.selection.clear();dojo.addClass(this.demo_options_view,"prmaxhidden");},_DemoToCustomerResponse:function(_3){if(_3.success=="OK"){alert("Customer Added");this._DeleteDemoRow();}else{if(_3.success=="DU"){alert("Customer Allready exists");}else{alert("Problem converting demo to customer");}}this.demo_to_customer_email.cancel();this.demo_to_customer.cancel();},_DemoToCustomerEmail:function(){this.sendctrl.Load(this._demorow.i,true,this);},_DemoToCustomer:function(){this.sendctrl.Load(this._demorow.i,false,this);},_DemoDeleteResponse:function(_4){if(_4.success=="OK"){alert("Demo Request Deleted");this._DeleteDemoRow();}this.demo_delete.cancel();},_DemoDelete:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._DemoDeleteResponseCall,url:"/iadmin/delete_demo",content:{demorequestid:this._demorow.i.demorequestid}}));}});}