/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.sales.prospects.gather.add"]){dojo._hasResource["prmax.iadmin.sales.prospects.gather.add"]=true;dojo.provide("prmax.iadmin.sales.prospects.gather.add");dojo.require("ttl.BaseWidget");dojo.require("dojox.validate.regexp");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dijit.form.Button");dojo.require("dojox.form.BusyButton");dojo.require("prmax.iadmin.sales.prospects.companies.add");dojo.require("dijit.Dialog");dojo.require("dojox.validate");dojo.require("dijit.form.ValidationTextBox");dojo.require("prmax.iadmin.sales.prospects.sources.add");dojo.require("prmax.iadmin.sales.prospects.types.add");dojo.require("prmax.iadmin.sales.prospects.regions.add");dojo.declare("prmax.iadmin.sales.prospects.gather.add",[ttl.BaseWidget],{url:"/iadmin/prospects/prospect/add_prospect",mode:"add",templateString:dojo.cache("prmax","iadmin/sales/prospects/gather/templates/add.html","<div>\r\n\t<form data-dojo-attach-point=\"form\" data-dojo-props='onsubmit:\"return false\"' data-dojo-type=\"dijit.form.Form\">\r\n\t\t<input data-dojo-props='type:\"hidden\",name:\"prospectid\"' data-dojo-attach-point=\"prospectid\" data-dojo-type=\"dijit.form.TextBox\" >\r\n\t\t<table width=\"500px\" cellpadding=\"0\" cellpadding=\"0\" >\r\n\t\t\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Email</td><td><input data-dojo-attach-point=\"email\" data-dojo-props='required:true,\"class\":\"prmaxinput\",name:\"email\",type:\"text\",style:\"width:20em\",trim:\"true\",regExpGen:dojox.validate.regexp.emailAddress,invalidMessage:\"invalid email address\"' data-dojo-type=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Family Name</td><td><input data-dojo-props='type:\"text\",name:\"familyname\"' data-dojo-attach-point=\"familyname\" data-dojo-type=\"dijit.form.TextBox\" ></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >First Name</td><td><input data-dojo-props='type:\"text\",name:\"firstname\"' data-dojo-attach-point=\"firstname\" data-dojo-type=\"dijit.form.TextBox\" ></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Title</td><td><input data-dojo-props='type:\"text\",name:\"title\"' data-dojo-attach-point=\"title\" data-dojo-type=\"dijit.form.TextBox\" ></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Company</td><td>\r\n\t\t\t\t<select data-dojo-props='searchAttr:\"prospectcompanyname\",required:false,\"class\":\"prmaxinput\",name:\"prospectcompanyid\",style:\"width:19em\",autoComplete:true' data-dojo-attach-point=\"prospectcompanyid\" data-dojo-type=\"dijit.form.FilteringSelect\" ></select>\r\n\t\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\"' data-dojo-attach-event=\"onClick:_add_company\">New </button>\r\n\t\t\t</td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Source</td><td><select data-dojo-props='searchAttr:\"prospectsourcename\",required:false,\"class\":\"prmaxinput\",name:\"prospectsourceid\",style:\"width:19em\",autoComplete:true' data-dojo-attach-point=\"prospectsourceid\" data-dojo-type=\"dijit.form.FilteringSelect\" ></select>\r\n\t\t\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\"' data-dojo-attach-event=\"onClick:_add_source\">New </button>\r\n\t\t\t</td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Type</td><td>\r\n\t\t\t\t\t<select data-dojo-props='searchAttr:\"prospecttypename\",required:false,\"class\":\"prmaxinput\",name:\"prospecttypeid\",style:\"width:19em\",autoComplete:true' data-dojo-attach-point=\"prospecttypeid\" data-dojo-type=\"dijit.form.FilteringSelect\" ></select>\r\n\t\t\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\"' data-dojo-attach-event=\"onClick:_add_type\">New </button>\r\n\t\t\t</td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Region</td><td>\r\n\t\t\t\t\t<select data-dojo-props='searchAttr:\"prospectregionname\",required:false,\"class\":\"prmaxinput\",name:\"prospectregionid\",style:\"width:19em\",autoComplete:true' data-dojo-attach-point=\"prospectregionid\" data-dojo-type=\"dijit.form.FilteringSelect\" ></select>\r\n\t\t\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\"' data-dojo-attach-event=\"onClick:_add_region\">New </button>\r\n\t\t\t</td></tr>\r\n\r\n\t\t\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Www:</td><td><input data-dojo-attach-point=\"web\" data-dojo-props='name:\"web\",type:\"text\",maxlength:120,regExpGen:dojox.validate.regexp.url' data-dojo-type=\"dijit.form.ValidationTextBox\"/></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Tel:</td><td><input data-dojo-attach-point=\"telephone\" data-dojo-props='name:\"telephone\",type:\"text\",maxlength:40,trim:true' data-dojo-type=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"prmaxrowlabel\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"closebtn\" data-dojo-props='type:\"button\"' data-dojo-attach-event=\"onClick:_close\">Close</button></td>\r\n\t\t\t\t<td class=\"prmaxrowlabel\" align=\"right\"><button data-dojo-type=\"dojox.form.BusyButton\" data-dojo-attach-point=\"addbtn\" data-dojo-props='busyLabel:\"Saving ...\",type:\"button\"' data-dojo-attach-event=\"onClick:_update\">Save</button></td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</form>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Add New Company\"' data-dojo-attach-point=\"adddialog\">\r\n\t\t<div data-dojo-attach-point=\"addctrl\" data-dojo-type=\"prmax.iadmin.sales.prospects.companies.add\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Add New Prospect Source\"' data-dojo-attach-point=\"addsourcedialog\">\r\n\t\t<div data-dojo-attach-point=\"addsourcectrl\" data-dojo-type=\"prmax.iadmin.sales.prospects.sources.add\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Add New Prospect Type\"' data-dojo-attach-point=\"addtypedialog\">\r\n\t\t<div data-dojo-attach-point=\"addtypectrl\" data-dojo-type=\"prmax.iadmin.sales.prospects.types.add\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Add New Prospect Region\"' data-dojo-attach-point=\"addregiondialog\">\r\n\t\t<div data-dojo-attach-point=\"addregionctrl\" data-dojo-type=\"prmax.iadmin.sales.prospects.regions.add\" ></div>\r\n\t</div>\r\n</div>\r\n"),constructor:function(){this._dialog=null;this._store=new dojox.data.JsonRestStore({target:"/iadmin/prospects/companies/list",idAttribute:"prospectcompanyid"});this._prospectsources=new dojox.data.JsonRestStore({target:"/iadmin/prospects/sources/list",idAttribute:"prospectsourceid"});this._prospecttypes=new dojox.data.JsonRestStore({target:"/iadmin/prospects/types/list",idAttribute:"prospecttypeid"});this._prospectregions=new dojox.data.JsonRestStore({target:"/iadmin/prospects/regions/list",idAttribute:"prospectregionid"});dojo.subscribe("/prospect/comp/add",dojo.hitch(this,this._add_event));dojo.subscribe("/prospect/sources/add",dojo.hitch(this,this._add_sources_event));dojo.subscribe("/prospect/types/add",dojo.hitch(this,this._add_types_event));dojo.subscribe("/prospect/regions/add",dojo.hitch(this,this._add_region_event));this._update_call_back=dojo.hitch(this,this._update_call);this._domain_call_back=dojo.hitch(this,this._domain_call);},postCreate:function(){this.inherited(arguments);this.prospectcompanyid.set("store",this._store);this.prospectsourceid.set("store",this._prospectsources);this.prospecttypeid.set("store",this._prospecttypes);this.prospectregionid.set("store",this._prospectregions);this.prospectsourceid.set("value",1);this.prospecttypeid.set("value",5);this.prospectregionid.set("value",null);if(this.mode=="edit"){dojo.addClass(this.closebtn.domNode,"prmaxhidden");}},_close:function(){if(this._dialog){this._dialog.hide();}},_update:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");this.addbtn.cancel();return false;}dojo.xhrPost(ttl.utilities.makeParams({load:this._domain_call_back,url:"/iadmin/prospects/prospect/check_prospect_domain",content:this.form.get("value")}));},_domain_call:function(_1){var _2=false;if(_1.success=="OK"){_2=true;}else{if(_1.success=="DU"){alert("Email Address already exists");}else{if(_1.success=="SA"){if(confirm("Domain is already in the database Continue?")){_2=true;}}else{if(_1.message!=null){alert(_1.message);}else{alert("Problem adding Entry");}}}}if(_2==true){dojo.xhrPost(ttl.utilities.makeParams({load:this._update_call_back,url:this.url,content:this.form.get("value")}));}else{this.addbtn.cancel();}},_update_call:function(_3){if(_3.success=="OK"){if(this.mode=="add"){dojo.publish("/prospect/prospect/add",[_3.data]);alert("Prospect Added");this._close();this.clear();}else{dojo.publish("/prospect/prospect/updated",[_3.data]);alert("Prospect Updated");}}else{if(_3.success=="DU"){alert("Email Address already exists");}else{if(_3.message!=null){alert(_3.message);}else{alert("Problem adding Entry");}}}this.addbtn.cancel();},_setDialogAttr:function(_4){this._dialog=_4;},load:function(_5){this.prospectid.set("value",_5.prospectid);this.email.set("value",_5.email);this.familyname.set("value",_5.familyname);this.firstname.set("value",_5.firstname);this.title.set("value",_5.title);this.prospectcompanyid.set("value",_5.prospectcompanyid);this.prospectsourceid.set("value",_5.prospectsourceid);this.prospecttypeid.set("value",_5.prospecttypeid);this.web.set("value",_5.web);this.telephone.set("value",_5.telephone);this.prospectregionid.set("value",_5.prospectregionid);},clear:function(){this.email.set("value","");this.familyname.set("value","");this.firstname.set("value","");this.title.set("value","");this.prospectcompanyid.set("value",null);this.addbtn.cancel();this.prospectsourceid.set("value",1);this.prospecttypeid.set("value",5);this.web.set("value","");this.telephone.set("value","");this.prospectregionid.set("value","");},_add_company:function(){this.addctrl.clear();this.addctrl.load(this.adddialog);this.adddialog.show();},_add_source:function(){this.addsourcectrl.clear();this.addsourcectrl.load(this.addsourcedialog);this.addsourcedialog.show();},_add_type:function(){this.addtypectrl.clear();this.addtypectrl.load(this.addtypedialog);this.addtypedialog.show();},_add_region:function(){this.addregionctrl.clear();this.addregionctrl.load(this.addregiondialog);this.addregiondialog.show();},_add_event:function(_6){this.prospectcompanyid.set("value",_6.prospectcompanyid);},_add_sources_event:function(_7){this.prospectsourceid.set("value",_7.prospectsourceid);},_add_types_event:function(_8){this.prospecttypeid.set("value",_8.prospecttypeid);},_add_region_event:function(_9){this.prospectregionid.set("value",_9.prospectregionid);}});}