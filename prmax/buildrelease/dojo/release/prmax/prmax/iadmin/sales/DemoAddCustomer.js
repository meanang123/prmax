/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.sales.DemoAddCustomer"]){dojo._hasResource["prmax.iadmin.sales.DemoAddCustomer"]=true;dojo.provide("prmax.iadmin.sales.DemoAddCustomer");dojo.require("ttl.utilities");dojo.declare("prmax.iadmin.sales.DemoAddCustomer",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<form class=\"prmaxdefault\" dojoAttachPoint=\"form\" onsubmit=\"return false\" dojoType=\"dijit.form.Form\">\r\n\t\t<input name=\"demorequestid\" dojoAttachPoint=\"demorequestid\" type=\"hidden\" dojoType=\"dijit.form.TextBox\" ></input>\r\n\t\t<table class=\"prmaxtable\" width=\"500px\"  border=\"0\">\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Type</td><td><select class=\"prmaxinput\" name=\"customertypeid\" dojoAttachPoint=\"customertypeid\" style=\"width:9em\" dojoType=\"dijit.form.FilteringSelect\" autoComplete=\"true\"></select></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" >Title</td><td><input class=\"prmaxinput\" name=\"contact_title\" dojoAttachPoint=\"contact_title\" type=\"text\" trim=\"true\" dojoType=\"dijit.form.TextBox\" style=\"width: 4em;\" ></input></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" >First Name</td><td><input class=\"prmaxrequired\" name=\"contact_firstname\" dojoAttachPoint=\"contact_firstname\" type=\"text\" trim=\"true\" required=\"true\" dojoType=\"dijit.form.TextBox\" style=\"width: 8em;\" ></input><td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" >Surname</td><td><input class=\"prmaxrequired\" name=\"contact_surname\" dojoAttachPoint=\"contact_surname\" type=\"text\" trim=\"true\" required=\"true\" dojoType=\"dijit.form.TextBox\" style=\"width: 12em;\"></input></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Job Title</td><td ><input class=\"prmaxinput\" dojoAttachPoint=\"job_title\" name=\"job_title\" type=\"text\" trim=\"true\" maxlength=\"80\"  dojoType=\"dijit.form.TextBox\" ></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Business Name</td><td ><input class=\"prmaxrequired\" dojoAttachPoint=\"customername\" name=\"customername\" type=\"text\" trim=\"true\" required=\"true\" maxlength=\"80\" invalidMessage=\"Please Enter the name of the business\" dojoType=\"dijit.form.ValidationTextBox\" ></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Email:</td><td><input class=\"prmaxrequired\" dojoAttachPoint=\"email\" name=\"email\" type=\"text\" size=\"40\" maxlength=\"80\" trim=\"true\" required=\"true\" dojoType=\"dijit.form.ValidationTextBox\" lowercase=\"true\" regExpGen=\"dojox.validate.regexp.emailAddress\" trim=\"true\" invalidMessage=\"invalid email address\" size=\"40\" maxlength=\"70\"/></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Address:</td><td><input class=\"prmaxinput\" dojoAttachPoint=\"address1\" name=\"address1\" type=\"text\" size=\"40\" invalidMessage=\"Please Enter first line of address\" dojoType=\"dijit.form.ValidationTextBox\"/></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Address 2:</td><td><input class=\"prmaxinput\" dojoAttachPoint=\"address2\" name=\"address2\" type=\"text\" size=\"40\" maxlength=\"80\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Town</td><td><input class=\"prmaxinput\" dojoAttachPoint=\"townname\" name=\"townname\" type=\"text\" size=\"30\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >County</td><td><input class=\"prmaxinput\" dojoAttachPoint=\"county\" name=\"county\" type=\"text\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Postcode:</td><td><input class=\"prmaxinput\" dojoAttachPoint=\"postcode\" name=\"postcode\" type=\"text\" style=\"width:10em\" maxlength=\"10\" invalidMessage=\"Please Enter a post code \" dojoType=\"dijit.form.ValidationTextBox\"/></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Country</td><td><select class=\"prmaxinput\" name=\"countryid\" dojoAttachPoint=\"countryid\" style=\"width:15em\" dojoType=\"dijit.form.FilteringSelect\" autoComplete=\"true\"></select></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Tel:</td><td><input class=\"prmaxrequired\" dojoAttachPoint=\"telephone\" name=\"telephone\" type=\"text\" size=\"25\" maxlength=\"40\" required =\"true\" invalidMessage=\"Please enter a contact telephone number\" dojoType=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" >Modules</td><td>&nbsp;</td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Features</td><td><input dojoAttachPoint=\"advancefeatures\" name=\"advancefeatures\" type=\"checkBox\" dojoType=\"dijit.form.CheckBox\" value=\"true\" ></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Engagement</td><td><input dojoAttachPoint=\"crm\" name=\"crm\" type=\"checkBox\" dojoType=\"dijit.form.CheckBox\" value=\"true\" ></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" colspan =\"2\">&nbsp;</td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Assign To</td><td><select class=\"prmaxrequired\" required=\"true\" dojoAttachPoint=\"assigntoid\" name=\"assigntoid\" autoComplete=\"true\" style=\"width:15em\" dojoType=\"dijit.form.FilteringSelect\" labelType=\"html\"></select></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" colspan =\"2\">&nbsp;</td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" colspan=\"2\" align=\"center\"><button dojoAttachPoint=\"saveNode\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Creating...\" dojoAttachEvent=\"onClick:_CustomerSave\" label=\"Create Demo Account\" class=\"prmaxbutton\"></button></td></tr>\r\n\t\t</table>\r\n\t</form>\r\n</div>\r\n\r\n\r\n",constructor:function(){this._SavedCallBack=dojo.hitch(this,this._Saved);this._LoadedCallBack=dojo.hitch(this,this._LoadedCall);this._countries=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=countries"});this._users=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=users&group=sales"});},postCreate:function(){this.countryid.store=this._countries;this.assigntoid.store=this._users;this.customertypeid.store=PRCOMMON.utils.stores.Customer_Types();this.inherited(arguments);},_Saved:function(_1){if(_1.success=="OK"){alert("Demo Created\nCustomer Id : "+_1.customerid+" User Id : "+_1.userid);this._Clear();this._ctrl._DeleteDemoRow();this._ctrl.senddlg.hide();}if(_1.success=="DU"){alert(_1.message);}this.saveNode.cancel();},_CustomerSave:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Not all required fields filled in");this.saveNode.cancel();return;}var _2=this.form.get("value");if(this._sendemail){_2["sendemail"]=true;}dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedCallBack,url:"/iadmin/demo_to_customer",content:_2}));},_LoadedCall:function(_3){if(_3.success=="OK"){this.customertypeid.set("value",_3.data.customertypeid);this.demorequestid.set("value",_3.data.demorequestid);this.contact_title.set("value",_3.data.contact_title);this.contact_firstname.set("value",_3.data.contact_firstname);this.contact_surname.set("value",_3.data.contact_surname);this.job_title.set("value",_3.data.job_title);this.customername.set("value",_3.data.customername);this.email.set("value",_3.data.email);this.address1.set("value",_3.data.address1);this.address2.set("value",_3.data.address2);this.townname.set("value",_3.data.townname);this.county.set("value",_3.data.county);this.postcode.set("value",_3.data.postcode);this.countryid.set("value",_3.data.countryid);this.telephone.set("value",_3.data.telephone);this.advancefeatures.set("value",true);this.crm.set("value",false);this._ctrl.senddlg.set("title",(this._sendemail==true)?"Add Customer & Send Email":"Add Customer");this._ctrl.senddlg.show();}else{alert("Problem Loading Demo Details");}},Load:function(_4,_5,_6){this._ctrl=_6;this._sendemail=_5;dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadedCallBack,url:"/iadmin/demo_get_customer",content:{demorequestid:_4.demorequestid}}));},_Clear:function(){}});}