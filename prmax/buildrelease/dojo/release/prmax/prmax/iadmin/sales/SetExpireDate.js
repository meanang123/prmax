/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.sales.SetExpireDate"]){dojo._hasResource["prmax.iadmin.sales.SetExpireDate"]=true;dojo.provide("prmax.iadmin.sales.SetExpireDate");dojo.require("dijit.Dialog");dojo.require("ttl.utilities");dojo.declare("prmax.iadmin.sales.SetExpireDate",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div dojoAttachPoint=\"dlg\" dojoType=\"dijit.Dialog\" title=\"Set Expire Date\">\r\n\t\t<form dojoAttachPoint=\"form\"  onsubmit=\"return false\" dojoType=\"dijit.form.Form\">\r\n\t\t\t<input type=\"hidden\" dojoAttachPoint=\"icustomerid\" name=\"icustomerid\" dojoType=\"dijit.form.TextBox\">\r\n\t\t\t<input type=\"hidden\" dojoAttachPoint=\"taskid\" name=\"taskid\" dojoType=\"dijit.form.TextBox\">\r\n\t\t\t<table style=\"width:400px;border-collapse:collapse;\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t<tr><td width=\"15%\"></td><td class=\"prmaxrowtag\" >Start Date</td><td class=\"prmaxrowtag\" >Expire Date</td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" width=\"25%\">Media</td>\r\n\t\t\t\t<td><input type=\"text\" required=\"true\" dojoAttachPoint=\"licence_start_date\" name = \"licence_start_date\" dojoType=\"dijit.form.DateTextBox\" style=\"width:8em\" ></td>\r\n\t\t\t\t<td><input type=\"text\" required=\"true\" dojoAttachPoint=\"licence_expire\" name = \"licence_expire\" dojoType=\"dijit.form.DateTextBox\" style=\"width:8em\" ></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr dojoAttachPoint=\"view1\"><td align=\"right\" class=\"prmaxrowtag\">Features</td>\r\n\t\t\t\t<td><input type=\"text\" dojoAttachPoint=\"advance_licence_start\" name = \"advance_licence_start\" dojoType=\"dijit.form.DateTextBox\" style=\"width:8em\"></td>\r\n\t\t\t\t<td><input type=\"text\" dojoAttachPoint=\"advance_licence_expired\" name = \"advance_licence_expired\" dojoType=\"dijit.form.DateTextBox\" style=\"width:8em\"></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr dojoAttachPoint=\"view2\"><td align=\"right\" class=\"prmaxrowtag\">Monitoring</td>\r\n\t\t\t\t<td><input type=\"text\" dojoAttachPoint=\"updatum_start_date\" name=\"updatum_start_date\" dojoType=\"dijit.form.DateTextBox\" style=\"width:8em\"></td>\r\n\t\t\t\t<td><input type=\"text\" dojoAttachPoint=\"updatum_end_date\" name=\"updatum_end_date\" dojoType=\"dijit.form.DateTextBox\" style=\"width:8em\"></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr><td align=\"right\" valign=\"top\" class=\"prmaxrowtag\">Reason</td><td colspan=\"2\"><div class=\"stdframe prmaxrequired\" style=\"height:150px;\" ><textarea class=\"prmaxrequired\" dojoAttachPoint=\"reason\" name=\"reason\" trim=\"true\" required=\"true\" dojoType=\"dijit.form.Textarea\" style=\"width:99%;height:80%\" ></textarea></div></td></tr>\r\n\t\t\t<tr><td colspan=\"3\"><br/></td></tr>\r\n\t\t\t<tr><td><button type=\"button\" dojoAttachEvent=\"onClick:_Close\" dojoType=\"dijit.form.Button\" label=\"Close\" ></button></td><td colspan=\"2\" align=\"right\"><button type=\"button\" dojoAttachEvent=\"onClick:_Update\" dojoType=\"dijit.form.Button\" label=\"Set Expire Date\" ></button></td></tr>\r\n\t\t\t</table>\r\n\t\t</form>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._SetExpireDateCall=dojo.hitch(this,this._SetExpireDate);this._LoadedCallBack=dojo.hitch(this,this._LoadedCall);},Load:function(_1,_2){this.icustomerid.set("value",_1);this.taskid.set("value",_2);dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadedCallBack,url:"/iadmin/get_internal",content:{icustomerid:_1}}));},_LoadedCall:function(_3){if(_3.success=="OK"){this._advancefeatures=_3.data.cust.advancefeatures;this.licence_expire.set("value",new Date(_3.data.cust.licence_expire.year,_3.data.cust.licence_expire.month-1,_3.data.cust.licence_expire.day));if(_3.data.cust.licence_start_date_d){this.licence_start_date.set("value",new Date(_3.data.cust.licence_start_date_d.year,_3.data.cust.licence_start_date_d.month-1,_3.data.cust.licence_start_date_d.day));}else{this.licence_start_date.set("value",null);}if(this._advancefeatures){dojo.removeClass(this.view1,"prmaxhidden");if(_3.data.cust.advance_licence_expired_d){this.advance_licence_expired.set("value",new Date(_3.data.cust.advance_licence_expired_d.year,_3.data.cust.advance_licence_expired_d.month-1,_3.data.cust.advance_licence_expired_d.day));}else{this.advance_licence_expired.set("value",null);}if(_3.data.cust.advance_licence_start_d){this.advance_licence_start.set("value",new Date(_3.data.cust.advance_licence_start_d.year,_3.data.cust.advance_licence_start_d.month-1,_3.data.cust.advance_licence_start_d.day));}else{this.advance_licence_start.set("value",null);}}else{dojo.addClass(this.view1,"prmaxhidden");}if(_3.data.cust.updatum){dojo.removeClass(this.view2,"prmaxhidden");if(_3.data.cust.updatum_end_date_d){this.updatum_end_date.set("value",new Date(_3.data.cust.updatum_end_date_d.year,_3.data.cust.updatum_end_date_d.month-1,_3.data.cust.updatum_end_date_d.day));}else{this.updatum_end_date.set("value",null);}if(_3.data.cust.updatum_start_date_d){this.updatum_start_date.set("value",new Date(_3.data.cust.updatum_start_date_d.year,_3.data.cust.updatum_start_date_d.month-1,_3.data.cust.updatum_start_date_d.day));}else{this.updatum_start_date.set("value",null);}}else{dojo.addClass(this.view2,"prmaxhidden");}this.reason.set("value","");this.dlg.show();}else{alert("Problem Loading Expire Details");}},_SetExpireDate:function(_4){if(_4.success=="OK"){alert("expire date re-set");dojo.publish(PRCOMMON.Events.Expire_Date_Changed,[_4.data.cust]);this.dlg.hide();}else{alert("Problem resetting expire date");}},_Update:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Invalid Expire Date");return false;}if(this.reason.get("value")==""){alert("No Reason Given");this.reason.focus();return false;}var _5=this.form.get("value");_5["licence_expire"]=ttl.utilities.toJsonDate(this.licence_expire.get("value"));_5["licence_start_date"]=ttl.utilities.toJsonDate(this.licence_start_date.get("value"));_5["advance_licence_start"]=ttl.utilities.toJsonDate(this.advance_licence_start.get("value"));_5["advance_licence_expired"]=ttl.utilities.toJsonDate(this.advance_licence_expired.get("value"));_5["updatum_start_date"]=ttl.utilities.toJsonDate(this.updatum_start_date.get("value"));_5["updatum_end_date"]=ttl.utilities.toJsonDate(this.updatum_end_date.get("value"));dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._SetExpireDateCall),url:"/iadmin/set_expire_date",content:_5}));},_Close:function(){this.dlg.hide();}});}