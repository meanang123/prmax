/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.sales.prospects.gather.view"]){dojo._hasResource["prmax.iadmin.sales.prospects.gather.view"]=true;dojo.provide("prmax.iadmin.sales.prospects.gather.view");dojo.require("ttl.BaseWidget");dojo.require("dijit.layout.ContentPane");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.Toolbar");dojo.require("dijit.form.Button");dojo.require("dijit.form.DropDownButton");dojo.require("dijit.TooltipDialog");dojo.require("dijit.layout.ContentPane");dojo.require("dojox.grid.DataGrid");dojo.require("dijit.layout.StackContainer");dojo.require("dijit.Dialog");dojo.require("prmax.iadmin.sales.prospects.gather.add");dojo.require("prmax.iadmin.sales.prospects.gather.delete");dojo.declare("prmax.iadmin.sales.prospects.gather.view",[ttl.BaseWidget,dijit.layout.BorderContainer],{templateString:dojo.cache("prmax","iadmin/sales/prospects/gather/templates/view.html","<div>\r\n\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-attach-point=\"controls\" data-dojo-props='region:\"top\",style:\"height:45px;width:100%;overflow:hidden\"'>\r\n\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='style:\"height:99%;width:100%;padding:0px;margin:0px\"'>\r\n\t\t\t<div data-dojo-attach-event=\"onClick:_add\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"PRMaxStdIcon PRMaxNewIcon\",showLabel:true'><span>Add Prospect</span></div>\r\n\t\t\t<div data-dojo-attach-event=\"onClick:_refresh\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"PRMaxStdIcon PRMaxRefreshIcon\"'><span>Refresh</span></div>\r\n\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\"  data-dojo-props='iconClass:\"PRMaxStdIcon PRMaxFilterIcon\",showLabel:true'>\r\n\t\t\t\t<span>Filter By</span>\r\n\t\t\t\t<div data-dojo-type=\"dijit.TooltipDialog\" data-dojo-props='title:\"Filter By\"' data-dojo-attach-event=\"execute:_execute_filter\">\r\n\t\t\t\t\t<table>\r\n\t\t\t\t\t\t<tr><td><label>Email Address</label></td><td><input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"emailaddress\" data-dojo-props='type:\"text\",name:\"emailaddress\"' ></td></tr>\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td align=\"left\"><button data-dojo-attach-event=\"onClick: _clear_filter\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\"' >Clear Filter</button></td>\r\n\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"submit\",name:\"submit\"'>Filter</button></td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"left\",style:\"width:50%\"'>\r\n\t\t<div data-dojo-attach-point=\"result_grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='style:\"height:100%;width:100%\",rowsPerPage:50'></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"tabcont\" data-dojo-type=\"dijit.layout.StackContainer\" data-dojo-props=\"region:'center',splitter:true,'class':'bordered'\">\r\n\t\t<div title=\"blank\" data-dojo-attach-point=\"blank\" data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='selected:\"selected\"' ></div>\r\n\t\t<div title=\"editctrl\" data-dojo-attach-point=\"editctrl\" data-dojo-type=\"prmax.iadmin.sales.prospects.gather.add\" data-dojo-props='mode:\"edit\",url:\"/iadmin/prospects/prospect/update_prospect\"'></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Add New Prospect\"' data-dojo-attach-point=\"adddialog\">\r\n\t\t<div data-dojo-attach-point=\"addctrl\" data-dojo-type=\"prmax.iadmin.sales.prospects.gather.add\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Remove Prospect\"' data-dojo-attach-point=\"deletedialog\">\r\n\t\t<div data-dojo-attach-point=\"deletectrl\" data-dojo-type=\"prmax.iadmin.sales.prospects.gather.delete\" ></div>\r\n\t</div></div>\r\n"),constructor:function(){this._store=new dojox.data.JsonRestStore({target:"/iadmin/prospects/prospect/list",idAttribute:"prospectid"});dojo.subscribe("/prospect/prospect/add",dojo.hitch(this,this._add_event));dojo.subscribe("/prospect/prospect/updated",dojo.hitch(this,this._update_event));dojo.subscribe("/prospect/prospect/delete",dojo.hitch(this,this._delete_event));this._load_call_back=dojo.hitch(this,this._load_call);},clear:function(){this.tabcont.selectChild(this.blank);},postCreate:function(){this.result_grid.set("structure",this.view);this.result_grid._setStore(this._store);this.result_grid.onStyleRow=dojo.hitch(this,ttl.GridHelpers.onStyleRow);this.result_grid.onRowClick=dojo.hitch(this,this._on_select_row);this.inherited(arguments);this.addctrl.set("dialog",this.adddialog);},_on_select_row:function(e){this._row=this.result_grid.getItem(e.rowIndex);if(e.cellIndex==0){this.deletectrl.load(this._row.prospectid,this.deletedialog,this._row.email);this.deletedialog.show();}else{dojo.xhrPost(ttl.utilities.makeParams({load:this._load_call_back,url:"/iadmin/prospects/prospect/get",content:{prospectid:this._row.prospectid}}));}this.result_grid.selection.clickSelectEvent(e);},_load_call:function(_1){if(_1.success=="OK"){this.editctrl.load(_1.data);this.tabcont.selectChild(this.editctrl);}else{}},view:{cells:[[{name:" ",width:"12px",field:"",formatter:ttl.utilities.deleteRowCtrl},{name:" ",width:"12px",field:"",formatter:ttl.utilities.formatRowCtrl},{name:"Email",width:"200px",field:"email"},{name:"Contact",width:"200px",field:"contactname"},{name:"Company",width:"200px",field:"prospectcompanyname"},{name:"Type",width:"100px",field:"prospecttypename"},{name:"Source",width:"100px",field:"prospectsourcename"},{name:"Region",width:"100px",field:"prospectregionname"}]]},_refresh:function(){this.result_grid.setQuery({});},_clear_filter:function(){this.emailaddress.set("value","");this.result_grid.setQuery({});this.clear();},_execute_filter:function(){var _2={};if(arguments[0].emailaddress.length>0){_2["emailaddress"]=arguments[0].emailaddress;}this.result_grid.setQuery(_2);this.clear();},_add:function(){this.tabcont.selectChild(this.blank);this.addctrl.clear();this.adddialog.show();},_add_event:function(_3){this._store.newItem(_3);},_update_event:function(_4){this._store.setValue(this._row,"email",_4.email);this._store.setValue(this._row,"contactname",_4.contactname);this._store.setValue(this._row,"prospectcompanyname",_4.prospectcompanyname);this._store.setValue(this._row,"prospecttypename",_4.prospecttypename);this._store.setValue(this._row,"prospectsourcename",_4.prospectsourcename);this._store.setValue(this._row,"prospectregionname",_4.prospectregionname);},_delete_event:function(_5){this._store.deleteItem(this._row);}});}