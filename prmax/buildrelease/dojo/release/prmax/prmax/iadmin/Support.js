/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.Support"]){dojo._hasResource["prmax.iadmin.Support"]=true;dojo.provide("prmax.iadmin.Support");dojo.require("ttl.BaseWidget");dojo.declare("prmax.iadmin.Support",[ttl.BaseWidget],{templateString:"<div>\r\n\t<br/>\r\n\t<form dojoAttachPoint=\"form\"  onsubmit=\"return false\" dojoType=\"dijit.form.Form\">\r\n\t\t<table width=\"400px\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\" >\r\n\t\t\t<tr><td width=\"40%\" class=\"prmaxrowtag\">Support User</td><td><select name=\"iuserid\" dojoAttachPoint=\"users\" autoComplete=\"true\" searchAttr=\"name\" dojoType=\"dijit.form.FilteringSelect\" labelType=\"html\" required=\"true\"></select></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\">Customers</td><td><select name=\"icustomerid\" dojoAttachPoint=\"customers\" autoComplete=\"true\" searchAttr=\"customername\" dojoType=\"dijit.form.FilteringSelect\" labelType=\"html\" required=\"true\"></select></td></tr>\r\n\t\t\t<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n\t\t\t<tr><td colspan=\"2\" align=\"center\"><button  style=\"padding:0px;margin:0px\" type=\"button\" dojoAttachEvent=\"onClick:_SetCustomer\" dojoType=\"dijit.form.Button\" label=\"Set Customer\"></button></td></tr>\r\n\t\t</table>\r\n\t</form>\r\n</div>\r\n",constructor:function(){this.inherited(arguments);this.customer_model=new prcommon.data.QueryWriteStore({url:"/iadmin/customers?licence_expired=1",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true,nocallback:true});this.user_model=new prcommon.data.QueryWriteStore({url:"/iadmin/users_support",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,nocallback:true,urlPreventCache:true});this._SetCustomerCallBack=dojo.hitch(this,this._SetCustomerCall);},postCreate:function(){this.inherited(arguments);this.customers.store=this.customer_model;this.users.store=this.user_model;},_SetCustomerCall:function(_1){if(_1.success=="OK"){alert("Support Customer updated");}else{alert("Problem Updating Support Customer");}},_SetCustomer:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");return false;}if(confirm("Set Support Customer")){dojo.xhrPost(ttl.utilities.makeParams({load:this._SetCustomerCallBack,url:"/iadmin/support_customer_set",content:this.form.get("value")}));}}});}