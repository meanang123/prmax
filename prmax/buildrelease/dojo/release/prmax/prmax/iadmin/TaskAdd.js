/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.TaskAdd"]){dojo._hasResource["prmax.iadmin.TaskAdd"]=true;dojo.provide("prmax.iadmin.TaskAdd");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("ttl.BaseWidget");dojo.declare("prmax.iadmin.TaskAdd",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<form dojoAttachPoint=\"form\"  onsubmit=\"return false\" dojoType=\"dijit.form.Form\">\r\n\t\t<input type=\"hidden\" dojoAttachPoint=\"group\" name=\"group\" dojoType=\"dijit.form.TextBox\" >\r\n\t\t<table width=\"99%\" class=\"prmaxtable\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"padding-top:5px\">\r\n\t\t\t<tr><td align=\"right\" valign=\"top\" class=\"prmaxrowtag\" width=\"120px\" >Subject</td><td><input type=\"text\" required=\"true\" dojoAttachPoint=\"subject\" name=\"subject\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:30em\"></td>\r\n\t\t\t<tr><td align=\"right\" valign=\"top\" class=\"prmaxrowtag\" >Customer</td><td><select name=\"icustomerid\" autoComplete=\"true\" dojoType=\"dijit.form.FilteringSelect\" labelType=\"html\" searchAttr=\"customername\" dojoAttachPoint=\"icustomerid\" required=\"true\"></select></td></tr>\r\n\t\t\t<tr><td align=\"right\" valign=\"top\" class=\"prmaxrowtag\">Type</td><td><select name=\"tasktypeid\" autoComplete=\"true\" dojoType=\"dijit.form.FilteringSelect\" labelType=\"html\" dojoAttachPoint=\"tasktypeid\" ></select></td></tr>\r\n\t\t\t<tr><td align=\"right\" valign=\"top\" class=\"prmaxrowtag\">Status</td><td><select name=\"taskstatusid\" autoComplete=\"true\" dojoType=\"dijit.form.FilteringSelect\" labelType=\"html\" dojoAttachPoint=\"taskstatusid\" ></select></td></tr>\r\n\t\t\t<tr><td align=\"right\" valign=\"top\" class=\"prmaxrowtag\">Due Date</td><td><input type=\"text\" required=\"true\" dojoAttachPoint=\"due_date\" name=\"due_date\" dojoType=\"dijit.form.DateTextBox\" style=\"width:8em\" ></td></tr>\r\n\t\t\t<tr><td align=\"right\" valign=\"top\" class=\"prmaxrowtag\">Owner</td><td><select class=\"prmaxrequired\" required=\"true\" dojoAttachPoint=\"assigntoid\" name=\"assigntoid\" autoComplete=\"true\" style=\"width:15em\" dojoType=\"dijit.form.FilteringSelect\" labelType=\"html\"></select></td></td></tr>\r\n\t\t\t<tr dojoAttachPoint=\"tasktag\" class=\"prmaxhidden\"><td align=\"right\" valign=\"top\" class=\"prmaxrowtag\">Diary Type</td><td><select dojoAttachPoint=\"tasktagid\" required=\"false\"  name=\"tasktagid\" autoComplete=\"true\" dojoType=\"dijit.form.FilteringSelect\" labelType=\"html\"></select></td></td></tr>\r\n\t\t\t<tr><td colspan=\"2\"><br/></td></tr>\r\n\t\t\t<tr><td><button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"clsbtn\" dojoAttachEvent=\"onClick:_Close\" label=\"Close\"></td><td align=\"right\">\r\n\t\t\t\t\t\t\t<button dojoType=\"dojox.form.BusyButton\" dojoAttachPoint=\"addbtn\" busyLabel=\"Adding ...\" dojoAttachEvent=\"onClick:_Add\" label=\"Add\"><td></tr>\r\n\t\t</table>\r\n\t</form>\r\n</div>\r\n",constructor:function(){this._users=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=users&group=sales,accounts"});this._taskstatus=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=taskstatus"});this.icustomerid_data=new dojox.data.QueryReadStore({url:"/iadmin/customers_combo",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true});this._tasktype=null;this._tasktags=null;this._AddCallBack=dojo.hitch(this,this._AddCall);},postCreate:function(){this.inherited(arguments);this.taskstatusid.store=this._taskstatus;this.assigntoid.store=this._users;this.icustomerid.store=this.icustomerid_data;},Load:function(_1,_2,_3,_4){var _5="";if(_1!=null){_5="&group="+_1;}if(this._tasktype==null){this._tasktype=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=tasktype"+_5});this._tasktags=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=tasktags"+_5});}this.tasktypeid.store=this._tasktype;this.tasktagid.store=this._tasktags;this._dialog=_2;this._model=_3;this.group.set("value",_1);this._Clear();dojo.removeClass(this.tasktag,"prmaxhidden");if(_4){this.icustomerid.set("value",_4);}},_Close:function(){this._dialog.hide();},_AddCall:function(_6){if(_6.success=="OK"){if(this._model){this._model.newItem(_6.task);}this._dialog.hide();this._Clear();}else{alert("Problem Adding Task");}this.addbtn.cancel();},_Clear:function(){this.addbtn.cancel();},_Add:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");this.addbtn.cancel();return false;}var _7=this.form.get("value");_7["due_date"]=ttl.utilities.toJsonDate(this.due_date.get("value"));dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._AddCallBack),url:"/iadmin/task_add",content:_7}));}});}