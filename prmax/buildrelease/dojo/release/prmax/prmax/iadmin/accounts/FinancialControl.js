/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.accounts.FinancialControl"]){dojo._hasResource["prmax.iadmin.accounts.FinancialControl"]=true;dojo.provide("prmax.iadmin.accounts.FinancialControl");dojo.require("ttl.BaseWidget");dojo.require("prmax.iadmin.accounts.Payment");dojo.require("prmax.iadmin.accounts.MonthlyPayment");dojo.require("prmax.iadmin.accounts.Proforma");dojo.require("prmax.iadmin.accounts.DDPayment");dojo.require("prmax.iadmin.accounts.DDInvoices");dojo.require("prmax.iadmin.accounts.DDCsv");dojo.require("prmax.iadmin.accounts.DDReturnPayment");dojo.require("prmax.iadmin.accounts.OrderConfirmation");dojo.require("prmax.iadmin.accounts.UpgradeOrderConfirmation");dojo.require("prmax.iadmin.accounts.ManualInvoice");dojo.require("prmax.iadmin.accounts.FinancialView");dojo.require("prmax.iadmin.accounts.Adjustments");dojo.require("prmax.iadmin.accounts.Credit");dojo.require("prmax.iadmin.accounts.PrePayInvoice");dojo.require("prmax.iadmin.accounts.OneOffInvoice");dojo.require("prmax.iadmin.accounts.ManualCredit");dojo.require("prmax.iadmin.accounts.SendDDConf");dojo.declare("prmax.iadmin.accounts.FinancialControl",[ttl.BaseWidget],{templateString:"<div>\r\n\t<div data-dojo-attach-point=\"frame\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='gutters:true,style:\"width:100%;height:100%\"' >\r\n\t\t<div data-dojo-type=\"dijit.layout.TabContainer\" data-dojo-props='region:\"center\"' >\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='\"class\":\"scrollpanel\",style:\"width:100%;height:100%\",title:\"Details\"' >\r\n\t\t\t\t<form data-dojo-attach-point=\"financialForm\" data-dojo-props='onsubmit:\"return false\"' data-dojo-type=\"dijit.form.Form\">\r\n\t\t\t\t\t<table class=\"prmaxtable\" width=\"500px\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\">\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" style=\"width:30%\" align=\"right\" >Order Status</td><td width=\"70%\"><select data-dojo-props='\"class\":\"prmaxinput\",name:\"customerorderstatusid\",style:\"width:19em\",autoComplete:true' data-dojo-attach-point=\"customerorderstatusid\" data-dojo-type=\"dijit.form.FilteringSelect\" ></select></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" style=\"width:30%\" align=\"right\" >Financial Status</td><td width=\"70%\"><select data-dojo-props='\"class\":\"prmaxinput\",name:\"financialstatusid\",style:\"width:15em\",autoComplete:true' data-dojo-attach-point=\"financialstatusid\" data-dojo-type=\"dijit.form.FilteringSelect\"></select></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" style=\"width:30%\" align=\"right\" >Payment Method</td><td width=\"70%\"><select data-dojo-props='\"class\":\"prmaxinput\",name:\"paymentmethodid\",style:\"width:15em\",autoComplete:true' data-dojo-attach-point=\"paymentmethodid\" data-dojo-type=\"dijit.form.FilteringSelect\"></select></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" style=\"width:30%\" align=\"right\" >Core Renewal Date</td><td><input data-dojo-attach-point=\"renewal_date\" data-dojo-props='\"class\":\"prmaxinput\",type:\"text\",required:true,name:\"renewal_date\"' data-dojo-type=\"dijit.form.DateTextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" style=\"width:30%\" align=\"right\" >Features Renewal Date</td><td><input data-dojo-attach-point=\"renewal_date_features\" data-dojo-props='\"class\":\"prmaxinput\",type:\"text\",name:\"renewal_date_features\"' data-dojo-type=\"dijit.form.DateTextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" style=\"width:30%\" align=\"right\" >Invoice Email</td><td width=\"70%\"><input data-dojo-props='\"class\":\"prmaxinput\",regExpGen:dojox.validate.regexp.emailAddress,trim:true,name:\"invoiceemail\",type:\"text\"' data-dojo-attach-point=\"invoiceemail\" data-dojo-type=\"dijit.form.ValidationTextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" style=\"width:30%\" align=\"right\" >Bank Name</td><td width=\"70%\"><input data-dojo-props='\"class\":\"prmaxinput\",name:\"bank_name\",type:\"text\",trim:true' data-dojo-attach-point=\"bank_name\" data-dojo-type=\"dijit.form.TextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" style=\"width:30%\" align=\"right\" >Account Name</td><td width=\"70%\"><input data-dojo-attach-point=\"bank_account_name\" data-dojo-props='name:\"bank_account_name\",type:\"text\",trim:true,\"class\":\"prmaxinput\"' data-dojo-type=\"dijit.form.TextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" style=\"width:30%\" align=\"right\" >Sort Code</td><td width=\"70%\"><input data-dojo-props='\"class\":\"prmaxinput\",name:\"bank_sort_code\",type:\"text\",trim:true' data-dojo-attach-point=\"bank_sort_code\" data-dojo-type=\"dijit.form.TextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" style=\"width:30%\" align=\"right\" >Account Number</td><td width=\"70%\"><input data-dojo-attach-point=\"bank_account_nbr\" data-dojo-props='\"class\":\"prmaxinput\",name:\"bank_account_nbr\",type:\"text\",trim:\"true\"' data-dojo-type=\"dijit.form.TextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" style=\"width:30%\" align=\"right\" >Purchase Order</td><td width=\"70%\"><input data-dojo-attach-point=\"purchase_order\" data-dojo-props='\"class\":\"prmaxinput\",name:\"purchase_order\",type:\"text\",trim:true' data-dojo-type=\"dijit.form.TextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" style=\"width:30%\" align=\"right\" >Bundled Invoice</td><td><input data-dojo-attach-point=\"has_bundled_invoice\" data-dojo-props='\"class\":\"prmaxinput\",name:\"has_bundled_invoice\",type:\"checkbox\"' data-dojo-type=\"dijit.form.CheckBox\"/></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">DD Reference</td><td width=\"70%\"><input data-dojo-attach-point=\"dd_ref\" data-dojo-props='type:\"text\",\"class\":\"prmaxinput\",name:\"dd_ref\"' data-dojo-type=\"dijit.form.TextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">DD Start Day of Month</td><td width=\"70%\"><select data-dojo-props='style:\"width:50px\",\"class\":\"prmaxinput\",name:\"dd_start_day\",type:\"text\"' data-dojo-attach-point=\"dd_start_day\" data-dojo-type=\"dijit.form.ComboBox\"></select></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">DD Start Month</td><td width=\"70%\"><input data-dojo-props='\"class\":\"prmaxinput\",name:\"dd_start_month\",type:\"text\",trim:true, constraints:{min:0,max:3}, style:\"width:3em\"' data-dojo-attach-point=\"dd_start_month\" data-dojo-type=\"dijit.form.NumberTextBox\"></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">DD Media Mn.</td><td width=\"70%\"><input data-dojo-attach-point=\"pay_monthly_value\" data-dojo-props='\"class\":\"prmaxinput\",name:\"pay_monthly_value\",type:\"text\",trim:true' data-dojo-type=\"dijit.form.CurrencyTextBox\" >&nbsp;<select data-dojo-props='\"class\":\"prmaxinput\",name:\"dd_media_pricecodeid\",style:\"width:5em\",autoComplete:true' data-dojo-attach-point=\"dd_media_pricecodeid\" data-dojo-type=\"dijit.form.ComboBox\"></select></td></tr>\r\n\t\t\t\t\t\t<tr data-dojo-attach-point=\"adv_1\"><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">DD Features Mn.</td><td width=\"70%\"><input data-dojo-attach-point=\"dd_advance_value\" data-dojo-props='\"class\":\"prmaxinput\",name:\"dd_advance_value\",type:\"text\",trim:true' data-dojo-type=\"dijit.form.CurrencyTextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr data-dojo-attach-point=\"monitoring_1\"><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">DD Monitoring Mn.</td><td width=\"70%\"><input data-dojo-attach-point=\"dd_monitoring_value\" data-dojo-props='\"class\":\"prmaxinput\",name:\"dd_monitoring_value\",type:\"text\",trim:true' data-dojo-type=\"dijit.form.CurrencyTextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr data-dojo-attach-point=\"int_1\"><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">DD International Mn.</td><td width=\"70%\"><input data-dojo-attach-point=\"dd_international_data_value\" data-dojo-props='\"class\":\"prmaxinput\",name:\"dd_international_data_value\",type:\"text\",trim:true' data-dojo-type=\"dijit.form.CurrencyTextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">Monthly Day</td><td width=\"70%\"><select data-dojo-props='style:\"width:50px\",\"class\":\"prmaxinput\",name:\"pay_montly_day\",type:\"text\"' data-dojo-attach-point=\"pay_montly_day\" data-dojo-type=\"dijit.form.ComboBox\"></select></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">Next Monthly Value</td><td width=\"70%\"><input data-dojo-props='\"class\":\"prmaxinput\",name:\"next_month_value\",type:\"text\",trim:true' data-dojo-attach-point=\"next_month_value\" data-dojo-type=\"dijit.form.CurrencyTextBox\"></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" valign=\"top\">Next Monthly Invoice Message</td><td><div class=\"dialogprofileframe\" ><textarea data-dojo-attach-point=\"next_invoice_message\" data-dojo-props='name:\"next_invoice_message\",\"class\":\"dijitTextarea\",style:\"width:99%;height:99%\"' data-dojo-type=\"dijit.form.Textarea\" ></textarea></div></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">Sub Day of Month</td><td width=\"70%\"><select data-dojo-props='style:\"width:50px\",\"class\":\"prmaxinput\",name:\"sub_start_day\",type:\"text\"' data-dojo-attach-point=\"sub_start_day\" data-dojo-type=\"dijit.form.ComboBox\"></select></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">Last Paid Month</td><td width=\"70%\"><input data-dojo-attach-point=\"last_paid_date\" data-dojo-props='\"class\":\"prmaxinput\",readonly:\"readonly\",type:\"text\",trim:true' data-dojo-type=\"dijit.form.TextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">Collection Date</td><td width=\"70%\"><input data-dojo-props='\"class\":\"prmaxinput\",readonly:\"readonly\",type:\"text\",trim:true' data-dojo-attach-point=\"dd_collectiondate\" data-dojo-type=\"dijit.form.TextBox\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" >SEO Payment Method</td><td ><select data-dojo-props='\"class\":\"prmaxinput\",name:\"seopaymenttypeid\",style:\"width:15em\",autoComplete:true' data-dojo-attach-point=\"seopaymenttypeid\" data-dojo-type=\"dijit.form.FilteringSelect\" ></select></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" >SEO Free Qty</td><td><input data-dojo-props='\"class\":\"prmaxinput\",readonly:\"readonly\", type:\"text\", \"disabled\":\"disabled\"' data-dojo-attach-point=\"seonbrincredit\" data-dojo-type=\"dijit.form.TextBox\"></td></tr>\r\n\t\t\t\t\t\t<tr ><td class=\"prmaxrowtag\" colspan=\"2\"><button data-dojo-props='label:\"Save\",\"class\":\"prmaxbutton\",busyLabel:\"Please Wait Saving...\",type:\"button\"' data-dojo-attach-point=\"saveFinancialNode\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-attach-event=\"onClick:_UpdateFinancial\" ></button></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='\"class\":\"scrollpanel\",style:\"width:100%;height:100%\",title:\"Sales Analysis\"' >\r\n\t\t\t\t<form data-dojo-attach-point=\"salesform\" data-dojo-props='onsubmit:\"return false\"' data-dojo-type=\"dijit.form.Form\">\r\n\t\t\t\t\t<table class=\"prmaxtable\" width=\"500px\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\">\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">Media</td><td width=\"70%\"><select data-dojo-props='\"class\":\"prmaxinput\",name:\"pricecodeid\",style:\"width:9em\",autoComplete:true' data-dojo-attach-point=\"pricecodeid\" data-dojo-type=\"dijit.form.FilteringSelect\"></select></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">Features</td><td width=\"70%\"><select data-dojo-props='\"class\":\"prmaxinput\",name:\"advpricecodeid\",style:\"width:9em\",autoComplete:true' data-dojo-attach-point=\"advpricecodeid\" data-dojo-type=\"dijit.form.FilteringSelect\"></select></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">Updateum</td><td width=\"70%\"><select data-dojo-props='\"class\":\"prmaxinput\",name:\"updatumpricecodeid\",style:\"width:9em\",autoComplete:true' data-dojo-attach-point=\"updatumpricecodeid\" data-dojo-type=\"dijit.form.FilteringSelect\"></select></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">International</td><td width=\"70%\"><select data-dojo-props='\"class\":\"prmaxinput\",name:\"intpricecodeid\",style:\"width:9em\",autoComplete:true' data-dojo-attach-point=\"intpricecodeid\" data-dojo-type=\"dijit.form.FilteringSelect\"></select></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" style=\"width:30%\">Clippings</td><td width=\"70%\"><select data-dojo-props='\"class\":\"prmaxinput\",name:\"clippingspricecodeid\",style:\"width:9em\",autoComplete:true' data-dojo-attach-point=\"clippingspricecodeid\" data-dojo-type=\"dijit.form.FilteringSelect\"></select></td></tr>\r\n\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" colspan=\"2\"><button data-dojo-props='label:\"Save\",\"class\":\"prmaxbutton\",busyLabel:\"Please Wait Saving...\",type:\"button\"' data-dojo-attach-point=\"savesalesanalysis\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-attach-event=\"onClick:_update_sales_analysis\" ></button></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='\"class\":\"scrollpanel\",region:\"right\",style:\"height:100%;width:150px\"' >\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_TakePayment\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Enter Payment\",type:\"button\"'></button>\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_ManualPayment\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Pay & Allocate\",type:\"button\"' ></button>\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_OneOffInvoice\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"On Off Invoice\",type:\"button\"' ></button>\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_SendProforma\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Send Proforma\",type:\"button\"' ></button>\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_ManualInvoice\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Manual Invoice\",type:\"button\"' ></button>\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_Invoice\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Invoice\",type:\"button\"' ></button>\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_CreditNote\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Credit Note\",type:\"button\"' ></button>\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_ManualCredit\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Manual Credit\",type:\"button\"' ></button>\r\n\t\t\t<button data-dojo-attach-event=\"onClick:_Adjustment\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Adjustment\",type:\"button\"' ></button>\r\n\t\t\t<hr/>\r\n\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_SendConfirmation\" data-dojo-props='label:\"Order Confirmation\"' ></button>\r\n\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_SendUpdateConfirmation\" data-dojo-props='label:\"Upgrade Confirmation\"' ></button>\r\n\t\t\t<hr/>\r\n\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_dd_received_confirm\" data-dojo-props='label:\"Letter DD Received\"' ></button>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Take Payment\"' data-dojo-attach-point=\"takepaymentdialog\">\r\n\t\t<div  data-dojo-attach-point=\"takepaymentctrl\" data-dojo-type=\"prmax.iadmin.accounts.Payment\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Credit Account\"' data-dojo-attach-point=\"creditdialog\">\r\n\t\t<div  data-dojo-attach-point=\"creditctrl\" data-dojo-type=\"prmax.iadmin.accounts.Credit\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Monthly Payment\"' data-dojo-attach-point=\"monthlypaymentdialog\">\r\n\t\t<div  data-dojo-attach-point=\"monthlypaymentctrl\" data-dojo-type=\"prmax.iadmin.accounts.MonthlyPayment\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Direct Debit Reject Payment\"' data-dojo-attach-point=\"ddrejectpaymentdialog\">\r\n\t\t<div  data-dojo-attach-point=\"ddrejectpaymentctrl\" data-dojo-type=\"prmax.iadmin.accounts.DDReturnPayment\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"First Month DD\"' data-dojo-attach-point=\"ddpaymentdialog\">\r\n\t\t<div data-dojo-attach-point=\"ddpaymentctrl\" data-dojo-type=\"prmax.iadmin.accounts.DDPayment\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Send Proforma\"' data-dojo-attach-point=\"sendproformadialog\">\r\n\t\t<div  data-dojo-attach-point=\"sendproformactrl\" data-dojo-type=\"prmax.iadmin.accounts.Proforma\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Enter Manual Invoice\"' data-dojo-attach-point=\"manualinvoicedialog\">\r\n\t\t<div data-dojo-attach-point=\"manualinvoicectrl\" data-dojo-type=\"prmax.iadmin.accounts.ManualInvoice\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Enter Payment & Allocated\"' data-dojo-attach-point=\"allocpaymentdialog\">\r\n\t\t<div  data-dojo-attach-point=\"allocpaymentctrl\" data-dojo-props='manualmode:\"true\"' data-dojo-type=\"prmax.iadmin.accounts.Payment\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Adjust Account\"' data-dojo-attach-point=\"adjustdialog\">\r\n\t\t<div  data-dojo-attach-point=\"adjustctrl\" data-dojo-type=\"prmax.iadmin.accounts.Adjustments\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Invoice Account\"' data-dojo-attach-point=\"invdialog\">\r\n\t\t<div  data-dojo-attach-point=\"invctrl\" data-dojo-type=\"prmax.iadmin.accounts.PrePayInvoice\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Enter Order Confirmation\"' data-dojo-attach-point=\"sendorderconfirmationdialog\">\r\n\t\t<div data-dojo-attach-point=\"sendorderconfirmationctrl\" data-dojo-type=\"prmax.iadmin.accounts.OrderConfirmation\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Upgrade Confirmation\"' data-dojo-attach-point=\"upgradeconfirmationdialog\">\r\n\t\t<div data-dojo-attach-point=\"upgradeconfirmationctrl\" data-dojo-type=\"prmax.iadmin.accounts.UpgradeOrderConfirmation\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"One Off Invoice\"' data-dojo-attach-point=\"onceoffinvoicedialog\">\r\n\t\t<div data-dojo-attach-point=\"onceoffinvoicectrl\" data-dojo-type=\"prmax.iadmin.accounts.OneOffInvoice\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Manual Credit\"' data-dojo-attach-point=\"manualcreditdialog\">\r\n\t\t<div data-dojo-attach-point=\"manualcreditctrl\" data-dojo-type=\"prmax.iadmin.accounts.ManualCredit\" ></div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Send DD Confirmation\"' data-dojo-attach-point=\"dd_conf_dialog\">\r\n\t\t<div data-dojo-attach-point=\"dd_conf_ctrl\" data-dojo-type=\"prmax.iadmin.accounts.SendDDConf\" ></div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._FinancialResponseCall=dojo.hitch(this,this._FinancialResponse);this._paymentmethods=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=paymentmethods"});this._financialstatus=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=financialstatus"});this._daysofmonth=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=daysofmonth"});this._customerorderstatus=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=customerorderstatus"});this._seopaymenttypes=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=seopaymenttypes"});this._pricecodes_core=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=pricecodes&type=core"});this._pricecodes_adv=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=pricecodes&type=adv"});this._pricecodes_updatum=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=pricecodes&type=updatum"});this._pricecodes_int=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=pricecodes&type=int"});this._pricecodes_clippings=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=pricecodes&type=clippings"});this._SendOrderCallBack=dojo.hitch(this,this._SendOrderCall);this._LoadInvoiceCallBack=dojo.hitch(this,this._LoadInvoiceCall);this._LoadCreditCallBack=dojo.hitch(this,this._LoadCreditCall);this._LoadOneOffCallBack=dojo.hitch(this,this._LoadOneOffCall);this._LoadCustomerCallBack=dojo.hitch(this,this._LoadCustomerCall);this._ManualCreditCallBack=dojo.hitch(this,this._ManualCreditCall);this._upgrade_load_confirmation_call_back=dojo.hitch(this,this._upgrade_load_confirmation_call);this._send_dd_conf_call_back=dojo.hitch(this,this._send_dd_conf_call);this._take_payment_call_back=dojo.hitch(this,this._take_payment_call);this._manual_payment_call_back=dojo.hitch(this,this._manual_payment_call);},postCreate:function(){this.paymentmethodid.store=this._paymentmethods;this.financialstatusid.store=this._financialstatus;this.pay_montly_day.store=this._daysofmonth;this.sub_start_day.store=this._daysofmonth;this.customerorderstatusid.store=this._customerorderstatus;this.seopaymenttypeid.store=this._seopaymenttypes;this.dd_start_day.set("store",this._daysofmonth);this.pricecodeid.set("store",this._pricecodes_core);this.advpricecodeid.set("store",this._pricecodes_adv);this.updatumpricecodeid.set("store",this._pricecodes_updatum);this.intpricecodeid.set("store",this._pricecodes_int);this.clippingspricecodeid.set("store",this._pricecodes_clippings);this.inherited(arguments);},_load_prices_call:function(_1){},Load:function(_2){this.paymentmethodid.set("value",_2.cust.paymentmethodid);this.financialstatusid.set("value",_2.cust.financialstatusid);this.customerorderstatusid.set("value",_2.cust.customerorderstatusid);this.next_invoice_message.set("value",_2.cust.next_invoice_message);this.bank_name.set("value",_2.cust.bank_name);if(_2.cust.renewal_date_d!=null){this.renewal_date.set("value",new Date(_2.cust.renewal_date_d.year,_2.cust.renewal_date_d.month-1,_2.cust.renewal_date_d.day));}else{this.renewal_date.set("value",null);}if(_2.cust.renewal_date_features_d!=null){this.renewal_date_features.set("value",new Date(_2.cust.renewal_date_features_d.year,_2.cust.renewal_date_features_d.month-1,_2.cust.renewal_date_features_d.day));}else{this.renewal_date_features.set("value",null);}this.invoiceemail.set("value",_2.cust.invoiceemail);this.bank_account_name.set("value",_2.cust.bank_account_name);this.bank_sort_code.set("value",_2.cust.bank_sort_code);this.bank_account_nbr.set("value",_2.cust.bank_account_nbr);this.pay_monthly_value.set("value",dojo.number.round(_2.cust.pay_monthly_value/100,2));this.dd_monitoring_value.set("value",dojo.number.round(_2.cust.dd_monitoring_value/100,2));this.dd_advance_value.set("value",dojo.number.round(_2.cust.dd_advance_value/100,2));this.dd_international_data_value.set("value",dojo.number.round(_2.cust.dd_international_data_value/100,2));this.last_paid_date.set("value",_2.cust.last_paid_date_display);this.dd_ref.set("value",_2.cust.dd_ref);this.dd_collectiondate.set("value",_2.cust.dd_collectiondate_display);this.pay_montly_day.set("value",_2.cust.pay_montly_day);this.sub_start_day.set("value",_2.cust.sub_start_day);this.purchase_order.set("value",_2.cust.purchase_order);this.next_month_value.set("value",dojo.number.round(_2.cust.next_month_value/100,2));this.seopaymenttypeid.set("value",_2.cust.seopaymenttypeid);this.seonbrincredit.set("value",_2.cust.seonbrincredit);this.dd_start_day.set("value",_2.cust.dd_start_day);this.dd_start_month.set("value",_2.cust.dd_start_month);this.has_bundled_invoice.set("checked",_2.cust.has_bundled_invoice);this.pricecodeid.set("value",_2.cust.pricecodeid);this.advpricecodeid.set("value",_2.cust.advpricecodeid);this.updatumpricecodeid.set("value",_2.cust.updatumpricecodeid);this.intpricecodeid.set("value",_2.cust.intpricecodeid);this.clippingspricecodeid.set("value",_2.cust.clippingspricecodeid);this._data=_2;this.Show_Hide_Fields(_2.cust);},_take_payment_call:function(_3){if(_3.success=="OK"){this.takepaymentctrl.setCustomer(_3.data.cust,this.takepaymentdialog);this.takepaymentdialog.show();}else{alert("Problem Loading");}},_TakePayment:function(){var _4=this.paymentmethodid.get("value");if(_4==1||_4==null){dojo.xhrPost(ttl.utilities.makeParams({load:this._take_payment_call_back,url:"/iadmin/get_internal",content:{"icustomerid":this._data.cust.customerid}}));}else{this.monthlypaymentctrl.setCustomer(this._data.cust.customerid,this._data.cust.customername,this._data.cust.email,this.monthlypaymentdialog,this.pay_monthly_value.get("value"));this.monthlypaymentdialog.show();}},_SendProforma:function(){this.sendproformactrl.setCustomer(this._data.cust.customerid,this._data.cust.customername,this._data.cust.email,this.sendproformadialog);this.sendproformadialog.show();},_getEmailAddress:function(){var _5=this.invoiceemail.get("value");if(_5==""){_5=this._data.cust.email;}return _5;},_TakeFirstPayment:function(){this.ddpaymentctrl.setCustomer(this._data.cust.customerid,this._data.cust.customername,this._getEmailAddress(),this.monthlypaymentdialog,0);this.ddpaymentdialog.show();},_ManualInvoice:function(){this.manualinvoicectrl.setCustomer(this._data.cust.customerid,this._data.cust.customername,this.manualinvoicedialog);this.manualinvoicedialog.show();},_Invoice:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadInvoiceCallBack,url:"/iadmin/get_internal",content:{"icustomerid":this._data.cust.customerid}}));},_LoadInvoiceCall:function(_6){if(_6.success=="OK"){this.invctrl.setCustomer(_6.data.cust,this.invdialog);this.invdialog.show();}else{alert("Problem Loading Data");}},_manual_payment_call:function(_7){if(_7.success=="OK"){this.allocpaymentctrl.setCustomer(_7.data.cust,this.allocpaymentdialog);this.allocpaymentdialog.show();}else{alert("Problem Loading");}},_ManualPayment:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._manual_payment_call_back,url:"/iadmin/get_internal",content:{"icustomerid":this._data.cust.customerid}}));},_CreditNote:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCreditCallBack,url:"/iadmin/get_internal",content:{"icustomerid":this._data.cust.customerid}}));},_LoadCreditCall:function(_8){if(_8.success=="OK"){this.creditctrl.setCustomer(_8.data.cust,this.creditdialog);this.creditdialog.show();}},_Adjustment:function(){this.adjustctrl.setCustomer(this._data.cust.customerid,this._data.cust.customername,this.adjustdialog);this.adjustdialog.show();},_UpdateFinancial:function(){if(ttl.utilities.formValidator(this.financialForm)==false){this.saveFinancialNode.cancel();return;}var _9=this.financialForm.get("value");_9["icustomerid"]=this._data.cust.customerid;_9["renewal_date"]=ttl.utilities.toJsonDate(this.renewal_date.get("value"));_9["renewal_date_features"]=ttl.utilities.toJsonDate(this.renewal_date_features.get("value"));dojo.xhrPost(ttl.utilities.makeParams({load:this._FinancialResponseCall,url:"/iadmin/update_customer_financial",content:_9}));},_FinancialResponse:function(_a){if(_a.success=="OK"){alert("Customer Financial Details Updated");}else{if(_a.message){alert(_a.message);}else{alert("Problem Updating Financial Details");}}this.saveFinancialNode.cancel();},resize:function(){this.frame.resize(arguments[0]);this.inherited(arguments);},_SendConfirmation:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCustomerCallBack,url:"/iadmin/get_internal",content:{"icustomerid":this._data.cust.customerid}}));},_LoadCustomerCall:function(_b){if(_b.success=="OK"){this.sendorderconfirmationctrl.setCustomer(_b.data.cust.customerid,this.sendorderconfirmationdialog,_b.data.cust);this.sendorderconfirmationdialog.show();}else{alert("Problem Loading Customer Details");}},_SendUpdateConfirmation:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._upgrade_load_confirmation_call_back,url:"/iadmin/get_internal",content:{"icustomerid":this._data.cust.customerid}}));},_upgrade_load_confirmation_call:function(_c){if(_c.success=="OK"){this.upgradeconfirmationctrl.set_customer(_c.data.cust.customerid,this.upgradeconfirmationdialog,_c.data.cust);this.upgradeconfirmationdialog.show();}else{alert("Problem Loading Customer Details");}},_LoadOneOffCall:function(_d){if(_d.success=="OK"){this.onceoffinvoicectrl.setCustomer(_d.data.cust,this.onceoffinvoicedialog);this.onceoffinvoicedialog.show();}},_OneOffInvoice:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadOneOffCallBack,url:"/iadmin/get_internal",content:{"icustomerid":this._data.cust.customerid}}));},_ManualCreditCall:function(_e){if(_e.success=="OK"){this.manualcreditctrl.setCustomer(_e.data.cust,this.manualcreditdialog);this.manualcreditdialog.show();}},_ManualCredit:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._ManualCreditCallBack,url:"/iadmin/get_internal",content:{"icustomerid":this._data.cust.customerid}}));},Show_Hide_Fields:function(_f){if(_f.updatum){dojo.removeClass(this.monitoring_1,"prmaxhidden");}else{dojo.addClass(this.monitoring_1,"prmaxhidden");}if(_f.advancefeatures){dojo.removeClass(this.adv_1,"prmaxhidden");}else{dojo.addClass(this.adv_1,"prmaxhidden");}if(_f.has_international_data){dojo.removeClass(this.int_1,"prmaxhidden");}else{dojo.addClass(this.int_1,"prmaxhidden");}},_send_dd_conf_call:function(_10){if(_10.success=="OK"){this.dd_conf_ctrl.set_customer(_10.data.cust,this.dd_conf_dialog);this.dd_conf_dialog.show();}else{alert("Problem Loading");}},_dd_received_confirm:function(){if(this.dd_ref.get("value").length>0){dojo.xhrPost(ttl.utilities.makeParams({load:this._send_dd_conf_call_back,url:"/iadmin/get_internal",content:{"icustomerid":this._data.cust.customerid}}));}else{alert("No DD Ref");}},_update_sales_analysis:function(){}});}