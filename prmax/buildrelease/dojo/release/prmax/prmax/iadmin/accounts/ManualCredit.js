/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.accounts.ManualCredit"]){dojo._hasResource["prmax.iadmin.accounts.ManualCredit"]=true;dojo.provide("prmax.iadmin.accounts.ManualCredit");dojo.require("ttl.BaseWidget");dojo.require("dojo.io.iframe");dojo.require("dojox.form.FileInput");dojo.require("ttl.DateTextBox");dojo.require("dojo.number");dojo.declare("prmax.iadmin.accounts.ManualCredit",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<form data-dojo-attach-point=\"form\" method=\"post\" name=\"form\" enctype=\"multipart/form-data\" onSubmit=\"return false;\">\r\n\t\t<input data-dojo-props='type:\"hidden\",name:\"icustomerid\"'  data-dojo-attach-point=\"icustomerid\" data-dojo-type=\"dijit.form.TextBox\" ></input>\r\n\t\t<input data-dojo-attach-point=\"invoice_date2\" data-dojo-props='name:\"credit_date\",type:\"hidden\"' data-dojo-type=\"dijit.form.TextBox\" ></input>\r\n\t\t<table width=\"600px\" cellpadding=\"0\" cellpadding=\"0\" >\r\n\t\t\t<tr><td colspan=\"2\"><label class=\"prmaxrowdisplaylarge\" style=\"text-align:center;display:inline\">Manual Credit</label><div style=\"display:inline\" class=\"prmaxrowdisplaylarge\" data-dojo-attach-point=\"customername\">Name</div></td></tr>\r\n\t\t\t<tr><td style=\"width:150px\" class=\"prmaxrowlabel\" align=\"right\">Reference</td><td><input data-dojo-attach-point=\"ref\" data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-props='type:\"text\",name:\"ref\",style:\"width:8em\",required:true' ></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowlabel\" align=\"right\">Date</td><td><input data-dojo-attach-point=\"credit_date\" data-dojo-type=\"ttl.DateTextBox\" data-dojo-props='type:\"text\",style:\"width:8em\",required:true' ></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" valign=\"top\" align=\"right\" >Message</td><td><div class=\"stdframe\" ><textarea data-dojo-attach-point=\"message\" data-dojo-type=\"dijit.form.Textarea\" data-dojo-props='name:\"message\",\"class\":\"dijitTextarea\",style:\"width:99%;height:99%\"'></textarea></div></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowlabel\">Amount</td><td><input data-dojo-type=\"dijit.form.CurrencyTextBox\" data-dojo-props='type:\"text\",name:\"amount\",style:\"width:8em\",required:true,trim:true,constraints:{min:0.01,max:99999.00,fractional:true,places:\"0,2\"}' data-dojo-attach-point=\"amount\" data-dojo-attach-event=\"onBlur:_Amounts\"></input></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowlabel\">Vat</td><td><input data-dojo-type=\"dijit.form.CurrencyTextBox\" data-dojo-props='type:\"text\",name:\"vat\",required:true,constraints:{min:0.00,max:99999.00,fractional:true,places:\"0,2\"},style:\"width:8em\"' data-dojo-attach-point=\"vat\"></input></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowlabel\" >Unpaid Amount</td><td><input data-dojo-type=\"dijit.form.CurrencyTextBox\" data-dojo-attach-point=\"unpaidamount\" data-dojo-props='type:\"text\",name:\"unpaidamount\",required:true,style:\"width:8em\",constraints:{min:0.00,max:99999.00,fractional:true,places:\"0,2\"}'></input></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowlabel\">Credit File (pdf)</td><td><input class=\"prmaxinput\" type=\"file\" data-dojo-attach-point=\"credit_file\" name=\"credit_file\" size=\"50\"></input></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowlabel\" align=\"right\" colspan=\"2\" align=\"right\"><button data-dojo-attach-point=\"okbtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='busyLabel:\"Please Wait Saving...\",type:\"button\"' data-dojo-attach-event=\"onClick:_Send\">Enter Manual Credit Note</button></td></tr>\r\n\t\t</table>\r\n\t</form>\r\n</div>\r\n",constructor:function(){this._AddCallBack=dojo.hitch(this,this._AddCall);},_AddCall:function(_1){if(_1.success=="OK"){alert("Credit Added");dojo.publish(PRCOMMON.Events.Financial_ReLoad,[]);this._dialog.hide();}else{alert("Problem Adding Credit");}},_Send:function(){if(this.ref.isValid()==false||this.credit_date.isValid()==false||this.amount.isValid()==false||this.unpaidamount.isValid()==false){this.okbtn.cancel();return false;}var _2=dojo.attr(this.credit_file,"value").toLowerCase();if(_2.indexOf(".pdf")==-1){alert("This must be a pdf file");this.okbtn.cancel();return false;}this.invoice_date2.set("value",this.credit_date.get("ValueISO"));if(confirm("Create Credit?")==true){dojo.io.iframe.send({url:"/iadmin/add_manual_credit",handleAs:"json",load:this._AddCallBack,form:this.form});}},setCustomer:function(_3,_4){this.icustomerid.set("value",_3.customerid);this.credit_date.set("value",new Date());this.ref.set("value","");this.amount.set("value",0);this.vat.set("value",0);this.unpaidamount.set("value",0);dojo.attr(this.credit_file,"value","");this.okbtn.cancel();dojo.attr(this.customername,"innerHTML",_3.customername);this._dialog=_4;},_Amounts:function(){var _5=this.amount.get("value");var _6=_5-(_5/(1+(20/100)));this.unpaidamount.set("value",_5);this.vat.set("value",dojo.number.format(_6,{places:2}));}});}