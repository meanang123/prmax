/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.accounts.MonthlyPayment"]){dojo._hasResource["prmax.iadmin.accounts.MonthlyPayment"]=true;dojo.provide("prmax.iadmin.accounts.MonthlyPayment");dojo.require("ttl.BaseWidget");dojo.declare("prmax.iadmin.accounts.MonthlyPayment",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n<form dojoAttachPoint=\"form\"  onsubmit=\"return false\" dojoType=\"dijit.form.Form\">\r\n<table width=\"500px\" cellpadding=\"0\" cellpadding=\"0\" >\r\n\t<tr><td colspan=\"4\"><div class=\"prmaxrowdisplaylarge\" style=\"text-align:center;display:inline\">Monthly Payment (Inc Vat.)</div><div class=\"prmaxrowdisplaylarge\" style=\"display:inline\" dojoAttachPoint=\"customername\"></div></td>\r\n\t<tr><td class=\"prmaxrowlabel\" align=\"right\">Amount (Inc Vat.)</td>\r\n\t\t<td><input type=\"text\" name=\"value\" dojoType=\"dijit.form.CurrencyTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"payment\"></input></td>\r\n\t</tr>\r\n\t<tr><td class=\"prmaxrowlabel\" align=\"right\">Paid Month</td>\r\n\t<td><select class=\"prmaxinput\" name=\"monthid\" dojoAttachPoint=\"monthid\" style=\"width:10em\" dojoType=\"dijit.form.FilteringSelect\" autoComplete=\"true\"></select></td>\r\n\t<td class=\"prmaxrowlabel\" align=\"right\">Paid Year</td><td><select class=\"prmaxinput\" name=\"yearid\" dojoAttachPoint=\"yearid\" style=\"width:5em\" dojoType=\"dijit.form.FilteringSelect\" autoComplete=\"true\"></select></td></tr>\r\n\t<tr><td class=\"prmaxrowlabel\" align=\"right\" valign=\"top\">Message</td><td><div class=\"dialogprofileframe\" ><textarea dojoAttachPoint=\"message\" name=\"message\" class=\"dijitTextarea\" dojoType=\"dijit.form.Textarea\"  style=\"width:99%;height:99%\" ></textarea></div></td></tr>\r\n\t<tr><td class=\"prmaxrowlabel\"align=\"right\" >Email Address</td><td><input class=\"prmaxinput\" dojoAttachPoint=\"email\" name=\"email\" type=\"text\" style=\"width:100%\" trim=\"true\" required=\"true\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.emailAddress\" trim=\"true\" invalidMessage=\"invalid email address\" size=\"40\" maxlength=\"70\"/></td></tr>\r\n\t<tr><td class=\"prmaxrowlabel\">Payment Date</td><td><input type=\"text\"  dojoAttachPoint=\"payment_date\" name = \"payment_date\" dojoType=\"dijit.form.DateTextBox\" ></td>\r\n\t</tr>\r\n\t<tr><td class=\"prmaxrowlabel\" colspan=\"4\" align=\"right\"><button dojoType=\"dijit.form.Button\" type=\"button\" dojoAttachEvent=\"onClick:_TakePayment\">Take Payment</button></td>\r\n</table></form>\r\n</div>\r\n",constructor:function(){this._PaymentTakenCallBack=dojo.hitch(this,this._PaymentTakenCall);this._months=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=months"});this._years=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=years"});},setCustomer:function(_1,_2,_3,_4,_5){this._customerid=_1;this._customername=_2;dojo.attr(this.customername,"innerHTML",this._customername);this.email.set("value",_3);this._dialog=_4;this.payment.set("value",_5);},_PaymentTakenCall:function(_6){if(_6.success=="OK"){alert("Payment Taken and invoice sent");this.Clear();dojo.publish(PRCOMMON.Events.Monthly_Payments,[_6.data]);this._dialog.hide();}else{alert("Problem taking payment");}},_TakePayment:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");return false;}var _7=this.form.get("value");var d=this.payment_date.get("value");if(d!=null){_7["payment_date"]=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();}_7["icustomerid"]=this._customerid;dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._PaymentTakenCallBack),url:"/iadmin/payment_monthly_take",content:_7}));},Clear:function(){this.payment.set("value","");this.email.set("value","");},postCreate:function(){this.monthid.store=this._months;this.yearid.store=this._years;var _8=new Date();var _9=_8.getFullYear();var _a=_8.getMonth()+1;this.monthid.set("value",_a);this.yearid.set("value",_9);this.inherited(arguments);}});}