/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.accounts.PriceCodes"]){dojo._hasResource["prmax.iadmin.accounts.PriceCodes"]=true;dojo.provide("prmax.iadmin.accounts.PriceCodes");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("ttl.BaseWidget");dojo.declare("prmax.iadmin.accounts.PriceCodes",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div dojoAttachPoint=\"borderControl\" dojotype=\"dijit.layout.BorderContainer\" style=\"width:100%;height:100%\" gutters=\"false\">\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"top\" style=\"height:42px;width:100%;overflow:hidden;border:1px solid black\">\r\n\t\t\t<div class=\"dijitToolbarTop\" dojoType=\"dijit.Toolbar\" style=\"float:left:height:100%;width:100%\" >\r\n\t\t\t\t<div dojoType=\"dijit.form.Button\" iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" dojoAttachEvent=\"onClick:_New\" showLabel=\"true\">New</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojotype=\"dijit.layout.ContentPane\" region=\"center\"  splitter=\"true\">\r\n\t\t\t<div dojoAttachPoint=\"view_grid\" dojoType=\"dojox.grid.DataGrid\"   query=\"{ }\" rowsPerPage=\"30\" ></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div dojoType=\"dijit.Dialog\" title=\"New Price Code\" dojoAttachPoint=\"pricecodedialog\">\r\n\t\t<form dojoAttachPoint=\"form\"  onsubmit=\"return false\" dojoType=\"dijit.form.Form\">\r\n\t\t\t<table style=\"width:500px;border-collapse:collapse;\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" width=\"150px\">Price Code</td><td><input type=\"text\" required=\"true\" dojoAttachPoint=\"pricecodedescription\" name = \"pricecodedescription\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:150px\" ></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Price Description</td><td><input type=\"text\" required=\"true\" dojoAttachPoint=\"pricecodelongdescription\" name = \"pricecodelongdescription\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:300px\" ></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Module Type</td><td><select class=\"prmaxinput\" name=\"prmaxmoduleid\" dojoAttachPoint=\"prmaxmoduleid\" style=\"width:10em\" dojoType=\"dijit.form.FilteringSelect\" autoComplete=\"true\" required=\"true\"></select>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Fixed Sales Price</td><td><input class=\"prmaxinput\" type=\"text\" name=\"fixed_salesprice\" dojoType=\"dijit.form.CurrencyTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"fixed_salesprice\" style=\"width:8em\" constraints=\"{min:0.00,max:99999.00,fractional:true,places:'0,2'}\" ></input>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Fixed Renewal Price</td><td><input class=\"prmaxinput\" type=\"text\" name=\"fixed_renewalprice\" dojoType=\"dijit.form.CurrencyTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"fixed_renewalprice\" style=\"width:8em\" constraints=\"{min:0.01,max:99999.00,fractional:true,places:'0,2'}\" ></input>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Monthly Sales Price</td><td><input class=\"prmaxinput\" type=\"text\" name=\"monthly_salesprice\" dojoType=\"dijit.form.CurrencyTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"monthly_salesprice\" style=\"width:8em\" constraints=\"{min:0.00,max:99999.00,fractional:true,places:'0,2'}\" ></input>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Monthly Renewal Price</td><td><input class=\"prmaxinput\" type=\"text\" name=\"monthly_renewalprice\" dojoType=\"dijit.form.CurrencyTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"monthly_renewalprice\" style=\"width:8em\" constraints=\"{min:0.01,max:99999.00,fractional:true,places:'0,2'}\" ></input>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Concurrent Users</td><td><input class=\"prmaxinput\" type=\"text\" name=\"concurrentusers\" dojoType=\"dijit.form.NumberTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"concurrentusers\" style=\"width:5em\" constraints=\"{min:1,max:200}\" ></input>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Paid Months</td><td><input class=\"prmaxinput\" type=\"text\" name=\"paid_months\" dojoType=\"dijit.form.NumberTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"paid_months\" style=\"width:5em\" constraints=\"{min:1,max:50}\" ></input>\r\n\t\t\t\t<tr><td colspan=\"2\"><br/></td></tr>\r\n\t\t\t\t<tr><td><button type=\"button\" dojoAttachEvent=\"onClick:_Close\" dojoType=\"dijit.form.Button\" label=\"Close\" ></button></td><td align=\"right\"><button type=\"button\" dojoAttachPoint=\"addbtn\" dojoAttachEvent=\"onClick:_Add\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Adding ...\" label=\"Add Price Code\" ></button></td></tr>\r\n\t\t\t</table>\r\n\t\t</form>\r\n\t</div>\r\n\t<div dojoType=\"dijit.Dialog\" title=\"Update Price Code\" dojoAttachPoint=\"pricecodeupddialog\">\r\n\t\t<form dojoAttachPoint=\"formupd\"  onsubmit=\"return false\" dojoType=\"dijit.form.Form\">\r\n\t\t\t<input type=\"hidden\" dojoAttachPoint=\"pricecodeid\" name = \"pricecodeid\" dojoType=\"dijit.form.TextBox\" />\r\n\t\t\t<table style=\"width:500px;border-collapse:collapse;\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" width=\"150px\">New Price Code</td><td><input type=\"text\" required=\"true\" dojoAttachPoint=\"pricecodedescription2\" name = \"pricecodedescription\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:300px\" ></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Price Description</td><td><input type=\"text\" required=\"true\" dojoAttachPoint=\"pricecodelongdescription2\" name = \"pricecodelongdescription\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:300px\" ></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Module Type</td><td><select class=\"prmaxinput\" name=\"prmaxmoduleid\" dojoAttachPoint=\"prmaxmoduleid2\" style=\"width:10em\" dojoType=\"dijit.form.FilteringSelect\" autoComplete=\"true\" required=\"true\"></select>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Fixed Sales Price</td><td><input class=\"prmaxinput\" type=\"text\" name=\"fixed_salesprice\" dojoType=\"dijit.form.CurrencyTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"fixed_salesprice2\" style=\"width:8em\" constraints=\"{min:0.00,max:99999.00,fractional:true,places:'0,2'}\" ></input>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Fixed Renewal Price</td><td><input class=\"prmaxinput\" type=\"text\" name=\"fixed_renewalprice\" dojoType=\"dijit.form.CurrencyTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"fixed_renewalprice2\" style=\"width:8em\" constraints=\"{min:0.01,max:99999.00,fractional:true,places:'0,2'}\" ></input>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Monthly Sales Price</td><td><input class=\"prmaxinput\" type=\"text\" name=\"monthly_salesprice\" dojoType=\"dijit.form.CurrencyTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"monthly_salesprice2\" style=\"width:8em\" constraints=\"{min:0.00,max:99999.00,fractional:true,places:'0,2'}\" ></input>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >MOnthly Renewal Price</td><td><input class=\"prmaxinput\" type=\"text\" name=\"monthly_renewalprice\" dojoType=\"dijit.form.CurrencyTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"monthly_renewalprice2\" style=\"width:8em\" constraints=\"{min:0.01,max:99999.00,fractional:true,places:'0,2'}\" ></input>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Concurrent Users</td><td><input class=\"prmaxinput\" type=\"text\" name=\"concurrentusers\" dojoType=\"dijit.form.NumberTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"concurrentusers2\" style=\"width:5em\" constraints=\"{min:1,max:200}\" ></input>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Paid Months</td><td><input class=\"prmaxinput\" type=\"text\" name=\"paid_months\" dojoType=\"dijit.form.NumberTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"paid_months2\" style=\"width:5em\" constraints=\"{min:1,max:50}\" ></input>\r\n\t\t\t\t<tr><td colspan=\"2\"><br/></td></tr>\r\n\t\t\t\t<tr><td><button type=\"button\" dojoAttachEvent=\"onClick:_Close2\" dojoType=\"dijit.form.Button\" label=\"Close\" ></button></td><td align=\"right\"><button type=\"button\" dojoAttachPoint=\"updbtn\" dojoAttachEvent=\"onClick:_Update\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Updating ...\" label=\"Update Price Code\" ></button></td></tr>\r\n\t\t\t</table>\r\n\t\t</form>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._AddPriceCallBack=dojo.hitch(this,this._AddPriceCall);this._DeletePriceCallBack=dojo.hitch(this,this._DeletePriceCall);this._UpdatePriceCallBack=dojo.hitch(this,this._UpdatePriceCall);this._pricecodes=new prcommon.data.QueryWriteStore({url:"/iadmin/pricecodes",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true,nocallback:true});this._modules=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=prmaxmodules",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true});},postCreate:function(){this.inherited(arguments);this.view_grid.set("structure",this.view);this.view_grid._setStore(this._pricecodes);this.view_grid["onRowClick"]=dojo.hitch(this,this._OnSelectRow);this.prmaxmoduleid.store=this._modules;this.prmaxmoduleid2.store=this._modules;},_OnSelectRow:function(e){this._row=this.view_grid.getItem(e.rowIndex);if(e.cellIndex==9){if(confirm("Delete Price Code "+this._row.i.pricecodedescription+"?")){dojo.xhrPost(ttl.utilities.makeParams({load:this._DeletePriceCallBack,url:"/iadmin/pricecode_delete",content:{pricecodeid:this._row.i.pricecodeid}}));}}else{if(e.cellIndex==10){this.pricecodedescription2.set("value",this._row.i.pricecodedescription);this.pricecodelongdescription2.set("value",this._row.i.pricecodelongdescription);this.pricecodeid.set("value",this._row.i.pricecodeid);this.prmaxmoduleid2.set("value",this._row.i.prmaxmoduleid);this.fixed_salesprice2.set("value",this._row.i.fixed_salesprice);this.fixed_renewalprice2.set("value",this._row.i.fixed_renewalprice);this.monthly_salesprice2.set("value",this._row.i.monthly_salesprice);this.monthly_renewalprice2.set("value",this._row.i.monthly_renewalprice);this.concurrentusers2.set("value",this._row.i.concurrentusers);this.paid_months2.set("value",this._row.i.paid_months);this.pricecodeupddialog.show();}}this.view_grid.selection.clickSelectEvent(e);},view:{noscroll:false,cells:[[{name:"Price Code",width:"200px",field:"pricecodedescription"},{name:"Description",width:"200px",field:"pricecodelongdescription"},{name:"Module",width:"100px",field:"prmaxmoduledescription"},{name:"Fixed Renewal Price",width:"5em",field:"fixed_renewalprice",styles:"text-align: right;padding-right:2px;",formatter:ttl.utilities.Display_Money},{name:"Fixed Sales Price",width:"5em",field:"fixed_salesprice",styles:"text-align: right;padding-right:2px;",formatter:ttl.utilities.Display_Money},{name:"Monthly Renewal Price",width:"5em",field:"monthly_renewalprice",styles:"text-align: right;padding-right:2px;",formatter:ttl.utilities.Display_Money},{name:"Monthly Sales Price",width:"5em",field:"monthly_salesprice",styles:"text-align: right;padding-right:2px;",formatter:ttl.utilities.Display_Money},{name:"Con. Users",width:"5em",field:"concurrentusers",styles:"text-align: right;padding-right:2px;"},{name:"Paid Months",width:"5em",field:"paid_months",styles:"text-align: right;padding-right:2px;"},{name:" ",width:"2em",field:"pricecodeid",formatter:ttl.utilities.deleteRowCtrl},{name:" ",width:"2em",field:"pricecodeid",formatter:ttl.utilities.formatRowCtrl}]]},resize:function(){this.borderControl.resize(arguments[0]);this.inherited(arguments);},_New:function(){this.pricecodedescription.set("value","");this.pricecodelongdescription.set("value","");this.prmaxmoduleid.set("value",1);this.fixed_salesprice.set("value",0);this.fixed_renewalprice.set("value",0);this.monthly_salesprice.set("value",0);this.monthly_renewalprice.set("value",0);this.concurrentusers.set("value",1);this.paid_months.set("value",12);this.pricecodedialog.show();this.pricecodedescription.focus();},_Close:function(){this.pricecodedialog.hide();},_Add:function(){if(ttl.utilities.formValidator(this.form)==false){this.addbtn.cancel();return false;}dojo.xhrPost(ttl.utilities.makeParams({load:this._AddPriceCallBack,url:"/iadmin/pricecode_add",content:this.form.get("value")}));},_AddPriceCall:function(_1){if(_1.success=="OK"){this._pricecodes.newItem(_1.data);this._Close();this.pricecodedescription.set("value","");this.pricecodelongdescription.set("value","");}else{if(_1.success=="DU"){alert("Already exists");}else{alert("Problem Adding");}}this.addbtn.cancel();},_DeletePriceCall:function(_2){if(_2.success=="OK"){this._pricecodes.deleteItem(this._row);}else{alert("Problem Deleting (Probably in use)");}},_UpdatePriceCall:function(_3){if(_3.success=="OK"){this._pricecodes.setValue(this._row,"pricecodedescription",_3.data.pricecodedescription,true);this._pricecodes.setValue(this._row,"pricecodelongdescription",_3.data.pricecodelongdescription,true);this._pricecodes.setValue(this._row,"prmaxmoduledescription",_3.data.prmaxmoduledescription,true);this._pricecodes.setValue(this._row,"fixed_salesprice",_3.data.fixed_salesprice,true);this._pricecodes.setValue(this._row,"fixed_renewalprice",_3.data.fixed_renewalprice,true);this._pricecodes.setValue(this._row,"monthly_salesprice",_3.data.monthly_salesprice,true);this._pricecodes.setValue(this._row,"monthly_renewalprice",_3.data.monthly_renewalprice,true);this._pricecodes.setValue(this._row,"concurrentusers",_3.data.concurrentusers,true);this._pricecodes.setValue(this._row,"paid_months",_3.data.paid_months,true);this._Close2();}else{if(_3.success=="DU"){alert("Already Exists");this.pricecodedescription2.focus();}else{alert("Problem Adding");}}this.updbtn.cancel();},_Update:function(){if(ttl.utilities.formValidator(this.formupd)==false){this.updbtn.cancel();return false;}dojo.xhrPost(ttl.utilities.makeParams({load:this._UpdatePriceCallBack,url:"/iadmin/pricecode_update",content:this.formupd.get("value")}));},_Close2:function(){this.pricecodeupddialog.hide();}});}