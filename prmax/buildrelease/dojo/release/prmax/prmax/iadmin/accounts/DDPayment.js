/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.accounts.DDPayment"]){dojo._hasResource["prmax.iadmin.accounts.DDPayment"]=true;dojo.provide("prmax.iadmin.accounts.DDPayment");dojo.require("ttl.BaseWidget");dojo.declare("prmax.iadmin.accounts.DDPayment",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n<form dojoAttachPoint=\"form\"  onsubmit=\"return false\" dojoType=\"dijit.form.Form\">\r\n<table width=\"600px\" cellpadding=\"0\" cellpadding=\"0\" >\r\n\t<tr><td colspan=\"4\"><div class=\"prmaxrowdisplaylarge\" style=\"text-align:center;display:inline\">Monthly Payment (Inc Vat.)</div><div class=\"prmaxrowdisplaylarge\" style=\"display:inline\" dojoAttachPoint=\"customername\"></div></td>\r\n\t<tr><td class=\"prmaxrowlabel\" align=\"right\">DD Reference</td><td><input type=\"text\" name=\"dd_ref\" dojoType=\"dijit.form.ValidationTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"dd_ref\"></input></td></tr>\r\n\t<tr><td class=\"prmaxrowlabel\" align=\"right\">First Month Amount(Inc Vat.)</td><td><input type=\"text\" name=\"first_month_value\" dojoType=\"dijit.form.CurrencyTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"first_month_value\"></input></td></tr>\r\n\t<tr><td class=\"prmaxrowlabel\" align=\"right\">Standard Amount (Inc Vat.)</td><td><input type=\"text\" name=\"value\" dojoType=\"dijit.form.CurrencyTextBox\" required=\"true\" trim=\"true\" dojoAttachPoint=\"payment\"></input></td></tr>\r\n\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Monthly Day</td><td width=\"70%\"><select style=\"width:50px\" class=\"prmaxinput\" dojoAttachPoint=\"pay_montly_day\" name=\"pay_montly_day\" type=\"text\" dojoType=\"dijit.form.ComboBox\"></select></td></tr>\r\n\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Sub Day of Month</td><td width=\"70%\"><select style=\"width:50px\" class=\"prmaxinput\" dojoAttachPoint=\"sub_start_day\" name=\"sub_start_day\" type=\"text\" dojoType=\"dijit.form.ComboBox\"></select></td></tr>\r\n\t<tr><td class=\"prmaxrowlabel\" align=\"right\" valign=\"top\">Message</td><td><div class=\"dialogprofileframe\" ><textarea dojoAttachPoint=\"message\" name=\"message\" class=\"dijitTextarea\" dojoType=\"dijit.form.Textarea\"  style=\"width:99%;height:99%\" ></textarea></div></td></tr>\r\n\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Email Address</td><td><input class=\"prmaxinput\" dojoAttachPoint=\"email\" name=\"email\" type=\"text\" style=\"width:100%\" trim=\"true\" required=\"true\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.emailAddress\" trim=\"true\" invalidMessage=\"invalid email address\" size=\"40\" maxlength=\"70\"/></td></tr>\r\n\t<tr><td class=\"prmaxrowlabel\" align=\"right\" >Collection Date</td><td><input type=\"text\" dojoAttachPoint=\"dd_collectiondate\" name = \"dd_collectiondate\" dojoType=\"dijit.form.DateTextBox\" required=\"true\" ></td>\r\n\t</tr>\r\n\t<tr><td class=\"prmaxrowlabel\" colspan=\"4\" align=\"right\"><button dojoType=\"dijit.form.Button\" type=\"button\" dojoAttachEvent=\"onClick:_TakePayment\">Take Payment</button></td>\r\n</table></form>\r\n</div>\r\n",constructor:function(){this._PaymentTakenCallBack=dojo.hitch(this,this._PaymentTakenCall);this._daysofmonth=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=daysofmonth"});},postCreate:function(){this.pay_montly_day.store=this._daysofmonth;this.sub_start_day.store=this._daysofmonth;this.inherited(arguments);},setCustomer:function(_1,_2,_3,_4,_5){this._customerid=_1;this._customername=_2;dojo.attr(this.customername,"innerHTML",this._customername);this.email.set("value",_3);this._dialog=_4;this.payment.set("value",_5);this.first_month_value.set("value",_5);},_PaymentTakenCall:function(_6){if(_6.success=="OK"){alert("Payment Taken and invoice sent");this.Clear();dojo.publish(PRCOMMON.Events.Monthly_Payments,[_6.data]);this._dialog.hide();}else{alert("Problem taking payment");}},_TakePayment:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");return false;}var _7=this.form.get("value");var d=this.dd_collectiondate.get("value");if(d!=null){_7["dd_collectiondate"]=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();}_7["icustomerid"]=this._customerid;dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._PaymentTakenCallBack),url:"/iadmin/payment_dd_first",content:_7}));},Clear:function(){this.payment.set("value","");this.first_month_value.set("value","");this.email.set("value","");}});}