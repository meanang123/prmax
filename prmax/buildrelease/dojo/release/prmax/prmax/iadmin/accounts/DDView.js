/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.accounts.DDView"]){dojo._hasResource["prmax.iadmin.accounts.DDView"]=true;dojo.provide("prmax.iadmin.accounts.DDView");dojo.require("ttl.BaseWidget");dojo.declare("prmax.iadmin.accounts.DDView",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div dojoAttachPoint=\"frame\" dojoType=\"dijit.layout.BorderContainer\" gutters=\"false\" >\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" preload=\"true\" region=\"top\" style=\"width:100%;height:40px\">\r\n\t\t\t<div style=\"height:40px;width:100%;overflow:hidden\" class=\"searchresults\">\r\n\t\t\t\t<div class=\"dijitToolbarTop\" dojoType=\"dijit.Toolbar\" style=\"float:left:height:100%;width:99%\" >\r\n\t\t\t\t\t<div dojoType=\"dijit.form.Button\" iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" showLabel=\"true\" dojoAttachEvent=\"onClick:_DD_Refresh\">Refresh</div>\r\n\t\t\t\t\t<div dojoType=\"dijit.form.Button\" iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" showLabel=\"true\" dojoAttachEvent=\"onClick:_DD_Show_All\" dojoAttachPoint=\"dd_show_all\">Only Not Paid</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojoAttachPoint=\"ddgrid\" dojoType=\"dojox.grid.DataGrid\" region=\"center\" query=\"{ name:'*'}\" rowsPerPage=\"50\" structure=\"PRMAX.iadmin.gridlayout.dd_view\"></div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){dojo.subscribe(PRCOMMON.Events.Monthly_Payments,dojo.hitch(this,this._Monthly_Payment_Event));this.dd_data=new prcommon.data.QueryWriteStore({url:"/iadmin/customer_monthlies",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true,nocallback:true});},postCreate:function(){this.inherited(arguments);this.ddgrid.set("structure",this._view);this.ddgrid._setStore(this.dd_data);this.ddgrid["onCellClick"]=dojo.hitch(this,this._OnDDClick);},resize:function(){this.frame.resize(arguments[0]);this.inherited(arguments);},_DD_Refresh:function(){this.ddgrid.setQuery(dojo.mixin(ttl.utilities.getPreventCache(),{showall:this._show_all}));},_DD_Show_All:function(){this._show_all=this._show_all==0?1:0;this.dd_show_all.set("label",this._show_all==1?"Show All Monthlies":"Only Not Paid");this.ddgrid.setQuery(dojo.mixin(ttl.utilities.getPreventCache(),{showall:this._show_all}));},_OnDDClick:function(e){if(e.cellIndex==6){this._row=this.ddgrid.getItem(e.rowIndex);if(this._row.i.paymentmethodid==3){this.monthlypaymentctrl.setCustomer(this._row.i.customerid,this._row.i.customername,this._row.i.email,this.monthlypaymentdialog,this._row.i.pay_monthly_value);this.monthlypaymentdialog.show();}else{this.ddpaymentctrl.setCustomer(this._row.i.customerid,this._row.i.customername,this._row.i.email,this.ddpaymentdialog,this._row.i.pay_monthly_value);this.ddpaymentdialog.show();}}},_Monthly_Payment_Event:function(_1){this.dd_data.setValue(this._row,"last_paid_display",_1.last_paid_display,true);},_view:{noscroll:false,cells:[[{name:"Name",width:"30em",field:"customername"},{name:"Payment Method",width:"12em",field:"paymentmethodname"},{name:"Financial Status",width:"12em",field:"financialstatusdescription"},{name:"Expire Date",width:"7em",field:"licence_expire"},{name:"Last Paid",width:"10em",field:"last_paid_display"},{name:"Payment (Ex Vat)",width:"8em",field:"pay_monthly_value",styles:"text-align: right;"},{name:" ",width:"2em",formatter:ttl.utilities.formatRowCtrl}]]}});}