/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.TaskTags"]){dojo._hasResource["prmax.iadmin.TaskTags"]=true;dojo.provide("prmax.iadmin.TaskTags");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("ttl.BaseWidget");dojo.declare("prmax.iadmin.TaskTags",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div dojoAttachPoint=\"borderControl\" dojotype=\"dijit.layout.BorderContainer\" style=\"width:100%;height:100%\" gutters=\"false\">\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"top\" style=\"height:42px;width:100%;overflow:hidden;border:1px solid black\">\r\n\t\t\t<div class=\"dijitToolbarTop\" dojoType=\"dijit.Toolbar\" style=\"float:left:height:100%;width:100%\" >\r\n\t\t\t\t<div dojoType=\"dijit.form.Button\" iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" dojoAttachEvent=\"onClick:_New\" showLabel=\"true\">New</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojotype=\"dijit.layout.ContentPane\" region=\"center\"  splitter=\"true\">\r\n\t\t\t<div dojoAttachPoint=\"view_grid\" dojoType=\"dojox.grid.DataGrid\" query=\"{ }\" rowsPerPage=\"30\" ></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div dojoType=\"dijit.Dialog\" title=\"New Diary Type\" dojoAttachPoint=\"tasktagdialog\">\r\n\t\t<form dojoAttachPoint=\"form\" onsubmit=\"return false\" dojoType=\"dijit.form.Form\">\r\n\t\t\t<input type=\"hidden\" dojoAttachPoint=\"group2\" name = \"group\" dojoType=\"dijit.form.TextBox\" />\r\n\t\t\t<table style=\"width:400px;border-collapse:collapse;\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" width=\"90px\">Diary Type</td><td><input type=\"text\" required=\"true\" dojoAttachPoint=\"tasktagdescription\" name = \"tasktagdescription\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:300px\" ></td></tr>\r\n\t\t\t\t<tr><td colspan=\"2\"><br/></td></tr>\r\n\t\t\t\t<tr><td><button type=\"button\" dojoAttachEvent=\"onClick:_Close\" dojoType=\"dijit.form.Button\" label=\"Close\" ></button></td><td align=\"right\"><button type=\"button\" dojoAttachPoint=\"addbtn\" dojoAttachEvent=\"onClick:_Add\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Adding ...\" label=\"Add Diary Type\" ></button></td></tr>\r\n\t\t\t</table>\r\n\t\t</form>\r\n\t</div>\r\n\t<div dojoType=\"dijit.Dialog\" title=\"Update Diary Type\" dojoAttachPoint=\"tasktagupddialog\">\r\n\t\t<form dojoAttachPoint=\"formupd\"  onsubmit=\"return false\" dojoType=\"dijit.form.Form\">\r\n\t\t\t<input type=\"hidden\" dojoAttachPoint=\"tasktagid\" name = \"tasktagid\" dojoType=\"dijit.form.TextBox\" />\r\n\t\t\t<input type=\"hidden\" dojoAttachPoint=\"group1\" name = \"group\" dojoType=\"dijit.form.TextBox\" />\r\n\t\t\t<table style=\"width:400px;border-collapse:collapse;\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" width=\"90px\">New Diary Type</td><td><input type=\"text\" required=\"true\" dojoAttachPoint=\"tasktagdescription2\" name = \"tasktagdescription\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:300px\" ></td></tr>\r\n\t\t\t\t<tr><td colspan=\"2\"><br/></td></tr>\r\n\t\t\t\t<tr><td><button type=\"button\" dojoAttachEvent=\"onClick:_Close2\" dojoType=\"dijit.form.Button\" label=\"Close\" ></button></td><td align=\"right\"><button type=\"button\" dojoAttachPoint=\"updbtn\" dojoAttachEvent=\"onClick:_Update\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Updating ...\" label=\"Update Diary Type\" ></button></td></tr>\r\n\t\t\t</table>\r\n\t\t</form>\r\n\t</div>\r\n</div>\r\n",group:"accounts",constructor:function(){this._AddTaskCallBack=dojo.hitch(this,this._AddTaskCall);this._DeleteTaskCallBack=dojo.hitch(this,this._DeleteTaskCall);this._UpdateTaskCallBack=dojo.hitch(this,this._UpdateTaskCall);this._tasktags=new prcommon.data.QueryWriteStore({url:"/iadmin/tasktags?group="+this.group,onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true,nocallback:true});},postCreate:function(){this.inherited(arguments);this.view_grid.set("structure",this.view);this.view_grid._setStore(this._tasktags);this.view_grid["onRowClick"]=dojo.hitch(this,this._OnSelectRow);this.group1.set("value",this.group);this.group2.set("value",this.group);},_OnSelectRow:function(e){this._row=this.view_grid.getItem(e.rowIndex);if(e.cellIndex==1){if(confirm("Delete Diary Type "+this._row.i.tasktagdescription+"?")){dojo.xhrPost(ttl.utilities.makeParams({load:this._DeleteTaskCallBack,url:"/iadmin/tasktags_delete",content:{tasktagid:this._row.i.tasktagid}}));}}else{if(e.cellIndex==2){this.tasktagdescription2.set("value",this._row.i.tasktagdescription);this.tasktagid.set("value",this._row.i.tasktagid);this.tasktagupddialog.show();}}this.view_grid.selection.clickSelectEvent(e);},view:{noscroll:false,cells:[[{name:"Diary Type",width:"400px",field:"tasktagdescription"},{name:" ",width:"2em",field:"tasktagid",formatter:ttl.utilities.deleteRowCtrl},{name:" ",width:"2em",field:"tasktagid",formatter:ttl.utilities.formatRowCtrl}]]},resize:function(){this.borderControl.resize(arguments[0]);this.inherited(arguments);},_New:function(){this.tasktagdescription.set("value","");this.tasktagdialog.show();this.tasktagdescription.focus();},_Close:function(){this.tasktagdialog.hide();},_Add:function(){if(ttl.utilities.formValidator(this.form)==false){this.addbtn.cancel();return false;}dojo.xhrPost(ttl.utilities.makeParams({load:this._AddTaskCallBack,url:"/iadmin/tasktags_add",content:this.form.get("value")}));},_AddTaskCall:function(_1){if(_1.success=="OK"){this._tasktags.newItem(_1.data);this._Close();this.tasktagdescription.set("value","");}else{if(_1.success=="DU"){alert("Already exists");}else{alert("Problem Adding");}}this.addbtn.cancel();},_DeleteTaskCall:function(_2){if(_2.success=="OK"){this._tasktags.deleteItem(this._row);}else{alert("Problem Deleting (Probably in use)");}},_UpdateTaskCall:function(_3){if(_3.success=="OK"){this._tasktags.setValue(this._row,"tasktagdescription",_3.data.tasktagdescription,true);this._Close2();}else{if(_3.success=="DU"){alert("Already Exists");this.tasktagdescription2.focus();}else{alert("Problem Adding");}}this.updbtn.cancel();},_Update:function(){if(ttl.utilities.formValidator(this.formupd)==false){this.updbtn.cancel();return false;}dojo.xhrPost(ttl.utilities.makeParams({load:this._UpdateTaskCallBack,url:"/iadmin/tasktags_update",content:this.formupd.get("value")}));},_Close2:function(){this.tasktagupddialog.hide();}});}