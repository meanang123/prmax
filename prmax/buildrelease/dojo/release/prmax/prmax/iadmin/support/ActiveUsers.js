/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.support.ActiveUsers"]){dojo._hasResource["prmax.iadmin.support.ActiveUsers"]=true;dojo.provide("prmax.iadmin.support.ActiveUsers");dojo.require("ttl.BaseWidget");dojo.declare("prmax.iadmin.support.ActiveUsers",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t\t<div dojoAttachPoint=\"frame\" dojotype=\"dijit.layout.BorderContainer\" gutters=\"false\" title=\"Active Users\" style=\"width:100%;height:100%;overflow: hidden\" >\r\n\t\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"top\" style=\"width:100%\">\r\n\t\t\t\t<div style=\"height:40px;width:100%;overflow:hidden\" class=\"searchresults\">\r\n\t\t\t\t\t<div style=\"height:100%;width:15%;float:left;\" dojoAttachPoint=\"activeusers_time\" class=\"dijitToolbar prmaxrowdisplaylarge\">Time</div>\r\n\t\t\t\t\t\t<div class=\"dijitToolbarTop\" dojoType=\"dijit.Toolbar\" style=\"float:left;height:100%;width:83%\" >\r\n\t\t\t\t\t\t\t<div dojoType=\"dijit.form.Button\" iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" showLabel=\"true\" dojoAttachEvent=\"onClick:_ActiveUsers_Refresh\">Refresh</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t<div  dojoType=\"dijit.layout.ContentPane\" region=\"center\" >\r\n\t\t\t\t<div dojoAttachPoint=\"activeusers\" dojoType=\"dojox.grid.DataGrid\" query=\"{ name:'*'}\" rowsPerPage=\"50\" ></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n</div>\r\n",constructor:function(){this.activeusers_data=new prcommon.data.QueryWriteStore({url:"/iadmin/activeusers",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,nocallback:true,urlPreventCache:true});},postCreate:function(){this.inherited(arguments);this.activeusers.set("structure",this._view);this.activeusers._setStore(this.activeusers_data);this.activeusers["onCellClick"]=dojo.hitch(this,this._OnActiveUser);},resize:function(){this.inherited(arguments);this.frame.resize(arguments[0]);},_UserLoggedOffCall:function(_1){if(_1.success=="OK"){this.activeusers_data.deleteItem(this._useractiverow);}},_OnActiveUser:function(e){if(e.cellIndex==3&&confirm("Log User off System")==true){this._useractiverow=this.activeusers.getItem(e.rowIndex);dojo.xhrPost(ttl.utilities.makeParams({load:this._UserLoggedOffCallBack,url:"/customers/logoff_user",content:{old_user_id:this._useractiverow.i.user_id}}));}},_ActiveUsers_Refresh:function(){this.activeusers.setQuery(ttl.utilities.getPreventCache());this._SetTime(this.activityview_time);},_SetTime:function(_2){dojo.attr(_2,"innerHTML",new Date().toString());},_view:{noscroll:false,cells:[[{name:"Expires",width:"auto",field:"expiry"},{name:"User Name",width:"auto",field:"user_name"},{name:"Customer",width:"auto",field:"customername"},{Name:"Logoff",width:"100px"}]]}});}