/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.support.seo.view"]){dojo._hasResource["prmax.iadmin.support.seo.view"]=true;dojo.provide("prmax.iadmin.support.seo.view");dojo.require("prmax.pressrelease.seo.edit");dojo.declare("prmax.iadmin.support.seo.view",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div  data-dojo-attach-point=\"borderControl\" data-dojo-type=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:100%;overflow: hidden\" data-dojo-props=\"gutters:false\">\r\n\t\t<div  data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props=\"region:'left',splitter:true,'class':'bordered',style:'height:100%;width:40%',gutters:false\">\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-attach-point=\"controls\" data-dojo-props='region:\"top\",style:\"height:42px;width:100%;overflow:hidden\"'>\r\n\t\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='style:\"height:99%;width:100%;padding:0px;margin:0px\"'>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\"  data-dojo-props='iconClass:\"PRMaxStdIcon PRMaxFilterIcon\",label:\"Filter SEO List\",showLabel:false'>\r\n\t\t\t\t\t\t<span></span>\r\n\t\t\t\t\t\t<div data-dojo-type=\"dijit.TooltipDialog\" data-dojo-props='title:\"Filter By\"' data-dojo-attach-event=\"execute:_ExecuteFilter\">\r\n\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t<tr><td>Status</td><td><select data-dojo-props='name:\"seostatusid\",autoComplete:true,searchAttr:\"name\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"filter_seostatusid\" ></select></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td>Headline</td><td><input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"filter_headline\" data-dojo-props='name:\"headline\",type:\"text\"' ></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td>Customer</td><td><select data-dojo-props='name:\"icustomerid\", autoComplete:true, required:true, labelType:\"html\", searchAttr:\"customername\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"filter_icustomerid\" ></select></td></tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td align=\"left\"><button data-dojo-attach-event=\"onClick: _ClearFilter\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\"' >Clear Filter</button></td>\r\n\t\t\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"submit\",name:\"submit\"'>Filter</button></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"center\"'>\r\n\t\t\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='style:\"height:100%;width:100%\",rowsPerPage:50'></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-attach-point=\"seopanel\" data-dojo-type=\"dijit.layout.StackContainer\" data-dojo-props='region:\"center\",splitter:true'>\r\n\t\t\t<div data-dojo-attach-point=\"seopanel_blank\" data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='selected:\"selected\",title:\"blank\"' ></div>\r\n\t\t\t<div data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-attach-point=\"seopanel_edit\" data-dojo-props='style:\"height:100%;width:100%\",gutters:false,title:\"Edit\"'>\r\n\t\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"top\",style:\"width:100%;height:42px\"'>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='style:\"height:99%;width:100%;padding:0px;margin:0px\"'>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Delete\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"PRMaxStdIcon PRMaxDeleteIcon\",label:\"Delete the SEO release\",showLabel:false'></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Withdraw\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"PRMaxStdIcon PRMaxWithDrawIcon\",label:\"Withdraw SEO release\",showLabel:false' data-dojo-attach-point=\"withdrawbtn\"></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Update\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"PRMaxStdIcon PRMaxUpdateIcon\",label:\"Update SEO\",showLabel:false'></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Publish\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='\"class\":\"prmaxhidden\",iconClass:\"PRMaxStdIcon PRMaxPublishIcon\",label:\"Re-Publish and SEO\",showLabel:false' data-dojo-attach-point=\"publishbtn\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"center\"'>\r\n\t\t\t\t\t<div data-dojo-type=\"prmax.pressrelease.seo.edit\" data-dojo-attach-point=\"seo_edit_ctrl\" data-dojo-props='style:\"width:100%;height:100%\", isinternal:true'></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.seo_model=new prcommon.data.QueryWriteStore({url:"/iadmin/seo/seo_list",onError:ttl.utilities.globalerrorchecker,nocallback:true});this._DeleteCallBack=dojo.hitch(this,this._DeleteCall);this._WithdrawCallBack=dojo.hitch(this,this._WithdrawCall);this._PublishCallBack=dojo.hitch(this,this._PublishCall);this._seostatus_data=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=seostatus&nofilter="});this._icustomerid_data=new dojox.data.QueryReadStore({url:"/iadmin/customers_combo",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true});},postCreate:function(){this.grid.set("structure",this.view);this.grid._setStore(this.seo_model);this.grid["onCellClick"]=dojo.hitch(this,this._OnCellClick2);this.filter_seostatusid.set("store",this._seostatus_data);this.filter_seostatusid.set("value",-1);this.filter_icustomerid.set("store",this._icustomerid_data);this.filter_icustomerid.set("value",-2);this.inherited(arguments);},_OnCellClick2:function(e){this.grid.selection.clickSelectEvent(e);this._row2=this.grid.getItem(e.rowIndex);this.seo_edit_ctrl.LoadSeo(this._row2.i.seoreleaseid);this.seopanel.selectChild(this.seopanel_edit);if(this._row2.i.seostatusid==3||this._row2.i.seostatusid==4){dojo.removeClass(this.publishbtn.domNode,"prmaxhidden");dojo.addClass(this.withdrawbtn.domNode,"prmaxhidden");}else{dojo.addClass(this.publishbtn.domNode,"prmaxhidden");dojo.removeClass(this.withdrawbtn.domNode,"prmaxhidden");}},view:{cells:[[{name:"C Id",width:"60px",field:"customerid"},{name:"Customer",width:"120px",field:"customername"},{name:"Seo Name",width:"auto",field:"headline"},{name:"Status",width:"150px",field:"seostatusdescription"},{name:"Published",width:"100px",field:"published_display"}]]},resize:function(){this.borderControl.resize(arguments[0]);},_Refresh:function(){this.grid.setQuery({});},_ClearFilter:function(){this.filter_headline.set("value","");this.filter_seostatusid.set("value","-1");this.filter_icustomerid.set("value","-2");this.grid.setQuery({});this.seopanel.selectChild(this.seopanel_blank);},_ExecuteFilter:function(){var _1={};if(arguments[0].seostatusid!="-2"){_1["seostatusid"]=arguments[0].seostatusid;}if(arguments[0].headline){_1["headline"]=arguments[0].headline;}if(arguments[0].icustomerid&&arguments[0].icustomerid!=-1){_1["icustomerid"]=arguments[0].icustomerid;}this.grid.setQuery(_1);},_DeleteCall:function(_2){if(_2.success=="OK"){this.seopanel.selectChild(this.seopanel_blank);this.seo_model.deleteItem(this._row2);dojo.removeClass(this.publishbtn.domNode,"prmaxhidden");dojo.addClass(this.withdrawbtn.domNode,"prmaxhidden");}},_Delete:function(){if(confirm("Delete SEO")){dojo.xhrPost(ttl.utilities.makeParams({load:this._DeleteCallBack,url:"/iadmin/seo/seo_delete",content:{seoreleaseid:this._row2.i.seoreleaseid}}));}},_WithdrawCall:function(_3){if(_3.success=="OK"){this.seopanel.selectChild(this.seopanel_blank);this.seo_model.setValue(this._row2,"seostatusdescription","PRmax Withdrawn",true);dojo.removeClass(this.publishbtn.domNode,"prmaxhidden");dojo.addClass(this.withdrawbtn.domNode,"prmaxhidden");}},_Withdraw:function(){if(confirm("Withdraw SEO")){dojo.xhrPost(ttl.utilities.makeParams({load:this._WithdrawCallBack,url:"/iadmin/seo/seo_withdraw",content:{seoreleaseid:this._row2.i.seoreleaseid}}));}},_Update:function(){},_Publish:function(){}});}