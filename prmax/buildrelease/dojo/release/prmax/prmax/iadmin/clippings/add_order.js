/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.clippings.add_order"]){dojo._hasResource["prmax.iadmin.clippings.add_order"]=true;dojo.provide("prmax.iadmin.clippings.add_order");dojo.require("ttl.BaseWidget");dojo.require("prcommon.search.Countries");dojo.require("prcommon.languages.Languages");dojo.require("prcommon.clippings.clippingstype");dojo.require("prmax.customer.clients.add");dojo.require("prcommon.search.std_search");dojo.declare("prmax.iadmin.clippings.add_order",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='\"class\":\"scrollpanel\",style:\"width:1000px;height:700px\"'>\r\n\t\t<form data-dojo-attach-point=\"form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='onSubmit:\"return false\",\"class\":\"common_prmax_layout\"'>\r\n\t\t\t<div style=\"height:155px;width:49%;float:left;padding:0px;margin:0px\">\r\n\t\t\t\t<input data-dojo-attach-point=\"icustomerid\" data-dojo-props='value:\"\",name:\"icustomerid\",type:\"hidden\"' data-dojo-type=\"dijit.form.TextBox\"/>\r\n\t\t\t\t<label class=\"label_2\">Source</label><select data-dojo-attach-point=\"clippingsourceid\" data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-props='name:\"clippingsourceid\",autoComplete:true,style:\"width:8em\"' data-dojo-attach-event=\"onChange:_change_source\"></select><br/>\r\n\t\t\t\t<label class=\"label_2\">Description</label><input data-dojo-attach-point=\"description\" data-dojo-props='name:\"description\",type:\"text\",required:true,trim:true' data-dojo-type=\"dijit.form.ValidationTextBox\" /><br/>\r\n\t\t\t\t<label class=\"label_2\">Start Date</label><input data-dojo-props='name:\"startdate\",style:\"width:8em\",type:\"text\",required:true' data-dojo-attach-point=\"startdate\" data-dojo-type=\"dijit.form.DateTextBox\"/><br/>\r\n\t\t\t\t<label class=\"label_2\">End Date</label><input data-dojo-props='name:\"enddate\",style:\"width:8em\",type:\"text\",required:true, readOnly:true' data-dojo-attach-point=\"enddate\" data-dojo-type=\"dijit.form.DateTextBox\"/><br/>\r\n\t\t\t\t<label class=\"label_2\">Keywords</label><input data-dojo-attach-point=\"keywords\" data-dojo-props='name:\"keywords\",type:\"text\",required:true,trim:true,style:\"width:20em\"' data-dojo-type=\"dijit.form.ValidationTextBox\"/><br/>\r\n\t\t\t\t<label class=\"label_2\">RSS Feed</label><input data-dojo-attach-point=\"rss_feed\" data-dojo-props='name:\"rss_feed\",type:\"text\",required:false, trim:true,style:\"width:20em\"' data-dojo-type=\"dijit.form.ValidationTextBox\"/><br/>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"height:155px;width:49%;float:right;padding:0px;margin:0px\">\r\n\t\t\t\t<label class=\"label_2\">Price Band</label><select data-dojo-props='name:\"clippingspriceid\",autoComplete:true,searchAttr:\"description\",labelType:\"html\",required:true' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clippingspriceid\" ></select><br/>\r\n\t\t\t\t<label class=\"label_2\">Price Code</label><select data-dojo-attach-point=\"pricecodeid\" data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-props='name:\"pricecodeid\",autoComplete:true,style:\"width:8em\"'></select><br/>\r\n\t\t\t\t<label class=\"label_2\">Purchase Order</label><input data-dojo-attach-point=\"purchaseorder\" data-dojo-props='name:\"purchaseorder\",type:\"text\",required:false,trim:true,style:\"width:12em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" /><br/>\r\n\t\t\t\t<label class=\"label_2\">Client</label><select data-dojo-props='name:\"clientid\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\",required:false' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clientid\" data-dojo-attach-event=\"onChange:_client_change\"></select>\r\n\t\t\t\t\t<button data-dojo-attach-event=\"onClick: _New_Client\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",\"class\":\"prmaxdefault\"' >New</button><br/>\r\n\t\t\t\t<label class=\"label_2\">Campaign</label><select data-dojo-props='name:\"issueid\",autoComplete:true,searchAttr:\"name\",labelType:\"html\",required:false' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"issueid\"></select><br/>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"height:20px;width:100%;float:left;padding:0px;margin:0px\"><hr/></div>\r\n\t\t\t<div style=\"height:160px;width:49%;float:left;padding:0px;margin:0px\">\r\n\t\t\t\t<div data-dojo-attach-point=\"countries\" data-dojo-props='style:\"width:450px\",name:\"countries\", selectonly:true, startopen:true' data-dojo-type=\"prcommon.search.Countries\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"height:160px;width:49%;float:right;padding:0px;margin:0px\">\r\n\t\t\t\t<div data-dojo-attach-point=\"languages\" data-dojo-props='style:\"width:450px\",name:\"languages\"' data-dojo-type=\"prcommon.languages.Languages\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"height:20px;width:100%;float:left;padding:0px;margin:0px\"><br/></div>\r\n\t\t\t<div style=\"height:160px;width:100%;float:left;padding:0px;margin:0px\" data-dojo-attach-point=\"clippingstypes_node\">\r\n\t\t\t\t<div data-dojo-attach-point=\"clippingstypes\" data-dojo-props='style:\"width:450px\",name:\"clippingstypes\"' data-dojo-type=\"prcommon.clippings.clippingstype\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"height:20px;width:100%;float:left;padding:0px;margin:0px\"><hr/></div>\r\n\t\t\t<div style=\"height:100px;width:100%\">\r\n\t\t\t\t<label class=\"label_2\">Message</label><div class=\"stdframe\" style=\"height:50px\" ><textarea data-dojo-attach-point=\"message\" data-dojo-props='name:\"message\",trim:true,style:\"width:99%;height:50px\"' data-dojo-type=\"dijit.form.Textarea\" ></textarea></div><br/>\r\n\t\t\t\t<button data-dojo-attach-event=\"onClick:_close\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Close\",style:\"float:left\"'></button>\r\n\t\t\t\t<button data-dojo-attach-event=\"onClick:_add\" data-dojo-attach-point=\"addbtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Adding...\",label:\"Create Order\",\"class\":\"btnright\"'></button>\r\n\t\t\t</div>\r\n\t\t</form>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-attach-point=\"client_add_dialog\" data-dojo-props='title:\"Add New Client\",style:\"width:700px;height:600px\"'>\r\n\t\t<div data-dojo-type=\"prmax.customer.clients.add\" data-dojo-attach-point=\"client_add_ctrl\"></div>\r\n\t</div>\t\r\n</div>\r\n\r\n",constructor:function(){this._add_call_back=dojo.hitch(this,this._add_call);this._Client_Add_Call_Back=dojo.hitch(this,this._Client_Add_Call);this._clippings_orders_model=new dojox.data.JsonRestStore({target:"/iadmin/clippings/list_clippingsprices",idAttribute:"clippingspriceid"});this._clients=new dojox.data.JsonRestStore({target:"/iadmin/clippings/list_clients",idAttribute:"clientid"});this._issues=new dojox.data.JsonRestStore({target:"/iadmin/clippings/list_issues",idAttribute:"issueid"});this._pricecodes=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=pricecodes&type=clippings"});this._sources=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=clippingsource"});},postCreate:function(){this.clippingspriceid.set("store",this._clippings_orders_model);this.clientid.set("store",this._clients);this.issueid.set("store",this._issues);this.pricecodeid.set("store",this._pricecodes);this.clippingsourceid.set("store",this._sources);this._clear();this.inherited(arguments);},load:function(_1,_2,_3){this._dialog=_1;this.icustomerid.set("value",_2);this._icustomerid=_2;this.clientid.set("query",{icustomerid:_2});this.issueid.set("query",{icustomerid:_2});this._dialog.resize({w:1010,h:700});},_close:function(){this._dialog.hide();},_add_call:function(_4){if(_4.success=="OK"){this._dialog.hide();this._clear();dojo.publish("/clippings/order/add",[_4.data]);}else{alert("Problem Adding Clippings Order");}this.addbtn.cancel();},_clear:function(){this.addbtn.cancel();this.startdate.set("value",new Date());this.enddate.set("value",new Date("2035-01-01"));this.keywords.set("value","");this.rss_feed.set("value","");this.purchaseorder.set("value","");this.description.set("value","");this.message.set("value","");this.clientid.set("value",null);this.issueid.set("value",null);this.clippingsourceid.set("value",6);},_add:function(){if(this.clippingsourceid!=1&&this.clippingstypes.value==""){alert("Please Enter Clippings Type");this.addbtn.cancel();return false;}if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");this.addbtn.cancel();return false;}var _5=this.form.get("value");_5["startdate"]=ttl.utilities.toJsonDate(this.startdate.get("value"));_5["enddate"]=ttl.utilities.toJsonDate(this.enddate.get("value"));dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._add_call_back),url:"/iadmin/clippings/add_order",content:_5}));},clear:function(){this._clear();},_client_change:function(){var _6=this.clientid.get("value");if(_6==undefined){_6=-1;}this.issueid.set("query",{icustomerid:this.icustomerid.get("value"),clientid:_6});this.issueid.set("value",null);},_change_source:function(){var _7=this.clippingsourceid.get("value");if(_7==1){dojo.addClass(this.clippingstypes_node,"prmaxhidden");if(this._dialog){this._dialog.resize({w:1010,h:525});}}else{try{this._dialog.resize({w:1010,h:700});}catch(e){}dojo.removeClass(this.clippingstypes_node,"prmaxhidden");}},_Client_Add_Call:function(_8,_9){this.clientid.set("value",_9.clientid);this.client_add_dialog.hide();},_New_Client:function(){this.client_add_ctrl.Load(-1,this._Client_Add_Call_Back);this.client_add_ctrl.set("icustomerid",this._icustomerid);this.client_add_dialog.show();}});}