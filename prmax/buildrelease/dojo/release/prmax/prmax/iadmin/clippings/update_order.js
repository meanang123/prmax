/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.iadmin.clippings.update_order"]){dojo._hasResource["prmax.iadmin.clippings.update_order"]=true;dojo.provide("prmax.iadmin.clippings.update_order");dojo.require("ttl.BaseWidget");dojo.require("prcommon.search.Countries");dojo.require("prcommon.languages.Languages");dojo.require("prcommon.clippings.clippingstype");dojo.require("prcommon.search.std_search");dojo.declare("prmax.iadmin.clippings.update_order",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='style:\"width:1000px;height:700px\"'>\r\n\t\t<form data-dojo-attach-point=\"form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='onSubmit:\"return false\",\"class\":\"common_prmax_layout\"'>\r\n\t\t\t<div style=\"height:165px;width:49%;float:left;padding:0px;margin:0px\">\r\n\t\t\t\t<input data-dojo-attach-point=\"icustomerid\" data-dojo-props='value:\"\",name:\"icustomerid\",type:\"hidden\"' data-dojo-type=\"dijit.form.TextBox\"/>\r\n\t\t\t\t<input data-dojo-attach-point=\"clippingsorderid\" data-dojo-props='value:\"\",name:\"clippingsorderid\",type:\"hidden\"' data-dojo-type=\"dijit.form.TextBox\"/>\r\n\t\t\t\t<label class=\"label_2\">Source</label><select data-dojo-attach-point=\"clippingsourceid\" data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-props='name:\"clippingsourceid\",readOnly:\"readonly\",autoComplete:true,style:\"width:8em\"'></select><br/>\r\n\t\t\t\t<label class=\"label_2\">Description</label><input data-dojo-attach-point=\"description\" data-dojo-props='name:\"description\",type:\"text\",required:true,trim:true' data-dojo-type=\"dijit.form.ValidationTextBox\" /><br/>\r\n\t\t\t\t<label class=\"label_2\">Start Date</label><input data-dojo-props='name:\"startdate\",style:\"width:8em\",type:\"text\",required:true' data-dojo-attach-point=\"startdate\" data-dojo-type=\"dijit.form.DateTextBox\"/><br/>\r\n\t\t\t\t<label class=\"label_2\">End Date</label><input data-dojo-props='name:\"enddate\",style:\"width:8em\",type:\"text\",required:true' data-dojo-attach-point=\"enddate\" data-dojo-type=\"dijit.form.DateTextBox\"/><br/>\r\n\t\t\t\t<label class=\"label_2\">Keywords</label><input data-dojo-attach-point=\"keywords\" data-dojo-props='name:\"keywords\",type:\"text\",required:true,trim:true,style:\"width:20em\"' data-dojo-type=\"dijit.form.ValidationTextBox\"/><br/>\r\n\t\t\t\t<label class=\"label_2\">RSS Feed</label><input data-dojo-attach-point=\"rss_feed\" data-dojo-props='name:\"rss_feed\",type:\"text\",required:false,trim:true,style:\"width:20em\"' data-dojo-type=\"dijit.form.ValidationTextBox\"/><br/>\r\n\t\t\t\t<label class=\"label_2\">Price Band</label><select data-dojo-props='name:\"clippingspriceid\",autoComplete:true,searchAttr:\"description\",labelType:\"html\",required:true' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clippingspriceid\" ></select><br/>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"height:165px;width:49%;float:right;padding:0px;margin:0px\">\r\n\t\t\t\t<label class=\"label_2\">Price Code</label><select data-dojo-attach-point=\"pricecodeid\" data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-props='name:\"pricecodeid\",autoComplete:true,style:\"width:8em\"'></select><br/>\r\n\t\t\t\t<label class=\"label_2\">Purchase Order</label><input data-dojo-attach-point=\"purchaseorder\" data-dojo-props='name:\"purchaseorder\",type:\"text\",required:false,trim:true,style:\"width:12em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" /><br/>\r\n\t\t\t\t<label class=\"label_2\">Client</label><select data-dojo-props='name:\"clientid\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\",required:false' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clientid\" data-dojo-attach-event=\"onChange:_client_change\"></select>\r\n\t\t\t\t\t<button data-dojo-attach-event=\"onClick: _New_Client\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",\"class\":\"prmaxdefault\"' >New</button><br/>\r\n\t\t\t\t<label class=\"label_2\">Campaign</label><select data-dojo-props='name:\"issueid\",autoComplete:true,searchAttr:\"name\",labelType:\"html\",required:false' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"issueid\"></select><br/>\r\n\t\t\t\t<label class=\"label_2\">Supplier Ref</label><input data-dojo-attach-point=\"supplierreference\" data-dojo-props='name:\"supplierreference\",type:\"text\",required:false,trim:true' data-dojo-type=\"dijit.form.ValidationTextBox\" /><br/>\r\n\t\t\t\t<label class=\"label_2\">Resend Supplier?</label><input data-dojo-type=\"dijit.form.CheckBox\" data-dojo-attach-point=\"resendsupemail\" data-dojo-props='type:\"checkbox\",name:\"resendsupemail\"' ><br/>\r\n\t\t\t\t<label class=\"label_2\">Email Address</label><input data-dojo-attach-point=\"email\" data-dojo-props='name:\"email\",type:\"text\",size:\"40\",maxlength:\"84\",trim:true,style:\"width:25em\",regExpGen:dojox.validate.regexp.emailAddress' data-dojo-type=\"dijit.form.ValidationTextBox\"/><br/>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"height:20px;width:100%;float:left;padding:0px;margin:0px\"><hr/></div>\r\n\t\t\t<div style=\"height:160px;width:49%;float:left;padding:0px;margin:0px\">\r\n\t\t\t\t<div data-dojo-attach-point=\"countries\" data-dojo-props='style:\"width:450px\",name:\"countries\", selectonly:true, startopen:true' data-dojo-type=\"prcommon.search.Countries\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"height:160px;width:49%;float:right;padding:0px;margin:0px\">\r\n\t\t\t\t<div data-dojo-attach-point=\"languages\" data-dojo-props='style:\"width:450px\",name:\"languages\"' data-dojo-type=\"prcommon.languages.Languages\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"height:20px;width:100%;float:left;padding:0px;margin:0px\"><br/></div>\r\n\t\t\t<div style=\"height:160px;width:49%;float:left;padding:0px;margin:0px\" data-dojo-attach-point=\"clippingstypes_node\" class=\"prmaxhidden\">\r\n\t\t\t\t<div data-dojo-attach-point=\"clippingstypes\" data-dojo-props='style:\"width:450px\",name:\"clippingstypes\"' data-dojo-type=\"prcommon.clippings.clippingstype\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"height:20px;width:100%;float:left;padding:0px;margin:0px\"><hr/></div>\r\n\t\t\t<div style=\"height:100px;width:100%\">\r\n\t\t\t\t<label class=\"label_2\">Message</label><div class=\"stdframe\" style=\"height:50px\" ><textarea data-dojo-attach-point=\"message\" data-dojo-props='name:\"message\",trim:true,style:\"width:99%;height:50px\"' data-dojo-type=\"dijit.form.Textarea\" ></textarea></div><br/>\r\n\t\t\t\t<button data-dojo-attach-event=\"onClick:_reactivate\" data-dojo-attach-point=\"reactivatebtn\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Reactivate\",\"class\":\"btnright prmaxhidden\"'></button>\r\n\t\t\t\t<button data-dojo-attach-event=\"onClick:_update\" data-dojo-attach-point=\"updbtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Adding...\",label:\"Update Order\",\"class\":\"btnright\"'></button>\r\n\t\t\t\t<button data-dojo-attach-event=\"onClick:_resend_conformation\" data-dojo-attach-point=\"resendbtn\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='type:\"button\",busyLabel:\"Please Wait Sending...\",label:\"Save & Resend Order Conformation\",\"class\":\"btnright\"'></button>\r\n\t\t\t\t<button data-dojo-attach-event=\"onClick:_close\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Close\",style:\"float:left\"'></button>\r\n\t\t\t\t<button data-dojo-attach-event=\"onClick:_cancel\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"cancelbtn\" data-dojo-props='type:\"button\",label:\"Cancel Clipping\",style:\"float:left\"'></button>\r\n\t\t\t</div>\r\n\t\t</form>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-attach-point=\"client_add_dialog\" data-dojo-props='title:\"Add New Client\",style:\"width:700px;height:600px\"'>\r\n\t\t<div data-dojo-type=\"prmax.customer.clients.add\" data-dojo-attach-point=\"client_add_ctrl\"></div>\r\n\t</div>\r\n</div>\r\n\r\n",constructor:function(){this._update_call_back=dojo.hitch(this,this._update_call);this._load_call_back=dojo.hitch(this,this._load_call);this._resend_conformation_call_back=dojo.hitch(this,this._resend_conformation_call);this._cancel_call_back=dojo.hitch(this,this._cancel_call);this._reactivate_call_back=dojo.hitch(this,this._reactivate_call);this._Client_Add_Call_Back=dojo.hitch(this,this._Client_Add_Call);this._clippings_orders_model=new dojox.data.JsonRestStore({target:"/iadmin/clippings/list_clippingsprices",idAttribute:"clippingspriceid"});this._clients=new dojox.data.JsonRestStore({target:"/iadmin/clippings/list_clients",idAttribute:"clientid"});this._issues=new dojox.data.JsonRestStore({target:"/iadmin/clippings/list_issues",idAttribute:"issueid"});this._pricecodes=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=pricecodes&type=clippings"});this._sources=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=clippingsource"});this._change_client_enabled=true;},postCreate:function(){this.clippingspriceid.set("store",this._clippings_orders_model);this.clientid.set("store",this._clients);this.issueid.set("store",this._issues);this.pricecodeid.set("store",this._pricecodes);this.clippingsourceid.set("store",this._sources);this._clear();this.inherited(arguments);},load:function(_1,_2,_3,_4){this._dialog=_2;this.licence_expire=_4;this.clippingsorderid.set("value",_1);this.icustomerid.set("value",_3);this.clientid.set("query",{icustomerid:_3});dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._load_call_back),url:"/iadmin/clippings/get_order",content:{clippingsorderid:_1}}));},_load_call:function(_5){if(_5.success=="OK"){with(_5){this.updbtn.cancel();this.resendsupemail.set("checked",false);this.icustomerid.set("value",order.customerid);this.startdate.set("value",order.startdate);this.enddate.set("value",order.enddate);this.keywords.set("value",order.keywords);this.rss_feed.set("value",order.rss_feed);this.purchaseorder.set("value",order.purchaseorder);this.description.set("value",order.description);this.message.set("value","");this._change_client_enabled=false;this.clientid.set("value",order.defaultclientid);this.issueid.set("value",order.defaultissueid);this.clippingspriceid.set("value",order.clippingspriceid);this.supplierreference.set("value",order.supplierreference);this.pricecodeid.set("value",order.pricecodeid);this.email.set("value",order.email);this.clippingsourceid.set("value",order.clippingsourceid);this.countries.set("value",order.countries);this.languages.set("value",order.languages);this.clippingstypes.set("value",order.clippingstypes);if(this.clippingsourceid.value==1){dojo.addClass(this.clippingstypes_node,"prmaxhidden");if(this._dialog){this._dialog.resize({w:1010,h:550});}}else{this._dialog.resize({w:1010,h:700});dojo.removeClass(this.clippingstypes_node,"prmaxhidden");}if(order.clippingorderstatusid==2){dojo.addClass(this.updbtn.domNode,"prmaxhidden");dojo.addClass(this.resendbtn.domNode,"prmaxhidden");dojo.addClass(this.cancelbtn.domNode,"prmaxhidden");dojo.removeClass(this.reactivatebtn.domNode,"prmaxhidden");}else{dojo.removeClass(this.updbtn.domNode,"prmaxhidden");dojo.removeClass(this.resendbtn.domNode,"prmaxhidden");dojo.removeClass(this.cancelbtn.domNode,"prmaxhidden");dojo.addClass(this.reactivatebtn.domNode,"prmaxhidden");}}this._dialog.show();}},_close:function(){this._dialog.hide();},_update_call:function(_6){if(_6.success=="OK"){this._dialog.hide();dojo.publish("/clippings/order/upd",[_6.data]);this._clear();}else{alert("Problem Updating Clippings Order");}this.updbtn.cancel();},_clear:function(){this.updbtn.cancel();this.resendbtn.cancel();this.startdate.set("value",new Date());this.enddate.set("value",dojo.date.add(new Date(),"year",1));this.keywords.set("value","");this.rss_feed.set("value","");this.purchaseorder.set("value","");this.description.set("value","");this.message.set("value","");this._change_client_enabled=false;this.clientid.set("value",-1);this.issueid.set("value",-1);this._change_client_enabled=true;this.supplierreference.set("value","");this.resendsupemail.set("checked",false);this.clippingsourceid.set("value",1);},_update:function(){if(this.clippingsourceid!=1&&this.clippingsourceid!=7&&this.clippingstypes.value==""){alert("Please Enter Clippings Type");this.updbtn.cancel();return false;}if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");this.updbtn.cancel();return false;}var _7=this.form.get("value");_7["startdate"]=ttl.utilities.toJsonDate(this.startdate.get("value"));_7["enddate"]=ttl.utilities.toJsonDate(this.enddate.get("value"));dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._update_call_back),url:"/iadmin/clippings/update_order",content:_7}));},_client_change:function(){var _8=this.clientid.get("value");if(_8==undefined){_8=-1;}this.issueid.set("query",{icustomerid:this.icustomerid.get("value"),clientid:_8});if(this._change_client_enabled==true){this.issueid.set("value",null);}this._change_client_enabled=true;},_resend_conformation_call:function(_9){if(_9.success=="OK"){dojo.publish("/clippings/order/upd",[_9.data]);alert("Sent");}else{alert("Problem");}this.resendbtn.cancel();},_resend_conformation:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Please Enter Details");this.resendbtn.cancel();return false;}if(confirm("Update & Resend Order Conformation")){var _a=this.form.get("value");_a["startdate"]=ttl.utilities.toJsonDate(this.startdate.get("value"));_a["enddate"]=ttl.utilities.toJsonDate(this.enddate.get("value"));dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._resend_conformation_call_back),url:"/iadmin/clippings/resend_conformation",content:_a}));}},_cancel_call:function(_b){if(_b.success=="OK"){alert("Clipping cancelled");this._dialog.hide();}else{alert("Problem");}},_cancel:function(){this.enddate.set("value",new Date());var _c=this.form.get("value");_c["enddate"]=ttl.utilities.toJsonDate(this.enddate.get("value"));_c["startdate"]=ttl.utilities.toJsonDate(this.startdate.get("value"));dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._cancel_call_back),url:"/iadmin/clippings/cancel_order",content:_c}));},_reactivate_call:function(_d){if(_d.success=="OK"){alert("Clipping reactivated");this._dialog.hide();}else{alert("Problem");}},_reactivate:function(){this.enddate.set("value",this.licence_expire);var _e=this.form.get("value");_e["enddate"]=ttl.utilities.toJsonDate(this.enddate.get("value"));_e["startdate"]=ttl.utilities.toJsonDate(this.startdate.get("value"));dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._reactivate_call_back),url:"/iadmin/clippings/reactivate_order",content:_e}));},_Client_Add_Call:function(_f,_10){this._change_client_enabled==true;this.clientid.set("value",_10.clientid);this.client_add_dialog.hide();},_New_Client:function(){this.client_add_ctrl.Load(-1,this._Client_Add_Call_Back);this.client_add_dialog.show();}});}