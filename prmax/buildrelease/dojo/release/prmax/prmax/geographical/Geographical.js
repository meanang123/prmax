/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.geographical.Geographical"]){dojo._hasResource["prmax.geographical.Geographical"]=true;dojo.provide("prmax.geographical.Geographical");dojo.require("ttl.BaseWidget");dojo.require("dijit.form.TextBox");dojo.require("ttl.Select");dojo.require("prmax.geographical.GeographicalTree");dojo.declare("prmax.geographical.Geographical",[prcommon.search.std_search,ttl.BaseWidget],{name:"",value:"",displaytitle:"Geo. Coverage",title:"",search:"",size:"7",selectonly:false,startopen:false,widgetsInTemplate:true,cascade:true,open:false,templateString:"<div class=\"dojogeographicalPane\" dojoAttachPoint=\"containerNode\" >\r\n\t<div>\r\n\t\t<table width=\"100%\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\" >\r\n\t\t\t<tr><td width=\"20%\"   class=\"prmaxrowtag\">${displaytitle}</td>\r\n\t\t\t\t\t<td width=\"5%\" ><i dojoAttachPoint=\"toggleCtrl\" dojoAttachEvent=\"onclick:_Toggle\" class=\"fa fa-plus-circle\" style=\"color:#7F7F7F\"></i></td>\r\n\t\t\t\t\t<td align=\"right\" v-align=\"top\" ><div dojoAttachPoint=\"countNode\" dojotype=\"prmax.search.SearchCount\"></div></td>\r\n\t\t\t</tr></table>\r\n\t\t<div style=\"border 2px solid black\">\r\n\t\t\t<div dojoAttachPoint=\"selectarea\" class=\"prmaxselectmultiple\" style=\"display:none\" >\r\n\t\t\t\t<table width=\"100%\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\" >\r\n\t\t\t\t\t  <tr><td width=\"47%\"></td><td width=\"5%\"></td><td width=\"47%\"></td></tr>\r\n\t\t\t\t\t  <tr><td colspan=\"3\">\r\n\t\t\t\t\t\t  <table style=\"width:100%\" class=\"prmaxtable\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" >\r\n\t\t\t\t\t\t\t  <tr>\r\n\t\t\t\t\t\t\t\t  <td dojoAttachPoint=\"master_type_text\"><span class=\"prmaxrowtag\">Select</span><input class=\"prmaxfocus prmaxinput\" type=\"text\" style=\"width:100px\" dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"geographical_list_select\" dojoAttachEvent=\"onkeyup:geographicalSelect\" /></td>\r\n\t\t\t\t\t\t<td style=\"padding-left:10px\"> <span class=\"prmaxrowtag\" >Filter By</span>\r\n\t\t\t\t\t\t\t\t<input dojoAttachEvent=\"onClick:_ShowNoFilter\" dojoAttachPoint=\"FilterRadioRestriction\" name=\"geog_selection\" class=\"prmaxdefault\" dojoType=\"dijit.form.RadioButton\" checked type=\"radio\" value=\"-1\"/><label dojoAttachPoint=\"FilterRadioRestrictionLabel\" class=\"prmaxlabeltag\" >All</label>\r\n\t\t\t\t\t\t\t\t<input dojoAttachEvent=\"onClick:_ShowAll\" dojoAttachPoint=\"FilterRadioTown\" name=\"geog_selection\" class=\"prmaxdefault\" dojoType=\"dijit.form.RadioButton\" type=\"radio\" value=\"1\"/><label dojoAttachPoint=\"FilterRadioTownLabel\" class=\"prmaxlabeltag\" >Towns</label>\r\n\t\t\t\t\t\t\t\t<input dojoAttachEvent=\"onClick:_ShowAll\" dojoAttachPoint=\"FilterRadioCounty\" name=\"geog_selection\" class=\"prmaxdefault\" dojoType=\"dijit.form.RadioButton\" type=\"radio\" value=\"2\"/><label dojoAttachPoint=\"FilterRadioCountyLabel\" class=\"prmaxlabeltag\" >Counties</label>\r\n\t\t\t\t\t\t\t\t<input dojoAttachEvent=\"onClick:_ShowAll\" dojoAttachPoint=\"FilterRadioRegion\" name=\"geog_selection\" class=\"prmaxdefault\" dojoType=\"dijit.form.RadioButton\" type=\"radio\" value=\"3\"/><label dojoAttachPoint=\"FilterRadioRegionLabel\" class=\"prmaxlabeltag\" >Regions</label>\r\n\t\t\t\t\t\t\t\t<input dojoAttachEvent=\"onClick:_ShowAll\" dojoAttachPoint=\"FilterRadioNation\" name=\"geog_selection\" class=\"prmaxdefault\" dojoType=\"dijit.form.RadioButton\" type=\"radio\" value=\"6\"/><label dojoAttachPoint=\"FilterRadioNationLabel\" class=\"prmaxlabeltag\" >Nation</label>\r\n\t\t\t\t\t\t</td><td width=\"5%\"><button dojoType=\"dijit.form.Button\" type=\"button\" dojoAttachEvent=\"onClick:_TreeView\">Tree</button></td>\r\n\t\t\t\t\t\t</tr></table>\r\n\t\t\t\t\t</td></tr>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td><select style=\"width:100%\" dojoAttachPoint=\"geographical_list\" size=\"${size}\" class=\"lists\" multiple=\"multiple\" ></select></td>\r\n\t\t\t\t\t\t  <td>\r\n\t\t\t\t\t\t\t<button  style=\"padding:0px;margin:0px\" class=\"button_add_all\" dojoAttachPoint=\"button_all\" disabled=\"true\" type=\"button\" dojoAttachEvent=\"onClick:geographicalSelectAll\" dojoType=\"dijit.form.Button\"><div class=\"std_movement_button\">&gt;&gt;</div></button><br/>\r\n\t\t\t\t\t\t\t<button style=\"padding:0px;margin:0px\" class=\"button_add_single\" dojoAttachPoint=\"button_single\" disabled=\"true\" type=\"button\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:geographicalSelectSingle\"><div class=\"std_movement_button\">&gt;&nbsp;</div></button><br/>\r\n\t\t\t\t\t\t\t<button style=\"padding:0px;margin:0px\" class=\"button_del_all\" dojoAttachPoint=\"button_del_all\" disabled=\"true\" type=\"button\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:geographicalRemoveAll\"><div class=\"std_movement_button\">&lt;&lt;</div></button><br/>\r\n\t\t\t\t\t\t\t<button style=\"padding:0px;margin:0px\" class=\"button_del_single\" dojoAttachPoint=\"button_del_single\" disabled=\"true\" type=\"button\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:geographicalRemoveSingle\"><div class=\"std_movement_button\">&lt;&nbsp;</div></button>\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t<td ><select style=\"width:100%\" dojoAttachPoint=\"geographical_select\" size=\"${size}\" class=\"lists\" multiple=\"multiple\" dojoAttachEvent=\"onchange:geographicalUpdateSelection\"></select></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t </div>\r\n\t<div dojoAttachPoint=\"geog_tree_dlg\" dojoType=\"dijit.Dialog\" title =\"Geographical Tree View\">\r\n\t\t<div dojoType=\"prmax.geographical.GeographicalTree\" style=\"width:400px;height:500px\"></div>\r\n\t</div>\r\n\r\n </div>\r\n",constructor:function(){this.disabled=false;this._LoadSelectionCall=dojo.hitch(this,this._LoadSelection);this._transactionid=null;this.selectTimer=null;},postCreate:function(){dojo.connect(this.geographical_list_select.domNode,"onkeyup",dojo.hitch(this,this.geographicalSelect));dojo.connect(this.geographical_list,"onchange",dojo.hitch(this,this.geographicalUpdateSelection));dojo.connect(this.geographical_list,"ondblclick",dojo.hitch(this,this.geographicalSelectDbl));dojo.connect(this.geographical_select,"ondblclick",dojo.hitch(this,this.geographicalSelectDeleteDbl));dojo.attr(this.FilterRadioRestrictionLabel,"for",this.FilterRadioRestriction.id);dojo.attr(this.FilterRadioTownLabel,"for",this.FilterRadioTown.id);dojo.attr(this.FilterRadioCountyLabel,"for",this.FilterRadioCounty.id);dojo.attr(this.FilterRadioRegionLabel,"for",this.FilterRadioRegion.id);dojo.attr(this.FilterRadioNationLabel,"for",this.FilterRadioNation.id);if(this.selectonly){this.countNode.domNode.style.display="None";}if(this.startopen){dojo.style(this.toggleCtrl,"display","none");dojo.style(this.selectarea,"display","block");}dojo.subscribe(PRCOMMON.Events.Geographical_Selected,dojo.hitch(this,this._GeographicalSelectionEvent));dojo.subscribe(PRCOMMON.Events.Dialog_Close,dojo.hitch(this,this._DialogCloseEvent));this.inherited(arguments);},_GeographicalSelectionEvent:function(e){var _1=true;for(var c1=0;c1<this.geographical_select.options.length;c1++){if(this.geographical_select.options[c1].value==e.geographicalarea){_1=false;break;}}if(_1){this.geographical_select.options[this.geographical_select.options.length]=new Option(e.geographicalname,e.geographicalid);this._Get(this._getValueAttr());}},Clear:function(){this._ClearSelectionBox();this._ClearSelectedBox();this.geographical_list_select.set("value","");this.FilterRadioRestriction.set("checked",true);this._Get(this._getValueAttr());this._SelectionOptions();this.inherited(arguments);},_ClearSelection:function(){this.Clear();},_Send_Request:function(_2){this._transactionid=PRCOMMON.utils.uuid.createUUID();dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadSelectionCall,url:"/geographical/listbytype",content:{word:_2,filter:this._getFilter(),geographicaltypeid:this.geographicaltypeid,transactionid:this._transactionid}}));},geographicalSelect:function(){var _3=this.geographical_list_select.get("value");if(_3.length>0){if(this.selectTimer){clearTimeout(this.selectTimer);this.selectTimer=null;}this.selectTimer=setTimeout(dojo.hitch(this,this._Send_Request,_3),this.searchTime);}else{this.selectTimer=null;this._ClearSelectionBox();this._SelectionOptions();}},_LoadSelection:function(_4){if(this._transactionid==_4.transactionid){this._ClearSelectionBox();for(var i=0;i<_4.data.length;++i){var _5=_4.data[i];this.geographical_list.options[this.geographical_list.options.length]=new Option(_5[0],_5[1]);}this._SelectionOptions();}},_ClearSelectionBox:function(){this.geographical_list.options.length=0;},_Get:function(_6,_7){if(this.keytypeid!=""){this.inherited(arguments);}},_ClearSelectedBox:function(){this.geographical_select.length=0;},geographicalUpdateSelection:function(){this._SelectionOptions();},geographicalSelectDbl:function(){this.geographicalSelectSingle();this._SelectionOptions();},geographicalSelectAll:function(){for(var c=0;c<this.geographical_list.options.length;c++){var _8=this.geographical_list.options[c];var _9=true;for(var c1=0;c1<this.geographical_select.options.length;c1++){if(this.geographical_select.options[c1].value==_8.value){_9=false;break;}}if(_9){this.geographical_select.options[this.geographical_select.options.length]=new Option(_8.text,_8.value);this._Get(this._getValueAttr());}}this.geographical_list.options.length=0;this.geographicalUpdateSelection();},geographicalSelectSingle:function(){for(var c=0;c<this.geographical_list.options.length;c++){var _a=this.geographical_list.options[c];if(_a.selected){_a.selected=false;var _b=true;for(var c1=0;c1<this.geographical_select.options.length;c1++){if(this.geographical_select.options[c1].value==_a.value){_b=false;break;}}if(_b){this.geographical_select.options[this.geographical_select.options.length]=new Option(_a.text,_a.value);this._Get(this._getValueAttr());}}}},geographicalRemoveAll:function(){this.geographical_select.options.length=0;this.geographicalUpdateSelection();this._Get(this._getValueAttr());},geographicalSelectDeleteDbl:function(_c){if(_c!=null&&_c.originalTarget!=null&&_c.originalTarget.index!=null){this.geographical_select.options[_c.originalTarget.index]=null;this.geographicalUpdateSelection();this._Get(this._getValueAttr());}else{this.geographicalRemoveSingle();}},geographicalRemoveSingle:function(){for(var c=0;c<this.geographical_select.options.length;c++){if(this.geographical_select.options[c].selected){this.geographical_select.options[c]=null;}}this.geographicalUpdateSelection();this._Get(this._getValueAttr());},addSelect:function(_d){this.geographical_select.options[this.geographical_select.options.length]=new Option(_d.geographicalname,_d.geographicalid);},_setValueAttr:function(_e){var _f=_e.data;var _10=false;if(_f==null||_f==undefined){_f=_e;}this.Clear();for(var key in _f){var _11=_f[key];this.geographical_select.options[this.geographical_select.options.length]=new Option(_11.geographicalname,_11.geographicalid);_10=true;}if(_10){this.MakeOpen();}this._extended=false;this._Get(this._getValueAttr());},_getValueAttr:function(){var _12=Array();for(var c=0;c<this.geographical_select.options.length;c++){if(this._extended){_12[c]={geographicalid:parseInt(this.geographical_select.options[c].value),geographicalname:this.geographical_select.options[c].text};}else{_12[c]=parseInt(this.geographical_select.options[c].value);}}var obj={data:_12,cascade:"C"};if(this._extended){return obj;}else{var _12=_12.length>0?dojo.toJson(obj):"";this.value=_12;return _12;}},_getCountAttr:function(){return this.geographical_select.options.length;},changeFilter:function(){this.geographicalSelect();},_SelectionOptions:function(){this.button_all.set("disabled",this.geographical_list.length?false:true);this.button_single.set("disabled",this.geographical_list.selectedIndex!=-1?false:true);this.button_del_all.set("disabled",this.geographical_select.length?false:true);this.button_del_single.set("disabled",this.geographical_select.selectedIndex!=-1?false:true);},_setDisabledAttr:function(_13){this.disabled=_13;},_getDisabledAttr:function(){return this.disabled;},destroy:function(){this.inherited(arguments);},_focus:function(){this.geographical_list_select.focus();},_OnFocus:function(){this.open=true;this._ToggleCascade();},_getFilter:function(){if(this.FilterRadioRestriction.get("checked")){return this.FilterRadioRestriction.get("value");}else{if(this.FilterRadioTown.get("checked")){return this.FilterRadioTown.get("value");}else{if(this.FilterRadioCounty.get("checked")){return this.FilterRadioCounty.get("value");}else{if(this.FilterRadioRegion.get("checked")){return this.FilterRadioRegion.get("value");}else{if(this.FilterRadioNation.get("checked")){return this.FilterRadioNation.get("value");}}}}}return -1;},_ShowAll:function(){var _14=this.geographical_list_select.get("value");if(_14.length!=0){this.geographicalSelect();}},_ShowNoFilter:function(){var _15=this.geographical_list_select.get("value");if(_15.length!=0){this.geographicalSelect();}else{this._ClearSelectionBox();this._SelectionOptions();}},_Toggle:function(){if(this.selectonly==false){this.inherited(arguments);}},_TreeView:function(){this.geog_tree_dlg.show();},_DialogCloseEvent:function(_16){this.geog_tree_dlg.hide();}});}