/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.editor.MergeFields"]){dojo._hasResource["prmax.editor.MergeFields"]=true;dojo.provide("prmax.editor.MergeFields");dojo.declare("prmax.editor._MergeFieldsButton",[dijit._Widget,dijit._Templated],{label:"",widgetsInTemplate:true,plainText:false,templateString:"<span style='white-space: nowrap' class='dijit dijitReset dijitInline'>"+"<label class='dijitLeft dijitInline' for='${selectId}'>${label}</label>"+"<select dojoType='dijit.form.FilteringSelect' tabIndex='-1' id='${selectId}' dojoAttachPoint='select' value='' style='width:100px'>"+"<option value=''></option><option value='!FIRSTNAME!'>First Name</option><option value='!FORMAL!'>Formal</option><option value='!JOBTITLE!'>Job title</option></select>"+"</span>",postMixInProperties:function(){this.inherited(arguments);this.label="Merge Fields";this.id=dijit.getUniqueId(this.declaredClass.replace(/\./g,"_"));this.selectId=this.id+"_select";this.inherited(arguments);},postCreate:function(){this.select.set("value","",false);this.disabled=this.select.get("disabled");},_getValueAttr:function(){return this.select.get("value");},focus:function(){this.select.focus();},_setDisabledAttr:function(_1){this.disabled=_1;this.select.set("disabled",_1);}});dojo.declare("prmax.editor.MergeFields",dijit._editor._Plugin,{useDefaultCommand:false,_initButton:function(){params=this.params;if(this.params.custom){params.values=this.params.custom;}this.button=new prmax.editor._MergeFieldsButton(params);this.connect(this.button.select,"onChange",function(_2){if(_2==""){return;}this.editor.focus();this.editor.execCommand("inserthtml",_2);this.button.select.set("value","");});},updateState:function(){var _3=this.editor;var _4=this.command;if(!_3||!_3.isLoaded||!_4.length){return;}if(this.button){var _5;try{_5=_3.queryCommandValue(_4)||"";}catch(e){_5="";}var _6=dojo.isString(_5)&&_5.match(/'([^']*)'/);if(_6){_5=_6[1];}if(!_5&&_4==="formatBlock"){var _7;var _8=dijit.range.getSelection(this.editor.window);if(_8&&_8.rangeCount>0){var _9=_8.getRangeAt(0);if(_9){_7=_9.endContainer;}}while(_7&&_7!==_3.editNode&&_7!==_3.document){var tg=_7.tagName?_7.tagName.toLowerCase():"";if(tg&&dojo.indexOf(this.button.values,tg)>-1){_5=tg;break;}_7=_7.parentNode;}}if(_5!==this.button.get("value")){this.button.set("value",_5,false);}}}});dojo.subscribe(dijit._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}switch(o.args.name){case "mergefields":o.plugin=new prmax.editor.MergeFields({command:o.args.name});break;}});}