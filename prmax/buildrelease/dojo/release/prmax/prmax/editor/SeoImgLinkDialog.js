/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.editor.SeoImgLinkDialog"]){dojo._hasResource["prmax.editor.SeoImgLinkDialog"]=true;dojo.provide("prmax.editor.SeoImgLinkDialog");dojo.require("dijit._editor.plugins.LinkDialog");dojo.require("dojo.i18n");dojo.requireLocalization("dijit","common",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw");dojo.requireLocalization("prmax","SeoImgLinkDialog",null,"ROOT");dojo.declare("prmax.editor.SeoImgLinkDialog",[dijit._editor.plugins.LinkDialog],{linkDialogTemplate:["<table><tr><td>","<label for='${id}_urlInput'>${url}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' regExp='${urlRegExp}' "+"required='true' id='${id}_urlInput' name='urlInput' intermediateChanges='true'>","</td></tr><tr><td>","<label for='${id}_textInput'>${text}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' required='false' id='${id}_textInput' "+"name='textInput' intermediateChanges='true'>","</td></tr><tr><td>","<label for='${id}_styleInput'>${style}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' required='false' id='${id}_styleInput' "+"name='styleInput' intermediateChanges='true'>","</td></tr><tr><td>","<label for='${id}_heightInput'>${height}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' required='false' id='${id}_heightInput' "+"name='heightInput' intermediateChanges='true'>","</td></tr><tr><td>","<label for='${id}_widthInput'>${width}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' required='false' id='${id}_widthInput' "+"name='widthInput' intermediateChanges='true'>","</td></tr>","</td></tr><tr><td colspan='2'>","<button dojoType='dijit.form.Button' type='button' id='${id}_loadThumbNail'>${loadThumbNail}</button>","<button dojoType='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button>","<button dojoType='dijit.form.Button' type='button' id='${id}_cancelButton'>${buttonCancel}</button>","</td></tr></table>"].join(""),htmlTemplate:"<img src=\"${urlInput}\" _djrealurl=\"${urlInput}\" alt=\"${textInput}\" height=\"${heightInput}\" width=\"${widthInput}\" height=\"${styleInput}\"/>",tag:"img",_getCurrentValues:function(_1){var _2,_3,_4,_5,_6;if(_1&&_1.tagName.toLowerCase()===this.tag){_2=_1.getAttribute("_djrealurl");var _7=_1.getAttribute("src");_2=_2||_7;_3=_1.getAttribute("alt");_4=_1.getAttribute("style");_5=_1.getAttribute("height");_6=_1.getAttribute("width");dojo.withGlobal(this.editor.window,"selectElement",dijit._editor.selection,[_1,true]);}else{_3=dojo.withGlobal(this.editor.window,dijit._editor.selection.getSelectedText);}return {urlInput:_2||"http://",textInput:_3||"",styleInput:_4,heightInput:_5,widthInput:_6};},_isValid:function(){return this._urlInput.isValid();},_connectTagEvents:function(){this.inherited(arguments);this.editor.onLoadDeferred.addCallback(dojo.hitch(this,function(){this.connect(this.editor.editNode,"onmousedown",this._selectTag);}));},_selectTag:function(e){if(e&&e.target){var t=e.target;var tg=t.tagName?t.tagName.toLowerCase():"";if(tg===this.tag){dojo.withGlobal(this.editor.window,"selectElement",dijit._editor.selection,[t]);}}},_checkValues:function(_8){if(_8&&_8.urlInput){_8.urlInput=_8.urlInput.replace(/"/g,"&quot;");}if(_8&&_8.textInput){_8.textInput=_8.textInput.replace(/"/g,"&quot;");}if(_8&&_8.styleInput){_8.styleInput=_8.styleInput.replace(/"/g,"&quot;");}return _8;},updateState:function(){var e=this.editor,c=this.command,_9,_a;if(!e||!e.isLoaded||!c.length){return;}if(this.button){try{_a=e.queryCommandEnabled(c);_a=true;if(this.enabled!==_a){this.enabled=_a;this.button.set("disabled",!_a);}if(typeof this.button.checked=="boolean"){_9=e.queryCommandState(c);if(this.checked!==_9){this.checked=_9;this.button.set("checked",e.queryCommandState(c));}}}catch(e){}}},_initButton:function(){var _b=this;this.tag="img";var _c=dojo.mixin(dojo.i18n.getLocalization("dijit","common",this.lang),dojo.i18n.getLocalization("prmax","SeoImgLinkDialog",this.lang));var _d=(this.dropDown=new dijit.TooltipDialog({title:_c[this.command+"Title"],execute:dojo.hitch(this,"setValue"),onOpen:function(){_b._onOpenDialog();dijit.TooltipDialog.prototype.onOpen.apply(this,arguments);},onCancel:function(){setTimeout(dojo.hitch(_b,"_onCloseDialog"),0);}}));_c.urlRegExp=this.urlRegExp;_c.id=dijit.getUniqueId(this.editor.id);this._uniqueId=_c.id;this._setContent(_d.title+"<div style='border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'></div>"+dojo.string.substitute(this.linkDialogTemplate,_c));_d.startup();this._urlInput=dijit.byId(this._uniqueId+"_urlInput");this._textInput=dijit.byId(this._uniqueId+"_textInput");this._setButton=dijit.byId(this._uniqueId+"_setButton");this.connect(dijit.byId(this._uniqueId+"_loadThumbNail"),"onClick",function(){dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,function(){dojo.publish("/seo/thumbnail",[]);}),url:"/emails/seorelease/link_to_thumbnail",content:{url:this._urlInput.get("value")}}));});this.connect(dijit.byId(this._uniqueId+"_cancelButton"),"onClick",function(){this.dropDown.onCancel();});if(this._urlInput){this.connect(this._urlInput,"onChange","_checkAndFixInput");}if(this._textInput){this.connect(this._textInput,"onChange","_checkAndFixInput");}this._connectTagEvents();if(this.command.length){var _e=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);if(!this.button){var _f=dojo.mixin({label:_c.label,showLabel:false,iconClass:_e,dropDown:this.dropDown,tabIndex:"-1"},this.params||{});this.button=new this.buttonClass(_f);}}},_onDblClick:function(e){if(e&&e.target){var t=e.target;var tg=t.tagName?t.tagName.toLowerCase():"";if(tg===this.tag&&dojo.attr(t,"src")){dojo.withGlobal(this.editor.window,"selectElement",dijit._editor.selection,[t]);this.editor.onDisplayChanged();setTimeout(dojo.hitch(this,function(){this.button.set("disabled",false);this.button.openDropDown();}),10);}}}});dojo.subscribe(dijit._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}switch(o.args.name){case "seoinsertimage":o.plugin=new prmax.editor.SeoImgLinkDialog({command:o.args.name});break;}});}