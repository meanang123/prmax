/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.roles.ApplyRoles"]){dojo._hasResource["prmax.roles.ApplyRoles"]=true;dojo.provide("prmax.roles.ApplyRoles");dojo.declare("prmax.roles.ApplyRoles",[ttl.BaseWidget],{selected:-1,widgetsInTemplate:true,templateString:"<div>\r\n\t<form class=\"prmaxdefault\" dojoAttachPoint=\"form\" onSubmit=\"return false;\" dojoType=\"dijit.form.Form\">\r\n\t\t<table width=\"95%\" class=\"prmaxtable\" style=\"margin:10px\">\r\n\t\t<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n\t\t<tr><td colspan=\"2\"><div  dojoType=\"prmax.roles.Roles\" startopen=\"true\" dojoAttachPoint=\"roles\" size=\"6\" name=\"roles\" ></div></td></tr>\r\n\t\t<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n\t\t<tr><td valign=\"top\" class=\"prmaxrowtag\" colspan=\"2\"><label dojoAttachPoint=\"label_primary\">If no such roles revert to Primary Contact?&nbsp;</label><div dojoAttachPoint=\"primary\" dojotype=\"dijit.form.CheckBox\" value=\"1\" name=\"setprimary\"</div></td></tr>\r\n\t\t<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n\t\t<tr><td width=\"40%\" valign=\"top\" class=\"prmaxrowtag\">List Selection</td><td><div name=\"selected\" dojoAttachPoint=\"selectedNode\" dojoType=\"prmax.common.SelectOptions\"  ></td></tr>\r\n\t\t<tr><td valign=\"top\" colspan=\"2\" class=\"prmaxrowtag\">Searching for Roles pick contacts with particular job instead of Primary Contact.<br/>\r\n\t\t\t<br/>If the tick box is selected, any Outlets that don't have a contact in the given Role will revert to the Primary Contact\r\n\t\t</td></tr>\r\n\t\t<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n\t\t<tr>\r\n\t\t\t<td align=\"left\"><button class=\"prmaxbutton\" dojoAttachEvent=\"onClick:_Close\" dojoType=\"dijit.form.Button\"  label=\"Close\"></button></td>\r\n\t\t\t<td align=\"right\"><button class=\"prmaxbutton\" iconClass=\"dijitPrmaxIcon dijitPrmaxAdd\" dojoAttachEvent=\"onClick:_ApplyTagsButton\" dojoAttachPoint=\"saveNode\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Updating Roles...\" label=\"Apply Roles\"></button></td>\r\n\t\t</tr>\r\n\t</table></form>\r\n</div>\r\n",constructor:function(){this._SavedResultCall=dojo.hitch(this,this._SavedResult);},postCreate:function(){dojo.connect(this.form,"onSubmit",dojo.hitch(this,this._Submit));this.selectedNode.setOptions(this.selected);dojo.attr(this.label_primary,"for",this.primary.id);this.inherited(arguments);},_ApplyTagsButton:function(){if(confirm("Apply Roles to Search Results")){this.form.submit();}},_Submit:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedResultCall,url:"/roles/applyroles",content:this.form.get("value")}));},_SavedResult:function(_1){this.saveNode.cancel();if(_1.success=="OK"){alert("Roles Added");dojo.publish(PRCOMMON.Events.SearchSession_Changed,[_1.data]);dojo.publish(PRCOMMON.Events.Dialog_Close,["roles"]);}else{alert("Problem adding Roles");}},_Close:function(){dojo.publish(PRCOMMON.Events.Dialog_Close,["roles"]);}});}