/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.display.CommonBanner"]){dojo._hasResource["prmax.display.CommonBanner"]=true;dojo.provide("prmax.display.CommonBanner");dojo.require("ttl.BaseWidget");dojo.require("prmax.search.SearchCtrl");dojo.require("prmax.DlgCtrl2");dojo.require("prmax.lists.exclusions.view");dojo.require("prmax.lists.exclusions.emailview");dojo.require("prcommon.documents.view");dojo.declare("prmax.display.CommonBanner",[ttl.BaseWidget],{widgetsInTemplate:true,message:"",showlabel:false,isuseradmin:false,canviewfinancial:false,constructor:function(){this.search=new prmax.search.SearchCtrl();this.stdDialog=new prmax.DlgCtrl2("width:30em;height:35em");this.largeDialog=new prmax.DlgCtrl2("width:710px;height:565px;");dojo.subscribe(PRCOMMON.Events.Dialog_Close,dojo.hitch(this,this._DialogCloseEvent));dojo.subscribe(PRCOMMON.Events.PressReleaseStart,dojo.hitch(this,this._StartPressEvent));dojo.subscribe("/update/engagement_label",dojo.hitch(this,this._UpdateEngagementLabelEvent));dojo.subscribe("/update/distribution_label",dojo.hitch(this,this._UpdateDistributionLabelEvent));},postCreate:function(){if(this.useradmin!=null){this.useradmin.set("disabled",this.isuseradmin?false:true);}if(this.pm_user_admin){this.pm_user_admin.set("disabled",this.isuseradmin?false:true);}if(this.financial!=null){this.financial.set("disabled",this.canviewfinancial?false:true);}if(this.pm_financial){this.pm_financial.set("disabled",this.canviewfinancial?false:true);}if(PRMAX.utils.settings.productid==PRCOMMON.Constants.PRMAX_Pro){dojo.removeClass(this.tag_menu.domNode,"prmaxhidden");dojo.removeClass(this.project_menu.domNode,"prmaxhidden");}if(PRMAX.utils.settings.advancefeatures&&this.advance_view){dojo.removeClass(this.advance_view.domNode,"prmaxhidden");}if(PRMAX.utils.settings.updatum&&this.updatum_view){dojo.removeClass(this.updatum_view.domNode,"prmaxhidden");}if(PRMAX.utils.settings.distributionistemplated&&this.distribution_template_menu){dojo.removeClass(this.distribution_template_menu.domNode,"prmaxhidden");}if((PRMAX.utils.settings.useemail==false||PRMAX.utils.settings.isdemo==true)&&this.distribution_menu!=null){this.distribution_menu.set("disabled",true);}if(PRMAX.utils.settings.no_distribution==true){dojo.addClass(this.distribution_menu.domNode,"prmaxhidden");}if(this.clients){dojo.attr(this.clients.containerNode,"innerHTML",PRMAX.utils.settings.client_name+"s");}if(this.banner_issue_label!=null){this.banner_issue_label.set("label",PRMAX.utils.settings.issue_description+"s");}if(PRMAX.utils.settings.crm){dojo.removeClass(this.engbtn.domNode,"prmaxhidden");if(this.banner_crm){dojo.removeClass(this.banner_crm.domNode,"prmaxhidden");}if(this.banner_issue_label){dojo.removeClass(this.banner_issue_label.domNode,"prmaxhidden");}}if(PRMAX.utils.settings.clippings&&this.clippings!=null){dojo.removeClass(this.clippings.domNode,"prmaxhidden");}if(this.engbtn){dojo.attr(this.engbtn,"label","<span><span class=\"main_menu_button\"><i class=\"fa fa-user fa-2x\"></i><p>"+PRMAX.utils.settings.crm_engagement_plural+"</p></span></span>");}if(this.distibution_menu){dojo.attr(this.distribution_menu,"label","<span><span class=\"main_menu_button\"><i class=\"fa fa-share-square-o fa-2x\"></i><p>"+PRMAX.utils.settings.distribution_description_plural+"</p></span></span>");}if(this.distr_menuitem!=undefined){dojo.attr(this.distr_menuitem.containerNode,"innerHTML",PRMAX.utils.settings.distribution_description_plural);}if(PRMAX.utils.settings.has_global_newsroom==false){dojo.addClass(this.newsrooms.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_new_outlet==true){dojo.removeClass(this.pm_new_outlet.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_new_freelance==true){dojo.removeClass(this.pm_new_freelance.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_collateral==true){dojo.removeClass(this.pm_collateral.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_exclusions==true){dojo.removeClass(this.pm_exclusions.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_clients==true){dojo.removeClass(this.clients.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_issues==true){dojo.removeClass(this.pm_issues.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_statements==true){dojo.removeClass(this.pm_statements.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_questions==true){dojo.removeClass(this.pm_questions.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_global_analysis==true){dojo.removeClass(this.pm_global_analysis.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_documents==true){dojo.removeClass(this.pm_documents.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_private_media_channels==true){dojo.removeClass(this.pm_private_media_channels.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_user_preferences==true){dojo.removeClass(this.pm_user_preferences.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_account_details==true){dojo.removeClass(this.pm_account_details.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_activity_log==true){dojo.removeClass(this.pm_activity_log.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_user_admin==true){dojo.removeClass(this.pm_user_admin.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_financial==true){dojo.removeClass(this.pm_financial.domNode,"prmaxhidden");}if(PRMAX.utils.settings.pm_prrequests==true){dojo.removeClass(this.pm_prrequests.domNode,"prmaxhidden");}this.inherited(arguments);},loadLinks:function(){if(this.mainpanel==undefined){this.mainpanel=dijit.byId("std_view_stack");}},_ShowSearchStd:function(){this._StdView("outlet_view",null,false);this._ShowSearchMode();},_ShowSearchAppend:function(){this._StdView("outlet_view",null,false);this._ShowSearchMode();},ShowSearchStd:function(){this._StdView("outlet_view",null,false);this._ShowSearchMode(1);},_ShowResultList:function(){this.ShowResultList();},ShowResultList:function(_1,_2){this._StdView(_1||"outlet_view",_2,true);},_StdView:function(_3,_4,_5){this.loadLinks();href="layout/std_view?result_view="+_3;if(_4!=null){href+="&";href+=_4;}var _6=this.mainpanel.getPage("std_view.search_list");var _7={key:"std_view.search_list",href:href,style:"width:100%;height:100%"};var _6=this.mainpanel.getPage("std_view.search_list");if(_6==null){_6=this.mainpanel.addPage(_7);ttl.utilities.resize(_6);}else{var _8=this.mainpanel.selectedChildWidget;this.mainpanel.showPage(_6);var _9=dijit.byId("std_view.search_list");if(_8!=_6){if(_9!=null){_9.Refresh(_3);}}else{if(_3!=null&&_5==true){if(_9!=null){_9.showView(_3);}}}}},_ShowSearchMode:function(){try{var _a=this.search.show_search_form();this.search._setAdvanceModeAttr(0);_a.show();this.search.focus();}catch(e){}},_ShowListPage:function(){this.loadLinks();this._StdView("outlet_view",null,true);},_Logout:function(){if(confirm("Logout of Prmax?")==true){window.location.href="/logout";}},_Help:function(){this.loadLinks();var _b={key:"help_system.html",href:"layout/help_system",style:"width:100%;height:100%"};var _c=this.mainpanel.getPage("help_system.html");if(_c==null){_c=this.mainpanel.addPage(_b);ttl.utilities.resize(_c);}else{this.mainpanel.showPage(_c);}},ShowListsPage:function(){this._Lists("standing",null);},_Lists:function(_d,_e){this.loadLinks();href="/layout/std_view_lists";if(_d!=null){href=href+"?selectedview="+_d;}if(_e){href=href+"&startup_mode="+_e;}var _f={key:"std_view.list_view",href:href,style:"width:100%;height:100%"};var _10=dijit.byId("std_view_stack");var _11=_10.getPage("std_view.list_view");if(_11==null){_11=_10.addPage(_f);ttl.utilities.resize(_11);}else{dijit.byId("std_view.list_view").refresh(_d,_e);_10.showPage(_11);}},_DoLoadOutlet:function(_12,key,_13){++_13;if(_13>20){return;}var _14=dijit.byId(key+"_controller");if(_14!=undefined&&_14.saveNode!=undefined){_14.Load(_12);}else{setTimeout("dijit.byId('std_banner_control')._DoLoadOutlet("+_12+",'"+key+"',"+_13+");",300);}},_DoLoadNewOutlet:function(key,_15){++_15;if(_15>20){return;}var _16=dijit.byId(key+"_controller");if(_16!=undefined&&_16.saveNode!=undefined){_16.Clear();}else{setTimeout("dijit.byId('std_banner_control')._DoLoadNewOutlet('"+key+"',"+_15+");",300);}},_Outlet:function(){this.ShowOutlet();},ShowOutlet:function(_17){this.loadLinks();var _18={key:"outlet_edit.html",href:"/outlets/outlet_edit",style:"width:100%;height:100%"};var _19=dijit.byId("std_view_stack");var _1a=_19.getPage("outlet_edit.html");if(_1a==null){_1a=_19.addPage(_18);if(_17){this._DoLoadOutlet(_17,_18["key"],1);}else{this._DoLoadNewOutlet(_18["key"],1);}}else{var _1b=dijit.byId(_18["key"]+"_controller");_19.showPage(_1a);_1b.Clear();if(_17){this._DoLoadOutlet(_17,_18["key"],1);}}},_Freelance:function(){this.ShowFreelance();},ShowHomePage:function(){this._ShowStartUp();},_ShowStartUp:function(){this.loadLinks();var _1c=this.mainpanel.getPage("std_start_view");if(_1c!==null){this.mainpanel.showPage(_1c);}else{var _1c=this.mainpanel.getPage("std_view.search_list");if(_1c!==null){this.mainpanel.showPage(_1c);}}},ShowFreelance:function(_1d){this.loadLinks();var _1e={key:"freelance_add.html",href:"/outlets/freelance_add",style:"width:100%;height:100%"};var _1f=this.mainpanel.getPage("freelance_add.html");if(_1f==null){_1f=this.mainpanel.addPage(_1e);ttl.utilities.resize(_1f);if(_1d){this._DoLoadOutlet(_1d,_1e["key"],1);}else{this._DoLoadNewOutlet(_1e["key"],1);}}else{var _20=dijit.byId(_1e["key"]+"_controller");_20.Clear();if(_1d){this._DoLoadOutlet(_1d,_1e["key"],1);}this.mainpanel.showPage(_1f);}},_Preferences:function(){this.largeDialog.set("content","<div dojoType=\"prmax.customer.Preferences\" style=\"width:710px;height:565px\" class=\"scrollpanel\"></div>");this.largeDialog.show("User Preferences");},_Customers:function(){this.stdDialog.set("content","<div dojoType=\"prmax.customer.Customer\"></div>");this.stdDialog.show("Customer Details");},_Tags:function(){this.stdDialog.set("content","<div dojoType=\"prmax.interests.Tags\"></div>");this.stdDialog.show("Tags");},destroy:function(){this.inherited(arguments);delete this.search;},_UserAdmin:function(){this.loadLinks();var _21=this.mainpanel.getPage("std_view.user_admin");var _22={key:"std_view.user_admin",href:"layout/std_user_admin_view",style:"width:100%;height:100%"};var _21=this.mainpanel.getPage("std_view.user_admin");if(_21==null){_21=this.mainpanel.addPage(_22);ttl.utilities.resize(_21);}else{dijit.byId("std_user_admin_view_id").Clear();this.mainpanel.showPage(_21);}},_Collateral:function(){this.loadLinks();var _23={key:"std_view.collateral",href:"layout/std_collateral_view",style:"width:100%;height:100%"};var _24=this.mainpanel.getPage("std_view.collateral");if(_24==null){_24=this.mainpanel.addPage(_23);ttl.utilities.resize(_24);}else{dijit.byId("std_collateral_view_id").Clear();this.mainpanel.showPage(_24);}},_ExclusionList:function(){this.loadLinks();var _25={key:"std_view.exclusions",href:"layout/std_exclusions_view",style:"width:100%;height:100%"};var _26=this.mainpanel.getPage("std_view.exclusions");if(_26==null){_26=this.mainpanel.addPage(_25);ttl.utilities.resize(_26);}else{dijit.byId("std_exclusions_view_id").Clear();this.mainpanel.showPage(_26);}},_Projects:function(){this.loadLinks();var _27={key:"std_view.projects",href:"layout/std_projects_view",style:"width:100%;height:100%"};var _28=this.mainpanel.getPage("std_view.projects");if(_28==null){_28=this.mainpanel.addPage(_27);ttl.utilities.resize(_28);}else{dijit.byId("std_projects_view_id").refresh();this.mainpanel.showPage(_28);}},_DialogCloseEvent:function(_29){this.stdDialog.hide();this.stdDialog.set("content","");this.largeDialog.hide();this.largeDialog.set("content","");},ShowEmailPanel:function(_2a){this.loadLinks();var _2b={key:"show_distribute_panel_view",href:"/layout/std_distribute_panel_view?emailtemplateid="+_2a.emailtemplateid,style:"width:100%;height:100%"};var _2c=this.mainpanel.getPage("show_distribute_panel_view");if(_2c==null){_2c=this.mainpanel.addPage(_2b);ttl.utilities.resize(_2c);}else{var _2d=dijit.byId(_2b["key"]+"_controller");this.mainpanel.showPage(_2c);_2d.Load(_2a.emailtemplateid);}},ShowDistribution:function(_2e){this.ShowEmailPanel(_2e);},_StartPressEvent:function(_2f){this.ShowEmailPanel(_2f);},_UpdateEngagementLabelEvent:function(){dojo.attr(this.engbtn,"label","<span><span class=\"main_menu_button\"><i class=\"fa fa-user fa-2x\"></i><p>"+PRMAX.utils.settings.crm_engagement_plural+"</p></span></span>");},_UpdateDistributionLabelEvent:function(){dojo.attr(this.distribution_menu,"label","<span><span class=\"main_menu_button\"><i class=\"fa fa-share-square-o fa-2x\"></i><p>"+PRMAX.utils.settings.distribution_description_plural+"</p></span></span>");},ShowExistingPressRelease:function(){this.selectrelease.show();},ShowNewPressRelease:function(){this.newrelease.show();},_Distribute:function(){this.loadLinks();var _30={key:"std_view.distribution",href:"/layout/std_distribution_view",style:"width:100%;height:100%"};var _31=this.mainpanel.getPage("std_view.distribution");if(_31==null){_31=this.mainpanel.addPage(_30);ttl.utilities.resize(_31);}else{dijit.byId("std_distribution_view_id").Clear();this.mainpanel.showPage(_31);}},_ShowAdvanceResult:function(){this._StdView("advance_view",null,true);},ShowSearchAdvance:function(_32){try{var _33=this.search.show_search_form(_32);this.search.StartUpAdvance();this.search._setAdvanceModeAttr(_32);_33.show();this.search.focus();}catch(e){}},ShowSentDistributions:function(){this._Lists("distributions","Display Sent");},_Financial:function(){this.loadLinks();var _34={key:"customer_financial.html",href:"/layout/customer_financial",style:"width:100%;height:100%"};var _35=this.mainpanel.getPage("customer_financial.html");if(_35==null){_35=this.mainpanel.addPage(_34);ttl.utilities.resize(_35);}else{this.mainpanel.showPage(_35);}},_Updatum:function(){this.loadLinks();var _36={key:"updatum.html",href:"/updatum/updatum_view",style:"width:100%;height:100%;overflow:hidden"};var _37=this.mainpanel.getPage("updatum.html");if(_37==null){_37=this.mainpanel.addPage(_36);ttl.utilities.resize(_37);}else{this.mainpanel.showPage(_37);}},_Clients:function(){this.loadLinks();var _38={key:"clients.html",href:"/layout/clients",style:"width:100%;height:100%"};var _39=this.mainpanel.getPage("clients.html");if(_39==null){_39=this.mainpanel.addPage(_38);ttl.utilities.resize(_39);}else{this.mainpanel.showPage(_39);}},_Newsrooms:function(){this.loadLinks();var _3a={key:"newsrooms.html",href:"/layout/newsrooms",style:"width:100%;height:100%"};var _3b=this.mainpanel.getPage("newsrooms.html");if(_3b==null){_3b=this.mainpanel.addPage(_3a);ttl.utilities.resize(_3b);}else{this.mainpanel.showPage(_3b);}},_issues:function(){this.loadLinks();var _3c={key:"issues.html",href:"/layout/issues",style:"width:100%;height:100%"};var _3d=this.mainpanel.getPage("issues.html");if(_3d==null){_3d=this.mainpanel.addPage(_3c);ttl.utilities.resize(_3d);}else{this.mainpanel.showPage(_3d);}},_statements:function(){this.loadLinks();var _3e={key:"statements.html",href:"/layout/statements",style:"width:100%;height:100%"};var _3f=this.mainpanel.getPage("statements.html");if(_3f==null){_3f=this.mainpanel.addPage(_3e);ttl.utilities.resize(_3f);}else{this.mainpanel.showPage(_3f);}},_privatechannels:function(){this.loadLinks();var _40={key:"privatechannels.html",href:"/layout/privatechannels",style:"width:100%;height:100%"};var _41=this.mainpanel.getPage("privatechannels.html");if(_41==null){_41=this.mainpanel.addPage(_40);ttl.utilities.resize(_41);}else{this.mainpanel.showPage(_41);}},_show_crm_viewer:function(){this.loadLinks();var _42={key:"crm.html",href:"/layout/crm_view",style:"width:100%;height:100%"};var _43=this.mainpanel.getPage("crm.html");if(_43==null){_43=this.mainpanel.addPage(_42);ttl.utilities.resize(_43);}else{this.mainpanel.showPage(_43);}},_show_documents_view:function(){this.loadLinks();var _44={key:"documents.html",href:"/layout/documents_view",style:"width:100%;height:100%"};var _45=this.mainpanel.getPage("documents.html");if(_45==null){_45=this.mainpanel.addPage(_44);ttl.utilities.resize(_45);}else{this.mainpanel.showPage(_45);}},_show_clippings:function(){this.loadLinks();var _46={key:"clippings.html",href:"/clippings/open_clipping_view",style:"width:100%;height:100%;padding:0px;margin:0px;overflow:hidden;"};var _47=this.mainpanel.getPage("clippings.html");if(_47==null){_47=this.mainpanel.addPage(_46);ttl.utilities.resize(_47);}else{this.mainpanel.showPage(_47);}},_question:function(_48){this.loadLinks();var _49={key:"questions.html",href:"/layout/questions_view",style:"width:100%;height:100%"};var _4a=this.mainpanel.getPage("questions.html");if(_4a==null){_4a=this.mainpanel.addPage(_49);ttl.utilities.resize(_4a);}else{this.mainpanel.showPage(_4a);}},_global_analysis_questions:function(){this.loadLinks();var _4b={key:"global_analysis_questions.html",href:"/layout/global_analysis_questions",style:"width:100%;height:100%"};var _4c=this.mainpanel.getPage("global_analysis_questions.html");if(_4c==null){_4c=this.mainpanel.addPage(_4b);ttl.utilities.resize(_4c);}else{this.mainpanel.showPage(_4c);}},_release_templates:function(){this.loadLinks();var _4d={key:"distributiontemplate.html",href:"/layout/distributiontemplate",style:"width:100%;height:100%"};var _4e=this.mainpanel.getPage("distributiontemplate.html");if(_4e==null){_4e=this.mainpanel.addPage(_4d);ttl.utilities.resize(_4e);}else{this.mainpanel.showPage(_4e);}},_pprrequest:function(){this.loadLinks();var _4f={key:"prrequest.html",href:"/layout/prrequest",style:"width:100%;height:100%"};var _50=this.mainpanel.getPage("prrequest.html");if(_50==null){_50=this.mainpanel.addPage(_4f);ttl.utilities.resize(_50);}else{this.mainpanel.showPage(_50);}},_Activity:function(){this.loadLinks();var _51={key:"activity.html",href:"/layout/activity",style:"width:100%;height:100%"};var _52=this.mainpanel.getPage("activity.html");if(_52==null){_52=this.mainpanel.addPage(_51);ttl.utilities.resize(_52);}else{this.mainpanel.showPage(_52);}},});}