/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.display.startup.plugins.standing"]){dojo._hasResource["prmax.display.startup.plugins.standing"]=true;dojo.provide("prmax.display.startup.plugins.standing");dojo.require("dojox.widget.Portlet");dojo.require("dojox.data.JsonRestStore");dojo.require("prmax.lists.NewListDlg");dojo.declare("prmax.display.startup.plugins.standing",[ttl.BaseWidget],{widgetsInTemplate:true,height:170,templateString:"<div>\r\n\t<div data-dojo-type=\"dojox.widget.Portlet\" data-dojo-attach-point=\"portlet\" data-dojo-props='title:\"Media Lists\", closable:false, style:\"width:100%;height:100%\", toggleable:false, dragRestriction:true'>\r\n\t\t<div data-dojo-attach-point=\"borderCtrl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='style:\"width:100%;height:170px\", gutters:false'>\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"top\", style:\"width:100%;height:20px\"'>\r\n\t\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='style:\"height:99%;width:100%;padding:0px;margin:0px\"'>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\" data-dojo-props='iconClass:\"PRMaxSmallIcon PRMaxSmallFilterIcon\",label:\"Filter\",showLabel:false'>\r\n\t\t\t\t\t\t<div data-dojo-type=\"dijit.TooltipDialog\" data-dojo-props='title:\"Filter By\"' data-dojo-attach-event=\"execute:_ExecuteFilter\">\r\n\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t<tr><td>Name</td><td><input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"filter_listname\" data-dojo-props='name:\"listname\",type:\"text\"' ></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td>Client</td><td><select data-dojo-props='name:\"clientid\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"filter_clientid\" ></select></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td><br/><br/></td></tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td align=\"left\"><button data-dojo-attach-event=\"onClick: _ClearFilter\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\"' >Clear Filter</button></td>\r\n\t\t\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"submit\",name:\"submit\"'>Filter</button></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Add\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"PRMaxSmallIcon PRMaxSmallAddIcon\",label:\"Add New List\",showLabel:false'></div>\r\n\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Search\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"PRMaxSmallIcon PRMaxSmallSearchIcon\",label:\"Search\",showLabel:false'></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='rowsPerPage:50,region:\"center\"' ></div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"prmax.lists.NewListDlg\" data-dojo-attach-point=\"newlistdlg\"></div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._liststore=new dojox.data.JsonRestStore({target:"/lists/rest_lists_standing",idAttribute:"listid"});this._client=new dojox.data.JsonRestStore({target:"/clients/rest_combo",idAttribute:"clientid"});this._open_list_call_back=dojo.hitch(this,this._open_list_call);this._client_added_call_back=dojo.hitch(this,this._client_added_call);},view:{cells:[[{name:"Name",width:"auto",field:"listname"},{name:"Client",width:"200px",field:"clientname"},{name:"Qty",width:"50px",field:"qty"},{name:" ",width:"15px",field:"",formatter:ttl.utilities.formatRowCtrl}]]},postCreate:function(){this.grid.set("structure",this.view);this.grid._setStore(this._liststore);this.filter_clientid.set("store",this._client);this.grid.onRowClick=dojo.hitch(this,this._select_row);this.grid.onCellDblClick=dojo.hitch(this,this._dbl_click_row);this.filter_clientid.set("value",-1);this.newlistdlg.set("callback",this._client_added_call_back);this.borderCtrl.resize({w:400,h:this.height});this.inherited(arguments);},startup:function(){this.inherited(arguments);setTimeout(dojo.hitch(this,this.correct_start_up_size),400);},resize:function(){this.inherited(arguments);},_select_row:function(e){var _1=this.grid.getItem(e.rowIndex);if(e.cellIndex==3&&_1){this._open_list(_1.listid);}this.grid.selection.clickSelectEvent(e);},_dbl_click_row:function(e){var _2=this.grid.getItem(e.rowIndex);if(_2){this._open_list(_2.listid);}},_open_list:function(_3){dojo.xhrPost(ttl.utilities.makeParams({load:this._open_list_call_back,url:"/lists/open",content:{overwrite:1,lists:dojo.toJson([_3]),selected:-1,listtypeid:1}}));},_open_list_call:function(_4){dojo.publish(PRCOMMON.Events.SearchSession_Changed,[_4.data]);dijit.byId("std_banner_control").ShowResultList();},correct_start_up_size:function(){var _5=dojo.position(this.portlet.domNode,true);this.borderCtrl.resize({w:_5.w,h:this.height});},_ExecuteFilter:function(){var _6=ttl.utilities.getPreventCache();if(arguments[0].listname){_6["listname_filter"]=arguments[0].listname;}if(arguments[0].clientid!="-1"){_6["clientid"]=arguments[0].clientid;}this.grid.setQuery(_6);},_ClearFilter:function(){this.filter_listname.set("value","");this.clientid.set("value",-1);this.grid.setQuery(ttl.utilities.getPreventCache());},_Add:function(){this.newlistdlg.show(0,-1,-1);},_client_added_call:function(_7){this._liststore.newItem(_7.list);},_Search:function(){dijit.byId("std_banner_control").ShowSearchStd();}});}