/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.display.startup.plugins.distribution"]){dojo._hasResource["prmax.display.startup.plugins.distribution"]=true;dojo.provide("prmax.display.startup.plugins.distribution");dojo.require("dojox.widget.Portlet");dojo.require("dojox.data.JsonRestStore");dojo.require("prmax.pressrelease.viewfilter");dojo.declare("prmax.display.startup.plugins.distribution",[ttl.BaseWidget],{templateString:dojo.cache("prmax","display/startup/plugins/templates/distribution.html","<div>\r\n\t<div data-dojo-type=\"dojox.widget.Portlet\" data-dojo-attach-point=\"portlet\" data-dojo-props='title:\"Distributions\", dndType:\"Portlet\", closable:false, style:\"width:100%;height:100%\",  toggleable:false, dragRestriction:true'>\r\n\t\t<div data-dojo-attach-point=\"borderCtrl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='style:\"width:100%;height:102px\", gutters:false'>\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"top\", style:\"width:100%;height:20px\"'>\r\n\t\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='style:\"height:99%;width:100%;padding:0px;margin:0px\"'>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\" data-dojo-props='iconClass:\"PRMaxSmallIcon PRMaxSmallFilterIcon\",label:\"Filter\",showLabel:false'>\r\n\t\t\t\t\t\t<div data-dojo-type=\"dijit.TooltipDialog\" data-dojo-props='title:\"Filter By\"' data-dojo-attach-event=\"execute:_ExecuteFilter\">\r\n\t\t\t\t\t\t\t<table width=\"500px\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t\t\t\t\t\t<tr><td style=\"width:100px\" class=\"prmaxlabel\">Name</td><td><input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"emailtemplatename\" data-dojo-props='name:\"emailtemplatename\",type:\"text\"' ></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td class=\"prmaxlabel\">Client</td><td><select data-dojo-props='name:\"clientid\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clientid\" ></select></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td class=\"prmaxlabel\">Show</td><td><div data-dojo-type=\"prmax.pressrelease.viewfilter\" data-dojo-props='name:\"restriction\"' data-dojo-attach-point=\"viewfilter\"></div></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td><br/></td></tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td align=\"left\"><button data-dojo-attach-event=\"onClick: _ClearFilter\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\"' >Clear Filter by</button></td>\r\n\t\t\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"submit\",name:\"submit\"'>Filter</button></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='query:{restriction:2}, rowsPerPage:50,region:\"center\"' ></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-type=\"prmax.lists.NewListDlg\" data-dojo-attach-point=\"newlistdlg\"></div>\r\n</div>\r\n"),height:102,constructor:function(){this._liststore=new dojox.data.JsonRestStore({target:"/emails/rest_distributions",idAttribute:"emailtemplateid"});this._client=new dojox.data.JsonRestStore({target:"/clients/rest_combo",idAttribute:"clientid"});dojo.subscribe("/update/distribution_label",dojo.hitch(this,this._UpdateDistributionLabelEvent));},view:{cells:[[{name:"Description",width:"auto",field:"emailtemplatename"},{name:"Status",width:"60px",field:"status"},{name:"Client",width:"150px",field:"clientname"},{name:"Time Sent",width:"100px",field:"display_sent_time"},{name:" ",width:"15px",field:"",formatter:ttl.utilities.formatRowCtrl}]]},postCreate:function(){this.grid.set("structure",this.view);this.grid._setStore(this._liststore);this.clientid.set("store",this._client);this.grid.onRowClick=dojo.hitch(this,this._select_row);this.grid.onCellDblClick=dojo.hitch(this,this._dbl_click_row);this.clientid.set("value",-1);dojo.attr(this.portlet,"title",PRMAX.utils.settings.distribution_description_plural);this.borderCtrl.resize({w:400,h:this.height});this.inherited(arguments);},_UpdateDistributionLabelEvent:function(){dojo.attr(this.portlet,"title",PRMAX.utils.settings.distribution_description_plural);},startup:function(){this.inherited(arguments);setTimeout(dojo.hitch(this,this.correct_start_up_size),400);},resize:function(){this.inherited(arguments);},_select_row:function(e){var _1=this.grid.getItem(e.rowIndex);if(e.cellIndex==4&&_1&&_1.pressreleasestatusid!=2){this._open_list(_1);}this.grid.selection.clickSelectEvent(e);},_dbl_click_row:function(e){var _2=this.grid.getItem(e.rowIndex);if(_2&&_2.pressreleasestatusid!=2){this._open_list(_2);}},correct_start_up_size:function(){var _3=dojo.position(this.portlet.domNode,true);this.borderCtrl.resize({w:_3.w,h:this.height});},_ExecuteFilter:function(){var _4={};if(arguments[0].emailtemplatename){_4["emailtemplatename"]=arguments[0].emailtemplatename;}if(arguments[0].clientid!="-1"){_4["clientid"]=arguments[0].clientid;}_4["restriction"]=arguments[0].restriction;this.grid.setQuery(_4);},_ClearFilter:function(){this.viewfilter.set("value",2);this.emailtemplatename.set("value","");this.clientid.set("value",-1);},_open_list:function(_5){dojo.publish(PRCOMMON.Events.PressReleaseStart,[_5]);}});}