/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.employee.EmployeeDisplay"]){dojo._hasResource["prmax.employee.EmployeeDisplay"]=true;dojo.provide("prmax.employee.EmployeeDisplay");dojo.require("prcommon.display.panel");dojo.require("prcommon.crm.viewer_only");dojo.require("prcommon.crm.responses.resend");dojo.declare("prmax.employee.EmployeeDisplay",[ttl.BaseWidget],{widgetsInTemplate:true,outletid:-1,employeeid:-1,customerid:-1,ccustomerid:-1,templateString:"<div class=\"employeedisplay\">\r\n\t<div dojoType=\"dijit.layout.BorderContainer\" dojoAttachPoint=\"frame\" gutters=\"false\">\r\n\t\t<div dojoAttachPoint=\"tabControl\" dojotype=\"dijit.layout.TabContainer\" tabStrip=\"true\" region=\"center\">\r\n\t\t\t<div dojoAttachPoint=\"maintab\" dojoType=\"ttl.layout.ContentPane\" title='Details' selected=\"true\" style=\"padding:2px\" class=\"scrollpanel\">\r\n\t\t\t\t<table class=\"prmaxtable\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-style:collapsed\" >\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td width=\"10%\" class=\"prmaxrowdisplaylarge\" rowspan=\"3\" ><img  dojoAttachPoint=\"employee_profile_image_url\" /></td><td class=\"prmaxrowdisplaylarge\" width=\"80%\" dojoAttachPoint=\"employee_display_contactname\"></td>\r\n\t\t\t\t\t\t<td width=\"10%\" class=\"employeetype\" dojoAttachPoint=\"employee_display_options\" ></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowdisplaymedium\" colspan=\"2\" dojoAttachPoint=\"employee_display_job_title\"></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\" valign=\"top\" colspan=\"2\" class=\"prmaxrowdisplay\" dojoAttachPoint=\"interest_display\"></td></tr>\r\n\t\t\t\t</table></br>\t\r\n<!--\r\n\t\t\t\t<table style=\"margin-bottom:20px\">\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\" valign=\"top\" class=\"prmaxrowdisplay\" dojoAttachPoint=\"interest_display\"></td></tr>\r\n\t\t\t\t</table>\r\n-->\r\n\t\t\t\t<table class=\"prmaxtable\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-style:collapsed\" >\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td width=\"10%\" class=\"prmaxrowtag\"><i class=\"fa fa-envelope-o fa-2x prmaxhidden\" dojoAttachPoint=\"employee_display_email_icon\" aria-hidden=\"true\"></td>\r\n\t\t\t\t\t\t<td width=\"40%\" class=\"prmaxrowdisplay\"><a dojoAttachPoint=\"employee_display_email\" href='outlet.email' style=\"width:100%\" target=\"blank\"></a></td>\r\n\t\t\t\t\t\t<td width=\"10%\" class=\"prmaxrowtag\" ><i class=\"fa fa-phone fa-2x prmaxhidden\" dojoAttachPoint=\"employee_display_tel_icon\" aria-hidden=\"true\"></td>\r\n\t\t\t\t\t\t<td width=\"40%\" class=\"prmaxrowdisplay\" colspan=\"2\" dojoAttachPoint=\"employee_display_tel\"></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td width=\"10%\" class=\"prmaxrowtag\"><i class=\"fa fa-twitter fa-2x prmaxhidden\" dojoAttachPoint=\"employee_display_twitter_icon\" aria-hidden=\"true\"></td>\r\n\t\t\t\t\t\t<td width=\"40%\" class=\"prmaxrowdisplay\"><a dojoAttachPoint=\"employee_display_twitter\" style=\"width:100%\" target=\"blank\"></a></td>\r\n\t\t\t\t\t\t<td width=\"10%\" class=\"prmaxrowtag\"><i class=\"fa fa-mobile fa-2x prmaxhidden\" dojoAttachPoint=\"employee_display_mobile_icon\" aria-hidden=\"true\"></td>\r\n\t\t\t\t\t\t<td width=\"40%\" class=\"prmaxrowdisplay\"><a dojoAttachPoint=\"employee_display_mobile\" style=\"width:100%\" target=\"blank\"></a></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td width=\"10%\" class=\"prmaxrowtag\"><i class=\"fa fa-linkedin fa-2x prmaxhidden\" dojoAttachPoint=\"employee_display_linkedin_icon\" aria-hidden=\"true\"></td>\r\n\t\t\t\t\t\t<td width=\"40%\" class=\"prmaxrowdisplay\"><a dojoAttachPoint=\"employee_display_linkedin\" style=\"width:100%\" target=\"blank\"></a></td>\r\n\t\t\t\t\t\t<td width=\"10%\" class=\"prmaxrowtag\"><i class=\"fa fa-instagram fa-2x prmaxhidden\" dojoAttachPoint=\"employee_display_instagram_icon\" aria-hidden=\"true\"></td>\r\n\t\t\t\t\t\t<td width=\"40%\" class=\"prmaxrowdisplay\"><a dojoAttachPoint=\"employee_display_instagram\" style=\"width:100%\" target=\"blank\"></a></td>\r\n\t\t\t\t\t</tr>\r\n\r\n\t\t\t\t</table></br>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType=\"ttl.layout.ContentPane\" title='Notes' >\r\n\t\t\t\t<div style=\"padding:2px\">\r\n\t\t\t\t\t<table class=\"prmaxtable\" width=\"100%\" >\r\n\t\t\t\t\t\t<tr><td valign=\"top\" class=\"prmaxrowdisplayinfo\" width=\"17%\">Your notes&nbsp;<button class=\"prmaxbuttongreybutton\" type=\"button\" dojoAttachEvent=\"onclick:_do_notes_edit\">Add Notes</button></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowdisplay\" dojoAttachPoint=\"employee_display_localprofile\"></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoAttachPoint=\"whereusedtab\" dojoType=\"dijit.layout.BorderContainer\" design=\"headline\" title='History'>\r\n\t\t\t\t<table dojoAttachPoint=\"whereused\" dojoType=\"dojox.grid.DataGrid\" query=\"{employeeid:-1}\" rowsPerPage=\"50\" region=\"center\" style=\"width:100%;height:100%\">\r\n\t\t\t\t\t<thead><tr><th field=\"listname\" width=\"auto\">List Name</th><th field=\"listtypedescription\" width=\"auto\">Type</th><th field=\"update_time\" width=\"auto\">Date</th></tr></thead>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-attach-point=\"crmview\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='title:\"Engagement\",preload:true'>\r\n\t\t\t\t<div data-dojo-attach-point=\"crmctrl\" data-dojo-type=\"prcommon.crm.viewer_only\" data-dojo-props='region:\"center\",mode:\"contact\"'></div>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-attach-point=\"resendview\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='title:\"Contact\",preload:true'>\r\n\t\t\t\t<div data-dojo-attach-point=\"resendctrl\" data-dojo-type=\"prcommon.crm.responses.resend\" data-dojo-props='region:\"center\"'></div>\r\n\t\t\t</div>\r\n\r\n\t\t</div>\r\n\t</div>\r\n\t<div class=\"prmaxrowdisplaylarge prmaxnametab\"><div style=\"text-align:right;padding-right:4px;padding-top:3px\"></div></div>\r\n</div>\r\n",constructor:function(){this._LoadCallBack=dojo.hitch(this,this._Load);this.crm_loaded=false;this.resend_loaded=false;this.whereused_loaded=false;this._setstore=false;this._contactid=null;this._outletid=null;this._outletname=null;dojo.subscribe(PRCOMMON.Events.Update_Notes,dojo.hitch(this,this._profile_refresh_event));dojo.subscribe("/update/engagement_label",dojo.hitch(this,this._UpdateEngagementLabelEvent));},postCreate:function(){this.whereusedstore=new dojox.data.QueryReadStore({url:"/lists/whereused",onError:ttl.utilities.globalerrorchecker});dojo.subscribe(this.tabControl.id+"-selectChild",dojo.hitch(this,this.onSelectTab));this.whereused._setStore(this.whereusedstore);this.inherited(arguments);},startup:function(){this.inherited(arguments);if(this.crmview&&this.crmview.controlButton){this.crmview.controlButton.domNode.style.display=(PRMAX.utils.settings.crm)?"":"none";}if(this.resendview&&this.resendview.controlButton){this.resendview.controlButton.domNode.style.display=(PRMAX.utils.settings.crm)?"":"none";}},onSelectTab:function(_1){if(_1.id==this.whereusedtab.id&&this.whereused_loaded==false){this.whereused_loaded=true;this.whereused.setQuery(ttl.utilities.getPreventCache({employeeid:this.employeeid}));}if(_1.id==this.resendview.id){this.resendctrl.Load(this._contactemail,this.employeeid);}if(_1.id==this.crmview.id&&this.crm_loaded==false){this.crm_loaded=true;this.crmctrl.load_employee(this.employeeid,this.contactname,this._outletid,this._contactid,this._outletname);}},LoadEmployee:function(_2,_3){this.employeeid=_2;this.contactname=_3;if(this.contactname==undefined){this.contactname="";}if(this.employeeid==-1){this.Clear();}else{this._clear_loaded_data();dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCallBack,url:"/employees/employeedisplay",content:{employeeid:_2}}));}this.LoadWhereUsed(_2);},_Load:function(_4){this._contactemail=_4.employee.email;this.tabControl.selectChild(this.maintab);this.Clear();this._contactid=_4.employee.contactid;this._outletid=_4.employee.outletid;this._outletname=_4.employee.outletname;this.crmview.set("title",PRMAX.utils.settings.crm_engagement_plural);dojo.attr(this.employee_display_contactname,"innerHTML",_4.employee.contactname_limited);dojo.attr(this.employee_display_job_title,"innerHTML",_4.employee.job_title);dojo.attr(this.employee_profile_image_url,"src",_4.employee.profileimageurl);if(_4.employee.email!=null&&_4.employee.email.trim().length>0){dojo.attr(this.employee_display_email,"href","mailto:"+_4.employee.email);dojo.attr(this.employee_display_email,"innerHTML",_4.employee.email);dojo.removeClass(this.employee_display_email_icon,"prmaxhidden");}else{dojo.addClass(this.employee_display_email_icon,"prmaxhidden");}if(_4.employee.twitter!=null&&_4.employee.twitter.trim().length>0){dojo.attr(this.employee_display_twitter,"href",_4.employee.twitter);dojo.attr(this.employee_display_twitter,"innerHTML",_4.employee.twitter);dojo.removeClass(this.employee_display_twitter_icon,"prmaxhidden");}else{dojo.addClass(this.employee_display_twitter_icon,"prmaxhidden");}if(_4.employee.linkedin!=null&&_4.employee.linkedin.length>0){dojo.attr(this.employee_display_linkedin,"href",_4.employee.linkedin);dojo.attr(this.employee_display_linkedin,"innerHTML",_4.employee.linkedin);dojo.removeClass(this.employee_display_linkedin_icon,"prmaxhidden");}else{dojo.addClass(this.employee_display_linkedin_icon,"prmaxhidden");}if(_4.employee.instagram!=null&&_4.employee.instagram.trim().length>0){dojo.attr(this.employee_display_instagram,"href",_4.employee.instagram);dojo.attr(this.employee_display_instagram,"innerHTML",_4.employee.instagram);dojo.removeClass(this.employee_display_instagram_icon,"prmaxhidden");}else{dojo.addClass(this.employee_display_instagram_icon,"prmaxhidden");}if(_4.employee.tel!=null&&_4.employee.tel.trim().length>0){dojo.attr(this.employee_display_tel,"innerHTML",_4.employee.tel);dojo.removeClass(this.employee_display_tel_icon,"prmaxhidden");}else{dojo.addClass(this.employee_display_tel_icon,"prmaxhidden");}if(_4.employee.mobile!=null&&_4.employee.mobile.trim().length>0){dojo.attr(this.employee_display_mobile,"innerHTML",_4.employee.mobile);dojo.removeClass(this.employee_display_mobile_icon,"prmaxhidden");}else{dojo.addClass(this.employee_display_mobile_icon,"prmaxhidden");}dojo.attr(this.employee_display_localprofile,"innerHTML",_4.employee.localprofile.replace(/\n/g,"<br/>"));if(_4.employee_display_interests!=null&&_4.employee_display_interests!=""){dojo.attr(this.interest_display,"innerHTML","Covers news on "+_4.employee_display_interests);}this.customerid=_4.employee.customerid;this.ccustomerid=_4.employee.customerid;var _5="";dojo.attr(this.employee_display_options,"innerHTML",_5);},_UpdateEngagementLabelEvent:function(){this.crmview.set("title",PRMAX.utils.settings.crm_engagement_plural);},LoadWhereUsed:function(_6){this.whereused.setQuery(ttl.utilities.getPreventCache({employeeid:_6}));this.whereused.render();},_Emptyfields:["employee_display_contactname","employee_display_contactname","employee_display_job_title","employee_display_email","employee_display_twitter","employee_display_linkedin","employee_display_instagram","employee_display_tel","employee_display_mobile","employee_display_localprofile","interest_display"],Clear:function(){this.customerid=-1;this.ccustomerid=-1;for(var _7 in this._Emptyfields){dojo.attr(this[this._Emptyfields[_7]],"innerHTML","");}this._clear_loaded_data();this.tabControl.selectChild(this.maintab);},_Expand:function(){ttl.utilities.open_close_panel_node(this.tglbtn,this.interest_inner_panel);},destroy:function(){delete this.whereusedstore;this.inherited(arguments);},resize:function(){if(arguments[0]){this.frame.resize({h:arguments[0].h,l:arguments[0].l,t:0,w:arguments[0].w});}this.inherited(arguments);},_do_notes_edit:function(){dojo.publish(PRCOMMON.Events.Edit_Notes,[null,this.employeeid]);},_profile_refresh_event:function(_8,_9){if(_9!=null&&_9==this.employeeid){this.LoadEmployee(_9);}},_clear_loaded_data:function(){this.crm_loaded=false;this.whereused_loaded=false;}});}