/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.employee.EmployeeOverride"]){dojo._hasResource["prmax.employee.EmployeeOverride"]=true;dojo.provide("prmax.employee.EmployeeOverride");dojo.require("ttl.BaseWidget");dojo.declare("prmax.employee.EmployeeOverride",[ttl.BaseWidget],{employeeid:-1,widgetsInTemplate:true,templateString:"<div>\r\n<form class=\"prmaxdefault\" dojoType=\"dijit.form.Form\" dojoAttachPoint=\"overrideNode\" onSubmit=\"return false\">\r\n<table style=\"width:99%\" class=\"prmaxtable\">\r\n<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n<tr><td class=\"prmaxrowtag\">Email:</td><td ><input style=\"width:20em\" name=\"email\" dojoAttachPoint=\"email\" type=\"text\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.emailAddress\" trim=\"true\" invalidMessage=\"invalid email address\" size=\"20\" maxlength=\"70\"></tr>\r\n<tr><td class=\"prmaxrowtag\">Tel:</td><td><input style=\"width:20em\" dojoAttachPoint=\"tel\" name=\"tel\" type=\"text\" maxlength=\"40\" dojoType=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n<tr><td class=\"prmaxrowtag\">Fax:</td><td><input style=\"width:20em\" dojoAttachPoint=\"fax\" name=\"fax\" type=\"text\" maxlength=\"40\" dojoType=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n<tr><td class=\"prmaxrowtag\">Mobile</td><td><input style=\"width:20em\" dojoAttachPoint=\"mobile\" name=\"mobile\" type=\"text\" maxlength=\"40\" dojoType=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n<tr><td colspan=\"2\"><div dojoAttachPoint=\"interests\" name=\"interests\" class=\"prmaxhidden\" selectonly=\"true\" startopen=\"true\" displaytitle=\"Tags\" nofilter=\"true\" size=\"6\" interesttypeid=\"2\" dojoAttachPoint=\"interest\" restrict=\"0\"  dojoType=\"prcommon.interests.Interests\" keytypeid=\"6\" ></div></td></tr>\r\n<tr><td class=\"prmaxrowtag\" valign=\"top\">Profile:</td>\r\n<td><div class=\"dialogprofileframe\" ><textarea dojoAttachPoint=\"profile\" name=\"profile\" class=\"dijitTextarea\" dojoType=\"dijit.form.Textarea\"  style=\"width:99%;height:99%\"></textarea></div></td></tr>\r\n<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n<tr>\r\n<td  align=\"left\"><button   type=\"button\" class=\"prmaxbutton\" dojoAttachPoint=\"cancelNode\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_Close\"  label=\"Close\"></button></td>\r\n<td  align=\"right\"><button  type=\"button\" class=\"prmaxbutton\"  dojoAttachPoint=\"saveNode\" dojoType=\"dojox.form.BusyButton\" dojoAttachEvent=\"onClick:_Save\" busyLabel=\"Please Wait Saving...\"  label=\"Save\"></button></td></tr></table>\r\n</form>\r\n</div>\r\n",constructor:function(){this._LoadCall=dojo.hitch(this,this._Load);this._SavedCall=dojo.hitch(this,this._Saved);},postCreate:function(){if(PRMAX.utils.settings.productid==PRCOMMON.Constants.PRMAX_Pro){dojo.removeClass(this.interests.domNode,"prmaxhidden");}dojo.connect(this.overrideNode,"onSubmit",dojo.hitch(this,this._Submit));this.Load();},Load:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCall,url:"/employees/employee_override_get",content:{employeeid:this.employeeid}}));},_Load:function(_1){if(_1.data.employee!=null){with(_1.data.employee){this.tel.set("value",tel);this.email.set("value",email);this.fax.set("value",fax);this.profile.set("value",profile);this.mobile.set("value",mobile);}}this.interests.set("value",_1.data.interests);this.saveNode.set("disabled",false);},Clear:function(){this.saveNode.cancel();this.tel.set("value","");this.email.set("value","");this.fax.set("value","");this.profile.set("value","");this.interests.set("value","");this.saveNode.set("disabled",true);this.mobile.set("value","");},_Saved:function(_2){if(_2.success=="OK"){dojo.publish(PRCOMMON.Events.Employee_Override,[_2.employee]);alert("Details Saved");this.saveNode.cancel();this.Clear();dojo.publish(PRCOMMON.Events.Dialog_Close,["employeeoverride"]);}else{alert("Problem updating details");this.saveNode.cancel();}},_Submit:function(){if(ttl.utilities.formValidator(this.overrideNode)==false){alert("Not all required field filled in");this.saveNode.cancel();return;}var _3=this.overrideNode.getValues();_3["employeeid"]=this.employeeid;dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedCall,url:"/employees/employee_override_save",content:_3}));},_Close:function(){this.Clear();dojo.publish(PRCOMMON.Events.Dialog_Close,["employeeoverride"]);},_Save:function(){this.overrideNode.submit();}});}