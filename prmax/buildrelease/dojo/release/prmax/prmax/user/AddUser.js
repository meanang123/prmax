/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.user.AddUser"]){dojo._hasResource["prmax.user.AddUser"]=true;dojo.provide("prmax.user.AddUser");dojo.require("dijit._Templated");dojo.require("dijit._Widget");dojo.require("dijit._Container");dojo.declare("prmax.user.AddUser",[dijit._Widget,dijit._Templated,dijit._Container],{widgetsInTemplate:true,templateString:"<div>\r\n    <form class=\"prmaxdefault\" dojoAttachPoint=\"addform\" dojoType=\"dijit.form.Form\" onSubmit=\"return false\">\r\n\t<input dojoAttachPoint=\"icustomerid\" name=\"icustomerid\" type=\"hidden\" size=\"40\" dojoType=\"dijit.form.TextBox\" value=\"\" />\r\n\t<input dojoAttachPoint=\"extended_security\" name=\"extended_security\" type=\"hidden\" size=\"40\" dojoType=\"dijit.form.TextBox\" value=\"\" />\r\n        <table style=\"width:350px\" class=\"prmaxtable\" >\r\n             <tr>\r\n\t\t\t\t<td width=\"30%\" class=\"prmaxrowtag\">Email Address</td>\r\n\t\t\t\t<td><input dojoAttachPoint=\"email\" name=\"email\" type=\"text\" size=\"40\" maxlength=\"80\" trim=\"true\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.emailAddress\" required=\"true\" trim=\"true\" invalidMessage=\"invalid email address\" size=\"40\" maxlength=\"70\"/></td>\r\n\t\t\t</tr>\r\n             <tr>\r\n\t\t\t\t<td width=\"30%\" class=\"prmaxrowtag\">Display Name</td>\r\n\t\t\t\t<td><input dojoAttachPoint=\"displayname\" name=\"displayname\" type=\"text\" size=\"40\" maxlength=\"80\" trim=\"true\" dojoType=\"dijit.form.ValidationTextBox\" required=\"true\" trim=\"true\" invalidMessage=\"Must be entered\" size=\"40\" maxlength=\"40\"/></td>\r\n\t\t\t</tr>\r\n             <tr>\r\n\t\t\t\t<td width=\"30%\" class=\"prmaxrowtag\">Password</td>\r\n\t\t\t\t<td><input dojoAttachPoint=\"password\" name=\"password\" type=\"password\" size=\"20\" maxlength=\"20\" trim=\"true\" dojoType=\"dijit.form.ValidationTextBox\" required=\"true\" trim=\"true\" invalidMessage=\"Must be entered\" size=\"20\" maxlength=\"20\"/></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr dojoAttachPoint=\"external_id_view\" class=\"prmaxhidden\"><td class=\"prmaxrowtag\" style=\"width:30%\">External Id</td><td width=\"70%\"><input class=\"prmaxinput\" dojoAttachPoint=\"external_key\" name=\"external_key\" type=\"text\" trim=\"true\" required=\"false\" dojoType=\"dijit.form.ValidationTextBox\" ></td></tr>\r\n\t\t\t<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n\t\t\t<tr><td colspan=\"2\" align=\"right\"><button class=\"prmaxbutton\" dojoAttachPoint=\"saveAddNode\" dojoAttachEvent=\"onClick:_AddUser\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Adding...\" label=\"Add\"></button></td></tr>\r\n\t\t\t<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n\t\t</table>\r\n\t</form>\r\n</div>\r\n",constructor:function(){},postCreate:function(){dojo.connect(this.addform,"onSubmit",dojo.hitch(this,this._Add));this._SavedCall=dojo.hitch(this,this._Saved);},_AddUser:function(){if(ttl.utilities.formValidator(this.addform)==false){alert("Not all required field filled in");this.saveAddNode.cancel();return;}var _1=this.password.value;if(this.extended_security.value==true){if(_1.length<8||this._has_lower_case(_1)==false||this._has_upper_case(_1)==false||this._has_number(_1)==false){alert("Please enter a valid password: minimum length 8 characters, at least one character upper case, one character lower case and one digit");this.saveAddNode.cancel();return;}}dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedCall,url:"/user/add",content:this.addform.get("value")}));},_Saved:function(_2){if(_2.success=="OK"){this.saveAddNode.cancel();dojo.publish(PRCOMMON.Events.User_Added,[_2.data]);}else{alert(_2.message);this.saveAddNode.cancel();}},_Add:function(){this.addform.submit();},Clear:function(){this.email.set("value","");this.displayname.set("value","");this.password.set("value","");this.external_key.set("value","");},_has_lower_case:function(_3){var i=0;while(i<=_3.length){c=_3.charAt(i);if(c==c.toLowerCase()){return true;}i++;}return false;},_has_upper_case:function(_4){var i=0;while(i<=_4.length){c=_4.charAt(i);if(c==c.toUpperCase()){return true;}i++;}return false;},_has_number:function(_5){var i=0;while(i<=_5.length){c=_5.charAt(i);if(parseInt(c)){return true;}i++;}return false;},set_has_external_level:function(_6){if(_6==23|_6==24){dojo.removeClass(this.external_id_view,"prmaxhidden");this.external_key.set("required",true);}else{dojo.addClass(this.external_id_view,"prmaxhidden");this.external_key.set("required",false);}}});}