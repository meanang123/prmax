/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.customer.clients.add"]){dojo._hasResource["prmax.customer.clients.add"]=true;dojo.provide("prmax.customer.clients.add");dojo.require("dijit.Editor");dojo.require("prmax.customer.clients.headerimage");dojo.require("dijit._editor.plugins.AlwaysShowToolbar");dojo.require("dijit._editor.plugins.ViewSource");dojo.require("dijit._editor.plugins.FontChoice");dojo.require("dojox.editor.plugins.Preview");dojo.require("prmax.customer.clients.pickcolour");dojo.require("prcommon.clippings.questions.analysis_viewer");dojo.declare("prmax.customer.clients.add",[ttl.BaseWidget],{widgetsInTemplate:true,mode:"add",templateString:"<div>\r\n\t<div data-dojo-attach-point=\"frame\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='gutters:false,style:\"width:100%;height:100%\"' >\r\n\t\t<div data-dojo-attach-point=\"tabcont\" data-dojo-type=\"dijit.layout.TabContainer\" data-dojo-props=\"region:'center',splitter:true,'class':'bordered'\">\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='title:\"Details\",style:\"width:100%;height:100%\"'>\r\n\t\t\t\t<form data-dojo-attach-point=\"form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='\"class\":\"prmaxdefault common_prmax_layout\",onsubmit:\"return false\"'>\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t<input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"clientid\" data-dojo-props='name:\"clientid\",type:\"hidden\",value:\"-1\"' >\r\n\t\t\t\t\t<label data-dojo-attach-point=\"client_name\" class=\"label_2\">Client Name</label><input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"clientname\" data-dojo-props='\"class\":\"prmaxrequired\",name:\"clientname\",required:true,trim:true,maxLength:120,invalidMessage:\"Client Name Required\",promptMessage:\"Please Enter a Client Name\",type:\"text\",style:\"width:20em\"'></br>\r\n\t\t\t\t\t<label class=\"label_2\">Www</label><input data-dojo-attach-point=\"www\" data-dojo-props='name:\"www\",type:\"text\",size:\"40\",maxLength:\"90\",trim:true,style:\"width:25em\",regExpGen:dojox.validate.regexp.url' data-dojo-type=\"dijit.form.ValidationTextBox\"/><br/>\r\n\t\t\t\t\t<label class=\"label_2\">Email</label><input data-dojo-attach-point=\"email\" data-dojo-props='name:\"email\",type:\"text\",size:\"40\",maxLength:\"84\",trim:true,style:\"width:25em\",regExpGen:dojox.validate.regexp.emailAddress' data-dojo-type=\"dijit.form.ValidationTextBox\"/><br/>\r\n\t\t\t\t\t<label class=\"label_2\">Tel</label><input data-dojo-attach-point=\"tel\" data-dojo-props='name:\"tel\",type:\"text\",maxLength:\"40\",style:\"15em\"' data-dojo-type=\"dijit.form.TextBox\"/><br/>\r\n\t\t\t\t\t<label class=\"label_2\">Twitter</label><input data-dojo-attach-point=\"twitter\" data-dojo-props='\"class\":\"prmaxinput\",name:\"twitter\",type:\"text\",maxLength:\"90\",regExpGen:dojox.validate.regexp.url,trim:true,style:\"width:25em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" /><br/>\r\n\t\t\t\t\t<label class=\"label_2\">Facebook</label><input data-dojo-attach-point=\"facebook\" data-dojo-props='\"class\":\"prmaxinput\",name:\"facebook\",type:\"text\",maxLength:\"90\",regExpGen:dojox.validate.regexp.url,trim:true,style:\"width:25em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" /><br/>\r\n\t\t\t\t\t<label class=\"label_2\">Linkedin</label><input data-dojo-attach-point=\"linkedin\" data-dojo-props='\"class\":\"prmaxinput\",name:\"linkedin\",type:\"text\",maxLength:\"80\",regExpGen:dojox.validate.regexp.url,trim:true,style:\"width:25em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" /><br/>\r\n\t\t\t\t\t<label class=\"label_2\">Instagram</label><input data-dojo-attach-point=\"instagram\" data-dojo-props='\"class\":\"prmaxinput\",name:\"instagram\",type:\"text\",maxLength:\"80\",regExpGen:dojox.validate.regexp.url,trim:true,style:\"width:25em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" /><br/>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='title:\"NewsRoom\",style:\"width:100%;height:100%\",\"class\":\"scrollpanel\"' data-dojo-attach-point=\"tab_newoom\">\r\n\t\t\t\t<form data-dojo-attach-point=\"form2\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='\"class\":\"prmaxdefault common_prmax_layout\",onsubmit:\"return false\"'>\r\n\t\t\t\t\t<input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"newsroomid\" data-dojo-props='name:\"newsroomid\",type:\"hidden\",value:\"-1\"' >\r\n\t\t\t\t\t<div data-dojo-attach-point=\"newsroom_avaliable\" class=\"prmaxhidden\"<label class=\"label_1\">Has Newsroom</label><input data-dojo-type=\"dijit.form.CheckBox\" data-dojo-attach-point=\"has_news_room\" data-dojo-props='type:\"checkbox\",name:\"has_news_room\"' data-dojo-attach-event=\"onChange:_new_room_show\"/></br></div>\r\n\t\t\t\t\t<div data-dojo-attach-point=\"news_room_details\" class=\"prmaxhidden\">\r\n\t\t\t\t\t\t<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t<td align=\"right\" class=\"prmaxrowtag\" width=\"20%\">News Room Root</td>\r\n\t\t\t\t\t\t\t\t<td colspan=\"2\"><input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"news_room_root\" data-dojo-props='lowercase:true,\"class\":\"prmaxrequired\",name:\"news_room_root\",trim:true,maxLength:20,type:\"text\",style:\"width:10em\", regExp:\"[\\\\w]+\", invalidMessage:\"Invalid\"'/></td>\r\n\t\t\t\t\t\t\t\t<td><button data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"show_new_room_url\" data-dojo-attach-event=\"onClick:_show_new_room_url\" data-dojo-props='type:\"button\",\"class\":\"prmaxhidden\",label:\"Goto News Room\"'></button></td>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t<td align=\"right\" class=\"prmaxrowtag\">Custom Link 1</td>\r\n\t\t\t\t\t\t\t\t<td colspan=\"2\">\r\n\t\t\t\t\t\t\t\t\t<span class=\"prmaxrowtag\">Name</span><input data-dojo-attach-point=\"link_1_name\" data-dojo-props='\"class\":\"prmaxinput\",name:\"link_1_name\",type:\"text\",maxLength:\"80\",trim:true,style:\"width:10em\"' data-dojo-type=\"dijit.form.TextBox\" />\r\n\t\t\t\t\t\t\t\t\t<span class=\"prmaxrowtag\">Url</span><input data-dojo-attach-point=\"link_1_url\" data-dojo-props='\"class\":\"prmaxinput\",name:\"link_1_url\",type:\"text\",maxLength:\"80\",regExpGen:dojox.validate.regexp.url,trim:true,style:\"width:20em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" />\r\n\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t<td align=\"right\" class=\"prmaxrowtag\">Custom Link 2</td>\r\n\t\t\t\t\t\t\t\t<td colspan=\"2\">\r\n\t\t\t\t\t\t\t\t\t<span class=\"prmaxrowtag\">Name</span><input data-dojo-attach-point=\"link_2_name\" data-dojo-props='\"class\":\"prmaxinput\",name:\"link_2_name\",type:\"text\",maxLength:\"80\",trim:true,style:\"width:10em\"' data-dojo-type=\"dijit.form.TextBox\" />\r\n\t\t\t\t\t\t\t\t\t<span class=\"prmaxrowtag\">Url</span><input data-dojo-attach-point=\"link_2_url\" data-dojo-props='\"class\":\"prmaxinput\",name:\"link_2_url\",type:\"text\",maxLength:\"80\",regExpGen:dojox.validate.regexp.url,trim:true,style:\"width:20em\"' data-dojo-type=\"dijit.form.ValidationTextBox\" />\r\n\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t<td align=\"right\" class=\"prmaxrowtag\" valign=\"top\" >Header Color</td>\r\n\t\t\t\t\t\t\t\t<td width=\"200px\">\r\n\t\t\t\t\t\t\t\t\t<div data-dojo-type=\"prmax.customer.clients.pickcolour\" data-dojo-attach-point=\"header_colour\" data-dojo-props='name:\"header_colour\",style:\"width:200px\"' data-dojo-attach-event=\"onClick:_ColourUpdate\" ></div>\r\n\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t<td >\r\n\t\t\t\t\t\t\t\t\t<label><input data-dojo-attach-point=\"default_header_colour\" data-dojo-type=\"dijit.form.CheckBox\" data-dojo-props='\"class\":\"prmaxdefault\",type:\"checkbox\",value:\"0\",checked:false' data-dojo-attach-event=\"onClick:_use_default_color\"/>Use Default</label><br/>\r\n\t\t\t\t\t\t\t\t</td>\r\n\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\" >Header Image Left</td><td colspan=\"3\"><div data-dojo-type=\"prmax.customer.clients.headerimage\" data-dojo-attach-point=\"headerimage_left\" data-dojo-props='style:\"width:500px;height:120px;margin:2px\",\"class\":\"bordered\",title:\"Left side Image\",imagetypeid:1,name:\"headerimageleftid\"' ></div></td></tr>\r\n\t\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\" >Header Image Right</td><td colspan=\"3\"><div data-dojo-type=\"prmax.customer.clients.headerimage\" data-dojo-attach-point=\"headerimage_right\" data-dojo-props='style:\"width:500px;height:120px;margin:2px\",\"class\":\"bordered\",title:\"Right side Image\",imagetypeid:2,name:\"headerimagerightid\"' ></div></td></tr>\r\n\t\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\" >About</td><td colspan=\"3\"><div data-dojo-type=\"dijit.Editor\" data-dojo-attach-point=\"about_template\" data-dojo-props='name:\"about_template\", \"class\":\"bordered\", extraPlugins:[{name:\"dijit._editor.plugins.FontChoice\",command:\"fontName\", generic:false},\"fontSize\",\"createLink\",\"viewsource\",\"preview\"],style:\"width:95%;height:150px\"' ></div></td></tr>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</form>\r\n\t\t\t\t<form data-dojo-attach-point=\"show_news_room_form\" target=\"_blank\" method=\"post\" action=\"\"></form>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-attach-point=\"analysis_tab\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='title:\"Analysis\",gutters:false' >\r\n\t\t\t\t<div data-dojo-type=\"prcommon.clippings.questions.analysis_viewer\" data-dojo-props='region:\"center\",style:\"width:100%;height:100%\"' data-dojo-attach-point=\"analysis_ctrl\"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"bottom\",style:\"width:100%;height:50px\"'>\r\n\t\t\t<div class=\"common_prmax_layout\" style=\"padding:2px;\">\r\n\t\t\t\t<button data-dojo-attach-point=\"delete_ctrl\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-attach-event=\"onClick:_Delete_Customer\" data-dojo-props='busyLabel:\"Please Wait Deleting...\",\"class\":\"prmaxbutton prmaxhidden\",style:\"float:left\",label:\"Delete\"'></button>\r\n\t\t\t\t<button data-dojo-attach-point=\"save\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-attach-event=\"onClick:_Add_Customer\" data-dojo-props='busyLabel:\"Please Wait...\",\"class\":\"prmaxbutton\",style:\"float:right\",label:\"Create\"'>Create</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._Save_Call_Back=dojo.hitch(this,this._Save_Call);this._Load_Call_Back=dojo.hitch(this,this._Load_Call);this._Delete_Call_Back=dojo.hitch(this,this._Delete_Call);this._icustomerid=null;},postCreate:function(){this.inherited(arguments);dojo.attr(this.client_name,"innerHTML",PRMAX.utils.settings.client_name+" Short Name");},startup:function(){if(this.mode=="edit"){this.save._label="Update";dojo.attr(this.save.containerNode,"innerHTML","Update");}else{this.headerimage_left.show();this.headerimage_right.show();}this.inherited(arguments);if(PRMAX.utils.settings.has_news_rooms==true){dojo.removeClass(this.newsroom_avaliable,"prmaxhidden");}else{this.tab_newoom.controlButton.domNode.style.display="none";}if(PRMAX.utils.settings.clippings!=true||this.mode!="edit"){this.analysis_tab.controlButton.domNode.style.display="none";}if(this.mode!="edit"){this.frame.resize({w:800,h:567});}},_Add_Customer:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Not all required field filled in");this.save.cancel();return;}if(this.has_news_room.get("checked")==true){if(this.news_room_root.get("value")==""){alert("Not all required field filled in");this.save.cancel();this.news_room_root.focus();return;}}var _1=dojo.mixin(this.form.get("value"),this.form2.get("value"));if(this._icustomerid!=null){_1["icustomerid"]=this._icustomerid;}dojo.xhrPost(ttl.utilities.makeParams({load:this._Save_Call_Back,url:"/clients/save",content:_1}));},_Save_Call:function(_2){if(_2.success=="OK"){if(this.mode=="edit"){alert("Updated");this.save.cancel();if(this._do_parent){this._do_parent(2,_2.data.client);}if(_2.data.client.has_news_room){dojo.attr(this.show_news_room_form,"action",_2.data.newsroom.news_room_url);dojo.removeClass(this.show_new_room_url.domNode,"prmaxhidden");}}else{alert("Added");if(this._do_parent){this._do_parent(3,_2.data.client);}this.Clear();}}else{if(_2.success=="DU"){alert(_2.message);this.clientname.focus();}else{alert("Problem");}}this.save.cancel();},Load:function(_3,_4){this._do_parent=_4;this.Clear();if(_3!=-1){dojo.xhrPost(ttl.utilities.makeParams({load:this._Load_Call_Back,url:"/clients/get",content:{clientid:_3,extended:true}}));}},_Load_Call:function(_5){if(_5.success=="OK"){with(_5.data){this.clientid.set("value",client.clientid);this.clientname.set("value",client.clientname);this.www.set("value",client.www);this.email.set("value",client.email);this.tel.set("value",client.tel);this.twitter.set("value",client.twitter);this.facebook.set("value",client.facebook);this.linkedin.set("value",client.linkedin);this.instagram.set("value",client.instagram);this.has_news_room.set("checked",client.has_news_room);if(newsroom){if(client.clientid==2014){newsroom.news_room_url="https://www.cardiffnewsroom.co.uk/";}if(client.clientid==1966){newsroom.news_room_url="https://www.newyddioncaerdydd.co.uk";}this.newsroomid.set("value",newsroom.newsroomid);this.news_room_root.set("value",newsroom.news_room_root);this.about_template.set("value",newsroom.about_template);dojo.attr(this.show_news_room_form,"action",newsroom.news_room_url);dojo.removeClass(this.show_new_room_url.domNode,"prmaxhidden");this.headerimage_left.set("value",client.clientid);this.headerimage_right.set("value",client.clientid);this.header_colour.set("value",newsroom.header_colour);this._new_room_show();this.link_1_name.set("value",newsroom.link_1.name);this.link_1_url.set("value",newsroom.link_1.url);this.link_2_name.set("value",newsroom.link_2.name);this.link_2_url.set("value",newsroom.link_2.url);}if(this._do_parent){this._do_parent(1,_5.data);}this.headerimage_left.show();this.headerimage_right.show();if(PRMAX.utils.settings.clippings==true){this.analysis_ctrl.load(client.clientid);}dojo.removeClass(this.delete_ctrl.domNode,"prmaxhidden");}}},Clear:function(){this.clientid.set("value",-1);this.clientid.set("value","");this.clientname.set("value","");this.www.set("value","");this.email.set("value","");this.tel.set("value","");this.twitter.set("value","");this.facebook.set("value","");this.linkedin.set("value","");this.instagram.set("value","");this.save.cancel();this.clientid.set("value",-1);this.newsroomid.set("value",-1);this.news_room_root.set("value","");this.about_template.set("value","");this.default_header_colour.set("checked",false);this.headerimage_left.set("value",-1);this.headerimage_right.set("value",-1);dojo.addClass(this.delete_ctrl.domNode,"prmaxhidden");dojo.addClass(this.show_new_room_url.domNode,"prmaxhidden");this.delete_ctrl.cancel();this.link_1_name.set("value","");this.link_1_url.set("value","");this.link_2_name.set("value","");this.link_2_url.set("value","");},_Delete_Call:function(_6){if(_6.success=="OK"){if(this._do_parent){this._do_parent(3,null);}alert("Deleted");this.Clear();}else{if(_6.success=="DU"){alert("In Use");}else{alert("Problem Deleting");}}this.delete_ctrl.cancel();},_Delete_Customer:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._Delete_Call_Back,url:"/clients/delete",content:{clientid:this.clientid.get("value")}}));},_new_room_show:function(){if(this.has_news_room.get("checked")){dojo.removeClass(this.news_room_details,"prmaxhidden");this.headerimage_left.show();this.headerimage_right.show();}else{dojo.addClass(this.news_room_details,"prmaxhidden");}},_show_new_room_url:function(){this.show_news_room_form.submit();},resize:function(){this.inherited(arguments);this.frame.resize(arguments[0]);},_use_default_color:function(){if(this.default_header_colour.checked){this.header_colour.set("value","#2e74b5");}},_ColourUpdate:function(){this.default_header_colour.set("checked",false);},_setIcustomeridAttr:function(_7){this._icustomerid=_7;}});}