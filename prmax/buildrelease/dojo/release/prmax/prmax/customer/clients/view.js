/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.customer.clients.view"]){dojo._hasResource["prmax.customer.clients.view"]=true;dojo.provide("prmax.customer.clients.view");dojo.require("prmax.customer.clients.add");dojo.require("prcommon.data.QueryWriteStore");dojo.declare("prmax.customer.clients.view",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"borderControl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='gutters:false,\"class\":\"clientview\",style:\"width:100%;height:100%;overflow: hidden\"'>\r\n\t\t<div data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props=\"region:'left',splitter:true,'class':'bordered',style:'height:100%;width:40%',gutters:false\">\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-attach-point=\"controls\" data-dojo-props='region:\"top\",style:\"height:42px;width:100%;overflow:hidden\", \"class\":\"std_menu_view\"'>\r\n\t\t\t\t<div style=\"height:100%;width:150px;float:left;padding-top:10px;\" class=\"prmaxrowdisplaylarge\" data-dojo-attach-point=\"client_header_name\">Clients</div>\r\n\t\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='style:\"float:left;height:99%;width:200px;padding:0px;margin:0px\",\"class\":\"dijitToolbarTop\"'>\r\n\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Add\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"fa fa-plus fa-3x\",label:\"Add\",showLabel:false'></div>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\"  data-dojo-props='iconClass:\"fa fa-filter fa-3x\",label:\"Filter List\",showLabel:false'>\r\n\t\t\t\t\t\t<span></span>\r\n\t\t\t\t\t\t<div data-dojo-type=\"dijit.TooltipDialog\" data-dojo-props='title:\"Filter By\"' data-dojo-attach-event=\"execute:_ExecuteFilter\">\r\n\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Name</td><td><input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"clientname_filter\" data-dojo-props='name:\"clientname_filter\",type:\"text\"' ></td></tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td align=\"left\"><button data-dojo-attach-event=\"onClick: _ClearFilter\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\"' >Clear</button></td>\r\n\t\t\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"submit\",name:\"submit\"'>Submit</button></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"left\",style:\"width:50%;height:100%\"'>\r\n\t\t\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='style:\"height:100%;width:100%\",rowsPerPage:50,splitter:true'></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.StackContainer\" data-dojo-props='region:\"center\",splitter:true' data-dojo-attach-point=\"edit_client_stack\">\r\n\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='title:\"blank\",style:\"width:100%;height:100%\",\"class\":\"scrollpanel\"' data-dojo-attach-point=\"blank_view\"></div>\r\n\t\t\t<div data-dojo-type=\"prmax.customer.clients.add\" data-dojo-attach-point=\"client_edit_ctrl\" data-dojo-props='title:\"edit_view\",mode:\"edit\",\"class\":\"scrollpanel\",style:\"width:100%;height:100%\"'></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-attach-point=\"client_add_dialog\" data-dojo-props='title:\"Add New Client\",style:\"width:800px;height:600px\"'>\r\n\t\t<div data-dojo-type=\"prmax.customer.clients.add\" data-dojo-attach-point=\"client_add_ctrl\" data-dojo-props='mode:\"add\",\"class\":\"scrollpanel\",style:\"width:100%;height:100%\"'></div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.client_model=new prcommon.data.QueryWriteStore({url:"/clients/list",onError:ttl.utilities.globalerrorchecker,nocallback:true});this._Client_Added_Call_Back=dojo.hitch(this,this._Client_Added_Call);this._Client_Update_Call_Back=dojo.hitch(this,this._Client_Update_Call);},postCreate:function(){this.client_add_dialog.set("title","Add New "+PRMAX.utils.settings.client_name);dojo.attr(this.client_header_name,"innerHTML",PRMAX.utils.settings.client_name+"s");this.view1["cells"][0][0].name=PRMAX.utils.settings.client_name+" Short Name";this.grid.set("structure",this.view1);this.grid._setStore(this.client_model);this.grid["onCellClick"]=dojo.hitch(this,this._OnCellClick);this.inherited(arguments);},_OnCellClick:function(e){this._row=this.grid.getItem(e.rowIndex);this.client_edit_ctrl.Load(this._row.i.clientid,this._Client_Update_Call_Back);this.grid.selection.clickSelectEvent(e);},view1:{cells:[[{name:"Short Name",width:"auto",field:"clientname"},{name:" ",width:"15px",styles:"text-align: center;",width:"20px",formatter:ttl.utilities.formatRowCtrl}]]},resize:function(){this.borderControl.resize(arguments[0]);},_ClearFilter:function(){this.clientname_filter.set("value","");},_ExecuteFilter:function(){var _1={};if(arguments[0].clientname_filter.length>0){_1["clientname"]=arguments[0].clientname_filter;}this.grid.setQuery(ttl.utilities.getPreventCache(_1));this._row=null;this.edit_client_stack.selectChild(this.blank_view);},_Client_Added_Call:function(_2,_3){if(_2==1){}else{if(_2==2){this.client_model.newItem(_3);this.client_add_dialog.hide();}else{if(_2==3){this.client_model.newItem(_3);this.client_add_dialog.hide();this.client_edit_ctrl.Load(_3.clientid,this._Client_Update_Call_Back);}}}},_Client_Update_Call:function(_4,_5){if(_4==1){this.edit_client_stack.selectChild(this.client_edit_ctrl);}else{if(_4==2){this.client_model.setValue(this._row,"clientname",_5.clientname,true);}else{if(_4==3){this.client_model.deleteItem(this._row);this._row=null;this.edit_client_stack.selectChild(this.blank_view);}}}},_Add:function(){this.client_add_ctrl.Load(-1,this._Client_Added_Call_Back);this.client_add_dialog.show();}});}