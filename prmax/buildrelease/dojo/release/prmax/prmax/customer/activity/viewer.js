/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.customer.activity.viewer"]){dojo._hasResource["prmax.customer.activity.viewer"]=true;dojo.provide("prmax.customer.activity.viewer");dojo.require("prcommon.data.QueryWriteStore");dojo.require("prcommon.date.daterange");dojo.require("prmax.customer.activity.output");dojo.declare("prmax.customer.activity.viewer",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"borderControl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='gutters:false,style:\"width:100%;height:100%;overflow: hidden\"'>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-attach-point=\"controls\" data-dojo-props='region:\"top\",style:\"height:42px;width:100%;overflow:hidden\", \"class\":\"std_menu_view\"'>\r\n\t\t\t<div style=\"height:100%;width:150px;float:left;padding-top:10px;\" class=\"prmaxrowdisplaylarge\" data-dojo-attach-point=\"client_header_name\">Activity Log</div>\r\n\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\"  data-dojo-props='iconClass:\"fa fa-filter fa-3x\",showLabel:true'>\r\n\t\t\t\t<span>Filter By</span>\r\n\t\t\t\t<div data-dojo-type=\"dijit.TooltipDialog\" data-dojo-props='title:\"Filter By\"' data-dojo-attach-event=\"execute:_execute_filter\">\r\n\t\t\t\t\t<table width=\"500px\">\r\n\t\t\t\t\t\t<tr><td style=\"width:50px\"><label>User</label></td><td><select data-dojo-props='placeHolder:\"No Selection\",name:\"user\",required:false,invalidMessage:\"User Name\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"filter_users\"></select></td></tr>\r\n\t\t\t\t\t\t<tr><td><label style=\"width:50px\">Date Range</label></td><td><div data-dojo-type=\"prcommon.date.daterange\" data-dojo-attach-point=\"drange\" data-dojo-props='value:\"\",name:\"drange\"'></div></td></tr>\r\n\t\t\t\t\t\t<tr><td><label style=\"width:50px\">Type</label></td><td><select data-dojo-props='placeHolder:\"No Selection\",name:\"objecttype\",required:false,invalidMessage:\"Type\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"filter_objecttypes\"></select></td></tr>\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td align=\"left\"><button data-dojo-attach-event=\"onClick:_clear_filter\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\"'>Clear</button></td>\r\n\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"submit\",name:\"submit\"'>Submit</button></td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-props='label:\"Output\",iconClass:\"fa fa-line-chart fa-3x\"' data-dojo-attach-event=\"onClick:_output_function\"></button>\t\t\t\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"left\",style:\"width:50%;height:100%\"'>\r\n\t\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='style:\"height:100%;width:100%\",rowsPerPage:50,splitter:true'></div>\r\n\t\t</div>\r\n\t</div>\r\n\t\r\n\t<div data-dojo-attach-point=\"output_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Output\",style:\"width:480px\"'>\r\n\t\t<div data-dojo-attach-point=\"output_ctrl\" data-dojo-type=\"prmax.customer.activity.output\"></div>\r\n\t</div>\t\r\n\r\n</div>\r\n",constructor:function(){this.client_model=new prcommon.data.QueryWriteStore({url:"/activity/activity_grid",onError:ttl.utilities.globalerrorchecker,nocallback:true});this._users=new dojo.data.ItemFileReadStore({url:"/user/user_list"});this._objecttypes=new dojo.data.ItemFileReadStore({url:"/activity/objecttype_list"});this._Client_Added_Call_Back=dojo.hitch(this,this._Client_Added_Call);this._Client_Update_Call_Back=dojo.hitch(this,this._Client_Update_Call);dojo.subscribe("/update/distribution_label",dojo.hitch(this,this._UpdateDistributionLabelEvent));},postCreate:function(){this.grid.set("structure",this.view1);this.grid._setStore(this.client_model);this.grid["onCellClick"]=dojo.hitch(this,this._OnCellClick);this.filter_users.store=this._users;this.filter_objecttypes.store=this._objecttypes;this.inherited(arguments);},view1:{cells:[[{name:"Date",width:"150px",field:"activitydate"},{name:"Description",width:"auto",field:"description"},{name:"Action",width:"60px",field:"actiontypedescription"},{name:"Type",width:"100px",field:"type"},{name:"User",width:"auto",field:"user_name"},]]},resize:function(){this.borderControl.resize(arguments[0]);},_execute_filter:function(){var _1={drange:this.drange.get("value")};this.filter=_1;if(arguments[0].user.length>0&&arguments[0].user!=""&&arguments[0].user!="-1"){_1["user"]=arguments[0].user;}if(arguments[0].objecttype.length>0&&arguments[0].objecttype!=""&&arguments[0].objecttype!="-1"){_1["objecttypeid"]=arguments[0].objecttype;}this.grid.setQuery(_1);},_output_function:function(){this.output_ctrl.clear();this.output_ctrl.set("dialog",this.output_dlg);this.output_dlg.show();},_clear_filter:function(){this.filter_users.set("value",null);this.filter_objecttypes.set("value",null);this.drange.set("value",null);},_UpdateDistributionLabelEvent:function(){this._objecttypes=new dojo.data.ItemFileReadStore({url:"/activity/objecttype_list"});},});}