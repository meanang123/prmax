/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.crm.task.viewer"]){dojo._hasResource["prmax.crm.task.viewer"]=true;dojo.provide("prmax.crm.task.viewer");dojo.require("prmax.iadmin.TaskAdd");dojo.declare("prmax.crm.task.viewer",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"borderControl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='style:\"width:100%;height:100%\",gutters:false'>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-attach-point=\"controls\" data-dojo-props='region:\"top\",style:\"height:42px;width:100%;overflow:hidden\"'>\r\n\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='style:\"height:99%;width:100%;padding:0px;margin:0px\"'>\r\n\t\t\t\t<div data-dojo-attach-event=\"onClick:_New\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"PrmaxResultsIcon PrmaxResultsEmpty\"'><span>New</span></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\"  data-dojo-props='region:\"center\"'>\r\n\t\t\t<div data-dojo-attach-point=\"viewer_grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='query:\"{ }\",rowsPerPage:30,style:\"width:100%;height:100%\"' style=\"width:100%;height:100%\"></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"New Task\"' data-dojo-attach-point=\"newtaskdialog\">\r\n\t<div data-dojo-attach-point=\"newtaskctrl\" data-dojo-type=\"prmax.iadmin.TaskAdd\" ></div>\r\n</div>\r\n</div>\r\n",constructor:function(){this.filter_db=new prcommon.data.QueryWriteStore({url:"/iadmin/tasks",nocallback:true,onError:ttl.utilities.globalerrorchecker});},_view:{noscroll:false,cells:[[{name:"Owner",width:"150px",field:"user_name"},{name:"Date",width:"60px",field:"due_date_display"},{name:"Status",width:"80px",field:"taskstatusdescription"},{name:"Type",width:"80px",field:"tasktypedescription"},{name:"Subject",width:"150px",field:"subject"},{name:"Diary Type",width:"80px",field:"tasktagdescription"}]]},postCreate:function(){this.viewer_grid.set("structure",this._view);this.viewer_grid._setStore(this.filter_db);this.viewer_grid.onRowClick=dojo.hitch(this,this.onSelectRow);this.viewer_grid.onStyleRow=dojo.hitch(this,this.onStyleRow);this.inherited(arguments);},onStyleRow:function(_1){ttl.GridHelpers.onStyleRow(_1);},onSelectRow:function(e){var _2=this.viewer_grid.getItem(e.rowIndex);this.viewer_grid.selection.clickSelectEvent(e);},_Filter:function(){this.viewer_grid.setQuery(ttl.utilities.getPreventCache({contacthistorysourceid:this.contacthistorysourceid.get("value"),icustomerid:this._customerid}));},Load:function(_3){this._customerid=_3;this.refresh();},refresh:function(){var _4={icustomerid:this._customerid};this.viewer_grid.setQuery(ttl.utilities.getPreventCache(_4));},resize:function(){this.borderControl.resize(arguments[0]);this.inherited(arguments);},_New:function(){this.newtaskctrl.Load(PRMAX.utils.settings.groups,this.newtaskdialog,this.filter_db,this._customerid);this.newtaskdialog.show();}});}