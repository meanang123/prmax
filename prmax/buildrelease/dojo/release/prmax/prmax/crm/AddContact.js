/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.crm.AddContact"]){dojo._hasResource["prmax.crm.AddContact"]=true;dojo.provide("prmax.crm.AddContact");dojo.declare("prmax.crm.AddContact",[dijit._Widget,dijit._Templated,dijit._Container],{widgetsInTemplate:true,contacthistorysourceid_default:-2,showclose:false,isedit:false,templateString:"<div >\r\n\t<form class=\"prmaxdefault\" dojoAttachPoint=\"formNode\" dojoType=\"dijit.form.Form\" onSubmit=\"return false\">\r\n\t\t<input name=\"contacthistoryid\" type=\"hidden\" dojoAttachPoint=\"contacthistoryid\"  value = \"-1\" dojoType=\"dijit.form.TextBox\" />\r\n\t\t<input name=\"ref_customerid\" type=\"hidden\" dojoAttachPoint=\"ref_customerid\"  dojoType=\"dijit.form.TextBox\" />\r\n\t\t<input name=\"outletid\" type=\"hidden\" dojoAttachPoint=\"outletid\"  dojoType=\"dijit.form.TextBox\" />\r\n\t\t<input name=\"employeeid\" type=\"hidden\" dojoAttachPoint=\"employeeid\"  dojoType=\"dijit.form.TextBox\" />\r\n\t\t<input name=\"taskid\" type=\"hidden\" dojoAttachPoint=\"taskid\"  dojoType=\"dijit.form.TextBox\" />\r\n\t\t<input name=\"contactid\" type=\"hidden\" dojoAttachPoint=\"contactid\"  dojoType=\"dijit.form.TextBox\" />\r\n\t\t<table style=\"width:100%;border-collapse:collapse;\" cellspacing=\"1\" cellpadding=\"1\" border=\"0\">\r\n\t\t\t<tr><td width=\"20%\" class=\"prmaxrowtag\" valign=\"top\"align=\"right\">Subject</td><td><input class=\"prmaxrequired\" name=\"subject\" type=\"text\" dojoAttachPoint=\"subject\"  maxlength=\"80\" trim=\"true\" required=\"true\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:98%\"/></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Contact Type</td><td><select class=\"prmaxrequired\" name=\"contacthistorysourceid\" autoComplete=\"true\" searchAttr=\"name\" dojoType=\"dijit.form.FilteringSelect\" required=\"true\" invalidMessage=\"Please Select Contact History Type\" labelType=\"html\" dojoAttachPoint=\"contacthistorysourceid\"></td></tr>\r\n\t\t\t<tr><td  align=\"right\" valign=\"top\" class=\"prmaxrowtag\">Details</td><td ><div class=\"stdframe\" style=\"height:150px;\" ><textarea dojoAttachPoint=\"details\" name=\"details\" trim=\"true\" required=\"true\" dojoType=\"dijit.form.Textarea\" style=\"width:99%;height:80%\" ></textarea></div></td></tr>\r\n\t\t\t<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n\t\t\t<tr><td ><button class=\"prmaxhidden\" dojoAttachEvent=\"onClick:_Close\" dojoAttachPoint=\"closeNode\" dojoType=\"dijit.form.Button\" type=\"button\" label=\"Close\"></button></td><td align=\"right\"><button dojoAttachEvent=\"onClick:_Save\" dojoAttachPoint=\"saveNode\" dojoType=\"dojox.form.BusyButton\" type=\"button\" busyLabel=\"Please Wait Adding Notes...\" label=\"Add\"></button></td></tr>\r\n\t\t</table>\r\n\t</form>\r\n</div>\r\n",constructor:function(){this._SavedCallBack=dojo.hitch(this,this._SavedCall);this._GetCallBack=dojo.hitch(this,this._GetCall);this._UpdateCallBack=dojo.hitch(this,this._UpdateCall);this._contacthistoryid=-1;this.inherited(arguments);},postCreate:function(){this.contacthistorysourceid.store=PRCOMMON.utils.stores.ContactHistoryTypes();if(this.contacthistorysourceid_default!=-2){this.contacthistorysourceid.st("value",this.contacthistorysourceid_default);}if(this.showclose){dojo.removeClass(this.closeNode.domNode,"prmaxhidden");}this.inherited(arguments);},_Save:function(){if(ttl.utilities.formValidator(this.formNode)==false){alert("Not all required field filled in");this.saveNode.cancel();return;}if(this._contacthistoryid==-1){dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedCallBack,url:"/crm/addnote",content:this.formNode.get("value")}));}else{dojo.xhrPost(ttl.utilities.makeParams({load:this._UpdateCallBack,url:"/crm/updatenote",content:this.formNode.get("value")}));}},_UpdateCall:function(_1){if(_1.success=="OK"){dojo.publish(PRCOMMON.Events.Crm_Note_Update,[_1.data]);this._Close();}else{alert("Problem Updating Note");this.saveNode.cancel();}},_SavedCall:function(_2){if(_2.success=="OK"){dojo.publish(PRCOMMON.Events.Crm_Note_Add,[_2.data]);this._Close();}else{alert("Problem Adding Note");this.saveNode.cancel();}},Clear:function(){this.contacthistorysourceid.set("value",(this.contacthistorysourceid_default!=-2)?this.contacthistorysourceid_default:null);this.subject.set("value","");this.details.set("value","");this.saveNode.cancel();this.isedit=false;this._contacthistoryid=-1;this.contacthistoryid.set("value",-1);this.saveNode.set("label","Add");this.saveNode.set("busyLabel","Please Wait Adding Notes...");},_Close:function(){dojo.publish(PRCOMMON.Events.Dialog_Close,["add_contact"]);this.Clear();},LoadControls:function(_3,_4,_5,_6,_7){this.ref_customerid.set("value",_6);this.outletid.set("value",_3);this.employeeid.set("value",_4);this.contactid.set("value",_5);this.taskid.set("value",_7);},_setContacthistorysourceid_defaultAttr:function(_8){this.contacthistorysourceid_default=_8;if(this.contacthistorysourceid_default!=-2){this.contacthistorysourceid.set("value",this.contacthistorysourceid_default);}},_getContacthistorysourceid_defaultAttr:function(){return this.contacthistorysourceid_default;},_GetCall:function(_9){if(_9.success=="OK"){this.contacthistoryid.set("value",_9.data.contacthistoryid);this.subject.set("value",_9.data.subject);this.details.set("value",_9.data.details);this.contacthistorysourceid.set("value",_9.data.contacthistorysourceid);this.saveNode.set("label","Save");this.saveNode.set("busyLabel","Please Wait Updating Notes...");}else{alert("Problem Loading Note");}},LoadEdit:function(_a){this._contacthistoryid=_a;dojo.xhrPost(ttl.utilities.makeParams({load:this._GetCallBack,url:"/crm/getnote",content:{contacthistoryid:_a}}));}});}