/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.search"]){dojo._hasResource["prmax.dataadmin.search"]=true;dojo.provide("prmax.dataadmin.search");dojo.require("prmax.dataadmin.employees.ContactInterests");dojo.declare("prmax.dataadmin.search",[ttl.BaseWidget],{widgetsInTemplate:true,searchtypeid:3,templateString:"<div>\r\n\t<div  dojoAttachPoint=\"frame\" dojotype=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:100%;overflow: hidden\" gutters=\"False\" >\r\n\t\t<div  dojotype=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:55%; border: 1\" region=\"top\">\r\n\t\t\t<div  dojoAttachPoint=\"search_form_pane\" dojotype=\"dijit.layout.TabContainer\" region=\"center\" >\r\n\t\t\t\t<div dojoAttachPoint=\"std_search_quick\" dojoType=\"ttl.layout.ContentPane\"  title=\"Smart\" href=\"/layout/std_search_quick\" style=\"overflow:auto\" ></div>\r\n\t\t\t\t<div dojoAttachPoint=\"std_search_outlet\" dojoType=\"ttl.layout.ContentPane\" title=\"Outlet\" selected=\"selected\" preload=\"false\"  href=\"/layout/std_search_outlet\"  ></div>\r\n\t\t\t\t<div dojoAttachPoint=\"std_search_employee\" dojoType=\"ttl.layout.ContentPane\"   title=\"Contact\" preload=\"false\"  href=\"/layout/std_search_employee\"  ></div>\r\n\t\t\t\t<div dojoAttachPoint=\"std_search_freelance\" dojoType=\"ttl.layout.ContentPane\"   title=\"Freelance\" preload=\"false\"  href=\"/layout/std_search_freelance\" ></div>\r\n\t\t\t</div>\r\n\t\t\t<div dojotype=\"dijit.layout.ContentPane\" region=\"bottom\" style=\"width:100%;height:12%;\">\r\n\t\t\t\t<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"border-collapse: collapse;\" >\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td ><button class=\"prmaxbutton\" dojoAttachEvent=\"onClick:_ClearSearch\" dojoType=\"dijit.form.Button\" label=\"Clear Search Criteria\" ></button></td>\r\n\t\t\t\t\t\t<td ><button class=\"prmaxbutton\" dojoAttachEvent=\"onClick:_ClearSearchResults\" dojoType=\"dijit.form.Button\" label=\"Clear Search Results\" ></button></td>\r\n\t\t\t\t\t\t<td align=\"right\"><button dojoAttachPoint=\"searchbutton\" class=\"prmaxbutton\" dojoAttachEvent=\"onClick:_Search\" dojoType=\"dojox.form.BusyButton\" iconClass=\"dijitPrmaxIcon dijitPrmaxIconSearch\" busyLabel=\"Searching...\" ><div style=\"font-size:18pt\">Search</div></button></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div  dojoType=\"dijit.layout.BorderContainer\" region=\"center\" splitter=\"true\" gutters=\"false\" >\r\n\t\t\t<div dojoAttachPoint=\"searchgrid\" dojoType=\"dojox.grid.DataGrid\" region=\"center\" rowsPerPage=\"50\"></div>\r\n\t\t\t<div dojotype=\"dijit.layout.ContentPane\"  region=\"bottom\" style=\"width:100%;height:2em\">\r\n\t\t\t\t<button class=\"prmaxbutton\" dojoAttachEvent=\"onClick:_ContactInterests\" dojoType=\"dijit.form.Button\" >Batch Contact Keywords</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<input dojoType=\"dijit.form.CheckBox\"  id=\"search_partial\" type=\"hidden\" checked >\r\n\t<div dojoAttachPoint=\"contact_interest_dlg\" dojoType=\"dijit.Dialog\" title =\"Modify the Keywords on the Contacts In the Search Results\">\r\n\t\t<div dojoType=\"prmax.dataadmin.employees.ContactInterests\"></div>\r\n\t</div>\r\n</div>\r\n",form_name:"std_search_outlet_form",constructor:function(){this.model=new prcommon.data.QueryWriteStore({url:"/search/list?searchtypeid="+this.searchtypeid+"&research=1",onError:ttl.utilities.globalerrorchecker,nocallback:true});this._LoadCallBack=dojo.hitch(this,this._LoadCall);this._getModelItemCall=dojo.hitch(this,this._getModelItem);dojo.subscribe(PRCOMMON.Events.SearchSession_Changed,dojo.hitch(this,this._SearchUpdateEvent));dojo.subscribe(PRCOMMON.Events.Outlet_Updated,dojo.hitch(this,this._OutletUpdateEvent));dojo.subscribe(PRCOMMON.Events.Outlet_Deleted,dojo.hitch(this,this._OutletDeletedEvent));dojo.subscribe(PRCOMMON.Events.Dialog_Close,dojo.hitch(this,this._CloseDialogEvent));},postCreate:function(){this.searchgrid.set("structure",this.view);this.searchgrid._setStore(this.model);dojo.connect(this.search_form_pane,"onLoad",dojo.hitch(this,this._ConnectPane));this.baseonCellClick=this.searchgrid["onCellClick"];this.searchgrid["onStyleRow"]=dojo.hitch(this,ttl.GridHelpers.onStyleRow);this.searchgrid["onRowClick"]=dojo.hitch(this,this.onSelectRow);this.searchgrid["onCellClick"]=dojo.hitch(this,this.onCellClick);this.inherited(arguments);},_ConnectPane:function(){dojo.connect(dijit.byId(this.form_name),"onSubmit",dojo.hitch(this,this._Submit));},_Submit:function(){this._DoSearch();},_Search:function(){this._DoSearch();},_LoadCall:function(_1){dojo.publish(PRCOMMON.Events.SearchSession_Changed,[_1.data]);this.searchbutton.cancel();},_getForm:function(){var _2=null;dojo.every(this.search_form_pane.selectedChildWidget.getDescendants(),function(_3){if(_3.formid!=null){_2=_3;}});return _2;},_DoSearch:function(){var _4=this._getForm();_4.setExtendedMode(false);var _5=_4.get("value");_5["mode"]=1;_5["search_partial"]=2;_5["searchtypeid"]=3;_5["research"]=1;dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCallBack,url:"/search/dosearch",content:_5}));},view:{cells:[[{name:" ",width:"6px",styles:"text-align: center;",width:"6px",field:"prmax_outletgroupid",formatter:ttl.utilities.outletType},{name:"Name",width:"auto",field:"outletname"},{name:"Contact",width:"auto",field:"contactname"},{name:"Source",width:"50px",field:"sourcename"},{name:"Id",width:"50px",field:"outletid"}]]},resize:function(){this.frame.resize(arguments[0]);},destroy:function(){try{this.inherited(arguments);}catch(e){}},_SearchUpdateEvent:function(_6){this.refresh(_6);},refresh:function(){this.searchgrid.selection.clear();this.searchgrid.setQuery(ttl.utilities.getPreventCache({}));},_ClearSearch:function(){var _7=this._getForm();dojo.every(_7.getDescendants(),function(_8){if(_8.Clear!=null){_8.Clear();}return true;});this.searchbutton.cancel();},_ClearSearchResults:function(){dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._ClearAllCall),url:"/search/sessionclear",content:{searchtypeid:3}}));},_ClearAllCall:function(_9){if(_9.success=="OK"){this.refresh({outletid:-1,employeeid:-1,outlettypeid:-1});}},onSelectRow:function(e){var _a=this.searchgrid.getItem(e.rowIndex);dojo.publish(PRCOMMON.Events.Display_Load,[_a.i.outletid,_a.i.prmax_outletgroupid]);this.searchgrid.selection.clickSelectEvent(e);},onCellClick:function(e){this.onSelectRow(e);},_getModelItem:function(){if(arguments[0].i.i!=null){this.tmp_row=arguments[0].i;}else{this.tmp_row=arguments[0];}},_OutletUpdateEvent:function(_b){for(var _c in _b.search){this.tmp_row=null;var _d={identity:_b.search[_c],onItem:this._getModelItemCall};this.model.fetchItemByIdentity(_d);if(this.tmp_row){this.model.SetNoCallBackMode(true);this.model.setValue(this.tmp_row,"contactname",_b.employee.contactname,true);this.model.setValue(this.tmp_row,"outletname",_b.outlet.outletname,true);}}},_OutletDeletedEvent:function(_e){for(var _f in _e.search){this.tmp_row=null;var _10={identity:_e.search[_f],onItem:this._getModelItemCall};this.model.fetchItemByIdentity(_10);if(this.tmp_row){this.model.deleteItem(this.tmp_row);}}},_ContactInterests:function(){this.contact_interest_dlg.show();},_CloseDialogEvent:function(){this.contact_interest_dlg.hide();}});}