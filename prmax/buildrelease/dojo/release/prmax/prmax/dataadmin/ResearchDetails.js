/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.ResearchDetails"]){dojo._hasResource["prmax.dataadmin.ResearchDetails"]=true;dojo.provide("prmax.dataadmin.ResearchDetails");dojo.declare("prmax.dataadmin.ResearchDetails",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<form  dojotype=\"dijit.form.Form\" dojoAttachPoint=\"form\" onsubmit=\"return false;\">\r\n\t\t<input type=\"hidden\" name=\"outletid\" value=\"-1\" dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"outletid\">\r\n\t\t<table cellspacing=\"1\" cellpadding=\"1\"  width=\"100%\">\r\n\t\t\t<tr><td width=\"20%\" align=\"right\" class=\"prmaxrowtag\">Surname</td><td><input dojoAttachPoint=\"surname\" class=\"prmaxrequired\"  name=\"surname\" type=\"text\" trim=\"true\" required=\"true\" invalidMessage=\"Please enter conatct surname\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:70%\"></input></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Firstname</td><td><input class=\"prmaxinput\" dojoAttachPoint=\"firstname\"  name=\"firstname\" type=\"text\" dojoType=\"dijit.form.TextBox\" style=\"width:40%\"></input></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Title</td><td><input class=\"prmaxinput\" dojoAttachPoint=\"prefix\"  name=\"prefix\" type=\"text\" dojoType=\"dijit.form.TextBox\" style=\"width:20%\"></input></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Job Title</td><td><input class=\"prmaxinput\" dojoAttachPoint=\"job_title\"  name=\"job_title\" type=\"text\" dojoType=\"dijit.form.TextBox\" style=\"width:70%\"></input></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Email</td><td><input dojoAttachPoint=\"email\" class=\"prmaxinput\" name=\"email\" dojoAttachPoint=\"Email\" type=\"text\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.emailAddress\" trim=\"true\" invalidMessage=\"invalid email address\" size=\"20\" maxlength=\"70\" style=\"width:90%\"></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Tel</td><td><input dojoAttachPoint=\"tel\" class=\"prmaxinput\" name=\"tel\" type=\"text\" maxlength=\"40\" dojoType=\"dijit.form.ValidationTextBox\" trim=\"true\" style=\"width:60%\" /></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Frequency</td>\r\n\t\t\t<td ><select style=\"width:70%\" class=\"prmaxrequired\" name=\"researchfrequencyid\"\r\n\t\t\t\t\t\t\t\t\tautoComplete=\"true\"\r\n\t\t\t\t\t\t\t\t\tsearchAttr=\"name\"\r\n\t\t\t\t\t\t\t\t\tdojoType=\"dijit.form.FilteringSelect\"\r\n\t\t\t\t\t\t\t\t\trequired=\"true\"\r\n\t\t\t\t\t\t\t\t\tinvalidMessage=\"Please select research frequency\"\r\n\t\t\t\t\t\t\t\t\tlabelType=\"html\"\r\n\t\t\t\t\t\t\t\t\tdojoAttachPoint=\"researchfrequencyid\"></select></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\">Notes</td><td><div class=\"stdframe\" style=\"height:300px\"><textarea dojoAttachPoint=\"notes\"  name=\"notes\" dojoType=\"dijit.form.Textarea\"  style=\"height:300px\"></textarea></div></td></tr>\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" width=\"20%\">Reason Code</td><td ><select dojoAttachPoint=\"reasoncodeid\" name=\"reasoncodeid\" dojotype =\"dijit.form.FilteringSelect\" searchAttr=\"name\" labelType=\"html\" style=\"width:98%\" class=\"prmaxrequired\"  /></td></tr>\r\n\r\n\t\t\t<tr>\r\n\t\t\t\t\t<td align=\"left\" ><button type=\"button\"  dojoAttachEvent=\"onClick:_ShowQDlg\" dojoType=\"dijit.form.Button\" label=\"Show Quest\" ></button>\r\n\t\t\t\t<button type=\"button\"  dojoAttachEvent=\"onClick:_Preview\" dojoType=\"dijit.form.Button\" label=\"Preview\" ></button></td>\r\n\t\t\t\t\t<td align=\"right\" ><button type=\"submit\"  dojoAttachPoint=\"saveBtn\" disabled=\"disabled\" dojoAttachEvent=\"onClick:_Update\" dojoType=\"dojox.form.BusyButton\" label=\"Update Research Details\"  busyLabel=\"Please Wait Updating...\"></button></td></tr>\r\n\t\t</table>\r\n\t</form>\r\n\t<div dojoAttachPoint=\"qdlg\" title=\"Email Questionaire\" dojoType=\"dijit.Dialog\">\r\n\t\t<div dojoAttachPoint=\"qctrl\" dojoType=\"prmax.dataadmin.questionnaires.SendSingle\"></div>\r\n\t</div>\r\n\r\n\t<form dojoAttachPoint=\"previewform\" target=\"_newtab\" action=\"/dataadmin/preview_questionnaire\" method=\"post\">\r\n\t\t<input type=\"hidden\" name=\"objecttypeid\" dojoAttachPoint=\"preview_objecttypeid\">\r\n\t\t<input type=\"hidden\" name=\"objectid\" dojoAttachPoint=\"preview_objectid\">\r\n\t</form>\r\n</div>\r\n",constructor:function(){this._objecttypeid=1;},postCreate:function(){this.researchfrequencyid.store=PRCOMMON.utils.stores.Research_Frequencies();this._LoadCallBack=dojo.hitch(this,this._LoadCall);this._UpdateCallBack=dojo.hitch(this,this._UpdateCall);this.inherited(arguments);},Load:function(_1,_2){this.outletid.set("value",_1);this._objecttypeid=1;if(_2==19){this._objecttypeid=4;}dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCallBack,url:"/dataadmin/reseach_details_get",content:{outletid:_1}}));},_LoadCall:function(_3){if(_3.success=="OK"){if(_3.data!=null){this.outletid.set("value",_3.data.outletid);this.surname.set("value",_3.data.surname);this.firstname.set("value",_3.data.firstname);this.prefix.set("value",_3.data.prefix);this.email.set("value",_3.data.email);this.tel.set("value",_3.data.tel);this.researchfrequencyid.set("value",_3.data.researchfrequencyid);this.notes.set("value",_3.data.notes);this.job_title.set("value",_3.data.job_title);this.reasoncodeid.store=PRCOMMON.utils.stores.Research_Reason_Update_Codes();this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Upd_Default);}else{this.Clear();this.reasoncodeid.store=PRCOMMON.utils.stores.Research_Reason_Add_Codes();this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Add_Default);}this.saveBtn.set("disabled",false);}},Clear:function(){this.surname.set("value","");this.firstname.set("value","");this.prefix.set("value","");this.email.set("value","");this.tel.set("value","");this.job_title.set("value","");this.researchfrequencyid.set("value",null);this.notes.set("value","");this.saveBtn.set("disabled",true);},_Update:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Not all required field filled in");this.saveBtn.cancel();return;}dojo.xhrPost(ttl.utilities.makeParams({load:this._UpdateCallBack,url:"/dataadmin/reseach_details_update",content:this.form.get("value")}));},_UpdateCall:function(_4){if(_4.success=="OK"){alert("Research Details Updated");this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Upd_Default);}else{alert("Update Research Details Failed");}this.saveBtn.cancel();},_ShowQDlg:function(){this.qctrl.Load(this.outletid.get("value"),this._objecttypeid,this.email.get("value"),this.firstname.get("value"),this.qdlg);},_Preview:function(){dojo.attr(this.preview_objecttypeid,"value",this._objecttypeid);dojo.attr(this.preview_objectid,"value",this.outletid.get("value"));this.previewform.submit();}});}