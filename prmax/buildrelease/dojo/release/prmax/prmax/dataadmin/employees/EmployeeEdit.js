/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.employees.EmployeeEdit"]){dojo._hasResource["prmax.dataadmin.employees.EmployeeEdit"]=true;dojo.provide("prmax.dataadmin.employees.EmployeeEdit");dojo.require("prmax.employee.EmployeeSelect");dojo.require("prmax.employee.EmployeeNew");dojo.declare("prmax.dataadmin.employees.EmployeeEdit",[ttl.BaseWidget],{employeeid:-1,outletid:-1,widgetsInTemplate:true,templateString:"<div>\r\n\t<div dojoType=\"dijit.layout.ContentPane\"  dojoAttachPoint=\"frame\" style=\"overflow:auto;overflow-x:hidden;border:1px solid black\">\r\n\t\t<form class=\"prmaxdefault\" dojoAttachPoint=\"formNode\" dojoType=\"dijit.form.Form\" onSubmit=\"return false\">\r\n\t\t\t<input name=\"outletid\" dojoAttachPoint=\"outletidNode\" type=\"hidden\" dojoType=\"dijit.form.TextBox\"></input>\r\n\t\t\t<input name=\"employeeid\" dojoAttachPoint=\"employeeidNode\" type=\"hidden\" dojoType=\"dijit.form.TextBox\"></input>\r\n\t\t\t<table style=\"width:97%;border-collapse:collapse;\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\">\r\n\t\t\t\t<tr><td width=\"15%\" class=\"prmaxrowtag\" valign=\"top\"align=\"right\">Person</td><td><div class=\"prmaxrequired\" dojoType=\"prmax.dataadmin.employees.EmployeeSelect\" dojoAttachPoint=\"selectcontact\"></div></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Job Title</td><td><input class=\"prmaxrequired\" name=\"job_title\" type=\"text\" dojoAttachPoint=\"job_title\"  maxlength=\"80\" trim=\"true\" required=\"true\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:98%\"/></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Email</td><td ><input class=\"prmaxinput\" name=\"email\" dojoAttachPoint=\"email\" type=\"text\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.emailAddress\" trim=\"true\" invalidMessage=\"invalid email address\" style=\"width:98%\" maxlength=\"70\"></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Tel</td><td><input class=\"prmaxinput\" name=\"tel\" type=\"text\" dojoAttachPoint=\"tel\" size=\"25\" maxlength=\"40\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Fax</td><td><input class=\"prmaxinput\" name=\"fax\" type=\"text\" dojoAttachPoint=\"fax\" size=\"25\" maxlength=\"40\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Mobile</td><td><input class=\"prmaxinput\" name=\"mobile\" type=\"text\" dojoAttachPoint=\"mobile\" size=\"25\" maxlength=\"40\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Twitter</td><td><input dojoAttachPoint=\"twitter\" name=\"twitter\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\" type=\"text\" maxlength=\"80\" trim=\"true\" style=\"width:70%\"/>\r\n\t\t\t\t\t<button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Update Media Only\",style:\"float:right\",disabled:\"disabled\"' data-dojo-attach-event=\"onClick:_UpdateMediaOnly\" data-dojo-attach-point=\"socialmediabtn\"></button>\r\n\t\t\t\t</td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Facebook</td><td><input dojoAttachPoint=\"facebook\" class=\"prmaxinput\" name=\"facebook\" type=\"text\" maxlength=\"80\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\"  trim=\"true\" style=\"width:90%\"/></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Linkedin</td><td><input dojoAttachPoint=\"linkedin\" class=\"prmaxinput\" name=\"linkedin\" type=\"text\" maxlength=\"80\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\" regExpGen=\"dojox.validate.regexp.url\" trim=\"true\" style=\"width:90%\" /></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Instagram</td><td><input dojoAttachPoint=\"instagram\" class=\"prmaxinput\" name=\"instagram\" type=\"text\" maxlength=\"80\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\" regExpGen=\"dojox.validate.regexp.url\" trim=\"true\" style=\"width:90%\" /></td></tr>\r\n\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Different Address</td><td><input name=\"no_address\" type=\"checkbox\" dojoAttachPoint=\"no_address\"  dojoType=\"dijit.form.CheckBox\" dojoAttachEvent=\"onClick:_AddressShow\" /></td></tr>\r\n\t\t\t\t<tr dojoAttachPoint=\"addr1\" class=\"prmaxhidden\" ><td align=\"right\" class=\"prmaxrowtag\">Address1</td><td><input dojoAttachPoint=\"address1\" style=\"margin-left:10px\" class=\"prmaxinput\"  name=\"address1\" type=\"text\" trim=\"true\" invalidMessage=\"Please enter address\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:90%\"></input></td></tr>\r\n\t\t\t\t<tr dojoAttachPoint=\"addr2\" class=\"prmaxhidden\" ><td align=\"right\" class=\"prmaxrowtag\">Address2</td><td><input dojoAttachPoint=\"address2\" style=\"margin-left:10px\" class=\"prmaxinput\" name=\"address2\" type=\"text\" trim=\"true\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:90%\"></input></td></tr>\r\n\t\t\t\t<tr dojoAttachPoint=\"addr3\" class=\"prmaxhidden\" ><td align=\"right\" class=\"prmaxrowtag\">Town</td><td><input dojoAttachPoint=\"townname\" style=\"margin-left:10px\" class=\"prmaxinput\" name=\"townname\" type=\"text\" trim=\"true\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:90%\" ></input></td></tr>\r\n\t\t\t\t<tr dojoAttachPoint=\"addr4\" class=\"prmaxhidden\" ><td align=\"right\" class=\"prmaxrowtag\">County</td><td><input dojoAttachPoint=\"county\" style=\"margin-left:10px\" class=\"prmaxinput\" name=\"county\" type=\"text\" trim=\"true\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:90%\" ></input></td></tr>\r\n\t\t\t\t<tr dojoAttachPoint=\"addr5\" class=\"prmaxhidden\" ><td align=\"right\" class=\"prmaxrowtag\">Post Code</td><td><input dojoAttachPoint=\"postcode\" style=\"margin-left:10px\" class=\"prmaxinput\" name=\"postcode\" type=\"text\" trim=\"true\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width:10em\" ></input></td></tr>\r\n\t\t\t\t<tr><td colspan=\"2\" align=\"right\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Update Interest Only\",style:\"float:right\",disabled:\"disabled\"' data-dojo-attach-event=\"onClick:_UpdateInterestsOnly\" data-dojo-attach-point=\"interestupdbtn\"></button></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\" >Keywords:</td><td><div displaytitle=\"\" dojoType=\"prcommon.interests.Interests\"  restrict=\"0\" dojoAttachPoint=\"interests\" size=\"6\" name=\"interests\" startopen=\"true\" selectonly=\"true\" nofilter=\"true\" keytypeid=\"1\" interesttypeid=\"1\" ></div></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\">Profile</td><td><div class=\"dialogprofileframe\" ><textarea dojoAttachPoint=\"profile\" name=\"profile\" dojoType=\"dijit.form.Textarea\"  style=\"width:99%;height:99%\" ></textarea></div></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\">Notes</td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Code</td><td ><select dojoAttachPoint=\"reasoncodeid\" name=\"reasoncodeid\" dojotype =\"dijit.form.FilteringSelect\" searchAttr=\"name\" labelType=\"html\" style=\"width:98%\" class=\"prmaxrequired\" /></td></tr>\r\n\t\t\t\t<tr><td  align=\"right\" valign=\"top\" class=\"prmaxrowtag\">Description</td><td ><div class=\"reasonframe\" ><textarea dojoAttachPoint=\"reason\" name=\"reason\" required=\"true\" dojoType=\"dijit.form.Textarea\" style=\"width:99%;height:80%\" ></textarea></div></td></tr>\r\n\t\t\t\t<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n\t\t\t\t<tr><td dojoAttachPoint=\"close_button\" class=\"prmaxhidden\"><button type=\"button\" dojoType=\"dijit.form.Button\" label=\"Close\" dojoAttachEvent=\"onClick:_Close\"></button></td><td colspan=\"3\" align=\"right\"><button disabled=\"disabled\" dojoAttachEvent=\"onClick:_Submit\" dojoAttachPoint=\"saveNode\" dojoType=\"dojox.form.BusyButton\" type=\"button\" busyLabel=\"Please Wait Saving...\" label=\"Save\"></button></td></tr>\r\n\t\t\t</table>\r\n\t\t</form>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._SavedCall=dojo.hitch(this,this._Saved);this._LoadCall=dojo.hitch(this,this._Load);this._InterestOnlyCallBack=dojo.hitch(this,this._InterestOnlyCall);this._MediaOnlyCallBack=dojo.hitch(this,this._MediaOnlyCall);this.reasoncode_data_add=PRCOMMON.utils.stores.Research_Reason_Add_Codes();this.reasoncode_data_upd=PRCOMMON.utils.stores.Research_Reason_Update_Codes();},_Saved:function(_1){if(_1.success=="OK"){if(this.employeeidNode.get("value")==-1){this.employeeidNode.set("value",_1.employee.employeeid);dojo.publish(PRCOMMON.Events.Employee_Add,[_1.employee]);alert("Contact added");this._Close();}else{dojo.publish(PRCOMMON.Events.Employee_Updated,[_1.employee]);alert("Contact updated");}}else{alert("Problem with Employee ");}this.saveNode.cancel();},postCreate:function(){dojo.connect(this.formNode,"onSubmit",dojo.hitch(this,this._Save));this.inherited(arguments);},Load:function(_2,_3){this.outletid=_3;this.employeeid=_2;this.outletidNode.set("value",this.outletid);this.employeeidNode.set("value",this.employeeid);this.reason.set("value","");if(this.employeeid!=-1){this.reasoncodeid.store=this.reasoncode_data_upd;dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCall,url:"/employees/research_get_edit",content:{employeeid:this.employeeid}}));}else{this.reasoncodeid.store=this.reasoncode_data_add;this.Clear();this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Add_Default);this.saveNode.set("disabled",false);}},_Load:function(_4){this.employeeidNode.set("value",_4.data.employee.employeeid);this.job_title.set("value",_4.data.employee.job_title);this.email.set("value",_4.data.comm.email);this.tel.set("value",_4.data.comm.tel);this.fax.set("value",_4.data.comm.fax);this.twitter.set("value",_4.data.comm.twitter);this.facebook.set("value",_4.data.comm.facebook);this.linkedin.set("value",_4.data.comm.linkedin);this.instagram.set("value",_4.data.comm.instagram);this.mobile.set("value",_4.data.comm.mobile);this.interests.set("value",_4.data.interests);this.profile.set("value",_4.data.employee.profile);if(_4.data.employee.contactid==null){this.selectcontact.setNoContact();}else{this.selectcontact.set("checked",false);this.selectcontact.set("value",_4.data.employee.contactid);}if(_4.data.employee.communicationid==null){this.no_address.set("checked",false);this._AddressShow_Do(false);}else{if(_4.data.address!=null){this.no_address.set("checked",true);this._AddressShow_Do(true);this.address1.set("value",_4.data.address.address1);this.address2.set("value",_4.data.address.address2);this.townname.set("value",_4.data.address.townname);this.county.set("value",_4.data.address.county);this.postcode.set("value",_4.data.address.postcode);}else{this.no_address.set("checked",false);this._AddressShow_Do(false);this.address1.set("value","");this.address2.set("value","");this.townname.set("value","");this.county.set("value","");this.postcode.set("value","");}}this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Upd_Default);this.saveNode.set("disabled",false);this.socialmediabtn.set("disabled",false);this.interestupdbtn.set("disabled",false);this.job_title.focus();},_Submit:function(){this.formNode.submit();},_Save:function(_5){if(ttl.utilities.formValidator(this.formNode)==false){alert("Not all required field filled in");this.saveNode.cancel();return;}url=(this.employeeid==-1)?"/employees/research_new":"/employees/research_update";dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedCall,url:url,content:this.formNode.get("value")}));},Clear:function(){this.employeeidNode.set("value",-1);this.selectcontact.Clear();this.job_title.set("value","");this.email.set("value","");this.tel.set("value","");this.fax.set("value","");this.mobile.set("value","");this.interests.set("value","");this.profile.set("value","");this.selectcontact.Clear();this.reason.set("value","");this.no_address.set("checked",false);this._AddressShow_Do(false);this.address1.set("value","");this.address2.set("value","");this.townname.set("value","");this.county.set("value","");this.postcode.set("value","");this.twitter.set("value","");this.facebook.set("value","");this.linkedin.set("value","");this.instagram.set("value","");this.socialmediabtn.set("disabled",true);this.interestupdbtn.set("disabled",true);},_Close:function(){this.Clear();dojo.publish(PRCOMMON.Events.Dialog_Close,["emp_cha"]);},_AddressShow:function(){this._AddressShow_Do(this.no_address.get("checked"));},_AddressShow_Do:function(_6){var _7=["addr1","addr2","addr3","addr4","addr5"];if(_6==false){for(var _8 in _7){dojo.addClass(this[_7[_8]],"prmaxhidden");}}else{for(var _8 in _7){dojo.removeClass(this[_7[_8]],"prmaxhidden");}}},resize:function(){this.frame.resize(arguments[0]);this.inherited(arguments);},_InterestOnlyCall:function(_9){if(_9.success=="OK"){alert("Interest Only Updated");}else{alert("Problem Updating Keywords Only");}},_UpdateInterestsOnly:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._InterestOnlyCallBack,url:"/interests/research_interest_only",content:this.formNode.get("value")}));},_MediaOnlyCall:function(_a){if(_a.success=="OK"){alert("Social Media Only Updated");}else{alert("Problem Updating Social Media Only");}},_UpdateMediaOnly:function(){if(this.twitter.isValid()==false||this.facebook.isValid()==false||this.instagram.isValid()==false||this.linkedin.isValid()==false){alert("Invalid Data");return false;}dojo.xhrPost(ttl.utilities.makeParams({load:this._MediaOnlyCallBack,url:"/employees/research_update_media",content:this.formNode.get("value")}));}});}