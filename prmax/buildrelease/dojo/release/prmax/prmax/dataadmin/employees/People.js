/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.employees.People"]){dojo._hasResource["prmax.dataadmin.employees.People"]=true;dojo.provide("prmax.dataadmin.employees.People");dojo.declare("prmax.dataadmin.employees.People",[dijit._Widget,dijit._Templated,dijit._Container],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div  dojoAttachPoint=\"borderControl\" dojotype=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:100%;overflow: hidden; border: 0; padding: 0; margin: 0\" >\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"top\" style=\"height:42px;width:100%;overflow:hidden\" class=\"searchresults\">\r\n\t\t\t<div style=\"height:40px;width:100%;overflow:hidden;padding:0px;margin:0px\" class=\"searchresults\">\r\n\t\t\t\t<div style=\"height:100%;width:15%;float:left;padding:0px;margin:0px\" class=\"dijitToolbar prmaxrowdisplaylarge\">Manage People</div>\r\n\t\t\t\t\t<div class=\"dijitToolbarTop\" dojoType=\"dijit.Toolbar\" style=\"float:left;height:100%;width:85%;padding:0px;margin:0px\" >\r\n\t\t\t\t\t\t<div dojoType=\"dijit.form.DropDownButton\"   iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" showLabel=\"true\">\r\n\t\t\t\t\t\t\t<span>Filter  By</span>\r\n\t\t\t\t\t\t\t<div dojoType=\"dijit.TooltipDialog\" title=\"Enter Interest filter\" dojoAttachEvent=\"execute: _Execute\">\r\n\t\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td><label for=\"user\">Surname</label></td>\r\n\t\t\t\t\t\t\t\t\t\t<td><input dojoType=\"dijit.form.TextBox\"name=\"filter\" dojoAttachPoint=\"filter\" trim=\"true\" maxlength=\"45\" type=\"text\"  ></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td align=\"left\"><button dojoAttachEvent=\"onClick: _ClearFilter\" dojoType=\"dijit.form.Button\" type=\"button\" >Clear Filter by</button></td>\r\n\t\t\t\t\t\t\t\t\t\t<td align=\"right\"><button dojoType=\"dijit.form.Button\" type=\"submit\" name=\"submit\">Filter by</button></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t<div dojoType=\"dijit.form.Button\"  iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" showLabel=\"true\" label=\"New\" dojoAttachEvent=\"onClick:_Add\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"left\" style=\"width:50%;height:100%\" splitter=\"true\" >\r\n\t\t\t<div dojoAttachPoint=\"people_grid\" dojoType=\"dojox.grid.DataGrid\" rowsPerPage=\"100\"></div>\r\n\t\t</div>\r\n\t\t<div dojoType=\"dijit.layout.StackContainer\" dojoAttachPoint=\"controls\" region=\"center\"  doLayout=\"true\" splitter=\"true\">\r\n\t\t\t<div  title=\"blank\" dojoAttachPoint=\"blank\" dojoType=\"dijit.layout.ContentPane\" selected></div>\r\n\t\t\t<div  title=\"details_view\" dojoAttachPoint=\"details_view\"  dojotype=\"dijit.layout.TabContainer\"  style=\"width:100%;height:100%\">\r\n\t\t\t\t<div  title=\"Details\" dojotype=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:100%\">\r\n\t\t\t\t\t<div dojoAttachPoint=\"top\" dojoType=\"dijit.layout.ContentPane\" region=\"top\" style=\"width:100%;height:50%\" splitter=\"true\">\r\n\t\t\t\t\t\t<form class=\"prmaxdefault\" dojoAttachPoint=\"formUpdate\" dojoType=\"dijit.form.Form\" onSubmit=\"return false\">\r\n\t\t\t\t\t\t\t<input name=\"contactid\" dojoAttachPoint=\"contactid\" type=\"hidden\" dojoType=\"dijit.form.TextBox\" ></input>\r\n\t\t\t\t\t\t\t<table cellspacing =\"0\" cellpadding=\"0\" width=\"100%\">\r\n\t\t\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Prefix</td><td colspan=\"2\"><input class=\"prmaxinput\" name=\"prefix\" dojoAttachPoint=\"prefix\" type=\"text\" trim=\"true\" dojoType=\"dijit.form.TextBox\" style=\"width: 2em;\" ></input></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">First Name</td><td colspan=\"2\"><input class=\"prmaxinput\" name=\"firstname\" dojoAttachPoint=\"firstname\" type=\"text\" trim=\"true\" dojoType=\"dijit.form.TextBox\" style=\"width: 5em;\" ></input></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Surname</td><td><input class=\"prmaxrequired\" name=\"familyname\" dojoAttachPoint=\"familyname\" type=\"text\"  trim=\"true\" required=\"true\" dojoType=\"dijit.form.ValidationTextBox\" style=\"width: 12em;\"></input></td><td></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Reason Code</td><td ><select dojoAttachPoint=\"reasoncodeid\" name=\"reasoncodeid\" dojotype =\"dijit.form.FilteringSelect\" searchAttr=\"name\" labelType=\"html\" style=\"width:98%\" class=\"prmaxrequired\"  /></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td  align=\"right\" valign=\"top\" class=\"prmaxrowtag\">Description</td><td ><div class=\"reasonframe\" ><textarea dojoAttachPoint=\"reason\" name=\"reason\" required=\"true\" dojoType=\"dijit.form.Textarea\" style=\"width:99%;height:80%\" ></textarea></div></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td align=\"left\" ><button dojoAttachEvent=\"onClick:_DeleteContact\" type=\"button\" dojoType=\"dijit.form.Button\" label=\"Delete\"></button></td><td align=\"right\" valign=\"bottom\" ><button dojoAttachEvent=\"onClick:_UpdateContact\" dojoAttachPoint=\"updateNode\" type=\"button\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Saving...\" label=\"Update\"></button></td></tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</form>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div dojoAttachPoint=\"\" dojoType=\"dijit.layout.ContentPane\"region=\"center\" splitter=\"true\" >\r\n\t\t\t\t\t\t<div dojoAttachPoint=\"people_details_employee_grid\" dojoType=\"dojox.grid.DataGrid\" rowsPerPage=\"100\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div  title=\"Audit\" dojotype=\"dijit.layout.ContentPane\"  style=\"width:100%;height:100%\">\r\n\t\t\t\t\t<div dojoAttachPoint=\"audit_ctrl\" dojoType=\"prmax.dataadmin.AuditViewer\" objecttypeid=\"5\" style=\"width:100%;height:100%\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div dojoAttachPoint=\"person_add_dlg\" dojoType=\"dijit.Dialog\" title =\"Add New Person\">\r\n\t\t<div dojoAttachPoint=\"person_add_ctrl\" dojoType=\"prmax.dataadmin.employees.EmployeeNew\" style=\"width:400px;height:300px\"></div>\r\n\t</div>\r\n\t<div dojoAttachPoint=\"person_delete_dlg\" dojoType=\"dijit.Dialog\" title =\"Delete Person\">\r\n\t\t<div dojoAttachPoint=\"person_delete_ctrl\" dojoType=\"prmax.dataadmin.employees.PersonDelete\" style=\"width:400px;height:200px\"></div>\r\n\t</div>\r\n</div>\r\n\r\n",constructor:function(){this.people_model=new prcommon.data.QueryWriteStore({url:"/contacts/research_contactlist",onError:ttl.utilities.globalerrorchecker,nocallback:true});this.people_employee_model=new dojox.data.QueryReadStore({url:"/contacts/research_contact_employee",onError:ttl.utilities.globalerrorchecker,nocallback:true});this._GetEntryCallBack=dojo.hitch(this,this._getContactEntry);this._LoadCallBack=dojo.hitch(this,this._LoadCall);this._UpdatedCallBack=dojo.hitch(this,this._UpdatedCall);dojo.subscribe(PRCOMMON.Events.Person_Added,dojo.hitch(this,this._PersonAddEvent));dojo.subscribe(PRCOMMON.Events.Person_Update,dojo.hitch(this,this._PersonUpdateEvent));dojo.subscribe(PRCOMMON.Events.Person_Delete,dojo.hitch(this,this._PersonDeleteEvent));dojo.subscribe(PRCOMMON.Events.Dialog_Close,dojo.hitch(this,this._DialogCloseEvent));},postCreate:function(){this.people_grid.set("structure",this.view);this.people_grid._setStore(this.people_model);this.people_details_employee_grid.set("structure",this.view_employee);this.people_details_employee_grid._setStore(this.people_employee_model);this.people_grid.onStyleRow=dojo.hitch(this,this._OnStyleRow);this.people_grid.onRowClick=dojo.hitch(this,this._OnSelectRow);this.reasoncodeid.store=PRCOMMON.utils.stores.Research_Reason_Update_Codes();this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Upd_Default);this.inherited(arguments);},_OnStyleRow:function(_1){ttl.GridHelpers.onStyleRow(_1);},_OnSelectRow:function(e){this._row=this.people_grid.getItem(e.rowIndex);this.contactid.set("value",this._row.i.contactid);this.people_details_employee_grid.setQuery(ttl.utilities.getPreventCache({contactid:this._row.i.contactid}));this.audit_ctrl.Load(this._row.i.contactid);dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCallBack,url:"/contacts/get",content:{contactid:this._row.i.contactid}}));this.controls.selectChild(this.details_view);this.people_grid.selection.clickSelectEvent(e);},_LoadCall:function(_2){if(_2.success=="OK"){this.prefix.set("value",_2.contact.prefix);this.firstname.set("value",_2.contact.firstname);this.familyname.set("value",_2.contact.familyname);this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Upd_Default);this.reason.set("value","");}},view:{cells:[[{name:"Display Name",width:"auto",field:"contactname"},{name:"Id",width:"auto",field:"contactid"},{name:"Source",width:"auto",field:"sourcename"}]]},view_employee:{cells:[[{name:"Outlet Name",width:"auto",field:"outletname"},{name:"Job Title ",width:"auto",field:"job_title"},{name:"Source",width:"auto",field:"sourcename"},{name:"Media Channel",width:"auto",field:"prmax_outlettypename"}]]},view:{cells:[[{name:"Display Name",width:"auto",field:"contactname"},{name:"Id",width:"auto",field:"contactid"},{name:"Source",width:"auto",field:"sourcename"}]]},resize:function(){this.borderControl.resize(arguments[0]);},_Execute:function(){var _3={};if(arguments[0].filter.length>0){_3["filter"]=arguments[0].filter;}this.people_grid.setQuery(ttl.utilities.getPreventCache(_3));},_ClearFilter:function(){this.filter.set("value","");},_Add:function(){this.person_add_dlg.show();},_PersonAddEvent:function(_4){this.people_model.newItem(_4);},_getContactEntry:function(){this.person=arguments[0];},_PersonUpdateEvent:function(_5){this.person=null;var _6={identity:_5.contactid,onItem:this._GetEntryCallBack};this.people_model.fetchItemByIdentity(_6);if(this.person!==null){this.people_model.setValue(this.person,"contactname",_5.contactname,true);this.people_model.setValue(this.person,"sourcename",_5.sourcename,true);}},_PersonDeleteEvent:function(_7){this.people_model.deleteItem(this._row);this.controls.selectChild(this.blank);this._row=null;},_DialogCloseEvent:function(_8){if(_8=="cont_add"){this.person_add_dlg.hide();}if(_8=="per_del"){this.person_delete_dlg.hide();}},_UpdateContact:function(){if(ttl.utilities.formValidator(this.formUpdate)==false){alert("Not all required field filled in");this.updateNode.cancel();return;}dojo.xhrPost(ttl.utilities.makeParams({load:this._UpdatedCallBack,url:"/contacts/research_update",content:this.formUpdate.get("value")}));},_ClearReason:function(){this.reasoncodeid.set("value",PRCOMMON.utils.stores.Reason_Upd_Default);this.reason.set("value","");},_UpdatedCall:function(_9){if(_9.success=="OK"){alert("Contact Updated");dojo.publish(PRCOMMON.Events.Person_Update,[_9.contact]);this._ClearReason();}else{alert("Problem Updated Contact");}this.updateNode.cancel();},_DeleteContact:function(){this.person_delete_ctrl.Load(this._row.i.contactid,this._row.i.contactname);this.person_delete_dlg.show();}});}