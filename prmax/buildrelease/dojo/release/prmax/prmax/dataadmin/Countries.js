/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.Countries"]){dojo._hasResource["prmax.dataadmin.Countries"]=true;dojo.provide("prmax.dataadmin.Countries");dojo.declare("prmax.dataadmin.Countries",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"frame\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='style:\"width:100%;height:100%;overflow:hidden\",gutters:false' >\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"top\",style:\"height:5%;width:100%;overflow:hidden\",\"class\":\"searchresults\"'>\r\n\t\t\t<div style=\"height:40px;width:100%;overflow:hidden;padding:0px;margin:0px\" class=\"searchresults\">\r\n\t\t\t\t<div style=\"height:100%;width:15%;float:left;padding:0px;margin:0px\" class=\"dijitToolbar prmaxrowdisplaylarge\">Manage Data Countries</div>\r\n\t\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='\"class\":\"dijitToolbarTop\",style:\"float:left;height:100%;width:85%;padding:0px;margin:0px\"' >\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\" data-dojo-props='iconClass:\"PrmaxResultsIcon PrmaxResultsEmpty\",showLabel:true'>\r\n\t\t\t\t\t\t<span>Filter By</span>\r\n\t\t\t\t\t\t<div data-dojo-type=\"dijit.TooltipDialog\" data-dojo-props='title:\"Enter Filter\"' data-dojo-attach-event=\"execute: _Execute\">\r\n\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t<tr><td class=\"prmaxlabeltag\">Name</td><td><input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"filter\" data-dojo-props='name:\"filter\",trim:true,maxlength:45,type:\"text\"'  ></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td class=\"prmaxlabeltag\">Type</td><td><select data-dojo-attach-point=\"countrytypeid_filter\" data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-props='name:\"countrytypeid\",searchAttr:\"name\",labelType:\"html\"' /></td></tr>\r\n\t\t\t\t\t\t\t\t<tr><td align=\"left\"><button data-dojo-attach-event=\"onClick: _ClearFilter\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",label:\"Clear Filter by\"'></button></td>\r\n\t\t\t\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"submit\",name:\"submit\",label:\"Filter by\"'></button></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"PrmaxResultsIcon PrmaxResultsEmpty\",showLabel:true,label:\"Add\"' data-dojo-attach-event=\"onClick:_ShowNew\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"center\",style:\"width:50%;height:100%\",splitter:\"true\"' >\r\n\t\t\t<div data-dojo-attach-point=\"countries_grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='rowsPerPage:50'></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-attach-point=\"add_dlg\" data-dojo-props='title:\"Add Country\",style:\"display:none;width:400px\"'>\r\n\t\t<form data-dojo-type=\"dijit.form.Form\" data-dojo-attach-point=\"form\" data-dojo-props='onsubmit:\"return false;\"'>\r\n\t\t\t<table width=\"300px\" cellpadding=\"0\" cellpadding=\"0\">\r\n\t\t\t\t<tr><td class=\"prmaxlabeltag\">Name</td><td><input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"countryname\" data-dojo-props='required:true,name:\"countryname\",invalidMessage:\"Please Enter Country Name\",trim:true,type:\"text\"'></td></tr>\r\n\t\t\t\t<tr><td class=\"prmaxlabeltag\">Type</td><td><select data-dojo-attach-point=\"countrytypeid\" data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-props='name:\"countrytypeid\",searchAttr:\"name\",labelType:\"html\",required:true' /></td></tr>\r\n\t\t\t\t<tr><td class=\"prmaxlabeltag\">Parent</td><td><select data-dojo-attach-point=\"regioncountryid\" data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-props='name:\"regioncountryid\",searchAttr:\"name\",labelType:\"html\"' /></td></tr>\r\n\t\t\t\t<tr><td><br/></td></tr>\r\n\t\t\t\t<tr><td colspan=\"2\" align=\"right\"><button data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='label:\"Add\",busyLabel:\"Please Wait\",type:\"button\"' data-dojo-attach-point=\"addBtn\" data-dojo-attach-event=\"onClick:_Add\"></button></td></tr>\r\n\t\t\t</table>\r\n\t\t</form>\r\n</div>\r\n</div>\r\n",constructor:function(){this.countries=new prcommon.data.QueryWriteStore({url:"/dataadmin/countries","nocallback":true});this.countrytypes_filter=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=countrytypes&nofilter=1"});this.countrytypes=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=countrytypes"});this.countries_list=new dojox.data.QueryReadStore({url:"/common/lookups?searchtype=countries&nofilter=1"});this._AddCallBack=dojo.hitch(this,this._AddCall);},postCreate:function(){this.countries_grid.set("structure",this.view);this.countries_grid._setStore(this.countries);this.countrytypeid_filter.set("store",this.countrytypes_filter);this.countrytypeid_filter.set("value",-1);this.countrytypeid.set("store",this.countrytypes);this.countrytypeid.set("value",1);this.regioncountryid.set("store",this.countries_list);this.regioncountryid.set("value",-1);this.inherited(arguments);},view:{cells:[[{name:"Name",width:"auto",field:"countryname"},{name:"Type",width:"auto",field:"countrytypedescription"},{name:"Parent",width:"auto",field:"parentcountryname"}]]},resize:function(){this.frame.resize(arguments[0]);this.inherited(arguments);},_Execute:function(){var _1={};if(arguments[0].countrytypeid!=-1){_1["countrytypeid"]=arguments[0].countrytypeid;}if(arguments[0].filter!=""){_1["countryname"]=arguments[0].filter;}this.countries_grid.setQuery(ttl.utilities.getPreventCache(_1));},_ClearFilter:function(){this.filter.set("value","");this.countrytypeid.set("value",-1);},onSelectRow:function(e){this._row=this.geographical_grid.getItem(e.rowIndex);},onCellClick:function(e){this.onSelectRow(e);},_Add:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Not all required field filled in");this.addBtn.cancel();return;}if(confirm("Add Country")){dojo.xhrPost(ttl.utilities.makeParams({load:this._AddCallBack,url:"/dataadmin/countries_add",content:this.form.get("value")}));}},_AddCall:function(_2){if(_2.success=="OK"){this.countries.newItem(_2.country);alert("Added");this.add_dlg.hide();}else{if(_2.message){alert(_2.message);}else{alert("Problem");}}this.addBtn.cancel();},_ShowNew:function(){this.countryname.set("value","");this.countrytypeid.set("value",1);this.regioncountryid.set("value",-1);this.add_dlg.show();this.countryname.focus();}});}