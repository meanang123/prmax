/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.ReasonCodes"]){dojo._hasResource["prmax.dataadmin.ReasonCodes"]=true;dojo.provide("prmax.dataadmin.ReasonCodes");dojo.declare("prmax.dataadmin.ReasonCodes",[dijit._Widget,dijit._Templated,dijit._Container],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div dojoAttachPoint=\"frame\" dojotype=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:100%;overflow: hidden\" gutters=\"false\">\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"top\" style=\"height:42px;width:100%;overflow:hidden\" class=\"searchresults\">\r\n\t\t\t<div style=\"height:40px;width:100%;overflow:hidden;padding:0px;margin:0px\" class=\"searchresults\">\r\n\t\t\t\t<div style=\"height:100%;width:15%;float:left;padding:0px;margin:0px\" class=\"dijitToolbar prmaxrowdisplaylarge\">Manage Reason Codes</div>\r\n\t\t\t\t\t<div class=\"dijitToolbarTop\" dojoType=\"dijit.Toolbar\" style=\"float:left;height:100%;width:85%;padding:0px;margin:0px\" >\r\n\t\t\t\t\t\t<div dojoType=\"dijit.form.DropDownButton\" iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" showLabel=\"true\">\r\n\t\t\t\t\t\t\t<span>Filter By</span>\r\n\t\t\t\t\t\t\t<div dojoType=\"dijit.TooltipDialog\" title=\"Enter Reason Filter filter\" dojoAttachEvent=\"execute: _Execute\">\r\n\t\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t\t<tr><td><label>Text</label></td><td><input dojoType=\"dijit.form.TextBox\" name=\"filter\" dojoAttachPoint=\"reason_filter_description\" trim=\"true\" maxlength=\"45\" type=\"text\" ></td></tr>\r\n\t\t\t\t\t\t\t\t\t<tr><td><label >Category</label></td><td><select dojoAttachPoint=\"reasoncategoryfilter\" name=\"reasoncategoryid\" dojotype =\"dijit.form.FilteringSelect\" searchAttr=\"name\" labelType=\"html\" style=\"width:98%\" /></td></tr>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td align=\"left\"><button dojoAttachEvent=\"onClick: _ClearFilter\" dojoType=\"dijit.form.Button\" type=\"button\" >Clear Filter by</button></td>\r\n\t\t\t\t\t\t\t\t\t\t<td align=\"right\"><button dojoType=\"dijit.form.Button\" type=\"submit\" name=\"submit\">Filter by</button></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div dojoType=\"dijit.form.DropDownButton\" iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" showLabel=\"true\">\r\n\t\t\t\t\t\t\t<span>New Reason</span>\r\n\t\t\t\t\t\t\t<div dojoType=\"dijit.TooltipDialog\" title=\"Enter Reason Code\" dojoAttachEvent=\"execute: _ExecuteAdd\">\r\n\t\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t\t<tr><td><label >Reason</label></td><td><input required=\"true\" invalidMessage=\"Role Name Required\" dojoType=\"dijit.form.ValidationTextBox\" name=\"reasoncodedescription\" dojoAttachPoint=\"reasoncodedescription\" trim=\"true\" maxlength=\"45\" type=\"text\"  class=\"prmaxrequired\" ></td></tr>\r\n\t\t\t\t\t\t\t\t\t<tr><td><label >Category</label></td><td><select dojoAttachPoint=\"reasoncategoryid\" name=\"reasoncategoryid\" dojotype =\"dijit.form.FilteringSelect\" searchAttr=\"name\" labelType=\"html\" style=\"width:98%\" class=\"prmaxrequired\" /></td></tr>\r\n\t\t\t\t\t\t\t\t\t<tr><td align=\"right\" colspan=\"2\"><button dojoType=\"dijit.form.Button\" type=\"submit\" name=\"submit\">Add Reason</button></td></tr>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"center\">\r\n\t\t\t<div dojoAttachPoint=\"reasons\" dojoType=\"dojox.grid.DataGrid\" query=\"{ reasonname:'*'}\" rowsPerPage=\"50\" style=\"width:100%:height:100%\"  ></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.model=new prcommon.data.QueryWriteStore({url:"/dataadmin/reasoncodes",onError:ttl.utilities.globalerrorchecker,nocallback:true});this.reasoncategories=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=reasoncategories"});this.reasoncategories_filter=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=reasoncategories&nooption=1"});this._AddReasonCallBack=dojo.hitch(this,this._AddReasonCall);},postCreate:function(){this.reasons.set("structure",this._view);this.reasons._setStore(this.model);this.reasoncategoryid.store=this.reasoncategories;this.reasoncategoryfilter.store=this.reasoncategories_filter;this.reasoncategoryfilter.set("value",-1);this.reasoncategoryid.set("value",1);this.inherited(arguments);},_view:{noscroll:false,cells:[[{name:"Reason Name",width:"auto",field:"reasoncodedescription"},{name:"Categories",width:"auto",field:"reasoncategoryname"}]]},_Execute:function(){var _1={};if(arguments[0].filter.length>0){_1["filter"]=arguments[0].filter;}if(arguments[0].reasoncategoryid!=-1){_1["reasoncategoryid"]=arguments[0].reasoncategoryid;}this.reasons.setQuery(ttl.utilities.getPreventCache(_1));},_ExecuteAdd:function(){if(this.reasoncodedescription.isValid()==false){alert("No Code Specified");}else{dojo.xhrPost(ttl.utilities.makeParams({load:this._AddReasonCallBack,url:"/dataadmin/reason_code_add",content:{reasoncodedescription:arguments[0].reasoncodedescription,reasoncategoryid:arguments[0].reasoncategoryid}}));}return false;},_AddReasonCall:function(_2){if(_2.success=="OK"){alert("Reason Added");gHelper.AddRowToQueryWriteGrid(this.reasons,this.model.newItem(_2.data));}else{if(_2.success=="DU"){alert("Reason Already Exists");}else{alert("Problem Adding Reason");}}},_ClearFilter:function(){this.reasoncategoryfilter.set("value",-1);this.reason_filter_description.set("value","");},resize:function(){this.frame.resize(arguments[0]);}});}