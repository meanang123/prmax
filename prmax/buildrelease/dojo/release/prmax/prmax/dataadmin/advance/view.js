/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.advance.view"]){dojo._hasResource["prmax.dataadmin.advance.view"]=true;dojo.provide("prmax.dataadmin.advance.view");dojo.require("prcommon.date.DateSearchExtended");dojo.require("prcommon.advance.advance");dojo.declare("prmax.dataadmin.advance.view",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div  dojoAttachPoint=\"frame\" dojotype=\"dijit.layout.BorderContainer\" gutters=\"False\" >\r\n\t\t<div  dojotype=\"dijit.layout.BorderContainer\"  region=\"left\" style=\"width:50%;height:100%\" gutters=\"False\" >\r\n\t\t\t<div  dojotype=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:55%; border: 0; padding: 0; margin: 0\" region=\"top\">\r\n\t\t\t\t<div  dojoAttachPoint=\"search_form_pane\" dojotype=\"dijit.layout.TabContainer\" region=\"center\" >\r\n\t\t\t\t\t<div dojoAttachPoint=\"std_search_advance\" dojoType=\"ttl.layout.ContentPane\"  title=\"Features\" href=\"/layout/std_search_advance\" style=\"overflow:auto\" ></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojotype=\"dijit.layout.ContentPane\" region=\"bottom\" style=\"width:100%;height:12%;\">\r\n\t\t\t\t\t<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"border-collapse: collapse;\" >\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td ><button class=\"prmaxbutton\" dojoAttachEvent=\"onClick:_ClearSearch\" dojoType=\"dijit.form.Button\" label=\"Clear Search Criteria\" ></button></td>\r\n\t\t\t\t\t\t\t<td ><button class=\"prmaxbutton\" dojoAttachEvent=\"onClick:_ClearSearchResults\" dojoType=\"dijit.form.Button\" label=\"Clear Search Results\" ></button></td>\r\n\t\t\t\t\t\t\t<td align=\"right\"><button dojoAttachPoint=\"searchbutton\" class=\"prmaxbutton\" dojoAttachEvent=\"onClick:_Search\" dojoType=\"dojox.form.BusyButton\" iconClass=\"dijitPrmaxIcon dijitPrmaxIconSearch\" busyLabel=\"Searching...\" ><div style=\"font-size:18pt\">Search</div></button></td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div  dojoType=\"dijit.layout.BorderContainer\" region=\"center\" splitter=\"true\" >\r\n\t\t\t\t<div dojoAttachPoint=\"searchgrid\" dojoType=\"dojox.grid.DataGrid\" region=\"center\" rowsPerPage=\"50\"></div>\r\n\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t<div dojoAttachPoint=\"outlet_advance_ctrl\" dojoType=\"prcommon.advance.advance\" style=\"padding-right:10px;overflow:auto;overflow-x:hidden\" region=\"center\"></div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.model=new prcommon.data.QueryWriteStore({url:"/advance/viewpage",onError:ttl.utilities.globalerrorchecker,nocallback:true});this._LoadCallBack=dojo.hitch(this,this._LoadCall);this._getModelItemCall=dojo.hitch(this,this._getModelItem);},postCreate:function(){this.searchgrid.set("structure",this.view);this.searchgrid._setStore(this.model);dojo.connect(this.search_form_pane,"onLoad",dojo.hitch(this,this._ConnectPane));this.searchgrid["onStyleRow"]=dojo.hitch(this,ttl.GridHelpers.onStyleRow);this.searchgrid["onRowClick"]=dojo.hitch(this,this.onSelectRow);this.searchgrid["onCellClick"]=dojo.hitch(this,this.onCellClick);this.inherited(arguments);},view:{cells:[[{name:"Outlet Name",width:"200px",field:"outletname"},{name:"Publication Date",width:"150px",field:"pub_date_display"},{name:"Feature",width:"auto",field:"feature"}]]},onSelectRow:function(e){var _1=this.searchgrid.getItem(e.rowIndex);this.outlet_advance_ctrl.Load(_1.i.advancefeatureid,_1.i.outletid);dojo.removeClass(this.outlet_advance_ctrl.domNode,"prmaxhidden");this.searchgrid.selection.clickSelectEvent(e);},onCellClick:function(e){this.onSelectRow(e);},_getModelItem:function(){if(arguments[0].i.i!=null){this.tmp_row=arguments[0].i;}else{this.tmp_row=arguments[0];}},_ConnectPane:function(){dojo.connect(dijit.byId(this.form_name),"onSubmit",dojo.hitch(this,this._Submit));},_Submit:function(){this._DoSearch();},_ClearSearch:function(){var _2=this._getForm();dojo.every(_2.getDescendants(),function(_3){if(_3.Clear!=null){_3.Clear();}return true;});this.searchbutton.cancel();},_ClearSearchResults:function(){dojo.xhrPost(ttl.utilities.makeParams({load:dojo.hitch(this,this._ClearAllCall),url:"/advance/delete_list_all"}));},_ClearAllCall:function(_4){this.searchgrid.selection.clear();this.searchgrid.setQuery(ttl.utilities.getPreventCache({}));dojo.addClass(this.outlet_advance_ctrl.domNode,"prmaxhidden");},_Search:function(){this._DoSearch();},_DoSearch:function(){var _5=this._getForm();_5.setExtendedMode(false);var _6=_5.get("value");_6["mode"]=1;_6["search_partial"]=2;_6["searchtypeid"]=3;_6["research"]=1;dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCallBack,url:"/search/dosearch",content:_6}));},_LoadCall:function(_7){this.searchgrid.selection.clear();this.searchgrid.setQuery(ttl.utilities.getPreventCache({}));this.searchbutton.cancel();},resize:function(){this.frame.resize(arguments[0]);this.inherited(arguments);},_getForm:function(){var _8=null;dojo.every(this.search_form_pane.selectedChildWidget.getDescendants(),function(_9){if(_9.formid!=null){_8=_9;}});return _8;}});}