/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.AuditViewer"]){dojo._hasResource["prmax.dataadmin.AuditViewer"]=true;dojo.provide("prmax.dataadmin.AuditViewer");dojo.declare("prmax.dataadmin.AuditViewer",[ttl.BaseWidget],{widgetsInTemplate:true,objecttypeid:-1,objectisbase:false,templateString:"<div>\r\n\t<div  dojoAttachPoint=\"borderControl\" dojotype=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:100%;overflow: hidden\" gutters=\"false\">\r\n\t\t<div dojotype=\"dijit.layout.ContentPane\" region=\"top\" style=\"width:100%;height:45px;\">\r\n\t\t\t<div style=\"height:40px;width:100%;overflow:hidden\" class=\"searchresults\">\r\n\t\t\t\t<div style=\"height:100%;width:25%;float:left;\" class=\"prmaxrowdisplaylarge\">View Audit Trail</div>\r\n\t\t\t\t<div style=\"float:left\" >\r\n\t\t\t\t\t<form dojoAttachPoint=\"filterform\"  onsubmit=\"return false\" dojoType=\"dijit.form.Form\">\r\n\t\t\t\t\t\t<input class=\"prmaxbutton\" type=\"text\"  dojoAttachPoint=\"filterdate\" name = \"filterdate\" dojoType=\"dijit.form.DateTextBox\" >\r\n\t\t\t\t\t\t<button class=\"prmaxbutton\"  type=\"submit\" dojoType=\"dijit.form.Button\" label=\"Filter By\" ></button>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div  dojoType=\"dijit.layout.ContentPane\" region=\"center\"  splitter=\"true\" >\r\n\t\t\t<div dojoAttachPoint=\"result_grid\" dojoType=\"dojox.grid.DataGrid\" rowsPerPage=\"50\"></div>\r\n\t\t</div>\r\n\t\t<div  dojoType=\"dijit.layout.ContentPane\" region=\"bottom\"  splitter=\"true\" style=\"width:100%;height:20%\">\r\n\t\t\t<div dojoAttachPoint=\"details_grid\" dojoType=\"dojox.grid.DataGrid\" rowsPerPage=\"50\"></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.results=new dojox.data.QueryReadStore({url:"/dataadmin/audit_trail"});this.details=new dojox.data.QueryReadStore({url:"/dataadmin/audit_details"});},postCreate:function(){if(this.objectisbase==true){this.result_grid.set("structure",this.view_ext);}else{this.result_grid.set("structure",this.view);}this.result_grid._setStore(this.results);this.details_grid.set("structure",this.view_details);this.details_grid._setStore(this.details);this.filterdate.set("value",new Date());dojo.connect(this.filterform,"onSubmit",dojo.hitch(this,this._Filter));this.result_grid.onRowClick=dojo.hitch(this,this._OnSelectRow);this.inherited(arguments);},_OnSelectRow:function(e){this._row=this.result_grid.getItem(e.rowIndex);this.details_grid.setQuery(ttl.utilities.getPreventCache({activityid:this._row.i.activityid}));this.result_grid.selection.clickSelectEvent(e);},view:{cells:[[{name:"Date",width:"120px",field:"activitydate"},{name:"Action",width:"100px",field:"actiontypedescription"},{name:"Reason",width:"auto",field:"reasoncodedescription"},{name:"User",width:"auto",field:"display_name"},{name:"Reason Details",width:"auto",field:"reason"}]]},view_ext:{cells:[[{name:"Date",width:"120px",field:"activitydate"},{name:"Action",width:"100px",field:"actiontypedescription"},{name:"Reason",width:"auto",field:"reasoncodedescription"},{name:"User",width:"auto",field:"display_name"},{name:"Reason Details",width:"auto",field:"reason"},{name:"Type",width:"auto",field:"objecttypename"}]]},view_details:{cells:[[{name:"Field",width:"auto",field:"fieldname"},{name:"From",width:"auto",field:"fromvalue"},{name:"To",width:"auto",field:"tovalue"}]]},resize:function(){this.borderControl.resize(arguments[0]);},Load:function(_1){this.Clear();this._objectid=_1;},_Filter:function(){var d=this.filterdate.get("value");this.result_grid.setQuery(ttl.utilities.getPreventCache({filterdate:d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate(),objecttypeid:this.objecttypeid,objectisbase:this.objectisbase,objectid:this._objectid}));},Clear:function(){this.result_grid.setQuery(ttl.utilities.getPreventCache({}));this.details_grid.setQuery(ttl.utilities.getPreventCache({}));}});}