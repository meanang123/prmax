/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.Interests"]){dojo._hasResource["prmax.dataadmin.Interests"]=true;dojo.provide("prmax.dataadmin.Interests");dojo.declare("prmax.dataadmin.Interests",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div  dojoAttachPoint=\"frame\" dojotype=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:100%;overflow: hidden\" gutters=\"false\">\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"top\" style=\"height:42px;width:100%;overflow:hidden\" class=\"searchresults\">\r\n\t\t\t<div style=\"height:40px;width:100%;overflow:hidden;padding:0px;margin:0px\" class=\"searchresults\">\r\n\t\t\t\t<div style=\"height:100%;width:15%;float:left;padding:0px;margin:0px\" class=\"dijitToolbar prmaxrowdisplaylarge\">Manage Keywords</div>\r\n\t\t\t\t\t<div class=\"dijitToolbarTop\" dojoType=\"dijit.Toolbar\" style=\"float:left;height:100%;width:85%;padding:0px;margin:0px\" >\r\n\t\t\t\t\t\t<div dojoType=\"dijit.form.DropDownButton\"   iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" showLabel=\"true\">\r\n\t\t\t\t\t\t\t<span>Filter  By</span>\r\n\t\t\t\t\t\t\t<div dojoType=\"dijit.TooltipDialog\" title=\"Enter Keyword filter\" dojoAttachEvent=\"execute: _Execute\">\r\n\t\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td><label for=\"user\">Text</label></td>\r\n\t\t\t\t\t\t\t\t\t\t<td><input dojoType=\"dijit.form.TextBox\"name=\"filter\" dojoAttachPoint=\"filter\" trim=\"true\" maxlength=\"45\" type=\"text\"  ></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td align=\"left\"><button dojoAttachEvent=\"onClick: _ClearFilter\" dojoType=\"dijit.form.Button\" type=\"button\" >Clear Filter by</button></td>\r\n\t\t\t\t\t\t\t\t\t\t<td align=\"right\"><button dojoType=\"dijit.form.Button\" type=\"submit\" name=\"submit\">Filter by</button></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t<div dojoType=\"dijit.form.DropDownButton\"   iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" showLabel=\"true\">\r\n\t\t\t\t\t\t<span>New</span>\r\n\t\t\t\t\t\t<div dojoType=\"dijit.TooltipDialog\" title=\"Enter New Keyword Name\" dojoAttachEvent=\"execute: _ExecuteAdd\">\r\n\t\t\t\t\t\t\t<table width=\"300px\">\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td><label >Keyword Name</label></td>\r\n\t\t\t\t\t\t\t\t\t<td><input required=\"true\" invalidMessage=\"Keyword Name Required\" dojoType=\"dijit.form.ValidationTextBox\" name=\"interestname\" dojoAttachPoint=\"interestname\" trim=\"true\" maxlength=\"45\" type=\"text\"  ></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td><label >Keyword Parent</label></td><td>\r\n\t\t\t\t\t\t\t\t\t<select style=\"width:100%\" name=\"interestparentid\" autoComplete=\"true\" searchAttr=\"name\" dojoType=\"dijit.form.FilteringSelect\" labelType=\"html\" dojoAttachPoint=\"master_type\" ></td></tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td><label >Is Section Heading</label></td>\r\n\t\t\t\t\t\t\t\t\t\t<td><input name=\"is_new_section\" dojoType=\"dijit.form.CheckBox\"  type=\"checkbox\"  ></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\r\n\t\t\t\t\t\t\t\t\t<td align=\"right\" colspan=\"2\"><button dojoType=\"dijit.form.Button\" type=\"submit\" name=\"submit\">Add </button></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"left\" style=\"width:50%;height:100%\" splitter=\"true\" >\r\n\t\t\t<div dojoAttachPoint=\"interest_grid\" dojoType=\"dojox.grid.DataGrid\" rowsPerPage=\"100\"></div>\r\n\t\t</div>\r\n\t\t<div dojoType=\"dijit.layout.TabContainer\" region=\"center\" splitter=\"true\">\r\n\t\t\t<div dojoAttachPoint=\"\" dojoType=\"dijit.layout.ContentPane\" title=\"Details\" preload=\"true\"  selected >\r\n\t\t\t\t<div dojoAttachPoint=\"details_view\"  class=\"prmaxhidden\">\r\n\t\t\t\t\t<table width=\"100%\">\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowdisplaylarge\" width=\"30%\">Keywords</td><td class=\"prmaxrowdisplaylarge\"  dojoAttachPoint=\"interest_name\"></td></tr>\r\n\t\t\t\t\t\t<tr><td><label >Name</label></td><td><input required=\"true\" invalidMessage=\"Keyword Name Required\" dojoType=\"dijit.form.ValidationTextBox\" name=\"interestname\" dojoAttachPoint=\"interestname2\" trim=\"true\" maxlength=\"45\" type=\"text\"  ></td></tr>\r\n\t\t\t\t\t\t<tr><td><label >Keyword Parent</label></td><td><select style=\"width:80%\" name=\"interestparentid\" autoComplete=\"true\" searchAttr=\"name\" dojoType=\"dijit.form.FilteringSelect\" labelType=\"html\" dojoAttachPoint=\"master_type2\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td><label >Is Section Heading</label></td><td><input name=\"is_section\" dojoType=\"dijit.form.CheckBox\" dojoAttachPoint=\"is_section\" type=\"checkbox\"  ></td></tr>\r\n\t\t\t\t\t\t<tr><td colspan=\"2\" align=\"right\"><button dojoType=\"dijit.form.Button\" type=\"button\" name=\"button\" dojoAttachEvent=\"onClick:_RenameInterest\">Update</button></td></tr>\r\n\t\t\t\t\t\t<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n\t\t\t\t\t\t<td align=\"left\"><button  style=\"padding:0px;margin:0px\" dojoAttachPoint=\"transfer\" type=\"button\" dojoAttachEvent=\"onClick:_Transfere\" dojoType=\"dijit.form.Button\" label=\"Show Transfer Keywords\"></button></td>\r\n\t\t\t\t\t\t\t<td ><button dojoType=\"dijit.form.Button\" type=\"button\" name=\"submit\" dojoAttachEvent=\"onClick:_DeleteInterest\">Delete Interest</button></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t\t<div class=\"prmaxhidden\" dojoAttachPoint=\"show_transfer\" style=\"padding-top:5px\">\r\n\t\t\t\t\t\t<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n\t\t\t\t\t\t\t<tr><td colspan=\"3\" class=\"prmaxrowdisplaytitle\">Move Interest to a New Interest</td></tr>\r\n\t\t\t\t\t\t\t<tr><td >&nbsp;</td></tr>\r\n\t\t\t\t\t\t\t<tr ><td colspan=\"3\" ><span class=\"prmaxrowtag\">Select</span><input class=\"prmaxfocus prmaxinput\" type=\"text\" style=\"width:200px;padding-bottom:3px\" dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"transfer_list_select\" /></td></tr>\r\n\t\t\t\t\t\t\t<tr><td width=\"46%\"><select style=\"width:100%\" dojoAttachPoint=\"transfer_list\" size=\"7\" class=\"lists\" ></select></td>\r\n\t\t\t\t\t\t\t<tr><td >&nbsp;</td></tr>\r\n\t\t\t\t\t\t\t<tr><td align=\"left\"><button  style=\"padding:0px;margin:0px\" dojoAttachPoint=\"transfer_do\" disabled=\"disabled\" type=\"button\" dojoAttachEvent=\"onClick:_Transfere_Do\" dojoType=\"dijit.form.Button\" label=\"Do Transfer Interest To\"></button></td></tr>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoAttachPoint=\"\" dojoType=\"dijit.layout.ContentPane\" title=\"Outlet Used\">\r\n\t\t\t\t<div dojoAttachPoint=\"interest_outlet_used_grid\" dojoType=\"dojox.grid.DataGrid\" rowsPerPage=\"200\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoAttachPoint=\"\" dojoType=\"dijit.layout.ContentPane\" title=\"Contact Used\">\r\n\t\t\t\t<div dojoAttachPoint=\"interest_employee_used_grid\" dojoType=\"dojox.grid.DataGrid\" rowsPerPage=\"200\"></div>\r\n\t\t\t</div>\r\n\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.interests=new prcommon.data.QueryWriteStore({url:"/dataadmin/interests",nocallback:true,onError:ttl.utilities.globalerrorchecker});this.interest_outlet_used=new prcommon.data.QueryWriteStore({url:"/interests/research_where_used_outlet",nocallback:true,onError:ttl.utilities.globalerrorchecker});this.interest_employee_used=new prcommon.data.QueryWriteStore({url:"/interests/research_where_used_employee",nocallback:true,onError:ttl.utilities.globalerrorchecker});this._AddInterestCallBack=dojo.hitch(this,this._AddInterestCall);this._RenameInterestCallBack=dojo.hitch(this,this._RenameInterestCall);this._DeleteInterestCallBack=dojo.hitch(this,this._DeleteInterestCall);this._DeleteOutletCallBack=dojo.hitch(this,this._DeleteOutletCall);this._DeleteEmployeeCallBack=dojo.hitch(this,this._DeleteEmployeeCall);this._TransferSelectionCallBack=dojo.hitch(this,this._TransferSelectionCall);this._TransferCallBack=dojo.hitch(this,this._TransferCall);},postCreate:function(){this.interest_grid.set("structure",this.view);this.interest_grid._setStore(this.interests);this.baseonCellClick=this.interest_grid["onCellClick"];this.interest_grid["onStyleRow"]=dojo.hitch(this,ttl.GridHelpers.onStyleRow);this.interest_grid["onRowClick"]=dojo.hitch(this,this.onSelectRow);this.interest_grid["onCellClick"]=dojo.hitch(this,this.onCellClick);this.interest_outlet_used_grid["onCellClick"]=dojo.hitch(this,this._OutletWhereUsed);this.interest_employee_used_grid["onCellClick"]=dojo.hitch(this,this._ContactWhereUsed);this.interest_outlet_used_grid.set("structure",this.view_user_outlet);this.interest_outlet_used_grid._setStore(this.interest_outlet_used);this.interest_employee_used_grid.set("structure",this.view_user_employee);this.interest_employee_used_grid._setStore(this.interest_employee_used);this.master_type.store=PRCOMMON.utils.stores.Interest_Filter();this.master_type.set("value",-1);this.master_type2.store=PRCOMMON.utils.stores.Interest_Filter();this.master_type2.set("value",-1);dojo.connect(this.transfer_list_select.domNode,"onkeyup",dojo.hitch(this,this._TransferSelect));dojo.connect(this.transfer_list,"onchange",dojo.hitch(this,this._TransferSelectionOptions));dojo.subscribe(PRCOMMON.Events.Interest_Delete,dojo.hitch(this,this._InterestDeleteEvent));dojo.subscribe(PRCOMMON.Events.Interest_Update,dojo.hitch(this,this._InterestUpdateEvent));dojo.subscribe(PRCOMMON.Events.Interest_Add,dojo.hitch(this,this._InterestAddEvent));},view:{cells:[[{name:"Interests",width:"auto",field:"interestname"},{name:"Parent",width:"auto",field:"parentname"},{name:"is_section",width:"50px",field:"is_section"}]]},view_user_employee:{cells:[[{name:"Outlet Name",width:"auto",field:"outletname"},{name:"Contact",width:"auto",field:"contactname"},{name:"Job Title",width:"auto",field:"job_title"},{name:" ",width:"13px",styles:"text-align: center;",width:"20px",formatter:ttl.utilities.deleteRowCtrl}]]},view_user_outlet:{cells:[[{name:"Outlet Name",width:"auto",field:"outletname"},{name:" ",width:"13px",styles:"text-align: center;",width:"20px",formatter:ttl.utilities.deleteRowCtrl}]]},resize:function(){this.frame.resize(arguments[0]);},_DeleteOutletCall:function(_1){if(_1.success=="OK"){this.interest_outlet_used.deleteItem(this._outlet_row);}},_OutletWhereUsed:function(e){if(e.cellIndex==1){this._outlet_row=this.interest_outlet_used_grid.getItem(e.rowIndex);dojo.xhrPost(ttl.utilities.makeParams({load:this._DeleteOutletCallBack,url:"/interests/research_delete_from_outlet",content:{outletid:this._outlet_row.i.outletid,interestid:this._interestid}}));}},_DeleteEmployeeCall:function(_2){if(_2.success=="OK"){this.interest_employee_used.deleteItem(this._employee_row);}},_ContactWhereUsed:function(e){if(e.cellIndex==3){this._employee_row=this.interest_employee_used_grid.getItem(e.rowIndex);dojo.xhrPost(ttl.utilities.makeParams({load:this._DeleteEmployeeCallBack,url:"/interests/research_delete_from_employee",content:{employeeid:this._employee_row.i.employeeid,interestid:this._interestid}}));}},destroy:function(){try{this.inherited(arguments);}catch(e){}},_Execute:function(){var _3={filter:arguments[0].filter};this.interest_grid.setQuery(ttl.utilities.getPreventCache(_3));this._Clear();},_AddInterestCall:function(_4){if(_4.success=="OK"){dojo.publish(PRCOMMON.Events.Interest_Add,[_4.data]);alert("Interest Added");this._ClearAdd();}else{if(_4.success=="DU"){alert("Interest all ready exists");}else{alert("Problem adding interest");}}},_ExecuteAdd:function(){if(this.interestname.isValid()==false){alert("No Interest Specified");}else{var _5={interestname:arguments[0].interestname,parentinterestid:arguments[0].interestparentid};if(arguments[0].is_new_section[0]=="on"){_5["is_section"]=1;}dojo.xhrPost(ttl.utilities.makeParams({load:this._AddInterestCallBack,url:"/interests/research_add",content:_5}));}return false;},_ClearFilter:function(){this.filter.set("value","");},_ClearAdd:function(){this.interestname.set("value","");this.master_type.set("value",-1);},_Clear:function(){this._interestid=null;this._row=null;dojo.addClass(this.details_view,"prmaxhidden");this.interest_outlet_used_grid.setQuery(ttl.utilities.getPreventCache({}));this.interest_employee_used_grid.setQuery(ttl.utilities.getPreventCache({}));},onSelectRow:function(e){var _6=this.interest_grid.getItem(e.rowIndex);dojo.removeClass(this.details_view,"prmaxhidden");this.interest_outlet_used_grid.setQuery(ttl.utilities.getPreventCache({interestid:_6.i.interestid}));this.interest_employee_used_grid.setQuery(ttl.utilities.getPreventCache({interestid:_6.i.interestid}));this._interestid=_6.i.interestid;dojo.attr(this.interest_name,_6.i.interestname);this.is_section.set("value",_6.i.is_section);this.interestname2.set("value",_6.i.interestname);this.master_type2.set("value",_6.i.parentinterestid);this._row=_6;this.interest_grid.selection.clickSelectEvent(e);},onCellClick:function(e){this.onSelectRow(e);},_DeleteInterestCall:function(_7){if(_7.success=="OK"){dojo.publish(PRCOMMON.Events.Interest_Delete,[_7.data]);alert("Interest Delete");}else{alert("Problem Deleting interest may still be in use ");}},_DeleteInterest:function(){if(confirm("Delete Interest")){dojo.xhrPost(ttl.utilities.makeParams({load:this._DeleteInterestCallBack,url:"/interests/research_delete",content:{interestid:this._interestid}}));}return false;},_RenameInterestCall:function(_8){if(_8.success=="OK"){dojo.publish(PRCOMMON.Events.Interest_Update,[_8.data]);dojo.attr(this.interest_name,_8.data.interest.interestname);alert("Interest Renamed");}else{if(_8.success=="DU"){alert("Already Exists");}else{alert("Problem Renaming interest");}}},_RenameInterest:function(){if(this.interestname2.isValid()==false){alert("No Interest Specified");return false;}if(confirm("Update Interest")){var _9={interestname:this.interestname2.get("value"),parentinterestid:this.master_type2.get("value"),interestid:this._interestid};if(this.is_section.get("checked")){_9["is_section"]=1;}dojo.xhrPost(ttl.utilities.makeParams({load:this._RenameInterestCallBack,url:"/interests/research_rename",content:_9}));}return false;},_InterestDeleteEvent:function(_a){this.interests.deleteItem(this._row);this._Clear();},_InterestUpdateEvent:function(_b){this.interests.setValue(this._row,"interestname",_b.interest.interestname,true);this.interests.setValue(this._row,"is_section",_b.is_section,true);},_InterestAddEvent:function(_c){var _d={interestid:_c.interest.interestid,interestname:_c.interest.interestname,parentname:"",parentinterestid:null};if(_c.parentinterest!=null){_d["parentname"]=_c.parentinterest.parentname;_d["parentinterestid"]=_c.parentinterest.parentinterestid;}gHelper.AddRowToQueryWriteGrid(this.interest_grid,this.interests.newItem(_d));},_Transfere:function(){dojo.toggleClass(this.show_transfer,"prmaxhidden");},_TransferCall:function(_e){if(_e.success=="OK"){this.interest_outlet_used_grid.setQuery(ttl.utilities.getPreventCache({interestid:this._interestid}));this.interest_employee_used_grid.setQuery(ttl.utilities.getPreventCache({interestid:this._interestid}));this._ClearTransferSelectionBox();this._Transfere();alert("Interest Moved");}else{alert("Problem Moving Interest");}},_Transfere_Do:function(){if(confirm("Move Interest to "+this.transfer_list.options[this.transfer_list.selectedIndex].text+"?")){dojo.xhrPost(ttl.utilities.makeParams({load:this._TransferCallBack,url:"/interests/research_move_interest",content:{frominterestid:this._interestid,tointerestid:this.transfer_list.options[this.transfer_list.selectedIndex].value}}));}},_TransferSelectionCall:function(_f){if(this._transactionid==_f.transactionid){this._ClearTransferSelectionBox();for(var i=0;i<_f.data.length;++i){var _10=_f.data[i];this.transfer_list.options[this.transfer_list.options.length]=new Option(_10[0]+"("+_10[1]+")",_10[1]);}this._TransferSelectionOptions();}},_TransferSelect:function(){var _11=this.transfer_list_select.get("value");if(_11.length>0){this._transactionid=PRCOMMON.utils.uuid.createUUID();dojo.xhrPost(ttl.utilities.makeParams({load:this._TransferSelectionCallBack,url:"/interests/listuserselection",content:{word:_11,filter:-1,interesttypeid:1,transactionid:this._transactionid,restrict:0}}));}else{this._ClearTransferSelectionBox();this._TransferSelectionOptions();}},_TransferSelectionOptions:function(){},_ClearTransferSelectionBox:function(){this.transfer_list.options.length=0;},_TransferSelectionOptions:function(){this.transfer_do.set("disabled",this.transfer_list.selectedIndex!=-1?false:true);}});}