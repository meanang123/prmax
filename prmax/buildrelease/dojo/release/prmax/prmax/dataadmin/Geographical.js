/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.Geographical"]){dojo._hasResource["prmax.dataadmin.Geographical"]=true;dojo.provide("prmax.dataadmin.Geographical");dojo.declare("prmax.dataadmin.Geographical",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div  dojoAttachPoint=\"frame\" dojotype=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:100%;overflow: hidden;\" gutters=\"false\" >\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"top\" style=\"height:5%;width:100%;overflow:hidden\" class=\"searchresults\">\r\n\t\t\t<div style=\"height:40px;width:100%;overflow:hidden;padding:0px;margin:0px\" class=\"searchresults\">\r\n\t\t\t\t<div style=\"height:100%;width:15%;float:left;padding:0px;margin:0px\" class=\"dijitToolbar prmaxrowdisplaylarge\">Manage Geography</div>\r\n\t\t\t\t<div class=\"dijitToolbarTop\" dojoType=\"dijit.Toolbar\" style=\"float:left;height:100%;width:85%;padding:0px;margin:0px\" >\r\n\t\t\t\t\t<div dojoType=\"dijit.form.DropDownButton\"   iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" showLabel=\"true\">\r\n\t\t\t\t\t\t<span>Filter  By</span>\r\n\t\t\t\t\t\t<div dojoType=\"dijit.TooltipDialog\" title=\"Enter Geographical filter\" dojoAttachEvent=\"execute: _Execute\">\r\n\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t<tr><td>Area</td>\r\n\t\t\t\t\t\t\t\t\t\t<td><input dojoType=\"dijit.form.TextBox\"name=\"filter\" dojoAttachPoint=\"filter\" trim=\"true\" maxlength=\"45\" type=\"text\"  ></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td>Type</td>\r\n\t\t\t\t\t\t\t\t\t<td><select dojoAttachPoint=\"geographicallookups\" name=\"geographicallookuptypeid\" dojotype =\"dijit.form.FilteringSelect\" searchAttr=\"name\" labelType=\"html\" /></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td align=\"left\"><button dojoAttachEvent=\"onClick: _ClearFilter\" dojoType=\"dijit.form.Button\" type=\"button\" >Clear Filter by</button></td>\r\n\t\t\t\t\t\t\t\t\t<td align=\"right\"><button dojoType=\"dijit.form.Button\" type=\"submit\" name=\"submit\">Filter by</button></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div dojoType=\"dijit.form.Button\"   iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\" showLabel=\"true\" dojoAttachEvent=\"onClick:_AddNew\" label=\"Add\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"left\" style=\"width:50%;height:100%\" splitter=\"true\" >\r\n\t\t\t<div dojoAttachPoint=\"geographical_grid\" dojoType=\"dojox.grid.DataGrid\" rowsPerPage=\"50\"></div>\r\n\t\t</div>\r\n\t\t<div dojoType=\"dijit.layout.TabContainer\" region=\"center\" splitter=\"true\" >\r\n\t\t\t<div dojoType=\"dijit.layout.ContentPane\" title=\"Details\" >\r\n\t\t\t\t<div dojoAttachPoint=\"geographical_edit\" dojoType=\"prmax.geographical.GeographicalEdit\" style=\"width:100%;height:100%\" class=\"prmaxhidden\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType=\"dijit.layout.ContentPane\" title=\"Geo. Coverage\" >\r\n\t\t\t\t<div dojoAttachPoint=\"coverage_grid\" dojoType=\"dojox.grid.DataGrid\" rowsPerPage=\"50\"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div dojoType=\"dijit.Dialog\" title=\"Add Geographical Area\" dojoAttachPoint=\"geographical_add_dlg\" style=\"display:none;width:400px\">\r\n\t\t<div dojoAttachPoint=\"geographical_add\" dojoType=\"prmax.geographical.GeographicalEdit\" style=\"width:100%;height:100%\" ></div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.geographical=new prcommon.data.QueryWriteStore({url:"/dataadmin/geographical","nocallback":true});this.geographical_types=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=geographicallookuptypes&addempty=1"});this.coverage_store=new dojox.data.QueryReadStore({url:"/dataadmin/coverage"});this.children_store=new dojox.data.QueryReadStore({url:"/geographical/geographical_children"});dojo.subscribe(PRCOMMON.Events.Dialog_Close,dojo.hitch(this,this._DialogCloseEvent));dojo.subscribe(PRCOMMON.Events.Geographical_Area_Delete,dojo.hitch(this,this._GeogDeleteEvent));dojo.subscribe(PRCOMMON.Events.Geographical_Area_Update,dojo.hitch(this,this._GeogUpdateEvent));dojo.subscribe(PRCOMMON.Events.Geographical_Area_Add,dojo.hitch(this,this._GeogAddEvent));dojo.subscribe(PRCOMMON.Events.Coverage_Moved,dojo.hitch(this,this._CoverageMovedEvent));},postCreate:function(){this.geographical_grid.set("structure",this.view);this.geographical_grid._setStore(this.geographical);this.coverage_grid.set("structure",this.coverage_view);this.coverage_grid._setStore(this.coverage_store);this.baseonCellClick=this.geographical_grid["onCellClick"];this.geographical_grid["onStyleRow"]=dojo.hitch(this,ttl.GridHelpers.onStyleRow);this.geographical_grid["onCellClick"]=dojo.hitch(this,this.onCellClick);this.geographicallookups.store=this.geographical_types;this.geographicallookups.set("value",-1);this.inherited(arguments);},view:{cells:[[{name:"Area",width:"auto",field:"geographicalname"},{name:"Type",width:"auto",field:"geographicallookupdescription"},{name:"Internal Id",width:"auto",field:"geographicalid"}]]},coverage_view:{cells:[[{name:"Outlet",width:"auto",field:"outletname"}]]},resize:function(){this.frame.resize(arguments[0]);this.inherited(arguments);},destroy:function(){try{this.inherited(arguments);}catch(e){}},_Execute:function(){var _1={filter:arguments[0].filter,geographicallookuptypeid:-1};if(arguments[0].geographicallookuptypeid!=-1){_1["geographicallookuptypeid"]=arguments[0].geographicallookuptypeid;}this.geographical_grid.setQuery(ttl.utilities.getPreventCache(_1));},_ClearFilter:function(){this.filter.set("value","");this.geographicallookuptypeid.set("value",-1);},onSelectRow:function(e){this._row=this.geographical_grid.getItem(e.rowIndex);this._ShowDetails();this.geographical_grid.selection.clickSelectEvent(e);},onCellClick:function(e){this.onSelectRow(e);},_ShowDetails:function(){dojo.removeClass(this.geographical_edit.domNode,"prmaxhidden");this.geographical_edit.Load(this._row.i.geographicalid);this.coverage_grid.setQuery(ttl.utilities.getPreventCache({geographicalid:this._row.i.geographicalid}));},_HideDetails:function(){dojo.addClass(this.geographical_edit.domNode,"prmaxhidden");this.geographical_edit.Load(-1);this._row=null;},_AddNew:function(){this.geographical_add.Load(-1);this.geographical_add_dlg.show();},_DialogCloseEvent:function(_2){this.geographical_add_dlg.hide();this.geographical_add.Load(-1);},_GeogDeleteEvent:function(_3){this.geographical.deleteItem(this._row);this._HideDetails();},_GeogUpdateEvent:function(_4){this.geographical.setValue(this._row,"geographicalname",_4.geographical.geographicalname,true);this.geographical.setValue(this._row,"geographicallookupdescription",_4.geographicallookupdescription,true);},_GeogAddEvent:function(_5){gHelper.AddRowToQueryWriteGrid(this.geographical_grid,this.geographical.newItem(_5));},_CoverageMovedEvent:function(){this.coverage_grid.setQuery(ttl.utilities.getPreventCache({geographicalid:this._row.i.geographicalid}));}});}