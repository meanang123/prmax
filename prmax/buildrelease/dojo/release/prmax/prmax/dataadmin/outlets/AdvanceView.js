/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.outlets.AdvanceView"]){dojo._hasResource["prmax.dataadmin.outlets.AdvanceView"]=true;dojo.provide("prmax.dataadmin.outlets.AdvanceView");dojo.require("ttl.BaseWidget");dojo.require("prcommon.advance.advance");dojo.require("prmax.dataadmin.advance.researchadvance");dojo.require("prmax.dataadmin.advance.AdvanceDelete");dojo.require("prmax.dataadmin.advance.AdvanceDuplicate");dojo.declare("prmax.dataadmin.outlets.AdvanceView",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div dojoAttachPoint=\"frame\" dojotype=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:100%;overflow: hidden; border: 0; padding: 0; margin: 0\" gutters=\"false\" >\r\n\t\t<div dojotype=\"dijit.layout.TabContainer\"  region=\"center\">\r\n\t\t\t<div title=\"Features\" dojotype=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:100%;overflow: hidden; border: 0; padding: 0; margin: 0\" gutters=\"false\" >\r\n\t\t\t\t<div  dojotype=\"dijit.layout.ContentPane\" style=\"width:50%;height:100%\" region=\"left\" splitter=\"true\">\r\n\t\t\t\t\t<div dojoAttachPoint=\"outlet_advance_grid\" dojoType=\"dojox.grid.DataGrid\"   query=\"{ }\" rowsPerPage=\"50\" style=\"width:100%;height:100%\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div dojotype=\"dijit.layout.ContentPane\" region=\"center\" splitter=\"true\">\r\n\t\t\t\t\t<div dojoAttachPoint=\"viewfeature\" dojotype=\"prcommon.advance.advance\" style=\"width:100%;height:100%\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div title=\"Research Infomation\" dojotype=\"dijit.layout.BorderContainer\"  style=\"width:100%;height:100%;overflow: hidden; border: 0; padding: 0; margin: 0\" gutters=\"false\" >\r\n\t\t\t\t<div dojotype=\"prmax.dataadmin.advance.researchadvance\" dojoAttachPoint=\"researchadvance\" region=\"center\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div title=\"New Features\" dojoAttachPoint=\"newfeature\"  dojotype=\"prcommon.advance.advance\"></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div dojoAttachPoint=\"advance_delete_dlg\" dojoType=\"dijit.Dialog\" title =\"Delete Feature\">\r\n\t\t<div dojoAttachPoint=\"advance_delete_ctrl\" dojoType=\"prmax.dataadmin.advance.AdvanceDelete\"></div>\r\n\t</div>\r\n\t<div dojoAttachPoint=\"advance_duplicate_dlg\" dojoType=\"dijit.Dialog\" title =\"Duplicate Feature\">\r\n\t\t<div dojoAttachPoint=\"advance_duplicate_ctrl\" dojoType=\"prmax.dataadmin.advance.AdvanceDuplicate\"></div>\r\n\t</div>\r\n\r\n</div>\r\n",constructor:function(){this.advance_feature_model=new prcommon.data.QueryWriteStore({url:"/advance/listoutlet?showall=1",onError:ttl.utilities.globalerrorchecker,nocallback:true});this._outletid=-1;dojo.subscribe(PRCOMMON.Events.Dialog_Close,dojo.hitch(this,this._DialogCloseEvent));dojo.subscribe(PRCOMMON.Events.Feature_Added,dojo.hitch(this,this._AdvanceAddEvent));dojo.subscribe(PRCOMMON.Events.Feature_Deleted,dojo.hitch(this,this._AdvanceDeleteEvent));dojo.subscribe(PRCOMMON.Events.Feature_Update,dojo.hitch(this,this._AdvanceUpdateEvent));this._getModelItemCall=dojo.hitch(this,this._getModelItem);},postCreate:function(){this.outlet_advance_grid.set("structure",this.View);this.outlet_advance_grid._setStore(this.advance_feature_model);this.outlet_advance_grid["onCellClick"]=dojo.hitch(this,this._onCellClick);this.newfeature.newmode();this.inherited(arguments);},_getModelItem:function(){if(arguments[0].i.i!=null){this.tmp_row=arguments[0].i;}else{this.tmp_row=arguments[0];}},_onCellClick:function(e){var _1=this.outlet_advance_grid.getItem(e.rowIndex);if(e.cellIndex==0||e.cellIndex==1||e.cellIndex==2){this.viewfeature.Load(_1.i.advancefeatureid,this._outletid);}if(e.cellIndex==3){this.advance_delete_ctrl.Load(_1.i.advancefeatureid,_1.i.feature);this.advance_delete_dlg.show();}if(e.cellIndex==4){this.advance_duplicate_ctrl.Load(_1.i.advancefeatureid,_1.i.feature);this.advance_duplicate_dlg.show();}},View:{cells:[[{name:"Description",width:"200px",field:"feature"},{name:"Publication Date",width:"200px",field:"pub_date_display"},{name:" ",width:"15px",field:"",formatter:ttl.utilities.formatRowCtrl},{name:" ",width:"20px",field:"",formatter:ttl.utilities.deleteRowCtrl},{name:" ",width:"15px",field:"",formatter:ttl.utilities.formatCopyCtrl}]]},resize:function(){this.frame.resize(arguments[0]);this.inherited(arguments);},Load:function(_2){this._outletid=_2;this.viewfeature.Load(-1,_2);this.newfeature.Load(-1,_2);this.researchadvance.Load(_2);this.outlet_advance_grid.setQuery(ttl.utilities.getPreventCache({outletid:this._outletid}));},_DialogCloseEvent:function(_3){if(_3=="feature_del"){this.advance_delete_dlg.hide();}if(_3=="feature_dup"){this.advance_duplicate_dlg.hide();}},_AdvanceAddEvent:function(_4){this.advance_feature_model.newItem(_4.advance);},_AdvanceDeleteEvent:function(_5){this.tmp_row=null;var _6={identity:_5.advancefeatureid,onItem:this._getModelItemCall};this.advance_feature_model.fetchItemByIdentity(_6);if(this.tmp_row){this.advance_feature_model.deleteItem(this.tmp_row);}},_AdvanceUpdateEvent:function(_7){this.tmp_row=null;var _8={identity:_7.advance.advancefeatureid,onItem:this._getModelItemCall};this.advance_feature_model.fetchItemByIdentity(_8);if(this.tmp_row){this.advance_feature_model.setValue(this.tmp_row,"feature",_7.advance.feature,true);this.advance_feature_model.setValue(this.tmp_row,"pub_date_display",_7.advance.pub_date_display,true);}}});}