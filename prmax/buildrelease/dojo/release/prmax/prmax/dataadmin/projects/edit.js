/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.projects.edit"]){dojo._hasResource["prmax.dataadmin.projects.edit"]=true;dojo.provide("prmax.dataadmin.projects.edit");dojo.require("prmax.dataadmin.projects.outletwizard");dojo.require("prmax.dataadmin.outlets.OutletEdit");dojo.require("prmax.dataadmin.freelance.FreelanceEdit");dojo.declare("prmax.dataadmin.projects.edit",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"borderControl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='style:\"width:100%;height:100%;overflow: hidden\",gutters:false'>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-attach-point=\"controls\" data-dojo-props='region:\"top\",style:\"height:42px;width:100%;overflow:hidden\"'>\r\n\t\t\t<div data-dojo-attach-point=\"projectname\" class=\"dijitToolbar prmaxrowdisplaylarge\" style=\"float:left;height:99%;width:25%;padding:0px;margin:0px\">Project Name</div>\r\n\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='style:\"height:99%;width:75%;padding:0px;margin:0px\"'>\r\n\t\t\t\t<div data-dojo-attach-event=\"onClick:_Filter\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='iconClass:\"PrmaxResultsIcon PrmaxResultsEmpty\"'><span>Filter</span></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dojox.layout.ExpandoPane\" data-dojo-props='title:\"Outlets\",region:\"left\",maxWidth:175,style:\"width:40%;height:100%;overflow:hidden\",splitter:true'>\r\n\t\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='style:\"height:100%;width:100%\",rowsPerPage:50'></div>\r\n\t\t</div>\r\n\t\t<div data-dojo-attach-point=\"zone\" data-dojo-type=\"dijit.layout.StackContainer\" data-dojo-props='region:\"center\"'>\r\n\t\t\t<div data-dojo-attach-point=\"blank\" data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='title:\"blank\"'></div>\r\n\t\t\t<div data-dojo-attach-point=\"outletwizard\" data-dojo-type=\"prmax.dataadmin.projects.outletwizard\" data-dojo-props='title:\"outletwizard\",style:\"height:100%;width:100%\"'></div>\r\n\t\t\t<div data-dojo-attach-point=\"outletedit\" data-dojo-type=\"prmax.dataadmin.outlets.OutletEdit\" data-dojo-props='title:\"outlet\",style:\"width:100%;height:100%\",\"class\":\"bordered\"'></div>\r\n\t\t\t<div data-dojo-attach-point=\"freelanceedit\" data-dojo-type=\"prmax.dataadmin.freelance.FreelanceEdit\" data-dojo-props='title:\"freelance\",style:\"width:100%;height:100%\",\"class\":\"bordered\"'></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"status_dlg\" data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Change Project Item Status\"'>\r\n\t\t<form data-dojo-attach-point=\"form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='onsubmit:\"return false;\",\"class\":\"prmaxdefault\"'>\r\n\t\t\t<input data-dojo-attach-point=\"researchprojectitemid\" data-dojo-props='name:\"researchprojectitemid\",type:\"hidden\"' data-dojo-type=\"dijit.form.TextBox\" >\r\n\t\t\t<table width=\"400px\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\"  border =\"0\">\r\n\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" width=\"200px\">New Status</td><td ><select data-dojo-attach-point=\"researchprojectstatusid\" data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-props='name:\"researchprojectstatusid\",searchAttr:\"name\",labelType:\"html\",style:\"width:98%\",\"class\":\"prmaxrequired\"'/></td></tr>\r\n\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\">Update Researched Date</td><td><input data-dojo-attach-point=\"researcheddate\" data-dojo-props='name:\"researcheddate\",type:\"checkbox\"' data-dojo-type=\"dijit.form.CheckBox\"></td></tr>\r\n\r\n\t\t\t<tr><td colspan=\"2\">&nbsp;</td></tr>\r\n\t\t\t<tr><td colspan=\"2\" align=\"right\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_UpdateRecord\" data-dojo-props='type:\"button\"'>Update</button></td></tr>\r\n\r\n\t\t</table>\r\n\t</form>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.model=new prcommon.data.QueryWriteStore({url:"/dataadmin/projects_members",onError:ttl.utilities.globalerrorchecker,nocallback:true});this._UpdateCallBack=dojo.hitch(this,this._UpdateCall);},postCreate:function(){this.grid.set("structure",this.view);this.grid._setStore(this.model);this.grid.onRowClick=dojo.hitch(this,this._OnSelectRow);this.researchprojectstatusid.set("store",PRCOMMON.utils.stores.Research_Project_Status());this.inherited(arguments);},_OnSelectRow:function(e){this._row=this.grid.getItem(e.rowIndex);if(e.cellIndex==3){this.researchprojectitemid.set("value",this._row.i.researchprojectitemid);this.researchprojectstatusid.set("value",this._row.i.researchprojectstatusid);this.status_dlg.show();}else{if(this._row.i.prmax_outletgroupid=="freelance"){this.zone.selectChild(this.freelanceedit);this.freelanceedit.Load(this._row.i.outletid);}else{this.zone.selectChild(this.outletedit);this.outletedit.Load(this._row.i.outletid);}}},resize:function(){this.borderControl.resize(arguments[0]);this.inherited(arguments);},Load:function(_1){this.researchprojectid=_1.researchprojectid;this.grid.setQuery(ttl.utilities.getPreventCache({researchprojectid:_1.researchprojectid}));dojo.attr(this.projectname,"innerHTML",_1.researchprojectname);},view:{cells:[[{name:"Outletname",width:"300px",field:"outletname"},{name:"Status",width:"150px",field:"researchprojectstatusdescription"},{name:" ",width:"12px",formatter:ttl.utilities.editRowCtrl},{name:" ",width:"12px",formatter:ttl.utilities.formatRowCtrl}]]},_Filter:function(){},_Clear:function(){this.researchprojectitemid.set("researchprojectitemid",-1);this.researchprojectstatusid.set("value",1);this.researcheddate.set("checked",true);},_UpdateCall:function(_2){if(_2.success=="OK"){this.model.setValue(this._row,"researchprojectstatusdescription",_2.data.researchprojectstatusdescription,true);this._Clear();this.status_dlg.hide();alert("Record Updated");}else{alert("Problem");}},_UpdateRecord:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._UpdateCallBack,url:"/dataadmin/project_item_update",content:this.form.get("value")}));}});}