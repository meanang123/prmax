/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.dataadmin.projects.create"]){dojo._hasResource["prmax.dataadmin.projects.create"]=true;dojo.provide("prmax.dataadmin.projects.create");dojo.declare("prmax.dataadmin.projects.create",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-attach-point=\"borderControl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='gutters:true,style:\"width:100%;height:100%;overflow:hidden\"'>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"top\",style:\"height:150px;width:100%\"'>\r\n\t\t\t<form data-dojo-type=\"dijit.form.Form\" data-dojo-attach-event='onsubmit:_ReturnFalse' data-dojo-attach-point=\"form\">\r\n\t\t\t\t<table width=\"550px\" cellspacing=\"0\" cellpadding=\"0\" style=\"border-collapse: collapse\" >\r\n\t\t\t\t\t<tr><td>&nbsp;</td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" width=\"250px\" >Name:</td><td><input data-dojo-props='style:\"width:300px\",\"class\":\"prmaxrequired\",name:\"projectname\",type:\"text\",maxlength:\"80\",trim:true,required:true' data-dojo-attach-point=\"projectname\" data-dojo-type=\"dijit.form.ValidationTextBox\"/></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\">User:</td><td><select data-dojo-attach-point=\"iuserid\" data-dojo-props='name:\"iuserid\",autoComplete:\"true\",style:\"width:15em\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\"></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\">Email Questionairres</td><td><input data-dojo-attach-point=\"sendq\" data-dojo-props='name:\"senq\",type:\"checkbox\"' data-dojo-type=\"dijit.form.CheckBox\"></td></tr>\r\n\t\t\t\t\t\t\t\t\t\t<tr><td>&nbsp;</td></tr>\r\n\t\t\t\t\t<tr><td colspan=\"2\" align=\"right\"><button data-dojo-attach-event=\"onClick:_Create\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"button\",\"class\":\"prmaxbuttonlarge\",label:\"Create Projects\"' ></button></td></tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</form>\r\n\t\t<div data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='gutters:false,region:\"left\",style:\"width:50%;height:100%\"'>\r\n\t\t\t<div data-dojo-attach-point=\"tabcont\" data-dojo-type=\"dijit.layout.TabContainer\" data-dojo-props='region:\"center\"'>\r\n\t\t\t\t<div data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='title:\"Search\",style:\"width:100%;height:100%;overflow:hidden\",gutters:false'>\r\n\t\t\t\t\t<div data-dojo-attach-point=\"search_tabcont\" data-dojo-type=\"dijit.layout.TabContainer\" data-dojo-props='region:\"center\"'>\r\n\t\t\t\t\t\t<div data-dojo-attach-point=\"search_tab_outlet\" data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='preload:true,href:\"/layout/std_search_outlet?prefix=pr_&searchtypeid=5\",style:\"height:100%;overflow:auto;overflow-x:hidden\",\"class\":\"scrollpanel\",title:\"Outlet\"'></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-point=\"search_tab_freelance\" data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='preload:true,href:\"/layout/std_search_freelance?prefix=pr_&searchtypeid=5\",style:\"height:100%;overflow:auto;overflow-x:hidden\",\"class\":\"scrollpanel\",title:\"Freelance\"'></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"bottom\",style:\"width:100%;height:15%;padding-top:10px\"'>\r\n\t\t\t\t\t\t<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"border-collapse: collapse;\" >\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t<td><button data-dojo-attach-point=\"_search_cancel\" data-dojo-attach-event=\"onClick:_ClearSearch\" data-dojo-type=\"dijit.form.Button\" data-dojo-props='\"class\":\"prmaxbutton\",label:\"Clear Search\"' ></button></td>\r\n\t\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-attach-point=\"searchbutton\" data-dojo-attach-event=\"onClick:_Search\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='\"class\":\"prmaxbutton\",iconClass:\"dijitPrmaxIcon dijitPrmaxIconSearch\",busyLabel:\"Searching...\"'><div style=\"font-size:18pt\">Search</div></button></td>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='style:\"height:100%;width:100%\",title:\"Monthly Set\"'></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"center\",splitter:true'>\r\n\t\t\t<div data-dojo-attach-point=\"grid\" data-dojo-type=\"dojox.grid.DataGrid\" data-dojo-props='rowsPerPage:200'>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._LoadCallBack=dojo.hitch(this,this._LoadCall);this._AddCallBack=dojo.hitch(this,this._AddCall);this._users=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=users&group=dataadmin&nofilter"});this.model=new prcommon.data.QueryWriteStore({url:"/search/list?searchtypeid=5&research=1",onError:ttl.utilities.globalerrorchecker,nocallback:true});},postCreate:function(){this.inherited(arguments);this.iuserid.store=this._users;this.iuserid.set("value",-1);this.grid.set("structure",this.view);this.grid._setStore(this.model);},resize:function(){this.borderControl.resize(arguments[0]);this.inherited(arguments);},_ClearSearchCall:function(_1){this.grid.setQuery(ttl.utilities.getPreventCache({}));},_ClearSearch:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._ClearSearchCallBack,url:"/search/sessionclear",content:{searchtypeid:5}}));},_ClearSearchResults:function(_2){if(_2.success=="OK"){this._LoadCall();}},_IsEmpty:function(_3){var _4=_3["search_type"];for(var _5 in _3){if(_5.indexOf(_4)!=-1){if(_3[_5].length!=0){return false;}}}return true;},_Search:function(){var _6="pr_std_search_outlet_form";if(this.search_tabcont.selectedChildWidget==this.search_tab_freelance){_6="pr_std_search_freelance_form";}var _7=dijit.byId(_6);_7.setExtendedMode(false);var _8=_7.get("value");if(this._IsEmpty(_8)==true){alert("No Search Criteria Specified");this.searchbutton.cancel();return;}else{if(_6=="pr_std_search_outlet_form"){var _9=dijit.byId("pr_search_outlet_roles");if(_9.get("value").length>0&&_9.get("IsDefault")==true&&this._SearchCriteriaCount(_8)==1){alert("This search will return all outlets. Please select another criteria e.g. Media Channel");this.searchbutton.cancel();return;}}}_8["mode"]=0;_8["search_partial"]=2;dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCallBack,url:"/search/dosearch",content:_8}));},_LoadCall:function(_a){this.searchbutton.cancel();this.grid.setQuery(ttl.utilities.getPreventCache({}));},_Clear:function(){this.grid.setQuery(ttl.utilities.getPreventCache({}));this.sendq.set("checked",true);this.iuserid.set("value",-1);this.projectname.set("value","");this.projectname.focus();},_AddCall:function(_b){if(_b.success=="OK"){alert("Project Added");this._Clear();}else{if(_b.success=="DU"){alert("Project Already Exists");this.projectname.focus();}else{alert("Problem adding Project");this.projectname.focus();}}},_Create:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Not all required field filled in");this.searchbutton.cancel();return;}if(confirm("Add Project")){dojo.xhrPost(ttl.utilities.makeParams({load:this._AddCallBack,url:"/dataadmin/projects_add",content:this.form.get("value")}));}},view:{cells:[[{name:" ",width:"12px",formatter:ttl.utilities.formatRowCtrl},{name:"Name",width:"auto",field:"outletname"},{name:"Contact",width:"auto",field:"contactname"},{name:"Source",width:"50px",field:"sourcename"},{name:"Id",width:"50px",field:"outletid"}]]}});}