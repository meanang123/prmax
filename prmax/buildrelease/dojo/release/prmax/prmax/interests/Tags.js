/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.interests.Tags"]){dojo._hasResource["prmax.interests.Tags"]=true;dojo.provide("prmax.interests.Tags");dojo.require("dijit._Templated");dojo.require("dijit._Widget");dojo.require("dijit._Container");dojo.declare("prmax.interests.Tags",[dijit._Widget,dijit._Templated,dijit._Container],{widgetsInTemplate:true,parentid:"",templateString:"<div>\r\n<div dojoType=\"dijit.TitlePane\" title=\"Existing Tags\" open=\"true\" style=\"width:100%\" >\r\n<table width=\"100%\" class=\"prmaxtable\">\r\n  <tr><td width=\"60%\"><select dojoAttachPoint=\"select\" style=\"width:100%\" size=\"10\" class=\"lists\" ></select>&nbsp;</td>\r\n</td><button class=\"prmaxbutton\" disabled=\"disabled\" dojoAttachPoint=\"renameButton\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_Rename\" style=\"width:150px\" ><div style=\"width:5em\">Rename</div></button>\r\n<button class=\"prmaxbutton\"  disabled=\"disabled\" dojoAttachPoint=\"deleteButton\" dojoType=\"dijit.form.Button\" style=\"width:150px\" dojoAttachEvent=\"onClick:_Delete\" ><div style=\"width:5em\">Delete</div></button>\r\n</td></tr></table>\r\n</div>\r\n<div dojoType=\"dijit.TitlePane\" title=\"Add Tag\" open=\"true\" style=\"width:100%\" >\r\n<div dojoType=\"prmax.interests.AddTags\" dojoAttachPoint=\"addtag\" style=\"width:100%\" ></div>\r\n</div>\r\n<table width=\"100%\" class=\"prmaxtable\">\r\n<tr><td><button class=\"prmaxbutton\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_Close\" label=\"Close\"></button>\r\n</td></tr></table>\r\n</div>\r\n",constructor:function(){this._LoadCall=dojo.hitch(this,this._Load);this._DeletedCall=dojo.hitch(this,this._DeleteResponse);this._RenameCall=dojo.hitch(this,this._RenameResponse);},postCreate:function(){dojo.connect(this.select,"onchange",dojo.hitch(this,this._onSelectChange));this.Load();this.addtag.setAdded(dojo.hitch(this,this._AddedTags));},_AddedTags:function(_1){this.select.options[this.select.options.length]=new Option(_1.interestname,_1.interestid);},_RenameResponse:function(_2){if(_2.success=="OK"){for(var c=0;c<this.select.options.length;c++){if(this.select.options[c].value==_2.data.interestid){this.select.options[c].text=_2.data.interestname;break;}}dojo.publish(PRCOMMON.Events.Display_ReLoad,[]);}else{if(_2.success=="DU"){alert("Tag already exists");}}this._EnableControls();},_DeleteResponse:function(_3){if(_3.success=="OK"){for(var c=0;c<this.select.options.length;c++){if(this.select.options[c].value==_3.data.interestid){this.select.options[c]=null;break;}}}this._EnableControls();},_onSelectChange:function(){this._EnableControls();},_EnableControls:function(){this.renameButton.attr("disabled",this.select.selectedIndex!=-1?false:true);this.deleteButton.attr("disabled",this.select.selectedIndex!=-1?false:true);},_Rename:function(){var _4=prompt("Rename Tag "+this.select.options[this.select.selectedIndex].text+" to","");if(_4){dojo.xhrPost(ttl.utilities.makeParams({load:this._RenameCall,url:"/interests/updatetag",content:{interestid:this.select.options[this.select.selectedIndex].value,interestname:_4}}));}},_Delete:function(){if(confirm("Delete Tag "+this.select.options[this.select.selectedIndex].text)){dojo.xhrPost(ttl.utilities.makeParams({load:this._DeletedCall,url:"/interests/deletetag",content:{interestid:this.select.options[this.select.selectedIndex].value}}));}},_Load:function(_5){for(var _6 in _5.data){var _7=_5.data[_6];this.select.options[this.select.options.length]=new Option(_7.interestname,_7.interestid);}},Load:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCall,url:"/interests/tags"}));},Clear:function(){this.addTag.cancel();this.select.options.length=0;this.interestname.attr("value","");this._EnableControls();},destroy:function(){this.inherited(arguments);},_Close:function(){dojo.publish(PRCOMMON.Events.Dialog_Close);}});}