/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.projects.projectselect"]){dojo._hasResource["prmax.projects.projectselect"]=true;dojo.provide("prmax.projects.projectselect");dojo.require("dijit.form.Button");dojo.require("prcommon.search.std_search");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit._Container");dojo.declare("prmax.projects.projectselect",[prcommon.search.std_search,dijit._Widget,dijit._Templated,dijit._Container],{name:"",value:"",search:"",size:"7",startopen:false,widgetsInTemplate:true,templateString:"<div dojoAttachPoint=\"containerNode\" >\r\n\t<table width=\"100%\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\" >\r\n\t\t<tr><td width=\"20%\"   class=\"prmaxrowtag\">Projects</td>\r\n\t\t\t\t<td width=\"5%\" ><img height=\"16px\" width=\"16px\" dojoAttachPoint=\"toggleCtrl\" dojoAttachEvent=\"onclick:_Toggle\" src=\"/static/images/toopen.gif\" class=\"toggleselect\"></img>\r\n\t\t\t\t<td align=\"right\" v-align=\"top\" ></div></td>\r\n\t\t</tr>\r\n\t</table>\r\n\t<div class=\"dojoprojectsPane\" >\r\n\t\t<div dojoAttachPoint=\"selectarea\" style=\"display:none\" >\r\n\t\t\t<table width=\"100%\" class=\"prmaxtable\" cellpadding=\"0\" cellspacing=\"0\" >\r\n\t\t\t\t  <tr><td width=\"47%\"></td><td width=\"5%\"></td><td width=\"48%\" ></td></tr>\r\n\t\t\t\t  <tr><td colspan=\"3\">\r\n\t\t\t\t  <table style=\"width:100%\" class=\"prmaxtable\" >\r\n\t\t\t\t  <tr>\r\n\t\t\t\t  <td width=\"20%\" dojoAttachPoint=\"master_type_text\"><span class=\"prmaxrowtag\">Select</span><input class=\"prmaxfocus prmaxinput\" type=\"text\" dojoType=\"dijit.form.TextBox\" style=\"width:20%\" dojoAttachPoint=\"projects_list_select\" dojoAttachEvent=\"onkeyup:projectsSelect\" /></td></tr></table>\r\n\t\t\t\t  </td></tr>\r\n\t\t\t\t  <tr><td ><select style=\"width:100%\" dojoAttachPoint=\"projects_list\" size=\"${size}\" class=\"lists\" multiple=\"multiple\" ></select></td>\r\n\t\t\t\t  <td >\r\n\t\t\t\t  <button class=\"button_add_all\" style=\"padding:0px;margin:0px\" dojoAttachPoint=\"button_all\" disabled=\"true\" type=\"button\" dojoAttachEvent=\"onClick:projectsSelectAll\" dojoType=\"dijit.form.Button\"><div class=\"std_movement_button\">&gt;&gt;</div></button><br/>\r\n\t\t\t\t  <button class=\"button_add_single\" style=\"padding:0px;margin:0px\" dojoAttachPoint=\"button_single\" disabled=\"true\" type=\"button\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:projectsSelectSingle\"><div class=\"std_movement_button\">&gt;&nbsp;</div></button><br/>\r\n\t\t\t\t  <button class=\"button_del_all\" style=\"padding:0px;margin:0px\" dojoAttachPoint=\"button_del_all\" disabled=\"true\" type=\"button\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:projectsRemoveAll\"><div class=\"std_movement_button\">&lt;&lt;</div></button><br/>\r\n\t\t\t\t  <button class=\"button_del_single\" style=\"padding:0px;margin:0px\" dojoAttachPoint=\"button_del_single\" disabled=\"true\" type=\"button\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:projectsRemoveSingle\"><div class=\"std_movement_button\">&lt;&nbsp;</div></button></td>\r\n\t\t\t\t  <td ><select style=\"width:100%\" dojoAttachPoint=\"projects_select\" size=\"${size}\" class=\"lists\" multiple=\"multiple\" dojoAttachEvent=\"onchange:projectsUpdateSelection\"></select></td></tr>\r\n\t\t\t</table>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.disabled=false;this._LoadSelectionCall=dojo.hitch(this,this._LoadSelection);},postCreate:function(){dojo.connect(this.projects_list_select.domNode,"onkeyup",dojo.hitch(this,this.projectsSelect));dojo.connect(this.projects_list,"onchange",dojo.hitch(this,this.projectsUpdateSelection));dojo.connect(this.projects_list,"ondblclick",dojo.hitch(this,this.projectsSelectDbl));if(this.startopen){dojo.style(this.toggleCtrl,"display","none");dojo.style(this.selectarea,"display","block");}},Clear:function(){this._ClearSelectionBox();this._ClearSelectedBox();this.projects_list_select.set("value","");this._SelectionOptions();this.inherited(arguments);},projectsSelect:function(){var _1=this.projects_list_select.get("value");if(_1.length>0){dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadSelectionCall,url:"/projects/listuserselection",content:{word:_1}}));}else{this._ClearSelectionBox();this._SelectionOptions();}},_LoadSelection:function(_2){this._ClearSelectionBox();for(var i=0;i<_2.data.length;++i){var _3=_2.data[i];this.projects_list.options[this.projects_list.options.length]=new Option(_3[0],_3[1]);}this._SelectionOptions();},_ClearSelectionBox:function(){this.projects_list.options.length=0;},_ClearSelectedBox:function(){this.projects_select.length=0;},projectsUpdateSelection:function(){this._SelectionOptions();},projectsSelectDbl:function(){this.projectsSelectSingle();this._SelectionOptions();},projectsSelectAll:function(){for(var c=0;c<this.projects_list.options.length;c++){var _4=this.projects_list.options[c];var _5=true;for(var c1=0;c1<this.projects_select.options.length;c1++){if(this.projects_select.options[c1].value==_4.value){_5=false;break;}}if(_5){this.projects_select.options[this.projects_select.options.length]=new Option(_4.text,_4.value);}}this.projects_list.options.length=0;this.projectsUpdateSelection();},projectsSelectSingle:function(){for(var c=0;c<this.projects_list.options.length;c++){var _6=this.projects_list.options[c];if(_6.selected){_6.selected=false;var _7=true;for(var c1=0;c1<this.projects_select.options.length;c1++){if(this.projects_select.options[c1].value==_6.value){_7=false;break;}}if(_7){this.projects_select.options[this.projects_select.options.length]=new Option(_6.text,_6.value);}}}},projectsRemoveAll:function(){this.projects_select.options.length=0;this.projectsUpdateSelection();},projectsRemoveSingle:function(){for(var c=0;c<this.projects_select.options.length;c++){if(this.projects_select.options[c].selected){this.projects_select.options[c]=null;}}this.projectsUpdateSelection();},addSelect:function(_8){this.projects_select.options[this.projects_select.options.length]=new Option(_8.projectsname,_8.projectsid);},_setValueAttr:function(_9){this.Clear();var _a=_9.data;if(_a==null||_a==undefined){_a=_9;}for(var _b in _a){var _c=_a[_b];this.projects_select.options[this.projects_select.options.length]=new Option(_c.projectsname,_c.projectsid);}},_getValueAttr:function(){var _d=Array();for(var c=0;c<this.projects_select.options.length;c++){if(this._extended){_d[c]={projectsid:parseInt(this.projects_select.options[c].value),projectsname:this.projects_select.options[c].text};}else{_d[c]=parseInt(this.projects_select.options[c].value);}}var _e={data:_d};if(this._extended){return _e;}else{var _d=_d.length>0?dojo.toJson(_e):"";this.value=_d;return _d;}},_getCountAttr:function(){return this.projects_select.options.length;},_setExtendedAttr:function(_f){this._extended=_f;},changeFilter:function(){this.projectsSelect();},_SelectionOptions:function(){this.button_all.set("disabled",this.projects_list.length?false:true);this.button_single.set("disabled",this.projects_list.selectedIndex!=-1?false:true);this.button_del_all.set("disabled",this.projects_select.length?false:true);this.button_del_single.set("disabled",this.projects_select.selectedIndex!=-1?false:true);},_CaptureExtendedContent:function(_10){var _11=this.AndOr.get("value");return dojo.mixin(_10);},_setDisabledAttr:function(_12){this.disabled=_12;},_getDisabledAttr:function(){return this.disabled;},destroy:function(){this.inherited(arguments);},_focus:function(){this.projects_list_select.focus();}});}