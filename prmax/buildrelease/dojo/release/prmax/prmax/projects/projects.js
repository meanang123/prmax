/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.projects.projects"]){dojo._hasResource["prmax.projects.projects"]=true;dojo.provide("prmax.projects.projects");dojo.require("dijit._Templated");dojo.require("dijit._Widget");dojo.require("dijit._Container");formatRowCtrl=function(_1){return isNaN(_1)?"...":"<img height=\"10px\" width=\"10px\" style=\"padding:0x;margin:0px\" src=\"/static/images/rowctrl.gif\" ></img>";};dojo.declare("prmax.projects.projects",[dijit._Widget,dijit._Templated,dijit._Container],{widgetsInTemplate:true,templateString:"<div >\r\n\t<div dojoAttachPoint=\"borderControl\" dojotype=\"dijit.layout.BorderContainer\" style=\"width:100%;height:100%\" >\r\n\t\t<div dojoType=\"dijit.layout.ContentPane\" region=\"top\" style=\"height:42px;width:100%;overflow:hidden\" class=\"searchresults\">\r\n\t\t\t<div style=\"height:40px;width:100%;overflow:hidden;padding:0px;margin:0px\" class=\"searchresults\">\r\n\t\t\t\t<div style=\"height:100%;width:15%;float:left;padding:0px;margin:0px\" class=\"prmaxrowdisplaylarge\">Manage Projects</div>\r\n\t\t\t\t<div class=\"dijitToolbarTop\" dojoType=\"dijit.Toolbar\" style=\"float:left:height:100%;width:85%;padding:0px;margin:0px\" >\r\n\t\t\t\t\t<div dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_ShowAddProject\" dojoAttachPoint=\"addbutton\" label=\"Add Project\" iconClass=\"PrmaxResultsIcon PrmaxResultsEmpty\"  showLabel=\"true\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojotype=\"dijit.layout.ContentPane\"   style=\"width:50%\" region=\"left\"  splitter=\"true\">\r\n\t\t\t<div dojoAttachPoint=\"projects\" dojoType=\"dojox.grid.DataGrid\" query=\"{ name:'*'}\" rowsPerPage=\"50\" style=\"width:100%:height:100%\"  ></div>\r\n\t\t</div>\r\n\t\t<div dojotype=\"dijit.layout.TabContainer\"   region=\"center\"  >\r\n\t\t<div dojotype=\"dijit.layout.ContentPane\"   title = \"Main\" >\r\n\t\t\t<div dojoAttachPoint=\"main_frame\" class=\"prmaxhidden\">\r\n\t\t\t\t<table class=\"prmaxtable\" width=\"100%\" >\r\n\t\t\t\t\t<tr><td class=\"prmaxrowdisplaylarge\" style=\"width:20%\">Project Name : </td><td class=\"prmaxrowdisplaylarge\"  dojoAttachPoint=\"projects_name\"></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowdisplaylarge\" colspan=\"2\"><div dojoType=\"dijit.form.Button\"  dojoAttachEvent=\"onClick:_Rename\"> <div style=\"width:9em\" class=\"prmaxbutton\">Rename Project</div></div><td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowdisplaylarge\" colspan=\"2\"><div dojoType=\"dijit.form.Button\"  dojoAttachEvent=\"onClick:_Delete\" ><div style=\"width:9em\" class=\"prmaxbutton\">Delete Project</div></div><td></tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojotype=\"dijit.layout.ContentPane\"   title = \"Associated  - Lists\" >\r\n\t\t\t<div dojoAttachPoint=\"projectlists\" dojoType=\"dojox.grid.DataGrid\" query=\"{ name:'*'}\" rowsPerPage=\"50\" style=\"width:100%:height:100%\"  ></div>\r\n\t\t</div>\r\n\t\t<div dojotype=\"dijit.layout.ContentPane\"   title = \"Associated  - Collateral\" >\r\n\t\t\t<div dojoAttachPoint=\"projectcollateral\" dojoType=\"dojox.grid.DataGrid\" query=\"{ name:'*'}\" rowsPerPage=\"50\" style=\"width:100%:height:100%\"  ></div>\r\n\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div dojoAttachPoint=\"newproject\" dojotype=\"prmax.projects.newproject\"  >\r\n</div>\r\n",constructor:function(){this.model=new prcommon.data.QueryWriteStore({url:"/projects/projects",onError:ttl.utilities.globalerrorchecker});this.projectlists_model=null;this.projectcollateral_model=null;this.projectid=null;this.projectname="";this._LoadProjectCallBack=dojo.hitch(this,this._LoadProjectDetails);this._DeleteProjectCallBack=dojo.hitch(this,this._DeleteProjectDetails);this._getModelItemCall=dojo.hitch(this,this._getModelItem);dojo.subscribe(PRCOMMON.Events.Project_Add,dojo.hitch(this,this._AddItemEvent));dojo.subscribe(PRCOMMON.Events.Project_Delete,dojo.hitch(this,this._DeleteItemEvent));},postCreate:function(){this.projects.attr("structure",this.view);this.projectlists.attr("structure",this.view_lists);this.projectcollateral.attr("structure",this.view_collateral);this.projects.setStore(this.model);this.baseonCellClick=this.projects["onCellClick"];this.projects["onStyleRow"]=dojo.hitch(this,this._OnStyleRow);this.projects["onCellClick"]=dojo.hitch(this,this._OnCellClick);},_OnStyleRow:function(_2){ttl.GridHelpers.onStyleRow(_2);},_OnSelectRow:function(e){var _3=this.projects.getItem(e.rowIndex);this._ShowProjectDetails(_3.i.projectid);this.projects.selection.clickSelectEvent(e);},_OnCellClick:function(e){if(e.cellIndex==0){this._OnSelectRow(e);}else{if(e.cellIndex==1){this._OnSelectRow(e);this.onRowContextMenu(e);}else{this.baseonCellClick(e);}}},_LoadProjectDetails:function(_4){if(_4.success=="OK"){dojo.attr(this.projects_name,"innerHTML",_4.project.projectname);this.projectid=_4.project.projectid;this.projectname=_4.project.projectname;dojo.removeClass(this.main_frame,"prmaxhidden");}},_ShowProjectDetails:function(_5){if(this.projectid!=_5){dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadProjectCallBack,url:"/projects/get",content:{projectid:_5}}));if(this.projectlists_model==null){this.projectlists_model=new prcommon.data.QueryWriteStore({url:"/projects/listmembers",onError:ttl.utilities.globalerrorchecker});this.projectlists.store=this.projectlists_model;this.projectcollateral_model=new prcommon.data.QueryWriteStore({url:"/projects/collateral",onError:ttl.utilities.globalerrorchecker});this.projectcollateral.store=this.projectcollateral_model;}this.projectlists.setQuery(ttl.utilities.getPreventCache({projectid:_5}));this.projectcollateral.setQuery(ttl.utilities.getPreventCache({projectid:_5}));}},view:{cells:[[{name:"Description ",width:"auto",field:"projectname"}]]},view_collateral:{cells:[[{name:"Collateral ",width:"auto",field:"collateralname"}]]},view_lists:{cells:[[{name:"List",width:"auto",field:"listname"},{name:"Count",width:"30px",field:"count"}]]},startup:function(){},destroy:function(){this.inherited(arguments);delete this.model;},resize:function(){this.borderControl.resize(arguments[0]);},refresh:function(){this.projects.setQuery(ttl.utilities.getPreventCache({}));this.projects.selection.clear();this.projectid=null;this._ClearPanel();},_ClearPanel:function(){this.projectid=null;this.projectlists.setQuery(ttl.utilities.getPreventCache({projectid:-1}));this.projectcollateral.setQuery(ttl.utilities.getPreventCache({projectid:-1}));dojo.attr(this.projects_name,"innerHTML","");dojo.addClass(this.main_frame,"prmaxhidden");},_ShowAddProject:function(){this.newproject.show();},_AddItemEvent:function(_6){this.model.newItem(_6);},_getModelItem:function(){if(arguments[0].i.i!=null){this.tmp_row=arguments[0].i;}else{this.tmp_row=arguments[0];}},_DeleteItemEvent:function(_7){if(_7==this.projectid){this._ClearPanel();this.projects.selection.clear();}var _8={identity:_7,onItem:this._getModelItemCall};this.model.fetchItemByIdentity(_8);if(this.tmp_row){this.model.deleteItem(this.tmp_row);}},_Rename:function(){},_DeleteProjectDetails:function(_9){if(_9.success=="OK"){dojo.publish(PRCOMMON.Events.Project_Delete,[_9.projectid]);alert("Project Deleted");}},_Delete:function(){if(confirm("Delete Project "+this.projectname+"?")==true){dojo.xhrPost(ttl.utilities.makeParams({load:this._DeleteProjectCallBack,url:"/projects/delete",content:{projectid:this.projectid}}));}}});}