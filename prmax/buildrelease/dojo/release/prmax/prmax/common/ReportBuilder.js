/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.common.ReportBuilder"]){dojo._hasResource["prmax.common.ReportBuilder"]=true;dojo.provide("prmax.common.ReportBuilder");dojo.require("dijit._Templated");dojo.require("dijit._Widget");dojo.require("dijit._Container");dojo.declare("prmax.common.ReportBuilder",[dijit._Widget,dijit._Templated,dijit._Container],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div>Please Wait Generating<br/>\r\n\t\t<div dojoType=\"dijit.ProgressBar\" dojoAttachPoint=\"downloadProgress\"  style=\"width:200px\" ></div>\r\n\t</div>\r\n\t<form dojoAttachPoint=\"reportForm\" target=\"_blank\" method=\"post\" action=\"/reports/view\">\r\n\t\t<input type=\"hidden\" name=\"reportid\"dojoAttachPoint=\"reportid\">\r\n\t</form>\r\n</div>\r\n",constructor:function(){this._reportid=-1;this.maximum=40;this._current=1;this._complete=null;this._OnStartCallBack=dojo.hitch(this,this._OnStartCall);this._OnStatusCallBack=dojo.hitch(this,this._OnStatusCall);this._OnGetStatusCallBack=dojo.hitch(this,this._GetReportBuildStatus);},SetCompleted:function(_1){this._complete=_1;},StartNoDialog:function(_2){dojo.style(this.domNode,{display:"block"});this._Start(_2);},StartDialog:function(_3){dojo.style(this.domNode,{display:"block"});dijit.byId("std_report_dlg").show();this._Start(_3);},_Start:function(_4){this._Clear();if(_4.searchtypeid==null){_4.searchtypeid=-1;}this.downloadProgress.update({maximum:this.maximum,progress:this._current});dojo.xhrPost(ttl.utilities.makeParams({load:this._OnStartCallBack,url:"/reports/start",content:_4}));},_OnStartCall:function(_5){this._reportid=_5.reportid;this._Wait();},_Wait:function(){if(this._reportid==-1){dijit.byId("std_report_dlg").hide();}else{++this._current;if(this._current>this.maximum){dijit.byId("std_report_dlg").hide();}else{this.downloadProgress.update({maximum:this.maximum,progress:this._current});setTimeout(this._OnGetStatusCallBack,2000);}}},_OnStatusCall:function(_6){if(_6.success=="OK"){if(_6.reportstatusid==0||_6.reportstatusid==1){this._Wait();}else{dojo.attr(this.reportid,"value",this._reportid);dojo.attr(this.reportForm,"action","/reports/view/"+this._reportid);dojo.attr(this.reportForm,"action","/reports/view/"+this._reportid);this.reportForm.submit();if(this._complete!=null){this._complete();}if(dijit.byId("std_report_dlg")){dijit.byId("std_report_dlg").hide();}dojo.style(this.domNode,{display:"none"});}}else{this.Stop();}},Stop:function(){this._Clear();dijit.byId("std_report_dlg").hide();dojo.style(this.domNode,{display:"none"});},_Clear:function(){this._reportid=-1;this._current=1;},Clear:function(){this._Clear();this.downloadProgress.update({maximum:this.maximum,progress:this._current});},hide:function(){dojo.style(this.domNode,{display:"none"});},_GetReportBuildStatus:function(){if(this._reportid!=-1){dojo.xhrPost(ttl.utilities.makeParams({load:this._OnStatusCallBack,url:"/reports/status",content:{reportid:this._reportid}}));}}});}