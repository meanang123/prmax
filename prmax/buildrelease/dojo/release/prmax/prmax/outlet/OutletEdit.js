/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.outlet.OutletEdit"]){dojo._hasResource["prmax.outlet.OutletEdit"]=true;dojo.provide("prmax.outlet.OutletEdit");dojo.require("prcommon.interests.Interests");dojo.require("ttl.utilities");formatRowCtrlLocal=function(_1){return isNaN(_1)?"...":_1==true?"":"<img  style=\"padding:0x;margin:0px\" src=\"/static/images/rowctrl.gif\" title=\"Outlet Options\" >";};PRMAX.outlet={view1:{cells:[[{name:"Job Title",width:"150px",field:"job_title"},{name:"Contact",width:"175px",field:"contactname"},{name:" ",width:"15px",formatter:formatRowCtrlLocal,field:"prn_primary"}]]}};dojo.declare("prmax.outlet.OutletEdit",[ttl.BaseWidget],{widgetsInTemplate:true,templateString:"<div>\r\n\t<div dojoAttachPoint=\"borderControl\" dojotype=\"dijit.layout.BorderContainer\" style=\"width:95%;height:95%\" >\r\n\t\t<div dojotype=\"dijit.layout.ContentPane\"  region=\"top\"  style=\"width:100%;height:3em\">\r\n\t\t\t<div class=\"prmaxHeadingLocation prmaxHeadingStyle\" dojoAttachPoint=\"headingNode\" >Adding Outlet</div>\r\n\t\t</div>\r\n\t\t<div dojotype=\"dijit.layout.ContentPane\"  region=\"left\" style=\"width:50%\" dojoAttachPoint=\"accNode\">\r\n\t\t\t<div dojoType=\"dijit.TitlePane\" title=\"Required Details\" open=\"true\" dojoAttachPoint=\"accRegNode\" >\r\n\t\t\t\t<form class=\"\" dojoType=\"dijit.form.Form\" dojoAttachPoint=\"requiredNode\">\r\n\t\t\t\t\t<table style=\"width:100%\" class=\"prmaxtable\">\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Type</td>\r\n\t\t\t\t\t<td><select style=\"width:90%\" class=\"prmaxrequired\" name=\"outlettypeid\"\r\n\t\t\t\t\t\t autoComplete=\"true\"\r\n\t\t\t\t\t\t searchAttr=\"name\"\r\n\t\t\t\t\t\t dojoType=\"dijit.form.FilteringSelect\"\r\n\t\t\t\t\t\t required=\"true\"\r\n\t\t\t\t\t\tinvalidMessage=\"Please select outlet type\"\r\n\t\t\t\t\t\t labelType=\"html\"\r\n\t\t\t\t\t\t dojoAttachPoint=\"outlettypes\">\r\n\t\t\t\t\t\t </select></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Name:</td>\r\n\t\t\t\t\t<td ><input style=\"width:70%\"  dojoAttachPoint=\"outletname\" class=\"prmaxrequired\" name=\"outletname\" type=\"text\" trim=\"true\" required=\"true\" invalidMessage=\"Please enter name\" dojoType=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Country</td><td><select style=\"width:90%\" class=\"prmaxrequired\" name=\"countryid\" autoComplete=\"true\" searchAttr=\"name\" dojoType=\"dijit.form.FilteringSelect\" required=\"true\" invalidMessage=\"Please select Country Name\" labelType=\"html\" dojoAttachPoint=\"countryid\"></select></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Email:</td><td ><input dojoAttachPoint=\"outlet_email\" name=\"outlet_email\" dojoAttachPoint=\"Email\" type=\"text\" dojoType=\"dijit.form.TextBox\" trim=\"true\" size=\"40\" maxlength=\"70\"/></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Primary Contact Details</td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Job Title:</td><td><input dojoAttachPoint=\"contact_jobtitle\" class=\"prmaxrequired\" name=\"contact_jobtitle\" type=\"text\" size=\"40\" maxlength=\"80\" trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Contact Title</td><td><input class=\"prmaxinput\" name=\"prefix\" dojoAttachPoint=\"prefix\" type=\"text\" trim=\"true\" dojoType=\"dijit.form.TextBox\" style=\"width: 2em;\" ></input></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">First Name</td><td><input class=\"prmaxinput\" name=\"firstname\" dojoAttachPoint=\"firstname\" type=\"text\" trim=\"true\" dojoType=\"dijit.form.TextBox\" style=\"width: 5em;\" ></input></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Surname</td><td><input class=\"prmaxinput\" name=\"familyname\" dojoAttachPoint=\"familyname\" type=\"text\" trim=\"true\" dojoType=\"dijit.form.TextBox\" style=\"width: 12em;\"></input></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType=\"dijit.TitlePane\" title=\"Outlet Other Details\" open=\"false\" dojoAttachPoint=\"accOtherNode\" class=\"scrollpane\">\r\n\t\t\t\t<form dojoType=\"dijit.form.Form\" dojoAttachPoint=\"outletDetailsFrom\">\r\n\t\t\t\t\t<table style=\"width:100%;border-collapse:collapse;\" cellspacing=\"0\" cellpadding=\"0\">\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Address1:</td><td><input  style=\"width:70%\"  dojoAttachPoint=\"address1\" name=\"address1\" type=\"text\" trim=\"true\" invalidMessage=\"Please enter address\" dojoType=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Address2:</td><td><input dojoAttachPoint=\"address2\" class=\"prmaxinput\" name=\"address2\" type=\"text\" maxlength=\"80\" trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Town</td><td><input dojoAttachPoint=\"townname\" class=\"prmaxinput\" name=\"townname\" type=\"text\" maxlength=\"80\" trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">County</td><td><input dojoAttachPoint=\"county\" class=\"prmaxinput\" name=\"county\" type=\"text\" trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Postcode:</td><td><input dojoAttachPoint=\"postcode\" class=\"prmaxinput\" name=\"postcode\" type=\"text \" maxlength=\"10\" trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Www:</td><td><input dojoAttachPoint=\"outlet_www\" class=\"prmaxinput\" name=\"outlet_www\" type=\"text\" maxlength=\"120\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Tel:</td><td><input dojoAttachPoint=\"outlet_tel\" class=\"prmaxinput\" name=\"outlet_tel\" type=\"text\" maxlength=\"40\" dojoType=\"dijit.form.ValidationTextBox\"  trim=\"true\" /></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Fax:</td><td><input dojoAttachPoint=\"outlet_fax\" class=\"prmaxinput\" name=\"outlet_fax\" type=\"text\" maxlength=\"40\" dojoType=\"dijit.form.ValidationTextBox\"  trim=\"true\" /></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Twitter</td><td><input dojoAttachPoint=\"outlet_twitter\" class=\"prmaxinput\" name=\"outlet_twitter\" type=\"text\" maxlength=\"80\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\" trim=\"true\" style=\"width:90%\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Facebook</td><td><input dojoAttachPoint=\"outlet_facebook\" class=\"prmaxinput\" name=\"outlet_facebook\" type=\"text\" maxlength=\"80\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\"  trim=\"true\" style=\"width:90%\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Linkedin</td><td><input dojoAttachPoint=\"outlet_linkedin\" class=\"prmaxinput\" name=\"outlet_linkedin\" type=\"text\" maxlength=\"80\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\" trim=\"true\" style=\"width:90%\" /></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Instagram</td><td><input dojoAttachPoint=\"outlet_instagram\" class=\"prmaxinput\" name=\"outlet_instagram\" type=\"text\" maxlength=\"80\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\" trim=\"true\" style=\"width:90%\" /></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\" valig=\"top\">Keywords:</td>\r\n\t\t\t\t\t<td colspan=\"2\"><div  name=\"outlet_interest\" selectonly=\"true\" size=\"6\" displaytitle=\"\" startopen=\"\"  dojoAttachPoint=\"outlet_interest\" restrict=\"0\"  dojoType=\"prcommon.interests.Interests\" keytypeid=\"6\" title=\"Select\"></div></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Circulation</td>\r\n\t\t\t\t\t<td><input dojoAttachPoint=\"outlet_circulation\" class=\"prmaxinput\" name=\"outlet_circulation\" type=\"text\" dojoType=\"dijit.form.NumberTextBox\" value=\"0\" constraints=\"{min:0,max:99999999}\" trim=\"true\"/></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Frequency</td>\r\n\t\t\t\t\t<td><select name=\"frequencyid\" class=\"prmaxinput\"\r\n\t\t\t\t\t\t autoComplete=\"true\"\r\n\t\t\t\t\t\t searchAttr=\"name\"\r\n\t\t\t\t\t\t dojoType=\"dijit.form.FilteringSelect\"\r\n\t\t\t\t\t\t required=\"true\"\r\n\t\t\t\t\t\tinvalidMessage=\"Please select frequency\"\r\n\t\t\t\t\t\t labelType=\"html\"\r\n\t\t\t\t\t\t dojoAttachPoint=\"frequencyNode\"\r\n\t\t\t\t\t\t ></select></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\">Profile</td>\r\n\t\t\t\t\t<td><textarea dojoAttachPoint=\"outlet_profile\"class=\"prmaxinput\" name=\"outlet_profile\" class=\"dijitTextarea\" dojoType=\"dijit.form.Textarea\"  style=\"width: 24em;\" ></textarea></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType=\"dijit.TitlePane\" title=\"Primary Contact Details\" open=\"false\" dojoAttachPoint=\"accContactNode\" >\r\n\t\t\t\t<form dojoType=\"dijit.form.Form\" dojoAttachPoint=\"contactDetailsFrom\">\r\n\t\t\t\t\t<table style=\"width:100%;border-collapse:collapse;\" cellspacing=\"0\" cellpadding=\"0\">\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Email:</td><td ><input dojoAttachPoint=\"contact_email\" class=\"prmaxinput\"  name=\"contact_email\" dojoAttachPoint=\"Email\" type=\"text\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.emailAddress\" trim=\"true\" invalidMessage=\"invalid email address\" size=\"20\" maxlength=\"70\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Tel:</td><td><input dojoAttachPoint=\"contact_tel\" class=\"prmaxinput\" name=\"contact_tel\" type=\"text\" id=\"contact_tel\" size=\"25\" maxlength=\"40\"  trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Fax:</td><td><input dojoAttachPoint=\"contact_fax\" class=\"prmaxinput\" name=\"contact_fax\" type=\"text\" size=\"25\" maxlength=\"40\"  trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Mobile:</td><td><input dojoAttachPoint=\"contact_mobile\" class=\"prmaxinput\" name=\"contact_mobile\" type=\"text\" size=\"25\" maxlength=\"40\"  trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Twitter</td><td><input dojoAttachPoint=\"contact_twitter\" class=\"prmaxinput\" name=\"contact_twitter\" type=\"text\" maxlength=\"80\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\" trim=\"true\" style=\"width:90%\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Facebook</td><td><input dojoAttachPoint=\"contact_facebook\" class=\"prmaxinput\" name=\"contact_facebook\" type=\"text\" maxlength=\"80\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\"  trim=\"true\" style=\"width:90%\"/></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Linkedin</td><td><input dojoAttachPoint=\"contact_linkedin\" class=\"prmaxinput\" name=\"contact_linkedin\" type=\"text\" maxlength=\"80\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\" trim=\"true\" style=\"width:90%\" /></td></tr>\r\n\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\">Instagram</td><td><input dojoAttachPoint=\"contact_instagram\" class=\"prmaxinput\" name=\"contact_instagram\" type=\"text\" maxlength=\"80\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.url\" trim=\"true\" style=\"width:90%\" /></td></tr>\r\n\t\t\t\t\t<tr><td class=\"prmaxrowtag\" valign=\"top\" >Keywords:</td>\r\n\t\t\t\t\t  <td colspan=\"2\"><div  dojoAttachPoint=\"contact_interest\" dojoType=\"prcommon.interests.Interests\" restrict=\"0\" selectonly=\"true\" startopen =\"\" size=\"6\" name=\"contact_interest\" keytypeid=\"7\"></div></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojotype=\"dijit.layout.ContentPane\"  region=\"right\" style=\"width:50%;height:100%\" dojoAttachPoint=\"extraContactPane\">\r\n\t\t\t\t<div dojoType=\"dijit.TitlePane\" title=\"Other Contact Details\" open=\"true\"  >\r\n\t\t\t\t\t<button class=\"prmaxbutton\"iconClass=\"dijitPrmaxIcon dijitPrmaxAdd\" dojoAttachPoint=\"newEmployeeNode\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_AddEmployee\" disabled=\"disabled\" label=\"Add New \"></button>\r\n\t\t\t\t\t<div  dojoAttachPoint=\"contactgrid\" dojoType=\"dojox.grid.DataGrid\"  rowsPerPage=\"50\" style=\"height:90%\"  structure=\"PRMAX.outlet.view1\"  ></div>\r\n\t\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojotype=\"dijit.layout.ContentPane\"  region=\"bottom\"  style=\"width:100%;height:3em\">\r\n\t\t\t<table style=\"width:100%;border-style:collapsed\"><tr><td align=\"right\">\r\n\t\t\t\t<button  type=\"button\" class=\"prmaxbutton\" iconClass=\"dijitPrmaxIcon dijitPrmaxIconNew\" dojoAttachPoint=\"newNode\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:New\" label=\"New\" disabled=\"disabled\"></button>\r\n\t\t\t\t<button  type=\"button\" class=\"prmaxbutton\"iconClass=\"dijitPrmaxIcon dijitPrmaxAdd\" dojoAttachPoint=\"saveNode\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Saving...\" dojoAttachEvent=\"onClick:Save\" disabled=\"disabled\" label=\"Save\"></button>\r\n\t\t\t</td></tr></table>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this._SavedCallBack=dojo.hitch(this,this._Saved);this._LoadCallBack=dojo.hitch(this,this._Load);this._DeleteCallBack=dojo.hitch(this,this._DeleteCall);this._GetContactEntryCallBack=dojo.hitch(this,this._GetContactEntry);this.outletid=-1;this.std_menu=null;this.std_menu2=null;this.baseonCellClick=null;this.modelemployees=new prcommon.data.QueryWriteStore({url:"/employees/contactlist",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true});this.modelemployees.SetNoCallBackMode(true);dojo.subscribe(PRCOMMON.Events.Employee_Updated,dojo.hitch(this,this._EmployeeUpdateEvent));dojo.subscribe(PRCOMMON.Events.Employee_Add,dojo.hitch(this,this._EmployeeAddEvent));this._prmax_freq_store=new dojo.data.ItemFileReadStore({url:"/common/lookups?searchtype=frequencies",onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true});},postCreate:function(){if(this.baseonCellClick==null){this.contactgrid.setStore(this.modelemployees);this.baseonCellClick=this.contactgrid["onCellClick"];this.contactgrid["onCellClick"]=dojo.hitch(this,this.onCellClick);this.contactgrid["onRowClick"]=dojo.hitch(this,this.onSelectRow);}this.outlettypes.store=PRCOMMON.utils.stores.OutletTypes();this.countryid.store=PRCOMMON.utils.stores.Countries();this.frequencyNode.store=this._prmax_freq_store;this.inherited(arguments);},_Saved:function(_2){if(_2.success=="OK"){this.outletid=_2.data.outlet.outletid;this.layout();this.contactgrid.setQuery(ttl.utilities.getPreventCache({outletid:this.outletid}));dojo.attr(this.headingNode,"innerHTML","Editing (  "+this.outletname.get("value")+" )");dojo.publish(PRCOMMON.Events.Outlet_Updated,[_2.data]);ttl.utilities.showMessageStd("Saved",1000);alert("Saved");}else{alert("Failed");}this.saveNode.cancel();},Load:function(_3){this.newNode.set("disabled",true);this.saveNode.set("disabled",true);dojo.attr(this.headingNode,"innerHTML","");dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCallBack,url:"/outlets/outlet_edit_get",content:{outletid:_3}}));},Save:function(){if(ttl.utilities.formValidator(this.requiredNode)==false){this.accRegNode.set("open",true);alert("Not all required field filled in");this.saveNode.cancel();return;}if(ttl.utilities.formValidator(this.outletDetailsFrom)==false){this.accOtherNode.set("open",true);alert("Not all required field filled in");this.saveNode.cancel();return;}if(ttl.utilities.formValidator(this.contactDetailsFrom)==false){this.accContactNode.set("open",true);alert("Not all required field filled in");this.saveNode.cancel();return;}var _4=this.requiredNode.get("value");_4.outletid=this.outletid;_4=dojo.mixin(_4,this.outletDetailsFrom.get("value"));_4=dojo.mixin(_4,this.contactDetailsFrom.get("value"));ttl.utilities.showMessageStd("Saving ..............",1000);dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedCallBack,url:"/outlets/outlet_save",content:_4}));},New:function(){this.Clear();this.layout();},layout:function(){this.accRegNode.set("open",true);this.accContactNode.set("open",false);this.accOtherNode.set("open",false);this.extraContactPane.set("open",this.outletid==-1?false:true);this.newEmployeeNode.set("disabled",this.outletid==-1?true:false);},Clear:function(){this.outletid=-1;this.saveNode.cancel();this.newEmployeeNode.set("disabled",true);this.contactgrid.setQuery(ttl.utilities.getPreventCache({outletid:this.outletid}));this.saveNode.set("disabled",false);this.newNode.set("disabled",false);dojo.attr(this.headingNode,"innerHTML","Adding Outlet");this.outlettypes.set("value",1);this.frequencyNode.set("value",1);this.outletname.set("value","");this.address1.set("value","");this.address2.set("value","");this.townname.set("value","");this.county.set("value","");this.postcode.set("value","");this.outlet_www.set("value","");this.outlet_email.set("value","");this.outlet_tel.set("value","");this.outlet_fax.set("value","");this.outlet_interest.clear_private();this.outlet_circulation.set("value",0);this.outlet_profile.set("value","");this.contact_jobtitle.set("value","");this.contact_email.set("value","");this.contact_tel.set("value","");this.contact_fax.set("value","");this.contact_mobile.set("value","");this.contact_interest.clear_private();this.prefix.set("value","");this.firstname.set("value","");this.familyname.set("value","");this.countryid.set("value",1);this.outlet_twitter.set("value","");this.outlet_facebook.set("value","");this.outlet_linkedin.set("value","");this.outlet_instagram.set("value","");this.contact_twitter.set("value","");this.contact_facebook.set("value","");this.contact_linkedin.set("value","");this.contact_instagram.set("value","");},_Load:function(_5){this.outletid=_5.outlet.outlet.outletid;this.layout();this.contactgrid.setQuery(ttl.utilities.getPreventCache({outletid:this.outletid}));dojo.attr(this.headingNode,"innerHTML","Editing (  "+_5.outlet.outlet.outletname+" )");this.countryid.set("value",_5.outlet.outlet.countryid);this.outlettypes.set("value",_5.outlet.outlet.prmax_outlettypeid);this.frequencyNode.set("value",_5.outlet.outlet.frequencyid);this.outletname.set("value",_5.outlet.outlet.outletname);this.outlet_www.set("value",_5.outlet.outlet.www);this.outlet_circulation.set("value",_5.outlet.outlet.circulation);this.outlet_profile.set("value",_5.outlet.outlet.profile);this.outlet_email.set("value",_5.outlet.communications.email);this.outlet_tel.set("value",_5.outlet.communications.tel);this.outlet_fax.set("value",_5.outlet.communications.fax);this.outlet_twitter.set("value",_5.outlet.communications.twitter);this.outlet_facebook.set("value",_5.outlet.communications.facebook);this.outlet_linkedin.set("value",_5.outlet.communications.linkedin);this.outlet_instagram.set("value",_5.outlet.communications.instagram);this.outlet_interest.set("value",_5.outlet.interests);this.address1.set("value",_5.outlet.address.address1);this.address2.set("value",_5.outlet.address.address2);this.townname.set("value",_5.outlet.address.townname);this.county.set("value",_5.outlet.address.county);this.postcode.set("value",_5.outlet.address.postcode);this.prefix.set("value",_5.primary.contact.prefix);this.firstname.set("value",_5.primary.contact.firstname);this.familyname.set("value",_5.primary.contact.familyname);this.contact_jobtitle.set("value",_5.primary.employee.job_title);this.contact_email.set("value",_5.primary.communications.email);this.contact_tel.set("value",_5.primary.communications.tel);this.contact_fax.set("value",_5.primary.communications.fax);this.contact_mobile.set("value",_5.primary.communications.mobile);this.contact_twitter.set("value",_5.primary.communications.twitter);this.contact_facebook.set("value",_5.primary.communications.facebook);this.contact_linkedin.set("value",_5.primary.communications.linkedin);this.contact_instagram.set("value",_5.primary.communications.instagram);this.contact_interest.set("value",_5.primary.interests);this.newEmployeeNode.set("disabled",false);this.saveNode.set("disabled",false);},resize:function(){this.borderControl.resize(arguments[0]);this.inherited(arguments);},_AddEmployee:function(){if(this.outletid!=-1){PRMAX.search.largeDialog.set("content","<div dojoType=\"prmax.employee.EmployeeEdit\" employeeid=\"-1\" parentcontrol=\""+this.id+"\""+" outletid=\""+this.outletid+"\"></div>");PRMAX.search.largeDialog.show("Add Contact to Outlet ("+this.outletname.get("value")+")");}},_ChangeEmployee:function(){PRMAX.search.largeDialog.set("content","<div dojoType=\"prmax.employee.EmployeeEdit\" employeeid=\""+this._context_row.i.employeeid+"\" parentcontrol=\""+this.id+"\""+" outletid=\""+this.outletid+"\"></div>");PRMAX.search.largeDialog.show("Edit Contact to Outlet ("+this.outletname.get("value")+")");},_DeleteCall:function(_6){if(_6.success=="OK"){dojo.publish(PRCOMMON.Events.Employee_Deleted,[this._context_row.i]);this.contactgrid.store.deleteItem(this._context_row);alert("Contact Deleted");}else{alert("Problem deleting Contact");}},_DeleteEmployee:function(){if(confirm("Delete Contact "+this._context_row.i.job_title+" "+this._context_row.i.contactname+" ? ")){dojo.xhrPost(ttl.utilities.makeParams({load:this._DeleteCallBack,url:"/employees/employee_delete",content:{"employeeid":this._context_row.i.employeeid}}));}},_PrimaryEmployee:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._DeleteCallBack,url:"/outlet/set_primary_employee",content:{"employeeid":this._context_row.i.employeeid,"outletid":this._context_row.i.outletid}}));},onCellClick:function(e){var _7=this.contactgrid.getItem(e.rowIndex);if(_7&&_7.prn_primary){return;}if(e.cellIndex>0&&e.cellIndex<2){this.onSelectRow(e);}else{if(e.cellIndex==2){this.onSelectRow(e);this.onRowContextMenu(e);}else{this.baseonCellClick(e);}}},onRowContextMenu:function(e){this._context_row=this.contactgrid.getItem(e.rowIndex);var _8=null;if(!this._context_row.i.prn_primary){_8=this._std_record_context_menu();}else{_8=this._std_record_min_context_menu();}_8._openMyself(e);},_std_record_context_menu:function(){if(this.std_menu==null){this.std_menu=new dijit.Menu();this.std_menu.addChild(new dijit.MenuItem({label:"Edit Contact",onClick:dojo.hitch(this,this._ChangeEmployee),iconClass:"dijitPrmaxIcon dijitPrmaxEmployee"}));this.std_menu.addChild(new dijit.MenuItem({label:"Delete Contact",onClick:dojo.hitch(this,this._DeleteEmployee),iconClass:"dijitPrmaxIcon dijitPrmaxEmployee"}));this.std_menu.addChild(new dijit.MenuItem({label:"Set as Primary Contact",onClick:dojo.hitch(this,this._PrimaryEmployee),iconClass:"dijitPrmaxIcon dijitPrmaxEmployee"}));this.std_menu.addChild(new dijit.MenuItem({label:"Add Contact",onClick:dojo.hitch(this,this._AddEmployee),iconClass:"dijitPrmaxIcon dijitPrmaxEmployee"}));this.std_menu.startup();}return this.std_menu;},_std_record_min_context_menu:function(){if(this.std_menu2==null){this.std_menu2=new dijit.Menu();this.std_menu2.addChild(new dijit.MenuItem({label:"Add Contact",onClick:dojo.hitch(this,this._AddEmployee),iconClass:"dijitPrmaxIcon dijitPrmaxEmployee"}));this.std_menu2.startup();}return this.std_menu2;},onSelectRow:function(e){this.contactgrid.selection.clickSelectEvent(e);},_EmployeeAddEvent:function(_9){if(this.outletid==_9.outletid){_9.prn_primary=false;var _a=this.modelemployees.newItem(_9);gHelper.AddRowToQueryWriteGrid(this.contactgrid,_a);}},_GetContactEntry:function(){this.content=arguments[0];},_EmployeeUpdateEvent:function(_b){this.content=null;var _c={identity:_b.employeeid,onItem:this._GetContactEntryCallBack};this.modelemployees.fetchItemByIdentity(_c);if(this.content!=null){this.modelemployees.setValue(this.content,"job_title",_b.job_title);this.modelemployees.setValue(this.content,"contactname",_b.contactname);}}});}