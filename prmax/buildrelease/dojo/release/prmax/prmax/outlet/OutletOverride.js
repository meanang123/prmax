/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.outlet.OutletOverride"]){dojo._hasResource["prmax.outlet.OutletOverride"]=true;dojo.provide("prmax.outlet.OutletOverride");dojo.require("dijit._Templated");dojo.require("dijit._Widget");dojo.require("dijit._Container");dojo.declare("prmax.outlet.OutletOverride",[dijit._Widget,dijit._Templated,dijit._Container],{outletid:-1,outlettypeid:1,widgetsInTemplate:true,templateString:"<div>\r\n<form class=\"prmaxdefault\" dojoType=\"dijit.form.Form\" dojoAttachPoint=\"overrideNode\" onsubmit=\"return false\">\r\n<table style=\"width:99%\" class=\"prmaxtable\" cellspacing=\"0\" cellpadding=\"0\">\r\n<tr><td class=\"prmaxrowtag\">Address1:</td><td><input style=\"width:20em\" dojoAttachPoint=\"address1\" name=\"address1\" type=\"text\" maxlength=\"80\" trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n<tr><td class=\"prmaxrowtag\">Address2:</td>\t<td><input style=\"width:20em\" dojoAttachPoint=\"address2\" name=\"address2\" type=\"text\" maxlength=\"80\" trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n<tr><td class=\"prmaxrowtag\">Town</td>\t<td><input style=\"width:20em\" dojoAttachPoint=\"townname\" name=\"townname\" type=\"text\" maxlength=\"80\" trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n<tr><td class=\"prmaxrowtag\">County</td><td><input style=\"width:20em\" dojoAttachPoint=\"county\" name=\"county\" type=\"text\" trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n<tr><td class=\"prmaxrowtag\">Postcode:</td>\t<td><input style=\"width:10em\" dojoAttachPoint=\"postcode\" name=\"postcode\" type=\"text \" maxlength=\"10\" trim=\"true\" dojoType=\"dijit.form.TextBox\"/></td></tr>\r\n<tr><td class=\"prmaxrowtag\">Email:</td><td ><input style=\"width:20em\" name=\"email\" dojoAttachPoint=\"email\" type=\"text\" dojoType=\"dijit.form.ValidationTextBox\" regExpGen=\"dojox.validate.regexp.emailAddress\" trim=\"true\" invalidMessage=\"invalid email address\" size=\"20\" maxlength=\"70\"></tr>\r\n<tr><td class=\"prmaxrowtag\">Tel:</td><td><input style=\"width:20em\" dojoAttachPoint=\"tel\" name=\"tel\" type=\"text\" maxlength=\"40\" dojoType=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n<tr><td class=\"prmaxrowtag\">Fax:</td><td><input style=\"width:20em\" dojoAttachPoint=\"fax\" name=\"fax\" type=\"text\" maxlength=\"40\" dojoType=\"dijit.form.ValidationTextBox\" /></td></tr>\r\n<tr dojoAttachPoint=\"primarycontactrow\"><td class=\"prmaxrowtag\" \tvalign=\"top\" >Primary Contact</td><td>\r\n<table style=\"width:100%\" class=\"prmaxtable\" cellspacing=\"0\" cellpadding=\"0\">\r\n<tr><td><input dojoAttachPoint=\"use_primary\" name=\"use_primary\" type=\"checkbox\" dojoType=\"dijit.form.CheckBox\" value=\"1\"  dojoAttachEvent=\"onClick:_ChangePrimaryMode\" /><label dojoAttachPoint=\"use_primary_label\">Use Standard Primary Contact</label></td></tr>\r\n<select style=\"width:100%\" name=\"primaryemployeeid\" class=\"prmaxinput\"\r\n\t\t\t\t autoComplete=\"true\"\r\n\t\t\t\t searchAttr=\"displayname\"\r\n\t\t\t\t labelAttr=\"displayname\"\r\n\t\t\t\t dojoType=\"dijit.form.FilteringSelect\"\r\n\t\t\t\t labelType=\"html\"\r\n\t\t\t\t maxlength=\"80\"\r\n\t\t\t\t dojoAttachPoint=\"primaryemployeeid\" ></select></td></tr>\r\n</table></td><tr>\r\n<tr><td colspan=\"2\"><div dojoAttachPoint=\"interests\" class=\"prmaxhidden\" name=\"interests\" startopen=\"true\" selectonly=\"true\" nofilter=\"true\" size=\"6\" interesttypeid=\"2\" restrict=\"0\"  dojoType=\"prcommon.interests.Interests\" keytypeid=\"6\" displaytitle=\"Tags\"></div></td></tr>\r\n<tr><td class=\"prmaxrowtag\" valign=\"top\">Profile</td>\r\n<td><div class=\"dialogprofileframe\" ><textarea dojoAttachPoint=\"profile\" name=\"profile\" class=\"dijitTextarea\" dojoType=\"dijit.form.Textarea\" style=\"height:99%;width:99%\" ></textarea><div></td></tr>\r\n<tr>\r\n<td  align=\"left\"><button class=\"prmaxbutton\" type=\"button\" dojoAttachPoint=\"cancelNode\" dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_Close\"  label=\"Close\"></button></td>\r\n<td  align=\"right\"><button class=\"prmaxbutton\" type=\"button\" dojoAttachPoint=\"saveNode\" dojoAttachEvent=\"onClick:_SaveCtrl\" disabled=\"disabled\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Saving...\" label=\"Save\"></button></td></tr></table>\r\n</form>\r\n</div>\r\n",constructor:function(){this._LoadCall=dojo.hitch(this,this._Load);this._SavedCall=dojo.hitch(this,this._Saved);},postCreate:function(){if(this.outlettypeid==PRCOMMON.Constants.Freelance){dojo.addClass(this.primarycontactrow,"prmaxhidden");}if(PRMAX.utils.settings.productid==PRCOMMON.Constants.PRMAX_Pro){dojo.removeClass(this.interests.domNode,"prmaxhidden");}dojo.connect(this.overrideNode,"onSubmit",dojo.hitch(this,this._Save));if(this.outlettypeid==1){this.modelemployees=new dojox.data.QueryReadStore({url:"/employees/listcombo?extended=1&outletid="+this.outletid,onError:ttl.utilities.globalerrorchecker,clearOnClose:true,urlPreventCache:true});this.primaryemployeeid.store=this.modelemployees;}this.Load();},_SaveCtrl:function(){this.overrideNode.submit();},Load:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._LoadCall,url:"/outlets/outlet_override_get",content:{outletid:this.outletid}}));},_Load:function(_1){if(_1.data.outlet!=null){with(_1.data.outlet){this.tel.set("value",tel);this.email.set("value",email);this.fax.set("value",fax);this.profile.set("value",profile);this.address1.set("value",address1);this.address2.set("value",address2);this.townname.set("value",townname);this.county.set("value",county);this.postcode.set("value",postcode);if(this.outlettypeid==1){var _2=(_1.data.outlet.primaryemployeeid>0)?primaryemployeeid:-1;this.use_primary.set("checked",_2==-1?true:false);this.primaryemployeeid.set("disabled",_2==-1?true:false);this.primaryemployeeid.set("value",_2);}}}else{if(this.outlettypeid==1){this.use_primary.set("checked",true);this.primaryemployeeid.set("disabled",true);this.primaryemployeeid.set("value",-1);}}if(this.outlettypeid==19){this.use_primary.set("disabled",true);this.primaryemployeeid.set("disabled",true);}this.interests.set("value",_1.data.interests);this.saveNode.set("disabled",false);},Clear:function(){},_Saved:function(_3){if(_3.success=="OK"){dojo.publish(PRCOMMON.Events.Outlet_Overrides,[{outlet:{outletid:this.outletid}}]);alert("Changes Saved");this.saveNode.cancel();PRMAX.search.stdDialog.hide();}else{alert("Problem saving changes");}},_Save:function(){try{if(ttl.utilities.formValidator(this.overrideNode)==false){alert("Not all required field filled in");this.saveNode.cancel();return;}if(this.address1.get("value").length==0&&(this.address2.get("value").length>0||this.townname.get("value").length>0||this.county.get("value").length>0||this.postcode.get("value").length>0)){alert("Address must have a first line ");this.address1.focus();this.saveNode.cancel();return;}var _4=this.overrideNode.get("value");_4["outletid"]=this.outletid;dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedCall,url:(this.outlettypeid==1)?"/outlets/outlet_override_save":"/outlets/freelance_override_save",content:_4}));}catch(e){alert(e);}},_ChangePrimaryMode:function(){var _5=this.use_primary.get("checked");if(_5){this.primaryemployeeid.set("value",-1);}this.primaryemployeeid.set("disabled",_5);},_Close:function(){this.Clear();PRMAX.search.stdDialog.hide();},destroy:function(){this.inherited(arguments);}});}