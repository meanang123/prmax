/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.lists.SaveToList"]){dojo._hasResource["prmax.lists.SaveToList"]=true;dojo.provide("prmax.lists.SaveToList");dojo.declare("prmax.lists.SaveToList",[ttl.BaseWidget],{selected:-1,widgetsInTemplate:true,templateString:"<div>\r\n    <div dojoType=\"dijit.TitlePane\" title=\"Save Results to list\" open=\"true\" style=\"width:100%\" >\r\n      <form class=\"prmaxdefault\" dojoAttachPoint=\"saveform\" name=\"saveform\" onSubmit=\"return false;\" dojoType=\"dijit.form.Form\">\r\n        <table width=\"100%\" class=\"prmaxtable\" >\r\n          <tr><td class=\"prmaxrowtag\" width=\"20%\" >List Name</td>\r\n            <td><div dojoType=\"dijit.form.FilteringSelect\"\r\n            name=\"listid\"\r\n            dojoAttachPoint=\"lists\"\r\n            required=\"true\"\r\n            pageSize=\"20\"\r\n            autoComplete=\"true\"\r\n            labelAttr=\"listname\"\r\n            searchAttr=\"listname\"\r\n            promptMessage=\"Please Select a list\"></div></td>\r\n            <td><button class=\"prmaxbutton\" type=\"button\" dojoAttachEvent=\"onClick:_ShowCreateList\" dojoType=\"dijit.form.Button\" label=\"Create a new List\"></button></td>\r\n          </tr>\r\n          <tr><td class=\"prmaxrowtag\" valign=\"top\">Selection from Source</td><td><div name=\"selection\" dojoAttachPoint=\"source\" dojoType=\"prmax.common.SelectOptions\" ></div></td></tr>\r\n          <tr><td class=\"prmaxrowtag\">List Options</td><td>\r\n              <input dojoAttachPoint=\"override_button\" type=\"radio\" name=\"overwrite\" dojotype=\"dijit.form.RadioButton\" value=\"1\" /> <label dojoAttachPoint=\"label_overwrite\" class=\"prmaxlabeltag\" >Overwrite</label>\r\n              <input dojoAttachPoint=\"append_button\" type=\"radio\" name=\"overwrite\" dojotype=\"dijit.form.RadioButton\" value=\"0\" checked =\"checked\"/> <label class=\"prmaxlabeltag\" dojoAttachPoint=\"label_append\" >Append</label>\r\n          </td></tr>\r\n          <tr><td colspan=\"3\" align=\"right\"><button class=\"prmaxbutton\" type=\"button\" dojoAttachEvent=\"onClick:_SaveList\" dojoAttachPoint=\"saveNode\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Saving...\" label=\"Save results\"></button></td></tr>\r\n        </table>\r\n      </form>\r\n    </div>\r\n    <div dojoType=\"dijit.TitlePane\" dojoAttachPoint=\"addpane\" title=\"Add  New List\" open=\"false\" style=\"width:100%\" >\r\n      <form dojoAttachPoint=\"addform\" name=\"addform\"  onSubmit=\"return false;\" dojoType=\"dijit.form.Form\">\r\n        <table width=\"100%\" class=\"prmaxtable\" >\r\n            <tr><td class=\"prmaxrowtag\">New List</td><td ><input dojoType=\"dijit.form.ValidationTextBox\" name=\"listname\" dojoAttachPoint=\"listnamenew\" required=\"true\" promptMessage=\"Please Enter new list name\" trim=\"true\" maxlength=\"45\" ></td></tr>\r\n            <tr><td colspan=\"2\" align=\"right\"><button  type=\"button\" class=\"prmaxbutton\" dojoAttachEvent=\"onClick:_SaveNewList\" dojoAttachPoint=\"addNode\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Saving...\" label=\"Add List\"></button></td></tr>\r\n        </table>\r\n      </form>\r\n    </div>\r\n</div>\r\n",constructor:function(){this.store=new dojox.data.QueryReadStore({url:"/lists/lists?listtypeid=1",onError:ttl.utilities.globalerrorchecker});this._SavedListCall=dojo.hitch(this,this._SavedListed);this._SavedResultCall=dojo.hitch(this,this._SavedResult);},_SaveList:function(){this.saveform.submit();},_SaveNewList:function(){this.addform.submit();},postCreate:function(){this.lists._setStore(this.store);dojo.connect(this.saveform,"onSubmit",dojo.hitch(this,this._SubmitList));dojo.connect(this.addform,"onSubmit",dojo.hitch(this,this._SubmitAdd));dojo.connect(this.addpane,"toggle",dojo.hitch(this,this._OpenSave));this.label_overwrite["for"]=this.override_button.id;this.label_append["for"]=this.append_button.id;},startup:function(){this.source.setOptions(this.selected);this.inherited(arguments);},_SubmitList:function(){if(ttl.utilities.formValidator(this.saveform)==false){alert("Not all required field filled in");this.saveNode.cancel();return;}dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedResultCall,url:"/lists/savetolist",content:this.saveform.get("value")}));},_SavedResult:function(_1){if(_1.success=="OK"){alert("Result Saved to List");PRMAX.search.closeStdDialog();}else{alert("Problem with List");this.lists.focus();}this.saveNode.cancel();},_SubmitAdd:function(){if(ttl.utilities.formValidator(this.addform)==false){alert("Not all required field filled in");this.addNode.cancel();return;}dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedListCall,url:"/lists/addnew",content:this.addform.get("value")}));},_SavedListed:function(_2){if(_2.success=="OK"){this.lists.set("value",_2.list.listid);this.listnamenew.set("value","");this.saveNode.focus();this.addpane.set("open",false);}else{if(_2.success=="DU"){alert("List Name Already Exists");this.listnamenew.focus();}else{if(_2.success=="VF"){alert("List Name: "+_2.error_message[0][1]);this.listnamenew.focus();}else{alert("Problem with List");this.listnamenew.focus();}}}this.addNode.cancel();},_OpenSave:function(){if(this.addpane.get("open")){this.listnamenew.focus();}},destroy:function(){this.inherited(arguments);delete this.store;},_ShowCreateList:function(){this.addpane.set("open",true);this.listnamenew.focus();}});}