/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.lists.standinglist"]){dojo._hasResource["prmax.lists.standinglist"]=true;dojo.provide("prmax.lists.standinglist");dojo.require("dojox.data.JsonRestStore");dojo.declare("prmax.lists.standinglist",[ttl.BaseWidget],{widgetsInTemplate:true,listtypeid:1,delete_mode:true,display:"Media Lists",templateString:"<div>\r\n\t<div data-dojo-attach-point=\"borderCtrl\" data-dojo-type=\"dijit.layout.BorderContainer\" data-dojo-props='style:\"width:100%;height:100%\"' >\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"top\",style:\"width:100%;height:44px\",\"class\":\"std_menu_view\"'>\r\n\t\t\t<div style=\"height:44px;width:100%;overflow:hidden;padding:0px;margin:0px\" class=\"std_menu_view\">\r\n\t\t\t\t<div style=\"height:100%;width:15%;float:left;padding:0px;margin:0px\" class=\"prmaxrowdisplaylarge\" data-dojo-attach-point=\"displayNode\"></div>\r\n\t\t\t\t\t<div data-dojo-type=\"dijit.Toolbar\" data-dojo-props='\"class\":\"dijitToolbarTop\",style:\"float:left;height:100%;width:83%\"' >\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_New\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"svl_new\" data-dojo-props='iconClass:\"fa fa-plus fa-3x\",showLabel:false,label:\"New\"'></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Delete\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"svl_delete\" data-dojo-props='iconClass:\"fa fa-trash fa-3x\",disabled:\"disabled\",showLabel:false,label:\"Delete\"'></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Open\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"svl_open\" data-dojo-props='iconClass:\"fa fa-folder-open fa-3x\",disabled:\"disabled\",showLabel:false,label:\"Open\"'></div>\r\n\t\t\t\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\" data-dojo-props='iconClass:\"fa fa-print fa-3x\",showLabel:false,label:\"Report\"'>\r\n\t\t\t\t\t\t\t<div data-dojo-type=\"dijit.Menu\" >\r\n\t\t\t\t\t\t\t\t<div data-dojo-type=\"dijit.MenuItem\" data-dojo-props='\"class\":\"prmaxhidden\",label:\"Full Report\"' data-dojo-attach-point=\"svl_reports_full\"></div>\r\n\t\t\t\t\t\t\t\t<div data-dojo-type=\"dijit.MenuItem\" data-dojo-props='label:\"Print Index\"' data-dojo-attach-point=\"svl_reports_summary\"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\" data-dojo-attach-point=\"menu_filter\" data-dojo-props='iconClass:\"fa fa-filter fa-3x\",showLabel:false,label:\"Filter By\"'>\r\n\t\t\t\t\t\t\t<div data-dojo-type=\"dijit.TooltipDialog\" data-dojo-attach-event=\"execute:_execute_filter\">\r\n\t\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t\t<tr><td>List Name</td><td><input data-dojo-type=\"dijit.form.TextBox\" data-dojo-attach-point=\"listnamefilter\" data-dojo-props='name:\"listnamefilter\"'/></td></tr>\r\n\t\t\t\t\t\t\t\t\t<tr><td data-dojo-attach-point=\"client_filter_name\">Client</td><td><select data-dojo-props='name:\"clientid\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"filter_clientid\" ></select></td></tr>\r\n\r\n\t\t\t\t\t\t\t\t\t<tr><td><br/><br/></td></tr>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td align=\"left\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_clear_filter\" data-dojo-props='type:\"button\"' >Clear Filter</button></td>\r\n\t\t\t\t\t\t\t\t\t\t<td align=\"right\"><button data-dojo-type=\"dijit.form.Button\" data-dojo-props='type:\"submit\",name:\"submit\"'>Filter</button></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='region:\"left\",style:\"width:50%;\",splitter:true' >\r\n\t\t\t<div data-dojo-attach-point=\"listGrid\" data-dojo-type=\"dojox.grid.DataGrid\" query=\"{ }\" rowsPerPage=\"50\" style=\"width:100%;height:100%\" ></div>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props='stlye:\"height:100%width:50%\",region:\"center\"' >\r\n\t\t\t<div data-dojo-type=\"dijit.TitlePane\" title=\"List Info\" data-dojo-attach-point=\"list_info_pane\" data-dojo-props='style:\"width:100%\",\"class\":\"prmaxhidden\"'>\r\n\t\t\t\t<table width=\"100%\" style=\"border-collapse:collapse\" cellspacing=\"0\" cellpadding=\"0\">\r\n\t\t\t\t\t<tr><td width=\"20%\">Name:</td><td width=\"70%\"><span data-dojo-attach-point=\"svl_name_field\"></span></td><td width=\"90px\" rowspan=\"5\"><div style=\"width:120px;height:130px;padding-right:10px;padding-bottom:3px\">\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_DeleteSingle\" data-dojo-props='disabled:\"disabled\"' data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"svl_list_delete\" ><div style=\"width:98px\" class=\"prmaxbutton\">Delete</div></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_Rename\" data-dojo-props='disabled:\"disabled\"' data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"svl_list_rename\" ><div style=\"width:98px\" class=\"prmaxbutton\">Rename</div></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_OpenSingle\" data-dojo-props='disabled:\"disabled\"' data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"svl_list_open\"><div style=\"width:98px\" class=\"prmaxbutton\">Open</div></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</td></tr>\r\n\t\t\t\t\t<tr><td>Nbr Entries:</td><td><span data-dojo-attach-point=\"svl_count_field\"></span></td></tr>\r\n\t\t\t\t\t<tr><td colspan=\"3\">&nbsp;</td></tr>\r\n\t\t\t\t\t<tr><td colspan=\"3\">&nbsp;</td></tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t\t<div data-dojo-type=\"dijit.TitlePane\" data-dojo-attach-point=\"list_projects_pane\" data-dojo-props='style:\"width: 100%\",\"class\":\"prmaxhidden\",title:\"Projects\"'>\r\n\t\t\t\t<table width=\"100%\" style=\"border-collapse:collapse\" cellspacing=\"0\" cellpadding=\"0\">\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td width=\"55%\"><select data-dojo-attach-point=\"svl_projects_listofprojects\" style=\"width:100%\" size=\"10\" class=\"lists\" multiple=\"multiple\" ></select>&nbsp;</td>\r\n\t\t\t\t\t\t<td valign=\"top\">\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_AddProjectToList\" disabled=\"disabled\" style=\"width:150px\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"svl_projects_add\"  > <div style=\"width:9em\" class=\"prmaxbutton\">Add To Projects</div></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_DeleteProjectFromList\" disabled=\"disabled\" style=\"width:150px\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"svl_projects_delete\" ><div style=\"width:9em\" class=\"prmaxbutton\">Delete from Projects</div></div>\r\n\t\t\t\t\t\t<div data-dojo-attach-event=\"onClick:_AddProject\" disabled=\"disabled\" style=\"width:150px\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"svl_projects_new\" ><div style=\"width:9em\" class=\"prmaxbutton\">Add New Project</div></div>\r\n\t\t\t\t\t\t</td></tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" title=\"Enter New Project\" data-dojo-attach-point=\"svl_project_new_dlg\" data-dojo-props='style:\"display:none\"'>\r\n\t\t<form data-dojo-attach-point=\"svl_project_add_form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='onsubmit:\"return false\"'>\r\n\t\t<table>\r\n\t\t\t<tr>\r\n\t\t\t\t<td><label>Name</label></td>\r\n\t\t\t\t<td><input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"svl_project_add_name\" data-dojo-props='name:\"projectname\",required:true,trim:true,maxlength:\"80\",promptMessage:\"Enter new projects name\",type:\"text\"'/></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td align=\"left\">\r\n\t\t\t\t\t<button data-dojo-attach-event=\"onClick:_CancelProjectDlg\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"svl_project_add_cancel\" type=\"button\" >Cancel</button></td>\r\n\t\t\t\t<td align=\"right\">\r\n\t\t\t\t\t<button data-dojo-attach-event=\"onClick:_AddProjectButton\" data-dojo-type=\"dojox.form.BusyButton\" type=\"button\" data-dojo-attach-point=\"svl_project_add_ok\" >Add Project</button></td>\r\n\t\t\t</tr>\r\n\t\t</table></form>\r\n\t</div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" title=\"Add List to Existing Project\" data-dojo-attach-point=\"svl_list_proj_dlg\" style=\"display:none\">\r\n\t\t<form data-dojo-attach-point=\"svl_list_proj_dlg_form\" data-dojo-type=\"dijit.form.Form\" onsubmit=\"return false\">\r\n\t\t<table>\r\n\t\t\t<tr>\r\n\t\t\t\t<td><label >Projects</label></td>\r\n\t\t\t\t<td><div data-dojo-type=\"dijit.form.ComboBox\" data-dojo-attach-point=\"svl_list_proj_dlg_list\" labelAttr=\"projectname\" searchAttr=\"projectname\"  pageSize=\"10\" autoComplete=\"false\"></div></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td align=\"left\">\r\n\t\t\t\t\t<button data-dojo-attach-event=\"onClick:_CancelAddPrjDlg\" data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"svl_list_proj_dlg_cancel\" type=\"button\" >Cancel</button></td>\r\n\t\t\t\t<td align=\"right\">\r\n\t\t\t\t\t<button data-dojo-attach-event=\"onClick:_AddExistingToList\" data-dojo-type=\"dojox.form.BusyButton\" type=\"button\" data-dojo-attach-point=\"svl_list_proj_dlg_ok\" >Add List to Project</button></td>\r\n\t\t\t</tr>\r\n\t\t</table></form>\r\n\t</div>\r\n\t<div data-dojo-type=\"prmax.lists.NewListDlg\" data-dojo-attach-point=\"svl_list_new_dlg\" ></div>\r\n</div>\r\n",constructor:function(){this.layoutListList=[this.view1];this.listid=-1;this.projectid=-1;this.onLoadListCall=dojo.hitch(this,this.onLoadDisplayCtrl);this.onOpenListCallBack=dojo.hitch(this,this.onOpenListCall);this._DetailsCallBack=dojo.hitch(this,this.ListDetailsCallBack);this._OnAddProjectCallBack=dojo.hitch(this,this._AddProjectCall);this._OnAddListCallBack=dojo.hitch(this,this._AddListCall);this._styleCallBack=dojo.hitch(this,this._StyleCallBackFunc);this._OnEnableToolbarCallBack=dojo.hitch(this,this._SelectionChanged);this._OnDeleteListsCallBack=dojo.hitch(this,this._OnDeleteListsCall);this._OnAddProjectToListCallBack=dojo.hitch(this,this._OnAddProjectToListCall);this._OnDeleteProjectsCallBack=dojo.hitch(this,this._OnDeleteProjectsCall);this._getModelItemCall=dojo.hitch(this,this._getModelItem);this._OnRefreshListCallBack=dojo.hitch(this,this._OnRefreshListCall);dojo.subscribe(PRCOMMON.Events.List_Deleted,dojo.hitch(this,this._ListDeletedEvent));dojo.subscribe(PRCOMMON.Events.List_Add,dojo.hitch(this,this._ListAddEvent));this._store_loaded=false;this._client=new dojox.data.JsonRestStore({target:"/clients/rest_combo",idAttribute:"clientid"});},postCreate:function(){this.modelList=new prcommon.data.QueryWriteStore({url:"/lists/listall?listtypeid="+this.listtypeid,tableid:2,oncallback:dojo.hitch(this,this._SelectionChanged),onError:ttl.utilities.globalerrorchecker,oncallbackparams:dojo.hitch(this,this._getContext)});this.listGrid.set("structure",this.layoutListList);this.listGrid._setStore(this.modelList);this.baseonCellClick=this.listGrid.onCellClick;this.listGrid.onCellClick=dojo.hitch(this,this.onCellClick);this.listGrid.onCellDblClick=dojo.hitch(this,this._OnRowDblClick);this.filter_clientid.set("store",this._client);this.filter_clientid.set("value",-1);dojo.attr(this.client_filter_name,"innerHTML",PRMAX.utils.settings.client_name+"s");dojo.connect(this.svl_project_filter_dialog,"execute",dojo.hitch(this,this._ProjectFilter));dojo.connect(this.svl_project_add_form,"onSubmit",dojo.hitch(this,this._ProjectSubmit));dojo.connect(this.svl_list_add_form,"onSubmit",dojo.hitch(this,this._ListSubmit));dojo.connect(this.svl_list_proj_dlg_form,"onSubmit",dojo.hitch(this,this._AddProjectToListSubmit));dojo.connect(this.svl_reports_full,"onClick",dojo.hitch(this,this._ReportStart,1));dojo.connect(this.svl_reports_summary,"onClick",dojo.hitch(this,this._ReportStart,7));dojo.connect(this.svl_projects_listofprojects,"onchange",dojo.hitch(this,this._onChangedProjects));this._newlist_callback=dojo.hitch(this,this._newlistcall);this._EnableToolbar();if(PRMAX.utils.settings.productid==PRCOMMON.Constants.PRMAX_Pro){dojo.removeClass(this.svl_reports_full.domNode,"prmaxhidden");dojo.removeClass(this.menu_filter.domNode,"prmaxhidden");}if(this.delete_mode==false){dojo.style(this.svl_list_delete.domNode,"display","none");dojo.style(this.svl_delete.domNode,"display","none");}dojo.attr(this.displayNode,"innerHTML",this.display);this.inherited(arguments);},_getContext:function(){return {listtypeid:this.listtypeid};},_AddProjectButton:function(){this.svl_project_add_form.submit();},_AddExistingToList:function(){this.svl_list_proj_dlg_form.submit();},_ClearFilter:function(){this.refresh();},_ProjectFilter:function(){},_ReportStart:function(){dijit.byId("std_report_control").StartDialog({reportoutputtypeid:0,reporttemplateid:arguments[0]});},_DeleteProjectFromList:function(){var ar=Array();var _1=0;for(var c=0;c<this.svl_projects_listofprojects.options.length;c++){if(this.svl_projects_listofprojects.options[c].selected){ar[_1]=parseInt(this.svl_projects_listofprojects.options[c].value,10);++_1;}}dojo.xhrPost(ttl.utilities.makeParams({load:this._OnDeleteProjectsCallBack,url:"/lists/deletelistprojects",content:{projects:dojo.toJson(ar),listid:this.listid}}));},_OnDeleteProjectsCall:function(_2){if(_2.success=="OK"){for(var c=0;c<this.svl_projects_listofprojects.options.length;c++){if(this.svl_projects_listofprojects.options[c].selected){this.svl_projects_listofprojects.options[c]=null;--c;}}}},_onChangedProjects:function(){this.svl_projects_delete.set("disabled",this.svl_projects_listofprojects.options.length?false:true);},_EnableToolbar:function(){dojo.xhrPost(ttl.utilities.makeParams({load:this._OnEnableToolbarCallBack,url:"/lists/listmaintcount?listtypeid="+this.listtypeid}));},onCellClick:function(e){if(e.cellIndex>0){this.onSelectRow(e);}else{if(e.cellIndex==0){var _3=this.listGrid.getItem(e.rowIndex);this.modelList.setValue(_3,"selected",!_3.i.selected,true);}else{this.baseonCellClick(e);}}},_OnRowDblClick:function(e){this._row=this.listGrid.getItem(e.rowIndex);this.listid=this._row.i.listid;this._OpenLists(1,[this.listid,0]);},_AddProjectCall:function(_4){if(_4.success=="OK"){this.svl_projects_listofprojects.options[this.svl_projects_listofprojects.options.length]=new Option(_4.project.projectname,_4.project.projectid);this._CancelProjectDlg();}else{if(_4.success=="DU"){alert("Project Name Already Exists");this._ProjectDlgClear();this.svl_project_add_name.focus();}else{if(_4.success=="VF"){alert("Project Name: "+_4.error_message[0][1]);this.svl_project_add_ok.cancel();this.svl_project_add_name.focus();}else{if(_4.success=="FA"){alert("Problem Adding Project");this.svl_project_add_ok.cancel();this.svl_project_add_name.focus();}}}}},_AddProjectToList:function(){this.projectlistmodel=new prcommon.data.QueryWriteStore({url:"/lists/projectforlist?listid="+this.listid,onError:ttl.utilities.globalerrorchecker,nocallback:true});this.svl_list_proj_dlg_list.store=this.projectlistmodel;this._ProjectAddToDlgClear();this.svl_list_proj_dlg.show();},_getModelItemProject:function(){this.projectid=arguments[0].i.projectid;},_AddProjectToListSubmit:function(){this.projectid=-1;var _5={identity:this.svl_list_proj_dlg_list.value,onItem:dojo.hitch(this,this._getModelItemProject)};this.projectlistmodel.fetchItemByIdentity(_5);if(this.projectid!=-1){dojo.xhrPost(ttl.utilities.makeParams({load:this._OnAddProjectToListCallBack,url:"/lists/addprojecttolist",content:{listid:this.listid,projectid:this.projectid}}));}else{alert("No Valid Project Selected");this.svl_list_proj_dlg_ok.cancel();}},_OnAddProjectToListCall:function(_6){var _7=_6.project;if(_6.success=="OK"){this.svl_projects_listofprojects.options[this.svl_projects_listofprojects.options.length]=new Option(_7.projectname,_7.projectid);this.svl_list_proj_dlg.hide();}this.svl_list_proj_dlg_ok.cancel();},_CancelAddPrjDlg:function(){this.svl_list_proj_dlg.hide();this._ProjectAddToDlgClear();},_ProjectAddToDlgClear:function(){this.svl_list_proj_dlg_ok.cancel();this.svl_list_proj_dlg_list.set("value","");},_ProjectSubmit:function(){if(this.svl_project_add_form.isValid()===false){this.svl_project_add_ok.cancel();return false;}var _8=this.svl_project_add_form.getValues();_8["listid"]=this.listid;dojo.xhrPost(ttl.utilities.makeParams({load:this._OnAddProjectCallBack,url:"projects/addnewandtolist",content:_8}));return false;},_CancelProjectDlg:function(){this.svl_project_new_dlg.hide();this._ProjectDlgClear();},_ProjectDlgClear:function(){this.svl_project_add_ok.cancel();this.svl_project_add_name.set("value","");},_AddProject:function(){this.svl_project_new_dlg.show();},_ListSubmit:function(){if(this.svl_list_add_form.isValid()===false){this.svl_list_add_ok.cancel();return false;}var _9=this.svl_list_add_form.getValues();_9["listid"]=this.listid;dojo.xhrPost(ttl.utilities.makeParams({load:this._OnAddListCallBack,url:this._ListModeUrl(),content:_9}));return false;},_AddListCall:function(_a){if(_a.success=="OK"){if(this.list_mode===0||this.list_mode===2){_a.list.selected=false;_a.list.qty=0;var _b=this.modelList.newItem(_a.list);gHelper.AddRowToQueryWriteGrid(this.listGrid,_b);this.listGrid.selection.clear();this.listid=_b.i.listid;this.listGrid.update();}else{this.list=_a.list;_b={identity:_a.list.listid,onItem:dojo.hitch(this,this._getModelItem)};this.tmp_row=null;this.modelList.fetchItemByIdentity(_b);if(this.tmp_row){this.modelList.SetNoCallBackMode(true);this.modelList.setValue(this.tmp_row,"listname",_a.list.listname,true);this.modelList.setValue(this.tmp_row,"clientname",_a.list.clientname,true);this.modelList.SetNoCallBackMode(false);}}this._ShowHideDetails();this._ListDisplayBasicDetails(_a.list);}},_DeleteSingle:function(){if(confirm("Delete List ("+this.svl_name_field.innerHTML+")?")){dojo.xhrPost(ttl.utilities.makeParams({load:this._OnDeleteListsCallBack,url:"/lists/deletelist",content:{listid:this.listid}}));}},_Delete:function(){if(confirm("Delete Selected Lists")){dojo.xhrPost(ttl.utilities.makeParams({load:this._OnDeleteListsCallBack,url:"/lists/deleteselection",content:{listtypeid:1}}));}},_OnDeleteListsCall:function(_c){if(_c.success=="OK"){var _d=[this.listid];if(_c.lists!=null){_d=_c.lists;}this._EnableToolBarCall(false);dojo.publish(PRCOMMON.Events.List_Deleted,[_d]);this.listid=-1;this._ShowHideDetails();this.listGrid.selection.clear();}else{alert("Problem Deleting List");}},onOpenListCall:function(_e){dojo.publish(PRCOMMON.Events.SearchSession_Changed,[_e.data]);dijit.byId("std_banner_control").ShowResultList();},_OpenSingle:function(){this._OpenLists(1,[this.listid,0]);},_Open:function(){this._OpenLists(1,[-1,-1]);},_OpenLists:function(_f,_10){var _11={overwrite:_f,lists:dojo.toJson(_10),selected:-1,listtypeid:this.listtypeid};dojo.xhrPost(ttl.utilities.makeParams({load:this.onOpenListCallBack,url:"/lists/open",content:_11}));},_Rename:function(){this.list_mode=1;this.svl_list_new_dlg.show(this.list_mode,this.listid);this.svl_list_new_dlg.set("callback",this._newlist_callback);},_Duplicate:function(){this.list_mode=2;this.svl_list_new_dlg.show(this.list_mode,this.listid);this.svl_list_new_dlg.set("callback",this._newlist_callback);},_New:function(){this.list_mode=0;this.svl_list_new_dlg.show(this.list_mode,-1);this.svl_list_new_dlg.set("callback",this._newlist_callback);},_newlistcall:function(_12){this._AddListCall(_12);},refresh:function(){this.listid=-1;this._EnableSingleListControls(false);this.listGrid.selection.clear();this._ShowHideDetails();this.listGrid.showMessage(this.listGrid.loadingMessage);var _13=ttl.utilities.getPreventCache();if(this.projectid!=-1){_13["projectid"]=this.projectid;}this.listGrid.setQuery(_13);this._EnableToolbar();},view1:{cells:[[{name:" ",width:"15px",styles:"text-align: center;",width:"20px",field:"selected",formatter:ttl.utilities.formatButtonCell},{name:"Name",width:"auto",field:"listname"},{name:"Client Name",width:"200px",field:"clientname"},{name:"Qty",width:"50px",field:"qty"}]]},loadListDetails:function(_14){dojo.xhrPost(ttl.utilities.makeParams({load:this._DetailsCallBack,url:"lists/info",content:{listid:_14}}));},_EnableSingleListControls:function(_15){var _16=_15?false:true;this.svl_list_rename.set("disabled",_16);this.svl_list_delete.set("disabled",_16);this.svl_list_open.set("disabled",_16);this.svl_projects_add.set("disabled",_16);this.svl_projects_new.set("disabled",_16);},ListDetailsCallBack:function(_17){this._ShowHideDetails();this._EnableSingleListControls(true);this._ListDisplayBasicDetails(_17.list);for(var key in _17.projects){var _18=_17.projects[key];this.svl_projects_listofprojects.options[this.svl_projects_listofprojects.options.length]=new Option(_18.projectname,_18.projectid);}},_ListDisplayBasicDetails:function(_19){this._EnableSingleListControls(true);this.svl_name_field.innerHTML=_19.listname;this.svl_count_field.innerHTML=(_19.nbr)?_19.nbr.toString():"0";this.svl_list_delete.set("disabled",_19.emailtemplateid>0?true:false);this.svl_projects_listofprojects.options.length=0;this.svl_projects_delete.set("disabled",true);},onSelectRow:function(e){this._row=this.listGrid.getItem(e.rowIndex);this.listid=this._row.i.listid;this.loadListDetails(this.listid);this.listGrid.selection.clickSelectEvent(e);},onStyleRow:function(_1a){ttl.GridHelpers.onStyleRow(_1a);},_StyleCallBackFunc:function(_1b){return (_1b.i.listid==this.listid)?true:false;},_EnableToolBarCall:function(_1c){var _1d=_1c?false:true;this.svl_delete.set("disabled",_1d);this.svl_open.set("disabled",_1d);},_ShowHideDetails:function(){var _1e=this.listid==-1?"none":"block";if(this.listid==-1){dojo.addClass(this.list_info_pane.domNode,"prmaxhidden");if(PRMAX.utils.settings.productid==PRCOMMON.Constants.PRMAX_Pro){dojo.addClass(this.list_projects_pane.domNode,"prmaxhidden");}}else{dojo.removeClass(this.list_info_pane.domNode,"prmaxhidden");if(PRMAX.utils.settings.productid==PRCOMMON.Constants.PRMAX_Pro){dojo.removeClass(this.list_projects_pane.domNode,"prmaxhidden");}}},_SelectionChanged:function(_1f){this._EnableToolBarCall(_1f.data.selected>0?true:false);},resize:function(){this.borderCtrl.resize(arguments[0]);},_getModelItem:function(){if(arguments[0].i.i!=null){this.tmp_row=arguments[0].i;}else{this.tmp_row=arguments[0];}},_ListDeletedEvent:function(_20){for(var key in _20){this.tmp_row=null;var _21={identity:_20[key],onItem:this._getModelItemCall};this.modelList.fetchItemByIdentity(_21);if(this.tmp_row){this.modelList.deleteItem(this.tmp_row);}}},_ListAddEvent:function(_22){this.modelList.newItem(_22);},_OnRefreshListCall:function(_23){if(_23.success=="OK"){this._ListDisplayBasicDetails(_23.list);var _24={identity:_23.list.listid,onItem:dojo.hitch(this,this._getModelItem)};this.tmp_row=null;this.modelList.fetchItemByIdentity(_24);if(this.tmp_row){this.modelList.SetNoCallBackMode(true);this.modelList.setValue(this.tmp_row,"nbr_deleted",_23.list.nbr_deleted,true);this.modelList.SetNoCallBackMode(false);}alert("List Refreshed");}else{alert("Problem Refreshing List");}},_execute_filter:function(){var _25={};if(arguments[0].listnamefilter){_25["listname_filter"]=arguments[0].listnamefilter;}if(arguments[0].clientid!="-1"){_25["clientid"]=arguments[0].clientid;}this.listGrid.setQuery(_25);},_clear_filter:function(){this.listnamefilter.set("value","");this.clientid.set("value",-1);}});}