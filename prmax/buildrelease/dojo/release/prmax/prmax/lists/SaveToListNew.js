/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.lists.SaveToListNew"]){dojo._hasResource["prmax.lists.SaveToListNew"]=true;dojo.provide("prmax.lists.SaveToListNew");dojo.declare("prmax.lists.SaveToListNew",[ttl.BaseWidget],{selected:-1,widgetsInTemplate:true,templateString:"\t<div>\r\n\t\t<div  dojoAttachPoint=\"tabController\" dojotype=\"dijit.layout.TabContainer\" style=\"width:100%;height:100%;padding:0px;margin:0px\">\r\n\t\t\t<div dojoAttachPoint=\"savetolisttab\" dojoType=\"dijit.layout.ContentPane\" title=\"Save To Existing List\" style=\"width:100%;height:390px;padding:5px\">\r\n\t\t\t\t<br/>\r\n\t\t\t\t<form class=\"prmaxdefault\" dojoAttachPoint=\"saveform\" name=\"saveform\" onSubmit=\"return false;\" dojoType=\"dijit.form.Form\">\r\n\t\t\t\t\t<table width=\"99%\" class=\"prmaxtable\" cellspacing=\"4\" >\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" width=\"30%\" align=\"right\">Existing List</td>\r\n\t\t\t\t\t\t\t<td><div dojoType=\"dijit.form.FilteringSelect\"\r\n\t\t\t\t\t\t\t\t\tname=\"listid\"\r\n\t\t\t\t\t\t\t\t\tdojoAttachPoint=\"lists\"\r\n\t\t\t\t\t\t\t\t\trequired=\"true\"\r\n\t\t\t\t\t\t\t\t\tpageSize=\"20\"\r\n\t\t\t\t\t\t\t\t\tautoComplete=\"true\"\r\n\t\t\t\t\t\t\t\t\tlabelAttr=\"listname\"\r\n\t\t\t\t\t\t\t\t\tsearchAttr=\"listname\"\r\n\t\t\t\t\t\t\t\t\tpromptMessage=\"Please Select a list\"></div></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" valign=\"top\">Save from search</td><td><div name=\"selection\" dojoAttachPoint=\"source\" dojoType=\"prmax.common.SelectOptions\" ></div></td></tr>\r\n\t\t\t\t\t\t<tr><td class=\"prmaxrowtag\" align=\"right\" >List Options</td><td>\r\n\t\t\t\t\t\t\t<input dojoAttachPoint=\"override_button\" type=\"radio\" name=\"overwrite\" dojotype=\"dijit.form.RadioButton\" value=\"1\" /> <label dojoAttachPoint=\"label_overwrite\" class=\"prmaxlabeltag\" >Overwrite</label>\r\n\t\t\t\t\t\t\t<input dojoAttachPoint=\"append_button\" type=\"radio\" name=\"overwrite\" dojotype=\"dijit.form.RadioButton\" value=\"0\" checked =\"checked\"/> <label class=\"prmaxlabeltag\" dojoAttachPoint=\"label_append\" >Append</label>\r\n\t\t\t\t\t\t</td></tr>\r\n\t\t\t\t\t\t<tr><td colspan=\"3\" >&nbsp;</td></tr>\r\n\t\t\t\t\t\t<tr><td colspan=\"3\" align=\"center\" ><button class=\"prmaxbuttonlarge\" type=\"button\" dojoAttachEvent=\"onClick:_SaveList\" dojoAttachPoint=\"saveNode\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Saving...\" label=\"Save Results To Existing List\"></button></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t\t<div dojoType=\"dijit.layout.ContentPane\" title=\"Save To New List\" style=\"width:100%;height:385px;padding:5px\">\r\n\t\t\t\t<br/>\r\n\t\t\t\t<form dojoAttachPoint=\"addform\" name=\"addform\"  onSubmit=\"return false;\" dojoType=\"dijit.form.Form\">\r\n\t\t\t\t\t<table width=\"100%\" class=\"prmaxtable\" >\r\n\t\t\t\t\t\t<tr><td width=\"30%\" align=\"right\" class=\"prmaxrowtag\">New List Name</td><td ><input dojoType=\"dijit.form.ValidationTextBox\" name=\"listname\" dojoAttachPoint=\"listnamenew\" required=\"true\" promptMessage=\"Please Enter new list name\" trim=\"true\" maxlength=\"45\" ></td></tr>\r\n\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" >Client</td><td><select data-dojo-props='name:\"clientid\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clientid\" ></select></td></tr>\r\n\t\t\t\t\t\t<tr><td align=\"right\" class=\"prmaxrowtag\" valign=\"top\">Save from search</td><td><div name=\"selection\" dojoAttachPoint=\"source2\" dojoType=\"prmax.common.SelectOptions\" ></div></td></tr>\r\n\t\t\t\t\t\t<tr><td colspan=\"3\" >&nbsp;</td></tr>\r\n\t\t\t\t\t\t<tr><td colspan=\"3\" align=\"center\" ><button  type=\"button\" class=\"prmaxbuttonlarge\" dojoAttachEvent=\"onClick:_SaveNewList\" dojoAttachPoint=\"addNode\" dojoType=\"dojox.form.BusyButton\" busyLabel=\"Please Wait Saving...\" label=\"Save Results To New List\"></button></td></tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n",constructor:function(){this.store=new dojox.data.QueryReadStore({url:"/lists/lists?listtypeid=1",onError:ttl.utilities.globalerrorchecker});this._SavedListCall=dojo.hitch(this,this._SavedListed);this._SavedResultCall=dojo.hitch(this,this._SavedResult);this._clients=new dojox.data.JsonRestStore({target:"/clients/rest_combo",idAttribute:"id"});},_SaveList:function(){this.saveNode.focus();this.saveform.submit();},_SaveNewList:function(){this.addform.submit();},postCreate:function(){this.lists.store=this.store;dojo.connect(this.saveform,"onSubmit",dojo.hitch(this,this._SubmitList));dojo.connect(this.addform,"onSubmit",dojo.hitch(this,this._SubmitAdd));dojo.connect(this.addpane,"toggle",dojo.hitch(this,this._OpenSave));this.label_overwrite["for"]=this.override_button.id;this.label_append["for"]=this.append_button.id;dojo.subscribe(this.tabController.id+"-selectChild",dojo.hitch(this,this.onSelectTab));this.clientid.set("store",this._clients);this.clientid.set("value","-1");this.inherited(arguments);},startup:function(){this.source.setOptions(this.selected);this.source2.setOptions(this.selected);this.inherited(arguments);},onSelectTab:function(_1){if(_1.id==this.savetolisttab.id){this.lists.focus();}else{this.listnamenew.focus();}},_SubmitList:function(){if(ttl.utilities.formValidator(this.saveform)==false){alert("Not all required field filled in");this.saveNode.cancel();return;}dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedResultCall,url:"/lists/savetolist",content:this.saveform.get("value")}));},_SavedResult:function(_2){if(_2.success=="OK"){alert("Result Saved to List");PRMAX.search.closeStdDialog();}else{alert("Problem with List");this.lists.focus();}this.saveNode.cancel();},_SubmitAdd:function(){if(ttl.utilities.formValidator(this.addform)==false){alert("Not all required field filled in");this.addNode.cancel();return;}dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedListCall,url:"/lists/addsavetolist",content:this.addform.get("value")}));},_SavedListed:function(_3){if(_3.success=="OK"){alert("Result Saved to List New List");PRMAX.search.closeStdDialog();}else{if(_3.success=="DU"){alert("List Name Already Exists");this.listnamenew.focus();}else{if(_3.success=="VF"){alert("List Name: "+_3.error_message[0][1]);this.listnamenew.focus();}else{alert("Problem with List");this.listnamenew.focus();}}}this.addNode.cancel();},_OpenSave:function(){if(this.addpane.get("open")){this.listnamenew.focus();}},destroy:function(){this.inherited(arguments);delete this.store;},resize:function(){this.tabController.resize({h:435,width:400});}});}