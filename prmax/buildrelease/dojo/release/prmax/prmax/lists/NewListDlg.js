/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["prmax.lists.NewListDlg"]){dojo._hasResource["prmax.lists.NewListDlg"]=true;dojo.provide("prmax.lists.NewListDlg");dojo.declare("prmax.lists.NewListDlg",[ttl.BaseWidget],{selected:-1,widgetsInTemplate:true,templateString:"<div>\r\n\t<div data-dojo-type=\"dijit.Dialog\" data-dojo-props='title:\"Enter New List Name\", style:\"width:400px;height:200px\"' data-dojo-attach-point=\"dlg\">\r\n\t\t<br/>\r\n\t\t<form data-dojo-attach-point=\"form\" data-dojo-type=\"dijit.form.Form\" data-dojo-props='\"class\":\"prmaxdefault\",onsubmit:\"return false\"'>\r\n\t\t\t<table class=\"prmaxtable\" width=\"100%\" >\r\n\t\t\t\t<tr><td width=\"100px\" align=\"right\" class=\"prmaxlabeltag\" >Name</label></td><td><input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"listname\" data-dojo-props='name:\"listname\", required:true, trim:true, maxlength:45, promptMessage:\"Enter new list name\", type:\"text\"'  ></td></tr>\r\n\t\t\t\t<tr><td align=\"right\" class=\"prmaxlabeltag\" >Client</td><td><select data-dojo-props='name:\"clientid\",autoComplete:true,searchAttr:\"clientname\",labelType:\"html\"' data-dojo-type=\"dijit.form.FilteringSelect\" data-dojo-attach-point=\"clientid\" ></select></td></tr>\r\n\t\t\t\t<tr><td><br/></td></tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td align=\"left\"><button data-dojo-props='\"class\":\"prmaxbutton\",type:\"button\", label:\"Cancel\"' data-dojo-type=\"dijit.form.Button\" data-dojo-attach-event=\"onClick:_Cancel\" ></button></td>\r\n\t\t\t\t\t<td align=\"right\"><button data-dojo-attach-event=\"onClick:_Save\" data-dojo-attach-point=\"saveNode\" data-dojo-type=\"dojox.form.BusyButton\" data-dojo-props='\"class\":\"prmaxbutton\",busyLabel:\"Please Wait Saving...\",label:\"Save\"'></td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t</form>\r\n\t</div>\r\n</div>\r\n",constructor:function(){this.callback=null;this._listid=-1;this._SavedCall=dojo.hitch(this,this._Saved);this._load_call_back=dojo.hitch(this,this._load_call);this._clients=new dojox.data.JsonRestStore({target:"/clients/rest_combo",idAttribute:"id"});},postCreate:function(){this.clientid.set("store",this._clients);this.clientid.set("value","-1");},_setCallbackAttr:function(_1){this.callback=_1;},_Save:function(){this._SubmitAdd();},_Cancel:function(){this.dlg.hide();this._Clear();},_Clear:function(){this.listname.set("value","");this.clientid.set("value","-1");this._listid=-1;},_SubmitAdd:function(){if(ttl.utilities.formValidator(this.form)==false){alert("Not all required field filled in");this.saveNode.cancel();return;}var _2=this.form.getValues();if(this._listid!=-1){_2["listid"]=this._listid;}dojo.xhrPost(ttl.utilities.makeParams({load:this._SavedCall,url:this._ListModeUrl(),content:_2}));},_Saved:function(_3){if(_3.success=="OK"){if(this.callback!=null){this.callback(_3);this.hide();this._Clear();}}else{if(_3.success=="DU"){alert("List Name Already Exists");this.listname.focus();}else{if(_3.success=="VF"){alert("List Name: "+_3.error_message[0][1]);this.listname.focus();}else{alert("Problem with List");this.listname.focus();}}}this.saveNode.cancel();},destroy:function(){this.inherited(arguments);},_load_call:function(_4){if(_4.success=="OK"){this.listname.set("value",_4.list.listname);this.clientid.set("value",_4.list.clientid);this.dlg.show();}},show:function(_5,_6){this._listid=_6;this.list_mode=_5;this._ListSetModeButton();this.saveNode.cancel();if(_5!=1&&_5!=2){this.dlg.show();}else{dojo.xhrPost(ttl.utilities.makeParams({load:this._load_call_back,url:"/lists/info",content:{listid:_6}}));}},_ListSetModeButton:function(){var _7="Enter New List Name";if(this.list_mode==1){_7="Enter Replacement list Name";}if(this.list_mode==2){_7="Enter Duplicate List Name";}this.dlg.set("title",_7);},_ListModeUrl:function(){var _8="/lists/addnew";if(this.list_mode==1){_8="/lists/rename";}if(this.list_mode==2){_8="/lists/duplicate";}return _8;},hide:function(){this.dlg.hide();this.saveNode.cancel();}});}